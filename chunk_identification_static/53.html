<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>53</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    53
                    <a href="52.html">prev</a>
                    <a href="54.html">next</a>
                    <a href="53_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_ce886921a652b2ea1ded6e36a0748360e01c007f_app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ce886921a652b2ea1ded6e36a0748360e01c007f:app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ce886921a652b2ea1ded6e36a0748360e01c007f^1:app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ce886921a652b2ea1ded6e36a0748360e01c007f^2:app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;84ce7e06974326b39f68f3f23fd64570bcdb9bdc:app/src/main/java/com/arialyy/simple/download/SingleTaskActivity.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 
  17 package com.arialyy.simple.download;
  18 
  19 import android.content.BroadcastReceiver;
  20 import android.content.Context;
  21 import android.content.Intent;
  22 import android.os.Bundle;
  23 import android.os.Environment;
  24 import android.os.Handler;
  25 import android.os.Message;
  26 import android.support.v7.widget.Toolbar;
  27 import android.util.Log;
  28 import android.view.Menu;
  29 import android.view.MenuItem;
  30 import android.view.View;
  31 import android.widget.Button;
  32 import android.widget.RadioGroup;
  33 import android.widget.TextView;
  34 import android.widget.Toast;
  35 import butterknife.Bind;
  36 import com.arialyy.annotations.Download;
  37 import com.arialyy.aria.core.download.DownloadTarget;
  38 import com.arialyy.aria.core.Aria;
  39 import com.arialyy.aria.core.download.DownloadEntity;
  40 import com.arialyy.aria.core.download.DownloadTask;
  41 import com.arialyy.aria.core.inf.IEntity;
  42 import com.arialyy.aria.util.CommonUtil;
  43 import com.arialyy.frame.util.FileUtil;
  44 import com.arialyy.frame.util.show.L;
  45 import com.arialyy.frame.util.show.T;
  46 import com.arialyy.simple.R;
  47 import com.arialyy.simple.base.BaseActivity;
  48 import com.arialyy.simple.databinding.ActivitySingleBinding;
  49 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  50 import java.io.File;
  51 
  52 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53   public static final int DOWNLOAD_PRE = 0x01;
  54   public static final int DOWNLOAD_STOP = 0x02;
  55   public static final int DOWNLOAD_FAILE = 0x03;
  56   public static final int DOWNLOAD_CANCEL = 0x04;
  57   public static final int DOWNLOAD_RESUME = 0x05;
  58   public static final int DOWNLOAD_COMPLETE = 0x06;
  59   public static final int DOWNLOAD_RUNNING = 0x07;
  60   public static final int DOWNLOAD_START = 0x08;
  61 
  62   private static final String DOWNLOAD_URL =
  63       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
  65       &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;
  66       //&quot;http://down2.xiaoshuofuwuqi.com/d/file/filetxt/20170608/14/%BA%DA%CE%D7%CA%A6%E1%C8%C6%F0.txt&quot;;
  67       //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;
  68 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69   //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
  70 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71   &quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
  72 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73       &quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
  74 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  75   //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;
<abbr title="  76   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  76   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/üîµ</abbr>
  77   //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  78   //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  79   //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  80   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  81   @Bind(R.id.start) Button mStart;
  82   @Bind(R.id.stop) Button mStop;
  83   @Bind(R.id.cancel) Button mCancel;
  84   @Bind(R.id.size) TextView mSize;
  85   @Bind(R.id.speed) TextView mSpeed;
  86   @Bind(R.id.speeds) RadioGroup mRg;
  87 
  88   private Handler mUpdateHandler = new Handler() {
  89     @Override public void handleMessage(Message msg) {
  90       super.handleMessage(msg);
  91       switch (msg.what) {
  92         case DOWNLOAD_RUNNING:
  93           DownloadTask task = (DownloadTask) msg.obj;
  94           long current = task.getCurrentProgress();
  95           long len = task.getFileSize();
  96           if (len == 0) {
  97             mPb.setProgress(0);
  98           } else {
  99             mPb.setProgress((int) ((current * 100) / len));
 100           }
 101           mSpeed.setText(task.getConvertSpeed());
 102           break;
 103         case DOWNLOAD_PRE:
 104           setBtState(false);
 105           break;
 106         case DOWNLOAD_START:
 107           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 108           break;
 109         case DOWNLOAD_FAILE:
 110           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 111           setBtState(true);
 112           break;
 113         case DOWNLOAD_STOP:
 114           Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 115           mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 116           setBtState(true);
 117           break;
 118         case DOWNLOAD_CANCEL:
 119           mPb.setProgress(0);
 120           Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 121           mStart.setText(&quot;ÂºÄÂßã&quot;);
 122           setBtState(true);
 123           break;
 124         case DOWNLOAD_RESUME:
 125           mStart.setText(&quot;ÊöÇÂÅú&quot;);
 126           setBtState(false);
 127           break;
 128         case DOWNLOAD_COMPLETE:
 129           mPb.setProgress(100);
 130           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 131           mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 132           mCancel.setEnabled(false);
 133           setBtState(true);
 134           break;
 135       }
 136     }
 137   };
 138 
 139   @Override protected void onCreate(Bundle savedInstanceState) {
 140     super.onCreate(savedInstanceState);
 141     Aria.download(this).register();
 142   }
 143 
 144   /**
 145    * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 146    */
 147   private void setBtState(boolean state) {
 148     mStart.setEnabled(state);
 149     mStop.setEnabled(!state);
 150   }
 151 
 152   @Override public boolean onCreateOptionsMenu(Menu menu) {
 153     getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 154     return super.onCreateOptionsMenu(menu);
 155   }
 156 
 157   @Override public boolean onMenuItemClick(MenuItem item) {
 158     double speed = -1;
 159     String msg = &quot;&quot;;
 160     switch (item.getItemId()) {
 161       case R.id.help:
 162         msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;
 163             + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•Âú®Ê≥®Ëß£‰∏≠Â¢ûÂä†ÈìæÊé•ÔºåÁî®‰∫éÊåáÂÆöË¢´Ê≥®Ëß£ÁöÑÊñπÊ≥ïÂè™ËÉΩË¢´ÁâπÂÆöÁöÑ‰∏ãËΩΩ‰ªªÂä°ÂõûË∞ÉÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;
 164             + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;
 165             + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;
 166         showMsgDialog(&quot;tip&quot;, msg);
 167         break;
 168       case R.id.speed_0:
 169         speed = 0.0;
 170         break;
 171       case R.id.speed_128:
 172         speed = 128.0;
 173         break;
 174       case R.id.speed_256:
 175         speed = 256.0;
 176         break;
 177       case R.id.speed_512:
 178         speed = 512.0;
 179         break;
 180       case R.id.speed_1m:
 181         speed = 1024.0;
 182         break;
 183     }
 184     if (speed &gt; -1) {
 185       msg = item.getTitle().toString();
 186       Aria.download(this).setMaxSpeed(speed);
 187       T.showShort(this, msg);
 188     }
 189     return true;
 190   }
 191 
 192   @Download.onPre(DOWNLOAD_URL) protected void onPre(DownloadTask task) {
 193     mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 194         .sendToTarget();
 195   }
 196 
 197   @Download.onTaskStart(DOWNLOAD_URL) void taskStart(DownloadTask task) {
 198     mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 199         .sendToTarget();
 200   }
 201 
 202   @Download.onTaskRunning(DOWNLOAD_URL) protected void running(DownloadTask task) {
 203     mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 204   }
 205 
 206   @Download.onTaskResume(DOWNLOAD_URL) void taskResume(DownloadTask task) {
 207     mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 208   }
 209 
 210   @Download.onTaskStop(DOWNLOAD_URL) void taskStop(DownloadTask task) {
 211     mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 212     L.d(TAG, &quot;task__stop&quot;);
 213   }
 214 
 215   @Download.onTaskCancel(DOWNLOAD_URL) void taskCancel(DownloadTask task) {
 216     mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 217     L.d(TAG, &quot;task__cancel&quot;);
 218     //Aria.download(this)
 219     //    .load(DOWNLOAD_URL)
 220     //    .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 221     //    .add();
 222   }
 223 
 224   @Download.onTaskFail(DOWNLOAD_URL) void taskFail(DownloadTask task) {
 225     L.d(TAG, &quot;task__fail&quot;);
 226     mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 227   }
 228 
 229   @Download.onTaskComplete(DOWNLOAD_URL) void taskComplete(DownloadTask task) {
 230     mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 231   }
 232 
 233   @Download.onNoSupportBreakPoint(DOWNLOAD_URL)
 234   public void onNoSupportBreakPoint(DownloadTask task) {
 235     T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 236   }
 237 
 238   @Override protected int setLayoutId() {
 239     return R.layout.activity_single;
 240   }
 241 
 242   @Override protected void init(Bundle savedInstanceState) {
 243     super.init(savedInstanceState);
 244     setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 245     DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 246     mPb.setProgress(target.getPercent());
 247     if (target.getTaskState() == IEntity.STATE_STOP) {
 248       mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 249       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 250       setBtState(true);
 251     } else if (target.isDownloading()) {
 252       setBtState(false);
 253     }
 254     mSize.setText(target.getConvertFileSize());
 255   }
 256 
 257   public void onClick(View view) {
 258     switch (view.getId()) {
 259       case R.id.start:
 260         String text = ((TextView) view).getText().toString();
 261         if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 262           Aria.download(this)
 263               .load(DOWNLOAD_URL)
 264               .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 265               .start();
 266         } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 267           Aria.download(this).load(DOWNLOAD_URL).resume();
 268         }
 269         //DownloadTarget target = Aria.download(this)
 270         //    .load(DOWNLOAD_URL)
 271         //    .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;);
 272         //target.add();
 273         //target.cancel();
 274         break;
 275       case R.id.stop:
 276         Aria.download(this).load(DOWNLOAD_URL).pause();
 277         break;
 278       case R.id.cancel:
 279         Aria.download(this).load(DOWNLOAD_URL).cancel();
 280         break;
 281     }
 282   }
 283 }
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 
  17 package com.arialyy.simple.download;
  18 
  19 import android.content.BroadcastReceiver;
  20 import android.content.Context;
  21 import android.content.Intent;
  22 import android.os.Bundle;
  23 import android.os.Environment;
  24 import android.os.Handler;
  25 import android.os.Message;
  26 import android.support.v7.widget.Toolbar;
  27 import android.util.Log;
  28 import android.view.Menu;
  29 import android.view.MenuItem;
  30 import android.view.View;
  31 import android.widget.Button;
  32 import android.widget.RadioGroup;
  33 import android.widget.TextView;
  34 import android.widget.Toast;
  35 import butterknife.Bind;
  36 import com.arialyy.annotations.Download;
  37 import com.arialyy.aria.core.download.DownloadTarget;
  38 import com.arialyy.aria.core.Aria;
  39 import com.arialyy.aria.core.download.DownloadEntity;
  40 import com.arialyy.aria.core.download.DownloadTask;
  41 import com.arialyy.aria.core.inf.IEntity;
  42 import com.arialyy.aria.util.CommonUtil;
  43 import com.arialyy.frame.util.FileUtil;
  44 import com.arialyy.frame.util.show.L;
  45 import com.arialyy.frame.util.show.T;
  46 import com.arialyy.simple.R;
  47 import com.arialyy.simple.base.BaseActivity;
  48 import com.arialyy.simple.databinding.ActivitySingleBinding;
  49 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  50 import java.io.File;
  51 
  52 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53   public static final int DOWNLOAD_PRE = 0x01;
  54   public static final int DOWNLOAD_STOP = 0x02;
  55   public static final int DOWNLOAD_FAILE = 0x03;
  56   public static final int DOWNLOAD_CANCEL = 0x04;
  57   public static final int DOWNLOAD_RESUME = 0x05;
  58   public static final int DOWNLOAD_COMPLETE = 0x06;
  59   public static final int DOWNLOAD_RUNNING = 0x07;
  60   public static final int DOWNLOAD_START = 0x08;
  61 
  62   private static final String DOWNLOAD_URL =
  63       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
  65       &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;
  66       //&quot;http://down2.xiaoshuofuwuqi.com/d/file/filetxt/20170608/14/%BA%DA%CE%D7%CA%A6%E1%C8%C6%F0.txt&quot;;
  67       //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;
  68   //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;
  69   //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;
<abbr title="  70   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  70   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/üîµ</abbr>
  71   //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  72   //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  73   //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  74   @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  75   @Bind(R.id.start) Button mStart;
  76   @Bind(R.id.stop) Button mStop;
  77   @Bind(R.id.cancel) Button mCancel;
  78   @Bind(R.id.size) TextView mSize;
  79   @Bind(R.id.speed) TextView mSpeed;
  80   @Bind(R.id.speeds) RadioGroup mRg;
  81 
  82   private Handler mUpdateHandler = new Handler() {
  83     @Override public void handleMessage(Message msg) {
  84       super.handleMessage(msg);
  85       switch (msg.what) {
  86         case DOWNLOAD_RUNNING:
  87           DownloadTask task = (DownloadTask) msg.obj;
  88           long current = task.getCurrentProgress();
  89           long len = task.getFileSize();
  90           if (len == 0) {
  91             mPb.setProgress(0);
  92           } else {
  93             mPb.setProgress((int) ((current * 100) / len));
  94           }
  95           mSpeed.setText(task.getConvertSpeed());
  96           break;
  97         case DOWNLOAD_PRE:
  98           setBtState(false);
  99           break;
 100         case DOWNLOAD_START:
 101           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 102           break;
 103         case DOWNLOAD_FAILE:
 104           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 105           setBtState(true);
 106           break;
 107         case DOWNLOAD_STOP:
 108           Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 109           mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 110           setBtState(true);
 111           break;
 112         case DOWNLOAD_CANCEL:
 113           mPb.setProgress(0);
 114           Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 115           mStart.setText(&quot;ÂºÄÂßã&quot;);
 116           setBtState(true);
 117           break;
 118         case DOWNLOAD_RESUME:
 119           mStart.setText(&quot;ÊöÇÂÅú&quot;);
 120           setBtState(false);
 121           break;
 122         case DOWNLOAD_COMPLETE:
 123           mPb.setProgress(100);
 124           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 125           mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 126           mCancel.setEnabled(false);
 127           setBtState(true);
 128           break;
 129       }
 130     }
 131   };
 132 
 133   @Override protected void onCreate(Bundle savedInstanceState) {
 134     super.onCreate(savedInstanceState);
 135     Aria.download(this).register();
 136   }
 137 
 138   /**
 139    * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 140    */
 141   private void setBtState(boolean state) {
 142     mStart.setEnabled(state);
 143     mStop.setEnabled(!state);
 144   }
 145 
 146   @Override public boolean onCreateOptionsMenu(Menu menu) {
 147     getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 148     return super.onCreateOptionsMenu(menu);
 149   }
 150 
 151   @Override public boolean onMenuItemClick(MenuItem item) {
 152     double speed = -1;
 153     String msg = &quot;&quot;;
 154     switch (item.getItemId()) {
 155       case R.id.help:
 156         msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;
 157             + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•Âú®Ê≥®Ëß£‰∏≠Â¢ûÂä†ÈìæÊé•ÔºåÁî®‰∫éÊåáÂÆöË¢´Ê≥®Ëß£ÁöÑÊñπÊ≥ïÂè™ËÉΩË¢´ÁâπÂÆöÁöÑ‰∏ãËΩΩ‰ªªÂä°ÂõûË∞ÉÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;
 158             + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;
 159             + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;
 160         showMsgDialog(&quot;tip&quot;, msg);
 161         break;
 162       case R.id.speed_0:
 163         speed = 0.0;
 164         break;
 165       case R.id.speed_128:
 166         speed = 128.0;
 167         break;
 168       case R.id.speed_256:
 169         speed = 256.0;
 170         break;
 171       case R.id.speed_512:
 172         speed = 512.0;
 173         break;
 174       case R.id.speed_1m:
 175         speed = 1024.0;
 176         break;
 177     }
 178     if (speed &gt; -1) {
 179       msg = item.getTitle().toString();
 180       Aria.download(this).setMaxSpeed(speed);
 181       T.showShort(this, msg);
 182     }
 183     return true;
 184   }
 185 
 186   @Download.onPre(DOWNLOAD_URL) protected void onPre(DownloadTask task) {
 187     mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 188         .sendToTarget();
 189   }
 190 
 191   @Download.onTaskStart(DOWNLOAD_URL) void taskStart(DownloadTask task) {
 192     mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 193         .sendToTarget();
 194   }
 195 
 196   @Download.onTaskRunning(DOWNLOAD_URL) protected void running(DownloadTask task) {
 197     mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 198   }
 199 
 200   @Download.onTaskResume(DOWNLOAD_URL) void taskResume(DownloadTask task) {
 201     mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 202   }
 203 
 204   @Download.onTaskStop(DOWNLOAD_URL) void taskStop(DownloadTask task) {
 205     mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 206     L.d(TAG, &quot;task__stop&quot;);
 207   }
 208 
 209   @Download.onTaskCancel(DOWNLOAD_URL) void taskCancel(DownloadTask task) {
 210     mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 211     L.d(TAG, &quot;task__cancel&quot;);
 212     //Aria.download(this)
 213     //    .load(DOWNLOAD_URL)
 214     //    .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 215     //    .add();
 216   }
 217 
 218   @Download.onTaskFail(DOWNLOAD_URL) void taskFail(DownloadTask task) {
 219     L.d(TAG, &quot;task__fail&quot;);
 220     mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 221   }
 222 
 223   @Download.onTaskComplete(DOWNLOAD_URL) void taskComplete(DownloadTask task) {
 224     mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 225   }
 226 
 227   @Download.onNoSupportBreakPoint(DOWNLOAD_URL)
 228   public void onNoSupportBreakPoint(DownloadTask task) {
 229     T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 230   }
 231 
 232   @Override protected int setLayoutId() {
 233     return R.layout.activity_single;
 234   }
 235 
 236   @Override protected void init(Bundle savedInstanceState) {
 237     super.init(savedInstanceState);
 238     setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 239     DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 240     mPb.setProgress(target.getPercent());
 241     if (target.getTaskState() == IEntity.STATE_STOP) {
 242       mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 243       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 244       setBtState(true);
 245     } else if (target.isDownloading()) {
 246       setBtState(false);
 247     }
 248     mSize.setText(target.getConvertFileSize());
 249   }
 250 
 251   public void onClick(View view) {
 252     switch (view.getId()) {
 253       case R.id.start:
 254         String text = ((TextView) view).getText().toString();
 255         if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 256           Aria.download(this)
 257               .load(DOWNLOAD_URL)
 258               .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 259               .start();
 260         } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 261           Aria.download(this).load(DOWNLOAD_URL).resume();
 262         }
 263         //DownloadTarget target = Aria.download(this)
 264         //    .load(DOWNLOAD_URL)
 265         //    .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;);
 266         //target.add();
 267         //target.cancel();
 268         break;
 269       case R.id.stop:
 270         Aria.download(this).load(DOWNLOAD_URL).pause();
 271         break;
 272       case R.id.cancel:
 273         Aria.download(this).load(DOWNLOAD_URL).cancel();
 274         break;
 275     }
 276   }
 277 }
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.simple.download;
  17 
  18 import android.content.BroadcastReceiver;
  19 import android.content.Context;
  20 import android.content.Intent;
  21 import android.os.Bundle;
  22 import android.os.Environment;
  23 import android.os.Handler;
  24 import android.os.Message;
  25 import android.support.v7.widget.Toolbar;
  26 import android.util.Log;
  27 import android.view.Menu;
  28 import android.view.MenuItem;
  29 import android.view.View;
  30 import android.widget.Button;
  31 import android.widget.RadioGroup;
  32 import android.widget.TextView;
  33 import android.widget.Toast;
  34 import butterknife.Bind;
  35 import com.arialyy.annotations.Download;
  36 import com.arialyy.aria.core.Aria;
  37 import com.arialyy.aria.core.download.DownloadEntity;
  38 import com.arialyy.aria.core.download.DownloadTarget;
  39 import com.arialyy.aria.core.download.DownloadTask;
  40 import com.arialyy.aria.core.inf.IEntity;
  41 import com.arialyy.aria.util.CommonUtil;
  42 import com.arialyy.frame.util.FileUtil;
  43 import com.arialyy.frame.util.show.L;
  44 import com.arialyy.frame.util.show.T;
  45 import com.arialyy.simple.R;
  46 import com.arialyy.simple.base.BaseActivity;
  47 import com.arialyy.simple.databinding.ActivitySingleBinding;
  48 import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  49 import java.io.File;
  50 
  51 
  52 public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53   public static final int DOWNLOAD_PRE = 0x01;
  54 
  55   public static final int DOWNLOAD_STOP = 0x02;
  56 
  57   public static final int DOWNLOAD_FAILE = 0x03;
  58 
  59   public static final int DOWNLOAD_CANCEL = 0x04;
  60 
  61   public static final int DOWNLOAD_RESUME = 0x05;
  62 
  63   public static final int DOWNLOAD_COMPLETE = 0x06;
  64 
  65   public static final int DOWNLOAD_RUNNING = 0x07;
  66 
  67   public static final int DOWNLOAD_START = 0x08;
  68 
  69       //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  70       //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
<abbr title="  71   private static final String DOWNLOAD_URL = &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;">  71   private static final String DOWNLOAD_URL = &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2üîµ</abbr>
  72 
  73       //&quot;http://down2.xiaoshuofuwuqi.com/d/file/filetxt/20170608/14/%BA%DA%CE%D7%CA%A6%E1%C8%C6%F0.txt&quot;;
  74       //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;
  75   //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;
  76   //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;
<abbr title="  77   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  77   //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/üîµ</abbr>
  78   //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  79   //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  80   //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  81   @Bind(R.id.progressBar)
  82   HorizontalProgressBarWithNumber mPb;
  83 
  84   @Bind(R.id.start) Button mStart;
  85 
  86   @Bind(R.id.stop) Button mStop;
  87 
  88   @Bind(R.id.cancel) Button mCancel;
  89 
  90   @Bind(R.id.size) TextView mSize;
  91 
  92   @Bind(R.id.speed) TextView mSpeed;
  93 
  94   @Bind(R.id.speeds) RadioGroup mRg;
  95 
  96   private Handler mUpdateHandler = new Handler() {
  97     @Override public void handleMessage(Message msg) {
  98       super.handleMessage(msg);
  99       switch (msg.what) {
 100         case DOWNLOAD_RUNNING:
 101           DownloadTask task = (DownloadTask) msg.obj;
 102           long current = task.getCurrentProgress();
 103           long len = task.getFileSize();
 104           if (len == 0) {
 105             mPb.setProgress(0);
 106           } else {
 107             mPb.setProgress((int) ((current * 100) / len));
 108           }
 109           mSpeed.setText(task.getConvertSpeed());
 110           break;
 111         case DOWNLOAD_PRE:
 112           setBtState(false);
 113           break;
 114         case DOWNLOAD_START:
 115           mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 116           break;
 117         case DOWNLOAD_FAILE:
 118           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 119           setBtState(true);
 120           break;
 121         case DOWNLOAD_STOP:
 122           Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 123           mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 124           setBtState(true);
 125           break;
 126         case DOWNLOAD_CANCEL:
 127           mPb.setProgress(0);
 128           Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 129           mStart.setText(&quot;ÂºÄÂßã&quot;);
 130           setBtState(true);
 131           break;
 132         case DOWNLOAD_RESUME:
 133           mStart.setText(&quot;ÊöÇÂÅú&quot;);
 134           setBtState(false);
 135           break;
 136         case DOWNLOAD_COMPLETE:
 137           mPb.setProgress(100);
 138           Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 139           mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 140           mCancel.setEnabled(false);
 141           setBtState(true);
 142           break;
 143       }
 144     }
 145   };
 146 
 147   @Override protected void onCreate(Bundle savedInstanceState) {
 148     super.onCreate(savedInstanceState);
 149     Aria.download(this).register();
 150   }
 151 
 152   /**
 153    * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 154    */
 155   private void setBtState(boolean state) {
 156     mStart.setEnabled(state);
 157     mStop.setEnabled(!state);
 158   }
 159 
 160   @Override public boolean onCreateOptionsMenu(Menu menu) {
 161     getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 162     return super.onCreateOptionsMenu(menu);
 163   }
 164 
 165   @Override public boolean onMenuItemClick(MenuItem item) {
 166     double speed = -1;
 167     String msg = &quot;&quot;;
 168     switch (item.getItemId()) {
 169       case R.id.help:
 170         msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;
 171             + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•Âú®Ê≥®Ëß£‰∏≠Â¢ûÂä†ÈìæÊé•ÔºåÁî®‰∫éÊåáÂÆöË¢´Ê≥®Ëß£ÁöÑÊñπÊ≥ïÂè™ËÉΩË¢´ÁâπÂÆöÁöÑ‰∏ãËΩΩ‰ªªÂä°ÂõûË∞ÉÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;
 172             + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;
 173             + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;
 174         showMsgDialog(&quot;tip&quot;, msg);
 175         break;
 176       case R.id.speed_0:
 177         speed = 0.0;
 178         break;
 179       case R.id.speed_128:
 180         speed = 128.0;
 181         break;
 182       case R.id.speed_256:
 183         speed = 256.0;
 184         break;
 185       case R.id.speed_512:
 186         speed = 512.0;
 187         break;
 188       case R.id.speed_1m:
 189         speed = 1024.0;
 190         break;
 191     }
 192     if (speed &gt; -1) {
 193       msg = item.getTitle().toString();
 194       Aria.download(this).setMaxSpeed(speed);
 195       T.showShort(this, msg);
 196     }
 197     return true;
 198   }
 199 
 200   @Download.onPre(DOWNLOAD_URL) protected void onPre(DownloadTask task) {
 201     mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 202         .sendToTarget();
 203   }
 204 
 205   @Download.onTaskStart(DOWNLOAD_URL) void taskStart(DownloadTask task) {
 206     mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 207         .sendToTarget();
 208   }
 209 
 210   @Download.onTaskRunning(DOWNLOAD_URL) protected void running(DownloadTask task) {
 211     mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 212   }
 213 
 214   @Download.onTaskResume(DOWNLOAD_URL) void taskResume(DownloadTask task) {
 215     mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 216   }
 217 
 218   @Download.onTaskStop(DOWNLOAD_URL) void taskStop(DownloadTask task) {
 219     mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 220     L.d(TAG, &quot;task__stop&quot;);
 221   }
 222 
 223   @Download.onTaskCancel(DOWNLOAD_URL)
 224   void taskCancel(DownloadTask task) {
 225     mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 226     L.d(TAG, &quot;task__cancel&quot;);
 227     //Aria.download(this)
 228     //    .load(DOWNLOAD_URL)
 229     //    .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 230     //    .add();
 231   }
 232 
 233   @Download.onTaskFail(DOWNLOAD_URL) void taskFail(DownloadTask task) {
 234     L.d(TAG, &quot;task__fail&quot;);
 235     mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 236   }
 237 
 238   @Download.onTaskComplete(DOWNLOAD_URL) void taskComplete(DownloadTask task) {
 239     mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 240   }
 241 
 242   @Download.onNoSupportBreakPoint(DOWNLOAD_URL)
 243   public void onNoSupportBreakPoint(DownloadTask task) {
 244     T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 245   }
 246 
 247   @Override protected int setLayoutId() {
 248     return R.layout.activity_single;
 249   }
 250 
 251   @Override
 252   protected void init(Bundle savedInstanceState) {
 253     super.init(savedInstanceState);
 254     setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 255     DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 256     mPb.setProgress(target.getPercent());
 257     if (target.getTaskState() == IEntity.STATE_STOP) {
 258       mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 259       mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 260       setBtState(true);
 261     } else if (target.isDownloading()) {
 262       setBtState(false);
 263     }
 264     mSize.setText(target.getConvertFileSize());
 265   }
 266 
 267   public void onClick(View view) {
 268     switch (view.getId()) {
 269       case R.id.start :
 270         String text = ((TextView) (view)).getText().toString();
 271         if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
<abbr title=" 272           Aria.download(this).load(DOWNLOAD_URL).setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;).start();"> 272           Aria.download(this).load(DOWNLOAD_URL).setDownloadPath(Environment.getExternalStorageDirectory(üîµ</abbr>
 273         } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 274           Aria.download(this).load(DOWNLOAD_URL).resume();
 275         }
 276         //DownloadTarget target = Aria.download(this)
 277         //    .load(DOWNLOAD_URL)
 278         //    .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;);
 279         //target.add();
 280         //target.cancel();
 281         break;
 282       case R.id.stop :
 283         Aria.download(this).load(DOWNLOAD_URL).pause();
 284         break;
 285       case R.id.cancel :
 286         Aria.download(this).load(DOWNLOAD_URL).cancel();
 287         break;
 288     }
 289   }
 290 }</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  
  17  package com.arialyy.simple.download;
  18  
  19  import android.content.BroadcastReceiver;
  20  import android.content.Context;
  21  import android.content.Intent;
  22  import android.os.Bundle;
  23  import android.os.Environment;
  24  import android.os.Handler;
  25  import android.os.Message;
  26  import android.support.v7.widget.Toolbar;
  27  import android.util.Log;
  28  import android.view.Menu;
  29  import android.view.MenuItem;
  30  import android.view.View;
  31  import android.widget.Button;
  32  import android.widget.RadioGroup;
  33  import android.widget.TextView;
  34  import android.widget.Toast;
  35  import butterknife.Bind;
  36  import com.arialyy.annotations.Download;
  37  import com.arialyy.aria.core.download.DownloadTarget;
  38  import com.arialyy.aria.core.Aria;
  39  import com.arialyy.aria.core.download.DownloadEntity;
  40  import com.arialyy.aria.core.download.DownloadTask;
  41  import com.arialyy.aria.core.inf.IEntity;
  42  import com.arialyy.aria.util.CommonUtil;
  43  import com.arialyy.frame.util.FileUtil;
  44  import com.arialyy.frame.util.show.L;
  45  import com.arialyy.frame.util.show.T;
  46  import com.arialyy.simple.R;
  47  import com.arialyy.simple.base.BaseActivity;
  48  import com.arialyy.simple.databinding.ActivitySingleBinding;
  49  import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  50  import java.io.File;
  51  
  52  public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53    public static final int DOWNLOAD_PRE = 0x01;
  54    public static final int DOWNLOAD_STOP = 0x02;
  55    public static final int DOWNLOAD_FAILE = 0x03;
  56    public static final int DOWNLOAD_CANCEL = 0x04;
  57    public static final int DOWNLOAD_RESUME = 0x05;
  58    public static final int DOWNLOAD_COMPLETE = 0x06;
  59    public static final int DOWNLOAD_RUNNING = 0x07;
  60    public static final int DOWNLOAD_START = 0x08;
  61  
  62    private static final String DOWNLOAD_URL =
  63        //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64        //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -      //&quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +      &quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;</span>
  67        //&quot;http://down2.xiaoshuofuwuqi.com/d/file/filetxt/20170608/14/%BA%DA%CE%D7%CA%A6%E1%C8%C6%F0.txt&quot;;
  68        //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -  &quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +  //&quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
  71    //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;
<abbr title="  72    //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  72    //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuraüîµ</abbr>
  73    //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  74    //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  75    //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  76    @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  77    @Bind(R.id.start) Button mStart;
  78    @Bind(R.id.stop) Button mStop;
  79    @Bind(R.id.cancel) Button mCancel;
  80    @Bind(R.id.size) TextView mSize;
  81    @Bind(R.id.speed) TextView mSpeed;
  82    @Bind(R.id.speeds) RadioGroup mRg;
  83  
  84    private Handler mUpdateHandler = new Handler() {
  85      @Override public void handleMessage(Message msg) {
  86        super.handleMessage(msg);
  87        switch (msg.what) {
  88          case DOWNLOAD_RUNNING:
  89            DownloadTask task = (DownloadTask) msg.obj;
  90            long current = task.getCurrentProgress();
  91            long len = task.getFileSize();
  92            if (len == 0) {
  93              mPb.setProgress(0);
  94            } else {
  95              mPb.setProgress((int) ((current * 100) / len));
  96            }
  97            mSpeed.setText(task.getConvertSpeed());
  98            break;
  99          case DOWNLOAD_PRE:
 100            setBtState(false);
 101            break;
 102          case DOWNLOAD_START:
 103            mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 104            break;
 105          case DOWNLOAD_FAILE:
 106            Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 107            setBtState(true);
 108            break;
 109          case DOWNLOAD_STOP:
 110            Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 111            mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 112            setBtState(true);
 113            break;
 114          case DOWNLOAD_CANCEL:
 115            mPb.setProgress(0);
 116            Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 117            mStart.setText(&quot;ÂºÄÂßã&quot;);
 118            setBtState(true);
 119            break;
 120          case DOWNLOAD_RESUME:
 121            mStart.setText(&quot;ÊöÇÂÅú&quot;);
 122            setBtState(false);
 123            break;
 124          case DOWNLOAD_COMPLETE:
 125            mPb.setProgress(100);
 126            Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 127            mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 128            mCancel.setEnabled(false);
 129            setBtState(true);
 130            break;
 131        }
 132      }
 133    };
 134  
 135    @Override protected void onCreate(Bundle savedInstanceState) {
 136      super.onCreate(savedInstanceState);
 137      Aria.download(this).register();
 138    }
 139  
 140    /**
 141     * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 142     */
 143    private void setBtState(boolean state) {
 144      mStart.setEnabled(state);
 145      mStop.setEnabled(!state);
 146    }
 147  
 148    @Override public boolean onCreateOptionsMenu(Menu menu) {
 149      getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 150      return super.onCreateOptionsMenu(menu);
 151    }
 152  
 153    @Override public boolean onMenuItemClick(MenuItem item) {
 154      double speed = -1;
 155      String msg = &quot;&quot;;
 156      switch (item.getItemId()) {
 157        case R.id.help:
 158          msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;
 159              + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•Âú®Ê≥®Ëß£‰∏≠Â¢ûÂä†ÈìæÊé•ÔºåÁî®‰∫éÊåáÂÆöË¢´Ê≥®Ëß£ÁöÑÊñπÊ≥ïÂè™ËÉΩË¢´ÁâπÂÆöÁöÑ‰∏ãËΩΩ‰ªªÂä°ÂõûË∞ÉÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;
 160              + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;
 161              + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;
 162          showMsgDialog(&quot;tip&quot;, msg);
 163          break;
 164        case R.id.speed_0:
 165          speed = 0.0;
 166          break;
 167        case R.id.speed_128:
 168          speed = 128.0;
 169          break;
 170        case R.id.speed_256:
 171          speed = 256.0;
 172          break;
 173        case R.id.speed_512:
 174          speed = 512.0;
 175          break;
 176        case R.id.speed_1m:
 177          speed = 1024.0;
 178          break;
 179      }
 180      if (speed &gt; -1) {
 181        msg = item.getTitle().toString();
 182        Aria.download(this).setMaxSpeed(speed);
 183        T.showShort(this, msg);
 184      }
 185      return true;
 186    }
 187  
 188    @Download.onPre(DOWNLOAD_URL) protected void onPre(DownloadTask task) {
 189      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 190          .sendToTarget();
 191    }
 192  
 193    @Download.onTaskStart(DOWNLOAD_URL) void taskStart(DownloadTask task) {
 194      mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 195          .sendToTarget();
 196    }
 197  
 198    @Download.onTaskRunning(DOWNLOAD_URL) protected void running(DownloadTask task) {
 199      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 200    }
 201  
 202    @Download.onTaskResume(DOWNLOAD_URL) void taskResume(DownloadTask task) {
 203      mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 204    }
 205  
 206    @Download.onTaskStop(DOWNLOAD_URL) void taskStop(DownloadTask task) {
 207      mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 208      L.d(TAG, &quot;task__stop&quot;);
 209    }
 210  
 211    @Download.onTaskCancel(DOWNLOAD_URL) void taskCancel(DownloadTask task) {
 212      mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 213      L.d(TAG, &quot;task__cancel&quot;);




 214    }
 215  
 216    @Download.onTaskFail(DOWNLOAD_URL) void taskFail(DownloadTask task) {
 217      L.d(TAG, &quot;task__fail&quot;);
 218      mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 219    }
 220  
 221    @Download.onTaskComplete(DOWNLOAD_URL) void taskComplete(DownloadTask task) {
 222      mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 223    }
 224  
 225    @Download.onNoSupportBreakPoint(DOWNLOAD_URL)
 226    public void onNoSupportBreakPoint(DownloadTask task) {
 227      T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 228    }
 229  
 230    @Override protected int setLayoutId() {
 231      return R.layout.activity_single;
 232    }
 233  
 234    @Override protected void init(Bundle savedInstanceState) {
 235      super.init(savedInstanceState);
 236      setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 237      DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 238      mPb.setProgress(target.getPercent());
 239      if (target.getTaskState() == IEntity.STATE_STOP) {
 240        mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 241        mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 242        setBtState(true);
 243      } else if (target.isDownloading()) {
 244        setBtState(false);
 245      }
 246      mSize.setText(target.getConvertFileSize());
 247      Aria.get(this).getDownloadConfig().setOpenBreadCast(true);
 248    }
 249  
 250    public void onClick(View view) {
 251      switch (view.getId()) {
 252        case R.id.start:
 253          String text = ((TextView) view).getText().toString();
 254          if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 255            Aria.download(this)
 256                .load(DOWNLOAD_URL)
 257                .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 258                .start();
 259          } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 260            Aria.download(this).load(DOWNLOAD_URL).resume();
 261          }





 262          break;
 263        case R.id.stop:
 264          Aria.download(this).load(DOWNLOAD_URL).pause();
 265          break;
 266        case R.id.cancel:
 267          Aria.download(this).load(DOWNLOAD_URL).cancel();
 268          break;
 269      }
 270    }
 271  }</pre></td>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  
  17  package com.arialyy.simple.download;
  18  
  19  import android.content.BroadcastReceiver;
  20  import android.content.Context;
  21  import android.content.Intent;
  22  import android.os.Bundle;
  23  import android.os.Environment;
  24  import android.os.Handler;
  25  import android.os.Message;
  26  import android.support.v7.widget.Toolbar;
  27  import android.util.Log;
  28  import android.view.Menu;
  29  import android.view.MenuItem;
  30  import android.view.View;
  31  import android.widget.Button;
  32  import android.widget.RadioGroup;
  33  import android.widget.TextView;
  34  import android.widget.Toast;
  35  import butterknife.Bind;
  36  import com.arialyy.annotations.Download;
  37  import com.arialyy.aria.core.download.DownloadTarget;
  38  import com.arialyy.aria.core.Aria;
  39  import com.arialyy.aria.core.download.DownloadEntity;
  40  import com.arialyy.aria.core.download.DownloadTask;
  41  import com.arialyy.aria.core.inf.IEntity;
  42  import com.arialyy.aria.util.CommonUtil;
  43  import com.arialyy.frame.util.FileUtil;
  44  import com.arialyy.frame.util.show.L;
  45  import com.arialyy.frame.util.show.T;
  46  import com.arialyy.simple.R;
  47  import com.arialyy.simple.base.BaseActivity;
  48  import com.arialyy.simple.databinding.ActivitySingleBinding;
  49  import com.arialyy.simple.widget.HorizontalProgressBarWithNumber;
  50  import java.io.File;
  51  
  52  public class SingleTaskActivity extends BaseActivity&lt;ActivitySingleBinding&gt; {
  53    public static final int DOWNLOAD_PRE = 0x01;
  54    public static final int DOWNLOAD_STOP = 0x02;
  55    public static final int DOWNLOAD_FAILE = 0x03;
  56    public static final int DOWNLOAD_CANCEL = 0x04;
  57    public static final int DOWNLOAD_RESUME = 0x05;
  58    public static final int DOWNLOAD_COMPLETE = 0x06;
  59    public static final int DOWNLOAD_RUNNING = 0x07;
  60    public static final int DOWNLOAD_START = 0x08;
  61  
  62    private static final String DOWNLOAD_URL =
  63        //&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;
  64        //&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;
  65        //&quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;

  66        //&quot;http://down2.xiaoshuofuwuqi.com/d/file/filetxt/20170608/14/%BA%DA%CE%D7%CA%A6%E1%C8%C6%F0.txt&quot;;
  67        //&quot;http://tinghuaapp.oss-cn-shanghai.aliyuncs.com/20170612201739607815&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -  &quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +      &quot;http://static.gaoshouyou.com/d/36/69/2d3699acfa69e9632262442c46516ad8.apk&quot;;</span>
  70    //&quot;http://oqcpqqvuf.bkt.clouddn.com/ceshi.txt&quot;;
<abbr title="  71    //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuralprisma-2.5.2.174-2000174_1494784835.apk?f=web_1&quot;;">  71    //&quot;http://down8.androidgame-store.com/201706122321/97967927DD4E53D9905ECAA7874C8128/new/game1/19/45319/com.neuraüîµ</abbr>
  72    //‰∏çÊîØÊåÅÊñ≠ÁÇπÁöÑÈìæÊé•
  73    //&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;
  74    //&quot;http://172.18.104.50:8080/download/_302turn&quot;;
  75    @Bind(R.id.progressBar) HorizontalProgressBarWithNumber mPb;
  76    @Bind(R.id.start) Button mStart;
  77    @Bind(R.id.stop) Button mStop;
  78    @Bind(R.id.cancel) Button mCancel;
  79    @Bind(R.id.size) TextView mSize;
  80    @Bind(R.id.speed) TextView mSpeed;
  81    @Bind(R.id.speeds) RadioGroup mRg;
  82  
  83    private Handler mUpdateHandler = new Handler() {
  84      @Override public void handleMessage(Message msg) {
  85        super.handleMessage(msg);
  86        switch (msg.what) {
  87          case DOWNLOAD_RUNNING:
  88            DownloadTask task = (DownloadTask) msg.obj;
  89            long current = task.getCurrentProgress();
  90            long len = task.getFileSize();
  91            if (len == 0) {
  92              mPb.setProgress(0);
  93            } else {
  94              mPb.setProgress((int) ((current * 100) / len));
  95            }
  96            mSpeed.setText(task.getConvertSpeed());
  97            break;
  98          case DOWNLOAD_PRE:
  99            setBtState(false);
 100            break;
 101          case DOWNLOAD_START:
 102            mSize.setText(CommonUtil.formatFileSize((Long) msg.obj));
 103            break;
 104          case DOWNLOAD_FAILE:
 105            Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂ§±Ë¥•&quot;, Toast.LENGTH_SHORT).show();
 106            setBtState(true);
 107            break;
 108          case DOWNLOAD_STOP:
 109            Toast.makeText(SingleTaskActivity.this, &quot;ÊöÇÂÅú‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 110            mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 111            setBtState(true);
 112            break;
 113          case DOWNLOAD_CANCEL:
 114            mPb.setProgress(0);
 115            Toast.makeText(SingleTaskActivity.this, &quot;ÂèñÊ∂à‰∏ãËΩΩ&quot;, Toast.LENGTH_SHORT).show();
 116            mStart.setText(&quot;ÂºÄÂßã&quot;);
 117            setBtState(true);
 118            break;
 119          case DOWNLOAD_RESUME:
 120            mStart.setText(&quot;ÊöÇÂÅú&quot;);
 121            setBtState(false);
 122            break;
 123          case DOWNLOAD_COMPLETE:
 124            mPb.setProgress(100);
 125            Toast.makeText(SingleTaskActivity.this, &quot;‰∏ãËΩΩÂÆåÊàê&quot;, Toast.LENGTH_SHORT).show();
 126            mStart.setText(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;);
 127            mCancel.setEnabled(false);
 128            setBtState(true);
 129            break;
 130        }
 131      }
 132    };
 133  
 134    @Override protected void onCreate(Bundle savedInstanceState) {
 135      super.onCreate(savedInstanceState);
 136      Aria.download(this).register();
 137    }
 138  
 139    /**
 140     * ËÆæÁΩÆstart Âíå stop ÊåâÈíÆÁä∂ÊÄÅ
 141     */
 142    private void setBtState(boolean state) {
 143      mStart.setEnabled(state);
 144      mStop.setEnabled(!state);
 145    }
 146  
 147    @Override public boolean onCreateOptionsMenu(Menu menu) {
 148      getMenuInflater().inflate(R.menu.menu_single_task_activity, menu);
 149      return super.onCreateOptionsMenu(menu);
 150    }
 151  
 152    @Override public boolean onMenuItemClick(MenuItem item) {
 153      double speed = -1;
 154      String msg = &quot;&quot;;
 155      switch (item.getItemId()) {
 156        case R.id.help:
 157          msg = &quot;‰∏Ä‰∫õÂ∞èÁü•ËØÜÁÇπÔºö\n&quot;
 158              + &quot;1„ÄÅ‰Ω†ÂèØ‰ª•Âú®Ê≥®Ëß£‰∏≠Â¢ûÂä†ÈìæÊé•ÔºåÁî®‰∫éÊåáÂÆöË¢´Ê≥®Ëß£ÁöÑÊñπÊ≥ïÂè™ËÉΩË¢´ÁâπÂÆöÁöÑ‰∏ãËΩΩ‰ªªÂä°ÂõûË∞ÉÔºå‰ª•Èò≤Ê≠¢progress‰π±Ë∑≥\n&quot;
 159              + &quot;2„ÄÅÂΩìÈÅáÂà∞ÁΩëÁªúÊÖ¢ÁöÑÊÉÖÂÜµÊó∂Ôºå‰Ω†ÂèØ‰ª•ÂÖà‰ΩøÁî®onPre()Êõ¥Êñ∞UIÁïåÈù¢ÔºåÂæÖËøûÊé•ÊàêÂäüÊó∂ÔºåÂÜçÂú®onTaskPre()Ëé∑ÂèñÂÆåÊï¥ÁöÑtaskÊï∞ÊçÆÔºåÁÑ∂ÂêéÁªôUIÁïåÈù¢ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊï∞ÊçÆ\n&quot;
 160              + &quot;3„ÄÅ‰Ω†ÂèØ‰ª•Âú®ÁïåÈù¢ÂàùÂßãÂåñÊó∂ÈÄöËøáAria.download(this).load(DOWNLOAD_URL).getPercent()Á≠âÊñπÊ≥ïÂø´ÈÄüËé∑ÂèñÁõ∏ÂÖ≥‰ªªÂä°ÁöÑ‰∏Ä‰∫õÊï∞ÊçÆ&quot;;
 161          showMsgDialog(&quot;tip&quot;, msg);
 162          break;
 163        case R.id.speed_0:
 164          speed = 0.0;
 165          break;
 166        case R.id.speed_128:
 167          speed = 128.0;
 168          break;
 169        case R.id.speed_256:
 170          speed = 256.0;
 171          break;
 172        case R.id.speed_512:
 173          speed = 512.0;
 174          break;
 175        case R.id.speed_1m:
 176          speed = 1024.0;
 177          break;
 178      }
 179      if (speed &gt; -1) {
 180        msg = item.getTitle().toString();
 181        Aria.download(this).setMaxSpeed(speed);
 182        T.showShort(this, msg);
 183      }
 184      return true;
 185    }
 186  
 187    @Download.onPre(DOWNLOAD_URL) protected void onPre(DownloadTask task) {
 188      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, task.getDownloadEntity().getFileSize())
 189          .sendToTarget();
 190    }
 191  
 192    @Download.onTaskStart(DOWNLOAD_URL) void taskStart(DownloadTask task) {
 193      mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getDownloadEntity().getFileSize())
 194          .sendToTarget();
 195    }
 196  
 197    @Download.onTaskRunning(DOWNLOAD_URL) protected void running(DownloadTask task) {
 198      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, task).sendToTarget();
 199    }
 200  
 201    @Download.onTaskResume(DOWNLOAD_URL) void taskResume(DownloadTask task) {
 202      mUpdateHandler.obtainMessage(DOWNLOAD_START, task.getFileSize()).sendToTarget();
 203    }
 204  
 205    @Download.onTaskStop(DOWNLOAD_URL) void taskStop(DownloadTask task) {
 206      mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);
 207      L.d(TAG, &quot;task__stop&quot;);
 208    }
 209  
 210    @Download.onTaskCancel(DOWNLOAD_URL) void taskCancel(DownloadTask task) {
 211      mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);
 212      L.d(TAG, &quot;task__cancel&quot;);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +    //Aria.download(this)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +    //    .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +    //    .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +    //    .add();</span>
 217    }
 218  
 219    @Download.onTaskFail(DOWNLOAD_URL) void taskFail(DownloadTask task) {
 220      L.d(TAG, &quot;task__fail&quot;);
 221      mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);
 222    }
 223  
 224    @Download.onTaskComplete(DOWNLOAD_URL) void taskComplete(DownloadTask task) {
 225      mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);
 226    }
 227  
 228    @Download.onNoSupportBreakPoint(DOWNLOAD_URL)
 229    public void onNoSupportBreakPoint(DownloadTask task) {
 230      T.showShort(SingleTaskActivity.this, &quot;ËØ•‰∏ãËΩΩÈìæÊé•‰∏çÊîØÊåÅÊñ≠ÁÇπ&quot;);
 231    }
 232  
 233    @Override protected int setLayoutId() {
 234      return R.layout.activity_single;
 235    }
 236  
 237    @Override protected void init(Bundle savedInstanceState) {
 238      super.init(savedInstanceState);
 239      setTitle(&quot;Âçï‰ªªÂä°‰∏ãËΩΩ&quot;);
 240      DownloadTarget target = Aria.download(this).load(DOWNLOAD_URL);
 241      mPb.setProgress(target.getPercent());
 242      if (target.getTaskState() == IEntity.STATE_STOP) {
 243        mStart.setText(&quot;ÊÅ¢Â§ç&quot;);
 244        mStart.setTextColor(getResources().getColor(android.R.color.holo_blue_light));
 245        setBtState(true);
 246      } else if (target.isDownloading()) {
 247        setBtState(false);
 248      }
 249      mSize.setText(target.getConvertFileSize());
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 250 -    Aria.get(this).getDownloadConfig().setOpenBreadCast(true);</span>
 251    }
 252  
 253    public void onClick(View view) {
 254      switch (view.getId()) {
 255        case R.id.start:
 256          String text = ((TextView) view).getText().toString();
 257          if (text.equals(&quot;ÈáçÊñ∞ÂºÄÂßãÔºü&quot;) || text.equals(&quot;ÂºÄÂßã&quot;)) {
 258            Aria.download(this)
 259                .load(DOWNLOAD_URL)
 260                .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;)
 261                .start();
 262          } else if (text.equals(&quot;ÊÅ¢Â§ç&quot;)) {
 263            Aria.download(this).load(DOWNLOAD_URL).resume();
 264          }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +        //DownloadTarget target = Aria.download(this)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +        //    .load(DOWNLOAD_URL)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +        //    .setDownloadPath(Environment.getExternalStorageDirectory().getPath() + &quot;/test.apk&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +        //target.add();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +        //target.cancel();</span>
 270          break;
 271        case R.id.stop:
 272          Aria.download(this).load(DOWNLOAD_URL).pause();
 273          break;
 274        case R.id.cancel:
 275          Aria.download(this).load(DOWNLOAD_URL).cancel();
 276          break;
 277      }
 278    }
 279  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            