<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>311</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    311
                    <a href="310.html">prev</a>
                    <a href="312.html">next</a>
                    <a href="311_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_cd7cff12a798c3a68943ad44552e25fb0f98f8d1_admin/broadleaf-open-admin-platform/src/main/java/org/broadleafcommerce/openadmin/server/service/AdminEntityServiceImpl.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;cd7cff12a798c3a68943ad44552e25fb0f98f8d1:admin/broadleaf-open-admin-platform/src/main/java/org/broadleafcommerce/openadmin/server/service/AdminEntityServiceImpl.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;cd7cff12a798c3a68943ad44552e25fb0f98f8d1^1:admin/broadleaf-open-admin-platform/src/main/java/org/broadleafcommerce/openadmin/server/service/AdminEntityServiceImpl.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;cd7cff12a798c3a68943ad44552e25fb0f98f8d1^2:admin/broadleaf-open-admin-platform/src/main/java/org/broadleafcommerce/openadmin/server/service/AdminEntityServiceImpl.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;556ac57d12139326e76b29db4638956d93283fb1:admin/broadleaf-open-admin-platform/src/main/java/org/broadleafcommerce/openadmin/server/service/AdminEntityServiceImpl.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-3339060969767811416" onmouseenter="enter('-3339060969767811416');" onmouseout="out('-3339060969767811416');" style="">   3  * BroadleafCommerce Open Admin Platform                                                                 </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-8794511651793620694" onmouseenter="enter('-8794511651793620694');" onmouseout="out('-8794511651793620694');" style="">  18 package org.broadleafcommerce.openadmin.server.service;                                                  </span>
<span  style="">  19                                                                                                          </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  20 import org.apache.commons.lang3.ArrayUtils;                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-6287859968194756382" onmouseenter="enter('-6287859968194756382');" onmouseout="out('-6287859968194756382');" style="">  24 import org.broadleafcommerce.common.admin.domain.AdminMainEntity;                                        </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  25 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  26 import org.broadleafcommerce.common.persistence.EntityConfiguration;                                     </span>
<span class="-6648433550510659033" onmouseenter="enter('-6648433550510659033');" onmouseout="out('-6648433550510659033');" style="">  27 import org.broadleafcommerce.common.presentation.client.AddMethodType;                                   </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  28 import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                              </span>
<span class="2428099238642943960" onmouseenter="enter('2428099238642943960');" onmouseout="out('2428099238642943960');" style="">  29 import org.broadleafcommerce.common.util.BLCMessageUtils;                                                </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  30 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="5951235614759861305" onmouseenter="enter('5951235614759861305');" onmouseout="out('5951235614759861305');" style="">  31 import org.broadleafcommerce.common.util.dao.DynamicDaoHelper;                                           </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  32 import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                       </span>
<span class="-3361215363157046739" onmouseenter="enter('-3361215363157046739');" onmouseout="out('-3361215363157046739');" style="">  33 import org.broadleafcommerce.openadmin.dto.AdornedTargetCollectionMetadata;                              </span>
<span class="-1781055592725563383" onmouseenter="enter('-1781055592725563383');" onmouseout="out('-1781055592725563383');" style="">  34 import org.broadleafcommerce.openadmin.dto.AdornedTargetList;                                            </span>
<span class="-6140296335181984013" onmouseenter="enter('-6140296335181984013');" onmouseout="out('-6140296335181984013');" style="">  35 import org.broadleafcommerce.openadmin.dto.BasicCollectionMetadata;                                      </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  36 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  37 import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                </span>
<span class="-3165611006566133086" onmouseenter="enter('-3165611006566133086');" onmouseout="out('-3165611006566133086');" style="">  38 import org.broadleafcommerce.openadmin.dto.CollectionMetadata;                                           </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  39 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  40 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  41 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  42 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  43 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="2672462771965160264" onmouseenter="enter('2672462771965160264');" onmouseout="out('2672462771965160264');" style="">  44 import org.broadleafcommerce.openadmin.dto.GroupMetadata;                                                </span>
<span class="826821438795056004" onmouseenter="enter('826821438795056004');" onmouseout="out('826821438795056004');" style="">  45 import org.broadleafcommerce.openadmin.dto.MapMetadata;                                                  </span>
<span class="-7888875133556467044" onmouseenter="enter('-7888875133556467044');" onmouseout="out('-7888875133556467044');" style="">  46 import org.broadleafcommerce.openadmin.dto.MapStructure;                                                 </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  47 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  48 import org.broadleafcommerce.openadmin.dto.Property;                                                     </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  49 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="5662236005419086618" onmouseenter="enter('5662236005419086618');" onmouseout="out('5662236005419086618');" style="">  50 import org.broadleafcommerce.openadmin.dto.TabMetadata;                                                  </span>
<span class="2699062320492900877" onmouseenter="enter('2699062320492900877');" onmouseout="out('2699062320492900877');" style="">  51 import org.broadleafcommerce.openadmin.exception.EntityNotFoundException;                                </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  52 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-2178507335566770341" onmouseenter="enter('-2178507335566770341');" onmouseout="out('-2178507335566770341');" style="">  53 import org.broadleafcommerce.openadmin.server.domain.FetchPageRequest;                                   </span>
<span class="4410643013278245372" onmouseenter="enter('4410643013278245372');" onmouseout="out('4410643013278245372');" style="">  54 import org.broadleafcommerce.openadmin.server.domain.PersistencePackageRequest;                          </span>
<span class="6597629584583725664" onmouseenter="enter('6597629584583725664');" onmouseout="out('6597629584583725664');" style="">  55 import org.broadleafcommerce.openadmin.server.factory.PersistencePackageFactory;                         </span>
<span class="7062965872140905778" onmouseenter="enter('7062965872140905778');" onmouseout="out('7062965872140905778');" style="">  56 import org.broadleafcommerce.openadmin.server.service.extension.CriteriaTransferObjectExtensionManager;  </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  57 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;             </span>
<span class="-8603256547657551769" onmouseenter="enter('-8603256547657551769');" onmouseout="out('-8603256547657551769');" style="">  58 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceResponse;                   </span>
<span class="-3086540061138981164" onmouseenter="enter('-3086540061138981164');" onmouseout="out('-3086540061138981164');" style="">  59 import org.broadleafcommerce.openadmin.server.service.persistence.module.BasicPersistenceModule;         </span>
<span class="-7452009352681558215" onmouseenter="enter('-7452009352681558215');" onmouseout="out('-7452009352681558215');" style="">  60 import org.broadleafcommerce.openadmin.web.form.entity.DynamicEntityFormInfo;                            </span>
<span class="8035715143965725316" onmouseenter="enter('8035715143965725316');" onmouseout="out('8035715143965725316');" style="">  61 import org.broadleafcommerce.openadmin.web.form.entity.EntityForm;                                       </span>
<span class="6015559832933397076" onmouseenter="enter('6015559832933397076');" onmouseout="out('6015559832933397076');" style="">  62 import org.broadleafcommerce.openadmin.web.form.entity.Field;                                            </span>
<span class="7834442097514100117" onmouseenter="enter('7834442097514100117');" onmouseout="out('7834442097514100117');" style="">  63 import org.broadleafcommerce.openadmin.web.form.entity.Tab;                                              </span>
<span class="-5699213192866872541" onmouseenter="enter('-5699213192866872541');" onmouseout="out('-5699213192866872541');" style="">  64 import org.hibernate.exception.ConstraintViolationException;                                             </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  65 import org.springframework.stereotype.Service;                                                           </span>
<span  style="">  66                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  67 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  68 import java.util.Arrays;                                                                                 </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  69 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  70 import java.util.List;                                                                                   </span>
<span class="174663421494487417" onmouseenter="enter('174663421494487417');" onmouseout="out('174663421494487417');" style="">  71 import java.util.ListIterator;                                                                           </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  72 import java.util.Map;                                                                                    </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  73 import java.util.Map.Entry;                                                                              </span>
<span  style="">  74                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  75 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  76 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  77 import javax.persistence.PersistenceContext;                                                             </span>
<span  style="">  78                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  79 /**                                                                                                      </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  80  * @author Andre Azzolini (apazzolini)                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  81  */                                                                                                      </span>
<span class="2205005937568393687" onmouseenter="enter('2205005937568393687');" onmouseout="out('2205005937568393687');" style="">  82 @Service(&quot;blAdminEntityService&quot;)                                                                         </span>
<span class="-2691323185499418706" onmouseenter="enter('-2691323185499418706');" onmouseout="out('-2691323185499418706');" style="">  83 public class AdminEntityServiceImpl implements AdminEntityService {                                      </span>
<span  style="">  84                                                                                                          </span>
<span class="6898728355289688423" onmouseenter="enter('6898728355289688423');" onmouseout="out('6898728355289688423');" style="">  85     protected static final Log LOG = LogFactory.getLog(AdminEntityServiceImpl.class);                    </span>
<span  style="">  86                                                                                                          </span>
<span class="6303589118895976221" onmouseenter="enter('6303589118895976221');" onmouseout="out('6303589118895976221');" style="">  87     @Resource(name = &quot;blDynamicEntityRemoteService&quot;)                                                     </span>
<span class="1505564706419640906" onmouseenter="enter('1505564706419640906');" onmouseout="out('1505564706419640906');" style="">  88     protected DynamicEntityService service;                                                              </span>
<span  style="">  89                                                                                                          </span>
<span class="-5295563268582613053" onmouseenter="enter('-5295563268582613053');" onmouseout="out('-5295563268582613053');" style="">  90     @Resource(name = &quot;blPersistencePackageFactory&quot;)                                                      </span>
<span class="5077122885687298736" onmouseenter="enter('5077122885687298736');" onmouseout="out('5077122885687298736');" style="">  91     protected PersistencePackageFactory persistencePackageFactory;                                       </span>
<span  style="">  92                                                                                                          </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style="">  93     @PersistenceContext(unitName = &quot;blPU&quot;)                                                               </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  94     protected EntityManager em;                                                                          </span>
<span  style="">  95                                                                                                          </span>
<span class="6650882675825573659" onmouseenter="enter('6650882675825573659');" onmouseout="out('6650882675825573659');" style="">  96     @Resource(name = &quot;blEntityConfiguration&quot;)                                                            </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  97     protected EntityConfiguration entityConfiguration;                                                   </span>
<span  style="">  98                                                                                                          </span>
<span class="-2309360235309114106" onmouseenter="enter('-2309360235309114106');" onmouseout="out('-2309360235309114106');" style="">  99     @Resource                                                                                            </span>
<span class="5773081278430031986" onmouseenter="enter('5773081278430031986');" onmouseout="out('5773081278430031986');" style=""> 100     protected CriteriaTransferObjectExtensionManager extensionManager;                                   </span>
<span  style=""> 101                                                                                                          </span>
<span class="6769863436851689394" onmouseenter="enter('6769863436851689394');" onmouseout="out('6769863436851689394');" style=""> 102     protected DynamicDaoHelper dynamicDaoHelper = new DynamicDaoHelperImpl();                            </span>
<span  style=""> 103                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 104     @Override                                                                                            </span>
<span class="689806418400872386" onmouseenter="enter('689806418400872386');" onmouseout="out('689806418400872386');" style=""> 105     public PersistenceResponse getClassMetadata(PersistencePackageRequest request)                       </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 106             throws ServiceException {                                                                    </span>
<span class="-477483751520958137" onmouseenter="enter('-477483751520958137');" onmouseout="out('-477483751520958137');" style=""> 107         PersistenceResponse response = inspect(request);                                                 </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 108         ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                           </span>
<span class="4495915987564569811" onmouseenter="enter('4495915987564569811');" onmouseout="out('4495915987564569811');" style=""> 109         cmd.setCeilingType(request.getCeilingEntityClassname());                                         </span>
<span class="-7633911880463002125" onmouseenter="enter('-7633911880463002125');" onmouseout="out('-7633911880463002125');" style=""> 110         cmd.setSecurityCeilingType(request.getSecurityCeilingEntityClassname());                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 111         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112     }                                                                                                    </span>
<span  style=""> 113                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 114     @Override                                                                                            </span>
<span class="6442257948747151854" onmouseenter="enter('6442257948747151854');" onmouseout="out('6442257948747151854');" style=""> 115     public PersistenceResponse getRecords(PersistencePackageRequest request) throws ServiceException {   </span>
<span class="-8968772654133629352" onmouseenter="enter('-8968772654133629352');" onmouseout="out('-8968772654133629352');" style=""> 116         return fetch(request);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117     }                                                                                                    </span>
<span  style=""> 118                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 119     @Override                                                                                            </span>
<span class="4020809512296494224" onmouseenter="enter('4020809512296494224');" onmouseout="out('4020809512296494224');" style=""><abbr title=" 120     public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd, boolean isCollectionRequest)"> 120     public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd,ðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 121             throws ServiceException {                                                                    </span>
<span class="-5399859376019632364" onmouseenter="enter('-5399859376019632364');" onmouseout="out('-5399859376019632364');" style=""> 122         String idProperty = getIdProperty(cmd);                                                          </span>
<span  style=""> 123                                                                                                          </span>
<span class="1207908904787390154" onmouseenter="enter('1207908904787390154');" onmouseout="out('1207908904787390154');" style=""> 124         FilterAndSortCriteria fasc = new FilterAndSortCriteria(idProperty);                              </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 125         fasc.setFilterValue(id);                                                                         </span>
<span class="-8339504512820574544" onmouseenter="enter('-8339504512820574544');" onmouseout="out('-8339504512820574544');" style=""> 126         request.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 127                                                                                                          </span>
<span class="-1381837102214910163" onmouseenter="enter('-1381837102214910163');" onmouseout="out('-1381837102214910163');" style=""> 128         PersistenceResponse response = fetch(request);                                                   </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 129         Entity[] entities = response.getDynamicResultSet().getRecords();                                 </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 130         if (ArrayUtils.isEmpty(entities)) {                                                              </span>
<span class="3317501704848962820" onmouseenter="enter('3317501704848962820');" onmouseout="out('3317501704848962820');" style=""> 131             String celiningEntity = request.getCeilingEntityClassname();                                 </span>
<span class="1970293616538386874" onmouseenter="enter('1970293616538386874');" onmouseout="out('1970293616538386874');" style=""><abbr title=" 132             throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiningEntity, id));"> 132             throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiniðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133         }                                                                                                </span>
<span  style=""> 134                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 135         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136     }                                                                                                    </span>
<span  style=""> 137                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 138     @Override                                                                                            </span>
<span class="-7201975922678164147" onmouseenter="enter('-7201975922678164147');" onmouseout="out('-7201975922678164147');" style=""><abbr title=" 139     public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 139     public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 140         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 140         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 141         // If the entity form has dynamic forms inside of it, we need to persist those as well.          </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 142         // They are typically done in their own custom persistence handlers, which will get triggered    </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 143         // based on the criteria specific in the PersistencePackage.                                     </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 144         for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 145             DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                  </span>
<span  style=""> 146                                                                                                          </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 147             if (info.getCustomCriteriaOverride() != null) {                                              </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 148                 customCriteria = info.getCustomCriteriaOverride();                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 149             } else {                                                                                     </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 150                 String propertyName = info.getPropertyName();                                            </span>
<span class="3293102538279717811" onmouseenter="enter('3293102538279717811');" onmouseout="out('3293102538279717811');" style=""> 151                 String propertyValue;                                                                    </span>
<span class="3903441351658368829" onmouseenter="enter('3903441351658368829');" onmouseout="out('3903441351658368829');" style=""> 152                 if (entityForm.getFields().containsKey(propertyName)) {                                  </span>
<span class="-3364727408470092918" onmouseenter="enter('-3364727408470092918');" onmouseout="out('-3364727408470092918');" style=""> 153                     propertyValue = entityForm.findField(propertyName).getValue();                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 154                 } else {                                                                                 </span>
<span class="6725656947693910623" onmouseenter="enter('6725656947693910623');" onmouseout="out('6725656947693910623');" style=""> 155                     propertyValue = info.getPropertyValue();                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                 }                                                                                        </span>
<span class="-5306746194951417463" onmouseenter="enter('-5306746194951417463');" onmouseout="out('-5306746194951417463');" style=""><abbr title=" 157                 customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue};"> 157                 customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158             }                                                                                            </span>
<span  style=""> 159                                                                                                          </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 160             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 160             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriterðŸ”µ</abbr></span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 161             ppr.addSubRequest(info.getPropertyName(), subRequest);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 163         return add(ppr);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164     }                                                                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 166     @Override                                                                                            </span>
<span class="2877208390579447415" onmouseenter="enter('2877208390579447415');" onmouseout="out('2877208390579447415');" style=""><abbr title=" 167     public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 167     public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 168         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 168         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="5530250091258169917" onmouseenter="enter('5530250091258169917');" onmouseout="out('5530250091258169917');" style=""> 169         ppr.setRequestingEntityName(entityForm.getMainEntityName());                                     </span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 170         // If the entity form has dynamic forms inside of it, we need to persist those as well.          </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 171         // They are typically done in their own custom persistence handlers, which will get triggered    </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 172         // based on the criteria specific in the PersistencePackage.                                     </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 173         for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 174             DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                  </span>
<span  style=""> 175                                                                                                          </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 176             if (info.getCustomCriteriaOverride() != null) {                                              </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 177                 customCriteria = info.getCustomCriteriaOverride();                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 178             } else {                                                                                     </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 179                 String propertyName = info.getPropertyName();                                            </span>
<span class="8503945409701800913" onmouseenter="enter('8503945409701800913');" onmouseout="out('8503945409701800913');" style=""> 180                 String propertyValue = entityForm.findField(propertyName).getValue();                    </span>
<span class="-4083933246171517436" onmouseenter="enter('-4083933246171517436');" onmouseout="out('-4083933246171517436');" style=""><abbr title=" 181                 customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue };"> 181                 customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182             }                                                                                            </span>
<span  style=""> 183                                                                                                          </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 184             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 184             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriterðŸ”µ</abbr></span>
<span class="3320363489874291671" onmouseenter="enter('3320363489874291671');" onmouseout="out('3320363489874291671');" style=""> 185             subRequest.withSecurityCeilingEntityClassname(info.getSecurityCeilingClassName());           </span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 186             ppr.addSubRequest(info.getPropertyName(), subRequest);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187         }                                                                                                </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 188         return update(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189     }                                                                                                    </span>
<span  style=""> 190                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 191     @Override                                                                                            </span>
<span class="369147730756947995" onmouseenter="enter('369147730756947995');" onmouseout="out('369147730756947995');" style=""><abbr title=" 192     public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb)"> 192     public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 193             throws ServiceException {                                                                    </span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 194         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 194         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 195         return remove(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196     }                                                                                                    </span>
<span  style=""> 197                                                                                                          </span>
<span class="-4457012513682950961" onmouseenter="enter('-4457012513682950961');" onmouseout="out('-4457012513682950961');" style=""> 198     protected List&lt;Property&gt; getPropertiesFromEntityForm(EntityForm entityForm) {                        </span>
<span class="5502280122802762543" onmouseenter="enter('5502280122802762543');" onmouseout="out('5502280122802762543');" style=""> 199         List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;(entityForm.getFields().size());              </span>
<span  style=""> 200                                                                                                          </span>
<span class="-1983225226345189396" onmouseenter="enter('-1983225226345189396');" onmouseout="out('-1983225226345189396');" style=""> 201         for (Entry&lt;String, Field&gt; entry : entityForm.getFields().entrySet()) {                           </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 202             Property p = new Property();                                                                 </span>
<span class="1947374185751812962" onmouseenter="enter('1947374185751812962');" onmouseout="out('1947374185751812962');" style=""> 203             p.setName(entry.getKey());                                                                   </span>
<span class="-7008764564116424461" onmouseenter="enter('-7008764564116424461');" onmouseout="out('-7008764564116424461');" style=""> 204             p.setValue(entry.getValue().getValue());                                                     </span>
<span class="4978688160201726577" onmouseenter="enter('4978688160201726577');" onmouseout="out('4978688160201726577');" style=""> 205             p.setDisplayValue(entry.getValue().getDisplayValue());                                       </span>
<span class="9200882176886832259" onmouseenter="enter('9200882176886832259');" onmouseout="out('9200882176886832259');" style=""> 206             p.setIsDirty(entry.getValue().getIsDirty());                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 207             properties.add(p);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208         }                                                                                                </span>
<span  style=""> 209                                                                                                          </span>
<span class="7053686412803007774" onmouseenter="enter('7053686412803007774');" onmouseout="out('7053686412803007774');" style=""> 210         return properties;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211     }                                                                                                    </span>
<span  style=""> 212                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 213     @Override                                                                                            </span>
<span class="7722997034713089523" onmouseenter="enter('7722997034713089523');" onmouseout="out('7722997034713089523');" style=""><abbr title=" 214     public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumbs) {"> 214     public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriterðŸ”µ</abbr></span>
<span class="-704234828580880941" onmouseenter="enter('-704234828580880941');" onmouseout="out('-704234828580880941');" style=""> 215         // Ensure the ID property is on the form                                                         </span>
<span class="-5311876513799607800" onmouseenter="enter('-5311876513799607800');" onmouseout="out('-5311876513799607800');" style=""> 216         Field idField = entityForm.findField(entityForm.getIdProperty());                                </span>
<span class="-5694238240637206409" onmouseenter="enter('-5694238240637206409');" onmouseout="out('-5694238240637206409');" style=""> 217         if (idField == null) {                                                                           </span>
<span class="250587265755875585" onmouseenter="enter('250587265755875585');" onmouseout="out('250587265755875585');" style=""> 218             idField = new Field();                                                                       </span>
<span class="7054903396669057342" onmouseenter="enter('7054903396669057342');" onmouseout="out('7054903396669057342');" style=""> 219             idField.setName(entityForm.getIdProperty());                                                 </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 220             idField.setValue(entityForm.getId());                                                        </span>
<span class="-7557326149225538579" onmouseenter="enter('-7557326149225538579');" onmouseout="out('-7557326149225538579');" style=""> 221             entityForm.getFields().put(entityForm.getIdProperty(), idField);                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 222         } else {                                                                                         </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 223             idField.setValue(entityForm.getId());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224         }                                                                                                </span>
<span  style=""> 225                                                                                                          </span>
<span class="2582109723187805610" onmouseenter="enter('2582109723187805610');" onmouseout="out('2582109723187805610');" style=""> 226         List&lt;Property&gt; propList = getPropertiesFromEntityForm(entityForm);                               </span>
<span class="-5301080913609099643" onmouseenter="enter('-5301080913609099643');" onmouseout="out('-5301080913609099643');" style=""> 227         Property[] properties = new Property[propList.size()];                                           </span>
<span class="-3900695733940297394" onmouseenter="enter('-3900695733940297394');" onmouseout="out('-3900695733940297394');" style=""> 228         properties = propList.toArray(properties);                                                       </span>
<span  style=""> 229                                                                                                          </span>
<span class="-4105415098036700385" onmouseenter="enter('-4105415098036700385');" onmouseout="out('-4105415098036700385');" style=""> 230         Entity entity = new Entity();                                                                    </span>
<span class="-2371781861505771230" onmouseenter="enter('-2371781861505771230');" onmouseout="out('-2371781861505771230');" style=""> 231         entity.setProperties(properties);                                                                </span>
<span class="2583214667713512490" onmouseenter="enter('2583214667713512490');" onmouseout="out('2583214667713512490');" style=""> 232         String entityType = entityForm.getEntityType();                                                  </span>
<span class="-96692239825780670" onmouseenter="enter('-96692239825780670');" onmouseout="out('-96692239825780670');" style=""> 233         if (StringUtils.isEmpty(entityType)) {                                                           </span>
<span class="-1511101492052020501" onmouseenter="enter('-1511101492052020501');" onmouseout="out('-1511101492052020501');" style=""> 234             entityType = entityForm.getCeilingEntityClassname();                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235         }                                                                                                </span>
<span class="7921575741096618275" onmouseenter="enter('7921575741096618275');" onmouseout="out('7921575741096618275');" style=""> 236         entity.setType(new String[]{entityType});                                                        </span>
<span  style=""> 237                                                                                                          </span>
<span class="2943675610735544566" onmouseenter="enter('2943675610735544566');" onmouseout="out('2943675610735544566');" style=""> 238         PersistencePackageRequest ppr = PersistencePackageRequest.standard()                             </span>
<span class="-2471313258794916634" onmouseenter="enter('-2471313258794916634');" onmouseout="out('-2471313258794916634');" style=""> 239                 .withEntity(entity)                                                                      </span>
<span class="5641680747003306930" onmouseenter="enter('5641680747003306930');" onmouseout="out('5641680747003306930');" style=""> 240                 .withCustomCriteria(customCriteria)                                                      </span>
<span class="3304977465026105541" onmouseenter="enter('3304977465026105541');" onmouseout="out('3304977465026105541');" style=""> 241                 .withCeilingEntityClassname(entityForm.getCeilingEntityClassname())                      </span>
<span class="-600959917227055027" onmouseenter="enter('-600959917227055027');" onmouseout="out('-600959917227055027');" style=""> 242                 .withSectionCrumbs(sectionCrumbs)                                                        </span>
<span class="745722289441255857" onmouseenter="enter('745722289441255857');" onmouseout="out('745722289441255857');" style=""> 243                 .withRequestingEntityName(entityForm.getMainEntityName());                               </span>
<span class="-1955805470028526694" onmouseenter="enter('-1955805470028526694');" onmouseout="out('-1955805470028526694');" style=""> 244         return ppr;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245     }                                                                                                    </span>
<span  style=""> 246                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 247     @Override                                                                                            </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 248     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 248     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity ðŸ”µ</abbr></span>
<span class="6970881093397655354" onmouseenter="enter('6970881093397655354');" onmouseout="out('6970881093397655354');" style=""><abbr title=" 249             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId)"> 249             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, StrinðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 250             throws ServiceException {                                                                    </span>
<span class="-8379471421074460507" onmouseenter="enter('-8379471421074460507');" onmouseout="out('-8379471421074460507');" style=""><abbr title=" 251         return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty, collectionItemId, sectionCrumbs, alternateId, null);"> 251         return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252     }                                                                                                    </span>
<span  style=""> 253                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 254     @Override                                                                                            </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 255     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 255     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity ðŸ”µ</abbr></span>
<span class="-7996433221423208195" onmouseenter="enter('-7996433221423208195');" onmouseout="out('-7996433221423208195');" style=""><abbr title=" 256             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId,"> 256             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, StrinðŸ”µ</abbr></span>
<span class="4731322974144125980" onmouseenter="enter('4731322974144125980');" onmouseout="out('4731322974144125980');" style=""> 257             String[] customCriteria) throws ServiceException {                                           </span>
<span class="-279994379320395128" onmouseenter="enter('-279994379320395128');" onmouseout="out('-279994379320395128');" style=""><abbr title=" 258         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs);"> 258         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetaðŸ”µ</abbr></span>
<span  style=""> 259                                                                                                          </span>
<span class="-1281430943574994988" onmouseenter="enter('-1281430943574994988');" onmouseout="out('-1281430943574994988');" style=""> 260         ppr.addCustomCriteria(customCriteria);                                                           </span>
<span  style=""> 261                                                                                                          </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 262         FieldMetadata md = collectionProperty.getMetadata();                                             </span>
<span class="3724000031963826131" onmouseenter="enter('3724000031963826131');" onmouseout="out('3724000031963826131');" style=""><abbr title=" 263         String containingEntityId = getContextSpecificRelationshipId(containingClassMetadata, containingEntity,"> 263         String containingEntityId = getContextSpecificRelationshipId(containingClassMetadata, containingEðŸ”µ</abbr></span>
<span class="-7103210414980095383" onmouseenter="enter('-7103210414980095383');" onmouseout="out('-7103210414980095383');" style=""> 264                 collectionProperty.getName());                                                           </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 265         ppr.setSectionEntityField(collectionProperty.getName());                                         </span>
<span  style=""> 266                                                                                                          </span>
<span class="6887268983731320356" onmouseenter="enter('6887268983731320356');" onmouseout="out('6887268983731320356');" style=""> 267         PersistenceResponse response;                                                                    </span>
<span  style=""> 268                                                                                                          </span>
<span class="-5961537470500127604" onmouseenter="enter('-5961537470500127604');" onmouseout="out('-5961537470500127604');" style=""> 269         if (md instanceof AdornedTargetCollectionMetadata) {                                             </span>
<span class="8356058175939814254" onmouseenter="enter('8356058175939814254');" onmouseout="out('8356058175939814254');" style=""><abbr title=" 270             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());"> 270             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFielðŸ”µ</abbr></span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 271             fasc.setFilterValue(containingEntityId);                                                     </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 272             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 273                                                                                                          </span>
<span class="-3458751872436187064" onmouseenter="enter('-3458751872436187064');" onmouseout="out('-3458751872436187064');" style=""> 274             fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName() + &quot;Target&quot;);  </span>
<span class="-3598598531395908508" onmouseenter="enter('-3598598531395908508');" onmouseout="out('-3598598531395908508');" style=""> 275             fasc.setFilterValue(collectionItemId);                                                       </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 276             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 277                                                                                                          </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 278             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="-5748606955827926888" onmouseenter="enter('-5748606955827926888');" onmouseout="out('-5748606955827926888');" style=""> 279                 fasc = new FilterAndSortCriteria(ppr.getAdornedList().getIdProperty());                  </span>
<span class="7811712685421146637" onmouseenter="enter('7811712685421146637');" onmouseout="out('7811712685421146637');" style=""> 280                 fasc.setFilterValue(alternateId);                                                        </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 281                 ppr.addFilterAndSortCriteria(fasc);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282             }                                                                                            </span>
<span  style=""> 283                                                                                                          </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 284             response = fetch(ppr);                                                                       </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 285             Entity[] entities = response.getDynamicResultSet().getRecords();                             </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 286             if (ArrayUtils.isEmpty(entities)) {                                                          </span>
<span class="-6945066260128413327" onmouseenter="enter('-6945066260128413327');" onmouseout="out('-6945066260128413327');" style=""> 287                 String altId = (!StringUtils.isEmpty(alternateId)) ? alternateId : &quot;&quot;;                   </span>
<span class="6252787461298878948" onmouseenter="enter('6252787461298878948');" onmouseout="out('6252787461298878948');" style=""><abbr title=" 288                 throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%s], id [%s], targetId [%s], alternateId [%s] &quot;, "> 288                 throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%ðŸ”µ</abbr></span>
<span class="-631993348779519244" onmouseenter="enter('-631993348779519244');" onmouseout="out('-631993348779519244');" style=""><abbr title=" 289                         ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), containingEntityId, collectionItemId, altId));"> 289                         ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), cðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 291         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="8401290555692845532" onmouseenter="enter('8401290555692845532');" onmouseout="out('8401290555692845532');" style=""> 292             MapMetadata mmd = (MapMetadata) md;                                                          </span>
<span class="-9165857322565832123" onmouseenter="enter('-9165857322565832123');" onmouseout="out('-9165857322565832123');" style=""> 293             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());</span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 294             fasc.setFilterValue(containingEntityId);                                                     </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 295             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 296                                                                                                          </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 297             response = fetch(ppr);                                                                       </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 298             Entity[] entities = response.getDynamicResultSet().getRecords();                             </span>
<span class="-7031469698370723184" onmouseenter="enter('-7031469698370723184');" onmouseout="out('-7031469698370723184');" style=""> 299             for (Entity e : entities) {                                                                  </span>
<span class="5353809260142967112" onmouseenter="enter('5353809260142967112');" onmouseout="out('5353809260142967112');" style=""> 300                 String idProperty = getIdProperty(containingClassMetadata);                              </span>
<span class="5591331798883124479" onmouseenter="enter('5591331798883124479');" onmouseout="out('5591331798883124479');" style=""> 301                 if (mmd.isSimpleValue()) {                                                               </span>
<span class="-4161155795101164165" onmouseenter="enter('-4161155795101164165');" onmouseout="out('-4161155795101164165');" style=""> 302                     idProperty = &quot;key&quot;;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303                 }                                                                                        </span>
<span class="8921593406962610258" onmouseenter="enter('8921593406962610258');" onmouseout="out('8921593406962610258');" style=""> 304                 Property p = e.getPMap().get(idProperty);                                                </span>
<span class="6407772199744557069" onmouseenter="enter('6407772199744557069');" onmouseout="out('6407772199744557069');" style=""> 305                 if (p.getValue().equals(collectionItemId)) {                                             </span>
<span class="-7132868348925489606" onmouseenter="enter('-7132868348925489606');" onmouseout="out('-7132868348925489606');" style=""> 306                     response.setEntity(e);                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 307                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 310         } else {                                                                                         </span>
<span class="8229323461389456522" onmouseenter="enter('8229323461389456522');" onmouseout="out('8229323461389456522');" style=""><abbr title=" 311             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not an &quot; +"> 311             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="8394443338285651390" onmouseenter="enter('8394443338285651390');" onmouseout="out('8394443338285651390');" style=""><abbr title=" 312                     &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));"> 312                     &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.gðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313         }                                                                                                </span>
<span  style=""> 314                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 315         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316     }                                                                                                    </span>
<span  style=""> 317                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 318     @Override                                                                                            </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 319     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 319     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity contðŸ”µ</abbr></span>
<span class="-8940960037863570008" onmouseenter="enter('-8940960037863570008');" onmouseout="out('-8940960037863570008');" style=""><abbr title=" 320             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 320             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxInðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 321             throws ServiceException {                                                                    </span>
<span class="4618756740023180601" onmouseenter="enter('4618756740023180601');" onmouseout="out('4618756740023180601');" style=""><abbr title=" 322         return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, startIndex,"> 322         return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fasðŸ”µ</abbr></span>
<span class="2241863538673887409" onmouseenter="enter('2241863538673887409');" onmouseout="out('2241863538673887409');" style=""> 323                 maxIndex, null, sectionCrumb);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324     }                                                                                                    </span>
<span  style=""> 325                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 326     @Override                                                                                            </span>
<span class="-7201231903947653503" onmouseenter="enter('-7201231903947653503');" onmouseout="out('-7201231903947653503');" style=""><abbr title=" 327     public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 327     public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, EntityðŸ”µ</abbr></span>
<span class="418251651311673518" onmouseenter="enter('418251651311673518');" onmouseout="out('418251651311673518');" style=""><abbr title=" 328             Property collectionProperty, FilterAndSortCriteria[] fascs, FetchPageRequest fetchPageRequest,"> 328             Property collectionProperty, FilterAndSortCriteria[] fascs, FetchPageRequest fetchPageRequestðŸ”µ</abbr></span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 329             String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {          </span>
<span class="7874520314895198323" onmouseenter="enter('7874520314895198323');" onmouseout="out('7874520314895198323');" style=""><abbr title=" 330         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs)"> 330         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetaðŸ”µ</abbr></span>
<span class="-7469251084029012642" onmouseenter="enter('-7469251084029012642');" onmouseout="out('-7469251084029012642');" style=""> 331             .withFilterAndSortCriteria(fascs)                                                            </span>
<span class="-7573135850576319031" onmouseenter="enter('-7573135850576319031');" onmouseout="out('-7573135850576319031');" style=""> 332             .withStartIndex(fetchPageRequest.getStartIndex())                                            </span>
<span class="-3581511696188385312" onmouseenter="enter('-3581511696188385312');" onmouseout="out('-3581511696188385312');" style=""> 333             .withMaxIndex(fetchPageRequest.getMaxIndex())                                                </span>
<span class="-8590301553347003975" onmouseenter="enter('-8590301553347003975');" onmouseout="out('-8590301553347003975');" style=""> 334             .withFirstId(fetchPageRequest.getFirstId())                                                  </span>
<span class="2671174632142808768" onmouseenter="enter('2671174632142808768');" onmouseout="out('2671174632142808768');" style=""> 335             .withLastId(fetchPageRequest.getLastId())                                                    </span>
<span class="-6593991434037097050" onmouseenter="enter('-6593991434037097050');" onmouseout="out('-6593991434037097050');" style=""> 336             .withLowerCount(fetchPageRequest.getLowerCount())                                            </span>
<span class="-117029417959198312" onmouseenter="enter('-117029417959198312');" onmouseout="out('-117029417959198312');" style=""> 337             .withUpperCount(fetchPageRequest.getUpperCount())                                            </span>
<span class="-4278016885305366423" onmouseenter="enter('-4278016885305366423');" onmouseout="out('-4278016885305366423');" style=""> 338             .withPageSize(fetchPageRequest.getPageSize())                                                </span>
<span class="-6582704259903712752" onmouseenter="enter('-6582704259903712752');" onmouseout="out('-6582704259903712752');" style=""> 339             .withPresentationFetch(true);                                                                </span>
<span  style=""> 340                                                                                                          </span>
<span class="-3273025574919321412" onmouseenter="enter('-3273025574919321412');" onmouseout="out('-3273025574919321412');" style=""> 341         FilterAndSortCriteria fasc;                                                                      </span>
<span  style=""> 342                                                                                                          </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 343         FieldMetadata md = collectionProperty.getMetadata();                                             </span>
<span class="-4862294775264679708" onmouseenter="enter('-4862294775264679708');" onmouseout="out('-4862294775264679708');" style=""> 344         String collectionCeilingClass = null;                                                            </span>
<span  style=""> 345                                                                                                          </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 346         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 347             fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                      </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 348             collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();             </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 349         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="5713965317772328276" onmouseenter="enter('5713965317772328276');" onmouseout="out('5713965317772328276');" style=""> 350             fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());             </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 351             collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();             </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 352         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 353             fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 354         } else {                                                                                         </span>
<span class="-7764689527754153249" onmouseenter="enter('-7764689527754153249');" onmouseout="out('-7764689527754153249');" style=""><abbr title=" 355             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not a &quot; +"> 355             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="9018729105513046766" onmouseenter="enter('9018729105513046766');" onmouseout="out('9018729105513046766');" style=""><abbr title=" 356                     &quot;collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));"> 356                     &quot;collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="4254518413777245486" onmouseenter="enter('4254518413777245486');" onmouseout="out('4254518413777245486');" style=""> 359         String id;                                                                                       </span>
<span class="4803324110888028956" onmouseenter="enter('4803324110888028956');" onmouseout="out('4803324110888028956');" style=""> 360         if (idValueOverride == null) {                                                                   </span>
<span class="-7725769379673096748" onmouseenter="enter('-7725769379673096748');" onmouseout="out('-7725769379673096748');" style=""><abbr title=" 361             id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionProperty.getName());"> 361             id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionPrðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 362         } else {                                                                                         </span>
<span class="-8702106967230782193" onmouseenter="enter('-8702106967230782193');" onmouseout="out('-8702106967230782193');" style=""> 363             id = idValueOverride;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 365         fasc.setFilterValue(id);                                                                         </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 366         ppr.addFilterAndSortCriteria(fasc);                                                              </span>
<span  style=""> 367                                                                                                          </span>
<span class="427990645680582522" onmouseenter="enter('427990645680582522');" onmouseout="out('427990645680582522');" style=""> 368         if (collectionCeilingClass != null) {                                                            </span>
<span class="-6816699203213465846" onmouseenter="enter('-6816699203213465846');" onmouseout="out('-6816699203213465846');" style=""> 369             ppr.setCeilingEntityClassname(collectionCeilingClass);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370         }                                                                                                </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 371         ppr.setSectionEntityField(collectionProperty.getName());                                         </span>
<span  style=""> 372                                                                                                          </span>
<span class="4509000565359254391" onmouseenter="enter('4509000565359254391');" onmouseout="out('4509000565359254391');" style=""> 373         return fetch(ppr);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374     }                                                                                                    </span>
<span  style=""> 375                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 376     @Override                                                                                            </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 377     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 377     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity contðŸ”µ</abbr></span>
<span class="509622451136715712" onmouseenter="enter('509622451136715712');" onmouseout="out('509622451136715712');" style=""><abbr title=" 378             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex,"> 378             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxInðŸ”µ</abbr></span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 379             String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {          </span>
<span class="-1197294568643910019" onmouseenter="enter('-1197294568643910019');" onmouseout="out('-1197294568643910019');" style=""><abbr title=" 380         FetchPageRequest pageRequest = new FetchPageRequest().withStartIndex(startIndex).withMaxIndex(maxIndex);"> 380         FetchPageRequest pageRequest = new FetchPageRequest().withStartIndex(startIndex).withMaxIndex(maxðŸ”µ</abbr></span>
<span class="-1074537376579155932" onmouseenter="enter('-1074537376579155932');" onmouseout="out('-1074537376579155932');" style=""><abbr title=" 381         return getPagedRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs,"> 381         return getPagedRecordsForCollection(containingClassMetadata, containingEntity, collectionPropertyðŸ”µ</abbr></span>
<span class="-3163237569846875940" onmouseenter="enter('-3163237569846875940');" onmouseout="out('-3163237569846875940');" style=""> 382                 pageRequest, idValueOverride, sectionCrumbs);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383     }                                                                                                    </span>
<span  style=""> 384                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 385     @Override                                                                                            </span>
<span class="-3841297295714521949" onmouseenter="enter('-3841297295714521949');" onmouseout="out('-3841297295714521949');" style=""><abbr title=" 386     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 386     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, EnðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 387             throws ServiceException {                                                                    </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 388         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                     </span>
<span  style=""> 389                                                                                                          </span>
<span class="-733567857055224528" onmouseenter="enter('-733567857055224528');" onmouseout="out('-733567857055224528');" style=""> 390         PersistenceResponse response = getClassMetadata(ppr);                                            </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 391         ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                           </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 392         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 393             if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])</span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 394                     &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                  </span>
<span class="8095643692447388517" onmouseenter="enter('8095643692447388517');" onmouseout="out('8095643692447388517');" style=""><abbr title=" 395                 PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, startIndex, maxIndex, sectionCrumb);"> 395                 PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, sðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 396                 map.put(p.getName(), response2.getDynamicResultSet());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398         }                                                                                                </span>
<span  style=""> 399                                                                                                          </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 400         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401     }                                                                                                    </span>
<span  style=""> 402                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 403     @Override                                                                                            </span>
<span class="-3628970257678085943" onmouseenter="enter('-3628970257678085943');" onmouseout="out('-3628970257678085943');" style=""><abbr title=" 404     public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity containingEntity,"> 404     public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity contðŸ”µ</abbr></span>
<span class="-4231090245204295086" onmouseenter="enter('-4231090245204295086');" onmouseout="out('-4231090245204295086');" style=""><abbr title=" 405                                                                            List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 405                                                                            List&lt;SectionCrumb&gt; sectionCrumðŸ”µ</abbr></span>
<span class="-2409741133586104337" onmouseenter="enter('-2409741133586104337');" onmouseout="out('-2409741133586104337');" style=""> 406         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;&gt;();                                             </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 407         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="4164210101311278906" onmouseenter="enter('4164210101311278906');" onmouseout="out('4164210101311278906');" style=""> 408             FieldMetadata fieldMetadata = p.getMetadata();                                               </span>
<span class="-4624883475289984299" onmouseenter="enter('-4624883475289984299');" onmouseout="out('-4624883475289984299');" style=""><abbr title=" 409             boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEntity.getType()[0]);"> 409             boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEðŸ”µ</abbr></span>
<span class="527509468046610128" onmouseenter="enter('527509468046610128');" onmouseout="out('527509468046610128');" style=""> 410             if (fieldAvailable &amp;&amp; fieldMetadata instanceof CollectionMetadata) {                         </span>
<span class="889550045664327310" onmouseenter="enter('889550045664327310');" onmouseout="out('889550045664327310');" style=""> 411                 FetchPageRequest pageRequest = new FetchPageRequest()                                    </span>
<span class="7756015397659671998" onmouseenter="enter('7756015397659671998');" onmouseout="out('7756015397659671998');" style=""> 412                         .withPageSize(Integer.MAX_VALUE);                                                </span>
<span class="-5742395122034161641" onmouseenter="enter('-5742395122034161641');" onmouseout="out('-5742395122034161641');" style=""><abbr title=" 413                 PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pageRequest, null, sectionCrumb);"> 413                 PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pðŸ”µ</abbr></span>
<span class="7448530828258193539" onmouseenter="enter('7448530828258193539');" onmouseout="out('7448530828258193539');" style=""> 414                 map.put(p.getName(), resp.getDynamicResultSet());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416         }                                                                                                </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 417         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418     }                                                                                                    </span>
<span  style=""> 419                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 420     @Override                                                                                            </span>
<span class="3589590817922421749" onmouseenter="enter('3589590817922421749');" onmouseout="out('3589590817922421749');" style=""><abbr title=" 421     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb)"> 421     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, EnðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 422             throws ServiceException {                                                                    </span>
<span  style=""> 423                                                                                                          </span>
<span class="7186594912669123504" onmouseenter="enter('7186594912669123504');" onmouseout="out('7186594912669123504');" style=""> 424         return getRecordsForAllSubCollections(ppr, containingEntity, null, null, sectionCrumb);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425     }                                                                                                    </span>
<span  style=""> 426                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 427     @Override                                                                                            </span>
<span class="-7386306397684799123" onmouseenter="enter('-7386306397684799123');" onmouseout="out('-7386306397684799123');" style=""><abbr title=" 428     public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb,"> 428     public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntðŸ”µ</abbr></span>
<span class="-5959215544738911709" onmouseenter="enter('-5959215544738911709');" onmouseout="out('-5959215544738911709');" style=""> 429             String currentTabName) throws ServiceException {                                             </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 430         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                     </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 431         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 432             if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])</span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 433                     &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                  </span>
<span  style=""> 434                                                                                                          </span>
<span class="-8882071661255371966" onmouseenter="enter('-8882071661255371966');" onmouseout="out('-8882071661255371966');" style=""> 435                 CollectionMetadata collectionMetadata = (CollectionMetadata) p.getMetadata();            </span>
<span  style=""> 436                                                                                                          </span>
<span class="-6866172471902490379" onmouseenter="enter('-6866172471902490379');" onmouseout="out('-6866172471902490379');" style=""><abbr title=" 437                 // Give preference to the Group since EntityForm.addListGrid() gives preference to the Group"> 437                 // Give preference to the Group since EntityForm.addListGrid() gives preference to the GrðŸ”µ</abbr></span>
<span class="5847566346942070760" onmouseenter="enter('5847566346942070760');" onmouseout="out('5847566346942070760');" style=""> 438                 TabMetadata tabMetadata = cmd.getTabMetadataUsingGroupKey(collectionMetadata.getGroup());</span>
<span class="5004852122593217272" onmouseenter="enter('5004852122593217272');" onmouseout="out('5004852122593217272');" style=""> 439                 if (tabMetadata == null) {                                                               </span>
<span class="231191347318133709" onmouseenter="enter('231191347318133709');" onmouseout="out('231191347318133709');" style=""> 440                     tabMetadata = cmd.getTabMetadataUsingTabKey(collectionMetadata.getTab());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441                 }                                                                                        </span>
<span  style=""> 442                                                                                                          </span>
<span class="-3015386838727954630" onmouseenter="enter('-3015386838727954630');" onmouseout="out('-3015386838727954630');" style=""><abbr title=" 443                 String tabName = tabMetadata == null ? collectionMetadata.getTab() : tabMetadata.getTabName();"> 443                 String tabName = tabMetadata == null ? collectionMetadata.getTab() : tabMetadata.getTabNaðŸ”µ</abbr></span>
<span class="-7179383252706615246" onmouseenter="enter('-7179383252706615246');" onmouseout="out('-7179383252706615246');" style=""><abbr title=" 444                 int tabOrder = tabMetadata == null ? collectionMetadata.getTabOrder() : tabMetadata.getTabOrder();"> 444                 int tabOrder = tabMetadata == null ? collectionMetadata.getTabOrder() : tabMetadata.getTaðŸ”µ</abbr></span>
<span class="-1384994182862418254" onmouseenter="enter('-1384994182862418254');" onmouseout="out('-1384994182862418254');" style=""> 445                 updateTabInfo(collectionMetadata, cmd, tabName, tabOrder);                               </span>
<span  style=""> 446                                                                                                          </span>
<span class="8686774820240993219" onmouseenter="enter('8686774820240993219');" onmouseout="out('8686774820240993219');" style=""> 447                 if (collectionMetadata.getLazyFetch() != null &amp;&amp; collectionMetadata.getLazyFetch()       </span>
<span class="5105727312979860339" onmouseenter="enter('5105727312979860339');" onmouseout="out('5105727312979860339');" style=""> 448                         &amp;&amp; tabName.toUpperCase().startsWith(currentTabName.toUpperCase())                </span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 449                         &amp;&amp; !collectionMetadata.getManualFetch()) {                                       </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 450                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 450                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, nulðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 451                     map.put(p.getName(), response2.getDynamicResultSet());                               </span>
<span class="8148681537408196343" onmouseenter="enter('8148681537408196343');" onmouseout="out('8148681537408196343');" style=""><abbr title=" 452                 } else if (collectionMetadata.getLazyFetch() != null &amp;&amp; !collectionMetadata.getLazyFetch()"> 452                 } else if (collectionMetadata.getLazyFetch() != null &amp;&amp; !collectionMetadata.getLazyFetch(ðŸ”µ</abbr></span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 453                         &amp;&amp; !collectionMetadata.getManualFetch()) {                                       </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 454                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 454                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, nulðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 455                     map.put(p.getName(), response2.getDynamicResultSet());                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 456                 } else {                                                                                 </span>
<span class="4201070416549217756" onmouseenter="enter('4201070416549217756');" onmouseout="out('4201070416549217756');" style=""> 457                     DynamicResultSet drs = new DynamicResultSet();                                       </span>
<span class="133064617150058408" onmouseenter="enter('133064617150058408');" onmouseout="out('133064617150058408');" style=""> 458                     Map&lt;String, Tab&gt; tabMap = new HashMap&lt;String, Tab&gt;();                                </span>
<span class="52154028506366978" onmouseenter="enter('52154028506366978');" onmouseout="out('52154028506366978');" style=""> 459                     Tab tab = new Tab();                                                                 </span>
<span class="7573724056713363868" onmouseenter="enter('7573724056713363868');" onmouseout="out('7573724056713363868');" style=""> 460                     tab.setKey(tabName);                                                                 </span>
<span class="6935872114105155637" onmouseenter="enter('6935872114105155637');" onmouseout="out('6935872114105155637');" style=""> 461                     tab.setTitle(BLCMessageUtils.getMessage(tabName));                                   </span>
<span class="-3862389491808527983" onmouseenter="enter('-3862389491808527983');" onmouseout="out('-3862389491808527983');" style=""> 462                     tab.setOrder(tabOrder);                                                              </span>
<span class="-8730262596017656059" onmouseenter="enter('-8730262596017656059');" onmouseout="out('-8730262596017656059');" style=""> 463                     tabMap.put(tab.getTitle(), tab);                                                     </span>
<span class="6973540073738050016" onmouseenter="enter('6973540073738050016');" onmouseout="out('6973540073738050016');" style=""> 464                     drs.setUnselectedTabMetadata(tabMap);                                                </span>
<span class="-3072709309961217124" onmouseenter="enter('-3072709309961217124');" onmouseout="out('-3072709309961217124');" style=""> 465                     drs.setTotalRecords(0);                                                              </span>
<span class="8982521778669319238" onmouseenter="enter('8982521778669319238');" onmouseout="out('8982521778669319238');" style=""> 466                     drs.setStartIndex(0);                                                                </span>
<span class="-2316590965963048275" onmouseenter="enter('-2316590965963048275');" onmouseout="out('-2316590965963048275');" style=""> 467                     drs.setBatchId(1);                                                                   </span>
<span class="6524963296885553626" onmouseenter="enter('6524963296885553626');" onmouseout="out('6524963296885553626');" style=""> 468                     drs.setClassMetaData(null);                                                          </span>
<span class="5830489670252814572" onmouseenter="enter('5830489670252814572');" onmouseout="out('5830489670252814572');" style=""> 469                     drs.setPageSize(1);                                                                  </span>
<span class="-3474843426091445352" onmouseenter="enter('-3474843426091445352');" onmouseout="out('-3474843426091445352');" style=""> 470                     drs.setRecords(new Entity[0]);                                                       </span>
<span class="5333638146813618055" onmouseenter="enter('5333638146813618055');" onmouseout="out('5333638146813618055');" style=""> 471                     map.put(p.getName(), drs);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474         }                                                                                                </span>
<span  style=""> 475                                                                                                          </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 476         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477     }                                                                                                    </span>
<span  style=""> 478                                                                                                          </span>
<span class="-8906234562852924572" onmouseenter="enter('-8906234562852924572');" onmouseout="out('-8906234562852924572');" style=""><abbr title=" 479     protected void updateTabInfo(CollectionMetadata fmd, ClassMetadata cmd, String tabName, int tabOrder) {"> 479     protected void updateTabInfo(CollectionMetadata fmd, ClassMetadata cmd, String tabName, int tabOrder)ðŸ”µ</abbr></span>
<span class="6418671463533151954" onmouseenter="enter('6418671463533151954');" onmouseout="out('6418671463533151954');" style=""> 480         boolean tabInfoFound = false;                                                                    </span>
<span class="5408213491241477604" onmouseenter="enter('5408213491241477604');" onmouseout="out('5408213491241477604');" style=""> 481         Map&lt;String, TabMetadata&gt; tabMetadataMap = cmd.getTabAndGroupMetadata();                          </span>
<span class="-2540078251533437241" onmouseenter="enter('-2540078251533437241');" onmouseout="out('-2540078251533437241');" style=""> 482         for (String tabKey : tabMetadataMap.keySet()) {                                                  </span>
<span class="7583512444437065393" onmouseenter="enter('7583512444437065393');" onmouseout="out('7583512444437065393');" style=""> 483             Map&lt;String, GroupMetadata&gt; groupMetadataMap = tabMetadataMap.get(tabKey).getGroupMetadata(); </span>
<span class="-5526517230184735053" onmouseenter="enter('-5526517230184735053');" onmouseout="out('-5526517230184735053');" style=""> 484             for (String groupKey : groupMetadataMap.keySet()) {                                          </span>
<span class="98584842541508129" onmouseenter="enter('98584842541508129');" onmouseout="out('98584842541508129');" style=""><abbr title=" 485                 if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equals(fmd.getGroup())) {"> 485                 if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equaðŸ”µ</abbr></span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 486                     tabName = tabMetadataMap.get(tabKey).getTabName();                                   </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 487                     tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                 </span>
<span class="4945701621495059563" onmouseenter="enter('4945701621495059563');" onmouseout="out('4945701621495059563');" style=""> 488                     tabInfoFound = true;                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 489                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491             }                                                                                            </span>
<span class="1550248699436795528" onmouseenter="enter('1550248699436795528');" onmouseout="out('1550248699436795528');" style=""> 492             if (tabInfoFound) {                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 493                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494             }                                                                                            </span>
<span class="6331731299217129446" onmouseenter="enter('6331731299217129446');" onmouseout="out('6331731299217129446');" style=""> 495             if (tabKey.equals(tabName) || tabMetadataMap.get(tabKey).getTabName().equals(tabName)) {     </span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 496                 tabName = tabMetadataMap.get(tabKey).getTabName();                                       </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 497                 tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500     }                                                                                                    </span>
<span  style=""> 501                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 502     @Override                                                                                            </span>
<span class="2611376483592856297" onmouseenter="enter('2611376483592856297');" onmouseout="out('2611376483592856297');" style=""><abbr title=" 503     public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field,"> 503     public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, ðŸ”µ</abbr></span>
<span class="6733854382866461502" onmouseenter="enter('6733854382866461502');" onmouseout="out('6733854382866461502');" style=""> 504             Entity parentEntity, List&lt;SectionCrumb&gt; sectionCrumbs)                                       </span>
<span class="-9069306879086868954" onmouseenter="enter('-9069306879086868954');" onmouseout="out('-9069306879086868954');" style=""> 505             throws ServiceException, ClassNotFoundException {                                            </span>
<span class="-8197057147118619768" onmouseenter="enter('-8197057147118619768');" onmouseout="out('-8197057147118619768');" style=""> 506         // Assemble the properties from the entity form                                                  </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 507         List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                             </span>
<span  style=""> 508                                                                                                          </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 509         FieldMetadata md = field.getMetadata();                                                          </span>
<span  style=""> 510                                                                                                          </span>
<span class="-3154651088293222897" onmouseenter="enter('-3154651088293222897');" onmouseout="out('-3154651088293222897');" style=""> 511         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs)        </span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 512                 .withEntity(new Entity());                                                               </span>
<span class="6854684741721952189" onmouseenter="enter('6854684741721952189');" onmouseout="out('6854684741721952189');" style=""> 513         ppr.getEntity().setIsPreAdd(parentEntity.isPreAdd());                                            </span>
<span  style=""> 514                                                                                                          </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 515         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="6607267312947776736" onmouseenter="enter('6607267312947776736');" onmouseout="out('6607267312947776736');" style=""> 516             BasicCollectionMetadata fmd = (BasicCollectionMetadata) md;                                  </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 517             ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                        </span>
<span  style=""> 518                                                                                                          </span>
<span class="-2325626323266423717" onmouseenter="enter('-2325626323266423717');" onmouseout="out('-2325626323266423717');" style=""> 519             // If we&#x27;re looking up an entity instead of trying to create one on the fly, let&#x27;s make sure </span>
<span class="3526840633411573677" onmouseenter="enter('3526840633411573677');" onmouseout="out('3526840633411573677');" style=""><abbr title=" 520             // that we&#x27;re not changing the target entity at all and only creating the association to the id"> 520             // that we&#x27;re not changing the target entity at all and only creating the association to the ðŸ”µ</abbr></span>
<span class="3093503126858687967" onmouseenter="enter('3093503126858687967');" onmouseout="out('3093503126858687967');" style=""> 521             if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP) ||                                   </span>
<span class="6274591046536853861" onmouseenter="enter('6274591046536853861');" onmouseout="out('6274591046536853861');" style=""> 522                     fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                    </span>
<span class="1728529167243720357" onmouseenter="enter('1728529167243720357');" onmouseout="out('1728529167243720357');" style=""> 523                 List&lt;String&gt; fieldsToRemove = new ArrayList&lt;String&gt;();                                   </span>
<span  style=""> 524                                                                                                          </span>
<span class="8261635343050838543" onmouseenter="enter('8261635343050838543');" onmouseout="out('8261635343050838543');" style=""> 525                 String idProp = getIdProperty(mainMetadata);                                             </span>
<span class="7372165960962811555" onmouseenter="enter('7372165960962811555');" onmouseout="out('7372165960962811555');" style=""> 526                 for (String key : entityForm.getFields().keySet()) {                                     </span>
<span class="-3969218055241208355" onmouseenter="enter('-3969218055241208355');" onmouseout="out('-3969218055241208355');" style=""> 527                     if (!idProp.equals(key)) {                                                           </span>
<span class="329726563907215496" onmouseenter="enter('329726563907215496');" onmouseout="out('329726563907215496');" style=""> 528                         fieldsToRemove.add(key);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530                 }                                                                                        </span>
<span  style=""> 531                                                                                                          </span>
<span class="-8204439459370995320" onmouseenter="enter('-8204439459370995320');" onmouseout="out('-8204439459370995320');" style=""> 532                 for (String key : fieldsToRemove) {                                                      </span>
<span class="-3002518314516620728" onmouseenter="enter('-3002518314516620728');" onmouseout="out('-3002518314516620728');" style=""> 533                     ListIterator&lt;Property&gt; li = properties.listIterator();                               </span>
<span class="-3598623445235132470" onmouseenter="enter('-3598623445235132470');" onmouseout="out('-3598623445235132470');" style=""> 534                     while (li.hasNext()) {                                                               </span>
<span class="-4936311913022510436" onmouseenter="enter('-4936311913022510436');" onmouseout="out('-4936311913022510436');" style=""> 535                         if (li.next().getName().equals(key)) {                                           </span>
<span class="-7629195606720709622" onmouseenter="enter('-7629195606720709622');" onmouseout="out('-7629195606720709622');" style=""> 536                             li.remove();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 537                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539                 }                                                                                        </span>
<span  style=""> 540                                                                                                          </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 541                 ppr.setValidateUnsubmittedProperties(false);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542             }                                                                                            </span>
<span  style=""> 543                                                                                                          </span>
<span class="-2511723907351376263" onmouseenter="enter('-2511723907351376263');" onmouseout="out('-2511723907351376263');" style=""> 544             if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                        </span>
<span class="4303470812456182979" onmouseenter="enter('4303470812456182979');" onmouseout="out('4303470812456182979');" style=""> 545                 ppr.setUpdateLookupType(true);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546             }                                                                                            </span>
<span  style=""> 547                                                                                                          </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 548             Property fp = new Property();                                                                </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 549             fp.setName(ppr.getForeignKey().getManyToField());                                            </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 550             fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));  </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 551             properties.add(fp);                                                                          </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 552         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="-4636884806383263612" onmouseenter="enter('-4636884806383263612');" onmouseout="out('-4636884806383263612');" style=""><abbr title=" 553             ppr.getEntity().setType(new String[] { ppr.getAdornedList().getAdornedTargetEntityClassname() });"> 553             ppr.getEntity().setType(new String[] { ppr.getAdornedList().getAdornedTargetEntityClassname()ðŸ”µ</abbr></span>
<span  style=""> 554                                                                                                          </span>
<span class="-8504901264761703182" onmouseenter="enter('-8504901264761703182');" onmouseout="out('-8504901264761703182');" style=""><abbr title=" 555             String[] maintainedFields = ((AdornedTargetCollectionMetadata) md).getMaintainedAdornedTargetFields();"> 555             String[] maintainedFields = ((AdornedTargetCollectionMetadata) md).getMaintainedAdornedTargetðŸ”µ</abbr></span>
<span class="7296878925630910355" onmouseenter="enter('7296878925630910355');" onmouseout="out('7296878925630910355');" style=""> 556             if (maintainedFields == null || maintainedFields.length == 0) {                              </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 557                 ppr.setValidateUnsubmittedProperties(false);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 558             }                                                                                            </span>
<span  style=""> 559                                                                                                          </span>
<span class="6130424394313681013" onmouseenter="enter('6130424394313681013');" onmouseout="out('6130424394313681013');" style=""> 560             // Fix for an adorned target collection where the link is maintained from a                  </span>
<span class="-1209465127207262219" onmouseenter="enter('-1209465127207262219');" onmouseout="out('-1209465127207262219');" style=""> 561             // ToOne property on a main entity                                                           </span>
<span class="-4782433380384096940" onmouseenter="enter('-4782433380384096940');" onmouseout="out('-4782433380384096940');" style=""><abbr title=" 562             String linkedProperty = ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot; + ppr.getAdornedList().getLinkedIdProperty();"> 562             String linkedProperty = ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot; + ppr.getAdornedListðŸ”µ</abbr></span>
<span class="-7677283136075345929" onmouseenter="enter('-7677283136075345929');" onmouseout="out('-7677283136075345929');" style=""> 563             for (Property p : properties) {                                                              </span>
<span class="-6798041327943240930" onmouseenter="enter('-6798041327943240930');" onmouseout="out('-6798041327943240930');" style=""> 564                 if (p.getName().equals(linkedProperty)) {                                                </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""><abbr title=" 565                     p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));"> 565                     p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getNameðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 568         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 569             ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                        </span>
<span  style=""> 570                                                                                                          </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 571             Property p = new Property();                                                                 </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 572             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 573             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 574             properties.add(p);                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 575         } else {                                                                                         </span>
<span class="6589458496639047773" onmouseenter="enter('6589458496639047773');" onmouseout="out('6589458496639047773');" style=""><abbr title=" 576             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; +"> 576             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="8841076042243319225" onmouseenter="enter('8841076042243319225');" onmouseout="out('8841076042243319225');" style=""> 577                     &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578         }                                                                                                </span>
<span  style=""> 579                                                                                                          </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 580         ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                     </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 581         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 582         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 583             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 585         ppr.setSectionEntityField(sectionField);                                                         </span>
<span  style=""> 586                                                                                                          </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 587         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 588         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 589             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 590         }else {                                                                                          </span>
<span class="1891301505194787668" onmouseenter="enter('1891301505194787668');" onmouseout="out('1891301505194787668');" style=""> 591             Property name = parentEntity.getPMap().get(&quot;name&quot;);                                          </span>
<span class="5844109132794648466" onmouseenter="enter('5844109132794648466');" onmouseout="out('5844109132794648466');" style=""> 592             if(name !=null) {                                                                            </span>
<span class="-827206152183551520" onmouseenter="enter('-827206152183551520');" onmouseout="out('-827206152183551520');" style=""> 593                 ppr.setRequestingEntityName(name.getValue());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595         }                                                                                                </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 596         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 597         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 598         ppr.getEntity().setProperties(propArr);                                                          </span>
<span  style=""> 599                                                                                                          </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 600         return add(ppr);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601     }                                                                                                    </span>
<span  style=""> 602                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 603     @Override                                                                                            </span>
<span class="-7675709464639024415" onmouseenter="enter('-7675709464639024415');" onmouseout="out('-7675709464639024415');" style=""><abbr title=" 604     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property"> 604     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadatðŸ”µ</abbr></span>
<span class="-2028598087534015745" onmouseenter="enter('-2028598087534015745');" onmouseout="out('-2028598087534015745');" style=""><abbr title=" 605             field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException, ClassNotFoundException {"> 605             field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ðŸ”µ</abbr></span>
<span class="5486792043368910160" onmouseenter="enter('5486792043368910160');" onmouseout="out('5486792043368910160');" style=""><abbr title=" 606         return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId, null, sectionCrumb);"> 606         return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607     }                                                                                                    </span>
<span  style=""> 608                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 609     @Override                                                                                            </span>
<span class="397736636649329238" onmouseenter="enter('397736636649329238');" onmouseout="out('397736636649329238');" style=""><abbr title=" 610     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field,"> 610     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadatðŸ”µ</abbr></span>
<span class="-318365979879509230" onmouseenter="enter('-318365979879509230');" onmouseout="out('-318365979879509230');" style=""><abbr title=" 611             Entity parentEntity, String collectionItemId, String alternateId, List&lt;SectionCrumb&gt; sectionCrumbs)"> 611             Entity parentEntity, String collectionItemId, String alternateId, List&lt;SectionCrumb&gt; sectionCðŸ”µ</abbr></span>
<span class="-9069306879086868954" onmouseenter="enter('-9069306879086868954');" onmouseout="out('-9069306879086868954');" style=""> 612             throws ServiceException, ClassNotFoundException {                                            </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 613         List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                             </span>
<span  style=""> 614                                                                                                          </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 615         FieldMetadata md = field.getMetadata();                                                          </span>
<span  style=""> 616                                                                                                          </span>
<span class="-3154651088293222897" onmouseenter="enter('-3154651088293222897');" onmouseout="out('-3154651088293222897');" style=""> 617         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs)        </span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 618                 .withEntity(new Entity());                                                               </span>
<span  style=""> 619                                                                                                          </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 620         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="6607267312947776736" onmouseenter="enter('6607267312947776736');" onmouseout="out('6607267312947776736');" style=""> 621             BasicCollectionMetadata fmd = (BasicCollectionMetadata) md;                                  </span>
<span class="226826482246311757" onmouseenter="enter('226826482246311757');" onmouseout="out('226826482246311757');" style=""> 622             ppr.setCeilingEntityClassname(fmd.getCollectionCeilingEntity());                             </span>
<span class="-5249561197408255652" onmouseenter="enter('-5249561197408255652');" onmouseout="out('-5249561197408255652');" style=""> 623             ppr.getEntity().setType(new String[] { fmd.getCollectionCeilingEntity() });                  </span>
<span  style=""> 624                                                                                                          </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 625             Property fp = new Property();                                                                </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 626             fp.setName(ppr.getForeignKey().getManyToField());                                            </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 627             fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));  </span>
<span class="8450408142962005401" onmouseenter="enter('8450408142962005401');" onmouseout="out('8450408142962005401');" style=""> 628             if (!properties.contains(fp)) {                                                              </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 629                 properties.add(fp);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630             }                                                                                            </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 631         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="-736797126069743382" onmouseenter="enter('-736797126069743382');" onmouseout="out('-736797126069743382');" style=""> 632             String adornedTargetEntityClassname = ppr.getAdornedList().getAdornedTargetEntityClassname();</span>
<span class="-3984105731247699024" onmouseenter="enter('-3984105731247699024');" onmouseout="out('-3984105731247699024');" style=""> 633             ppr.setCeilingEntityClassname(adornedTargetEntityClassname);                                 </span>
<span class="-4067322056629005576" onmouseenter="enter('-4067322056629005576');" onmouseout="out('-4067322056629005576');" style=""> 634             ppr.getEntity().setType(new String[] {adornedTargetEntityClassname});                        </span>
<span  style=""> 635                                                                                                          </span>
<span class="2404180692851035070" onmouseenter="enter('2404180692851035070');" onmouseout="out('2404180692851035070');" style=""> 636             for (Property property : properties) {                                                       </span>
<span class="-3911962540946632188" onmouseenter="enter('-3911962540946632188');" onmouseout="out('-3911962540946632188');" style=""> 637                 if (property.getName().equals(ppr.getAdornedList().getLinkedObjectPath() +               </span>
<span class="2022280188845233855" onmouseenter="enter('2022280188845233855');" onmouseout="out('2022280188845233855');" style=""> 638                                     &quot;.&quot; + ppr.getAdornedList().getLinkedIdProperty())) {                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 639                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 641             }                                                                                            </span>
<span  style=""> 642                                                                                                          </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 643             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 644                 Property p = new Property();                                                             </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 645                 p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                 </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 646                 p.setValue(alternateId);                                                                 </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 647                 if (!properties.contains(p)) {                                                           </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 648                     properties.add(p);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 650             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 651         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 652             ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                        </span>
<span  style=""> 653                                                                                                          </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 654             Property p = new Property();                                                                 </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 655             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 656             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 657             properties.add(p);                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 658         } else {                                                                                         </span>
<span class="6589458496639047773" onmouseenter="enter('6589458496639047773');" onmouseout="out('6589458496639047773');" style=""><abbr title=" 659             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; +"> 659             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="8841076042243319225" onmouseenter="enter('8841076042243319225');" onmouseout="out('8841076042243319225');" style=""> 660                     &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661         }                                                                                                </span>
<span  style=""> 662                                                                                                          </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 663         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 664         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 665             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 667         ppr.setSectionEntityField(sectionField);                                                         </span>
<span  style=""> 668                                                                                                          </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 669         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 670         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 671             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672         }                                                                                                </span>
<span  style=""> 673                                                                                                          </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 674         Property p = new Property();                                                                     </span>
<span class="76365074730046782" onmouseenter="enter('76365074730046782');" onmouseout="out('76365074730046782');" style=""> 675         p.setName(entityForm.getIdProperty());                                                           </span>
<span class="-4252521779434663948" onmouseenter="enter('-4252521779434663948');" onmouseout="out('-4252521779434663948');" style=""> 676         p.setValue(collectionItemId);                                                                    </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 677         if (!properties.contains(p)) {                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 678             properties.add(p);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679         }                                                                                                </span>
<span  style=""> 680                                                                                                          </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 681         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 682         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 683         ppr.getEntity().setProperties(propArr);                                                          </span>
<span  style=""> 684                                                                                                          </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 685         return update(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686     }                                                                                                    </span>
<span  style=""> 687                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 688     @Override                                                                                            </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 689     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 689     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, EntiðŸ”µ</abbr></span>
<span class="7718985087288552750" onmouseenter="enter('7718985087288552750');" onmouseout="out('7718985087288552750');" style=""><abbr title=" 690                 String itemId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {"> 690                 String itemId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceExceptionðŸ”µ</abbr></span>
<span class="1153666597088080540" onmouseenter="enter('1153666597088080540');" onmouseout="out('1153666597088080540');" style=""><abbr title=" 691         return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectionCrumbs);"> 691         return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectiðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692     }                                                                                                    </span>
<span  style=""> 693                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 694     @Override                                                                                            </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 695     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 695     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, EntiðŸ”µ</abbr></span>
<span class="-7641167286743654353" onmouseenter="enter('-7641167286743654353');" onmouseout="out('-7641167286743654353');" style=""><abbr title=" 696             String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {"> 696             String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ðŸ”µ</abbr></span>
<span class="6439752407856920746" onmouseenter="enter('6439752407856920746');" onmouseout="out('6439752407856920746');" style=""> 697         List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;();                                           </span>
<span  style=""> 698                                                                                                          </span>
<span class="-7639830684562317861" onmouseenter="enter('-7639830684562317861');" onmouseout="out('-7639830684562317861');" style=""> 699         Property p;                                                                                      </span>
<span class="5073856407409165319" onmouseenter="enter('5073856407409165319');" onmouseout="out('5073856407409165319');" style=""> 700         String parentId = getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()); </span>
<span  style=""> 701                                                                                                          </span>
<span class="255305470667416020" onmouseenter="enter('255305470667416020');" onmouseout="out('255305470667416020');" style=""><abbr title=" 702         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(field.getMetadata(), sectionCrumbs)"> 702         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(field.getMetadata(), sectiðŸ”µ</abbr></span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 703                 .withEntity(new Entity());                                                               </span>
<span  style=""> 704                                                                                                          </span>
<span class="6642416971497632068" onmouseenter="enter('6642416971497632068');" onmouseout="out('6642416971497632068');" style=""> 705         if (field.getMetadata() instanceof BasicCollectionMetadata) {                                    </span>
<span class="5195082360751194411" onmouseenter="enter('5195082360751194411');" onmouseout="out('5195082360751194411');" style=""> 706             BasicCollectionMetadata fmd = (BasicCollectionMetadata) field.getMetadata();                 </span>
<span  style=""> 707                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 708             p = new Property();                                                                          </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 709             p.setName(&quot;id&quot;);                                                                             </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 710             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 711             properties.add(p);                                                                           </span>
<span  style=""> 712                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 713             p = new Property();                                                                          </span>
<span class="736571882968420419" onmouseenter="enter('736571882968420419');" onmouseout="out('736571882968420419');" style=""> 714             p.setName(ppr.getForeignKey().getManyToField());                                             </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 715             p.setValue(parentId);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 716             properties.add(p);                                                                           </span>
<span  style=""> 717                                                                                                          </span>
<span class="6632512256771168785" onmouseenter="enter('6632512256771168785');" onmouseout="out('6632512256771168785');" style=""> 718             ppr.getEntity().setType(new String[]{fmd.getCollectionCeilingEntity()});                     </span>
<span class="2294469176396117772" onmouseenter="enter('2294469176396117772');" onmouseout="out('2294469176396117772');" style=""> 719         } else if (field.getMetadata() instanceof AdornedTargetCollectionMetadata) {                     </span>
<span class="-1689031862376375101" onmouseenter="enter('-1689031862376375101');" onmouseout="out('-1689031862376375101');" style=""> 720             AdornedTargetList adornedList = ppr.getAdornedList();                                        </span>
<span  style=""> 721                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 722             p = new Property();                                                                          </span>
<span class="-8312107819432651962" onmouseenter="enter('-8312107819432651962');" onmouseout="out('-8312107819432651962');" style=""> 723             p.setName(adornedList.getLinkedObjectPath() + &quot;.&quot; + adornedList.getLinkedIdProperty());      </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 724             p.setValue(parentId);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 725             properties.add(p);                                                                           </span>
<span  style=""> 726                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 727             p = new Property();                                                                          </span>
<span class="371368176127783534" onmouseenter="enter('371368176127783534');" onmouseout="out('371368176127783534');" style=""> 728             p.setName(adornedList.getTargetObjectPath() + &quot;.&quot; + adornedList.getTargetIdProperty());      </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 729             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 730             properties.add(p);                                                                           </span>
<span  style=""> 731                                                                                                          </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 732             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 733                 p = new Property();                                                                      </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 734                 p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                 </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 735                 p.setValue(alternateId);                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 736                 properties.add(p);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737             }                                                                                            </span>
<span  style=""> 738                                                                                                          </span>
<span class="-2729449254338899005" onmouseenter="enter('-2729449254338899005');" onmouseout="out('-2729449254338899005');" style=""> 739             ppr.getEntity().setType(new String[]{adornedList.getAdornedTargetEntityClassname()});        </span>
<span class="7912118845776081771" onmouseenter="enter('7912118845776081771');" onmouseout="out('7912118845776081771');" style=""> 740         } else if (field.getMetadata() instanceof MapMetadata) {                                         </span>
<span class="2366674339618495793" onmouseenter="enter('2366674339618495793');" onmouseout="out('2366674339618495793');" style=""> 741             MapMetadata fmd = (MapMetadata) field.getMetadata();                                         </span>
<span  style=""> 742                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 743             p = new Property();                                                                          </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 744             p.setName(&quot;id&quot;);                                                                             </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 745             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 746             properties.add(p);                                                                           </span>
<span  style=""> 747                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 748             p = new Property();                                                                          </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 749             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 750             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 751             properties.add(p);                                                                           </span>
<span  style=""> 752                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 753             p = new Property();                                                                          </span>
<span class="-5579409047855153374" onmouseenter="enter('-5579409047855153374');" onmouseout="out('-5579409047855153374');" style=""> 754             p.setName(&quot;priorKey&quot;);                                                                       </span>
<span class="-4418910479857896781" onmouseenter="enter('-4418910479857896781');" onmouseout="out('-4418910479857896781');" style=""> 755             p.setValue(priorKey);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 756             properties.add(p);                                                                           </span>
<span  style=""> 757                                                                                                          </span>
<span class="6290651600977544526" onmouseenter="enter('6290651600977544526');" onmouseout="out('6290651600977544526');" style=""> 758             MapStructure mapStructure = ppr.getMapStructure();                                           </span>
<span  style=""> 759                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 760             p = new Property();                                                                          </span>
<span class="-8796819570859336354" onmouseenter="enter('-8796819570859336354');" onmouseout="out('-8796819570859336354');" style=""> 761             p.setName(mapStructure.getKeyPropertyName());                                                </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 762             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 763             properties.add(p);                                                                           </span>
<span  style=""> 764                                                                                                          </span>
<span class="-3538327046279125798" onmouseenter="enter('-3538327046279125798');" onmouseout="out('-3538327046279125798');" style=""> 765             ppr.getEntity().setType(new String[] { fmd.getTargetClass() });                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766         }                                                                                                </span>
<span  style=""> 767                                                                                                          </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 768         ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                     </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 769         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 770         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 771             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 773         ppr.setSectionEntityField(sectionField);                                                         </span>
<span  style=""> 774                                                                                                          </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 775         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 776         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 777             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 778         }                                                                                                </span>
<span  style=""> 779                                                                                                          </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 780         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 781         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 782         ppr.getEntity().setProperties(propArr);                                                          </span>
<span  style=""> 783                                                                                                          </span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 784         return remove(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785     }                                                                                                    </span>
<span  style=""> 786                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 787     @Override                                                                                            </span>
<span class="4282644893410961184" onmouseenter="enter('4282644893410961184');" onmouseout="out('4282644893410961184');" style=""><abbr title=" 788     public String getContextSpecificRelationshipId(ClassMetadata cmd, Entity entity, String propertyName) {"> 788     public String getContextSpecificRelationshipId(ClassMetadata cmd, Entity entity, String propertyName)ðŸ”µ</abbr></span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style=""> 789         String prefix;                                                                                   </span>
<span class="-4471312176558876108" onmouseenter="enter('-4471312176558876108');" onmouseout="out('-4471312176558876108');" style=""> 790         if (propertyName.contains(&quot;.&quot;)) {                                                                </span>
<span class="1236521803185463300" onmouseenter="enter('1236521803185463300');" onmouseout="out('1236521803185463300');" style=""> 791             prefix = propertyName.substring(0, propertyName.lastIndexOf(&quot;.&quot;));                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 792         } else {                                                                                         </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style=""> 793             prefix = &quot;&quot;;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794         }                                                                                                </span>
<span  style=""> 795                                                                                                          </span>
<span class="2108963067613019567" onmouseenter="enter('2108963067613019567');" onmouseout="out('2108963067613019567');" style=""> 796         if (prefix.equals(&quot;&quot;)) {                                                                         </span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 797             return entity.findProperty(&quot;id&quot;).getValue();                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 798         } else {                                                                                         </span>
<span class="2912662671806002044" onmouseenter="enter('2912662671806002044');" onmouseout="out('2912662671806002044');" style=""><abbr title=" 799             //we need to check all the parts of the prefix. For example, the prefix could include an @Embedded class like"> 799             //we need to check all the parts of the prefix. For example, the prefix could include an @EmbðŸ”µ</abbr></span>
<span class="-6847147968781015235" onmouseenter="enter('-6847147968781015235');" onmouseout="out('-6847147968781015235');" style=""><abbr title=" 800             //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the @Embedded does"> 800             //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the ðŸ”µ</abbr></span>
<span class="-9096360951865760456" onmouseenter="enter('-9096360951865760456');" onmouseout="out('-9096360951865760456');" style=""> 801             //not have an id property - nor should it.                                                   </span>
<span class="8843283418167771984" onmouseenter="enter('8843283418167771984');" onmouseout="out('8843283418167771984');" style=""> 802             String[] prefixParts = prefix.split(&quot;\\.&quot;);                                                  </span>
<span class="-7822949011963974832" onmouseenter="enter('-7822949011963974832');" onmouseout="out('-7822949011963974832');" style=""> 803             for (int j = 0; j &lt; prefixParts.length; j++) {                                               </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 804                 StringBuilder sb = new StringBuilder();                                                  </span>
<span class="2290448841761568128" onmouseenter="enter('2290448841761568128');" onmouseout="out('2290448841761568128');" style=""> 805                 for (int x = 0; x &lt; prefixParts.length - j; x++) {                                       </span>
<span class="1036821456394348565" onmouseenter="enter('1036821456394348565');" onmouseout="out('1036821456394348565');" style=""> 806                     sb.append(prefixParts[x]);                                                           </span>
<span class="837864378579548727" onmouseenter="enter('837864378579548727');" onmouseout="out('837864378579548727');" style=""> 807                     if (x &lt; prefixParts.length - j - 1) {                                                </span>
<span class="2682813583155160314" onmouseenter="enter('2682813583155160314');" onmouseout="out('2682813583155160314');" style=""> 808                         sb.append(&quot;.&quot;);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810                 }                                                                                        </span>
<span class="-7912523814943214188" onmouseenter="enter('-7912523814943214188');" onmouseout="out('-7912523814943214188');" style=""> 811                 String tempPrefix = sb.toString();                                                       </span>
<span  style=""> 812                                                                                                          </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 813                 for (Property property : entity.getProperties()) {                                       </span>
<span class="-7524924011426943089" onmouseenter="enter('-7524924011426943089');" onmouseout="out('-7524924011426943089');" style=""> 814                     if (property.getName().startsWith(tempPrefix)) {                                     </span>
<span class="-577685276283853994" onmouseenter="enter('-577685276283853994');" onmouseout="out('-577685276283853994');" style=""><abbr title=" 815                         //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the current prefix level"> 815                         //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the cðŸ”µ</abbr></span>
<span class="6988170330009622433" onmouseenter="enter('6988170330009622433');" onmouseout="out('6988170330009622433');" style=""><abbr title=" 816                         //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAttributes.id"> 816                         //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAðŸ”µ</abbr></span>
<span class="-1849094327471901943" onmouseenter="enter('-1849094327471901943');" onmouseout="out('-1849094327471901943');" style=""><abbr title=" 817                         if (StringUtils.countMatches(property.getName().replace(tempPrefix, &quot;&quot;), &quot;.&quot;) == 1) {"> 817                         if (StringUtils.countMatches(property.getName().replace(tempPrefix, &quot;&quot;), &quot;.&quot;) == ðŸ”µ</abbr></span>
<span class="-8594951258528203905" onmouseenter="enter('-8594951258528203905');" onmouseout="out('-8594951258528203905');" style=""> 818                             if (cmd.getPMap().containsKey(property.getName())) {                         </span>
<span class="-7732609283402352986" onmouseenter="enter('-7732609283402352986');" onmouseout="out('-7732609283402352986');" style=""><abbr title=" 819                                 BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.getName()).getMetadata();"> 819                                 BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.gðŸ”µ</abbr></span>
<span class="-2874474282821972662" onmouseenter="enter('-2874474282821972662');" onmouseout="out('-2874474282821972662');" style=""> 820                                 if (md.getFieldType().equals(SupportedFieldType.ID)) {                   </span>
<span class="-1836186832588240544" onmouseenter="enter('-1836186832588240544');" onmouseout="out('-1836186832588240544');" style=""> 821                                     return property.getValue();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 826                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828         }                                                                                                </span>
<span class="6467699841617564408" onmouseenter="enter('6467699841617564408');" onmouseout="out('6467699841617564408');" style=""> 829         if (!prefix.contains(&quot;.&quot;)) {                                                                     </span>
<span class="-6458727047245688221" onmouseenter="enter('-6458727047245688221');" onmouseout="out('-6458727047245688221');" style=""><abbr title=" 830             //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restrictedPriceLists on OfferImpl)"> 830             //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restricðŸ”µ</abbr></span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 831             return entity.findProperty(&quot;id&quot;).getValue();                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832         }                                                                                                </span>
<span class="-8024958864039426916" onmouseenter="enter('-8024958864039426916');" onmouseout="out('-8024958864039426916');" style=""> 833         throw new RuntimeException(&quot;Unable to establish a relationship id&quot;);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834     }                                                                                                    </span>
<span  style=""> 835                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 836     @Override                                                                                            </span>
<span class="-3908255710031606050" onmouseenter="enter('-3908255710031606050');" onmouseout="out('-3908255710031606050');" style=""> 837     public String getIdProperty(ClassMetadata cmd) throws ServiceException {                             </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 838         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-1029066852878262358" onmouseenter="enter('-1029066852878262358');" onmouseout="out('-1029066852878262358');" style=""> 839             if (p.getMetadata() instanceof BasicFieldMetadata) {                                         </span>
<span class="-5664285287189453326" onmouseenter="enter('-5664285287189453326');" onmouseout="out('-5664285287189453326');" style=""> 840                 BasicFieldMetadata fmd = (BasicFieldMetadata) p.getMetadata();                           </span>
<span class="513655466689307970" onmouseenter="enter('513655466689307970');" onmouseout="out('513655466689307970');" style=""><abbr title=" 841                 //check for ID type and also make sure the field we&#x27;re looking at is not a &quot;ToOne&quot; association"> 841                 //check for ID type and also make sure the field we&#x27;re looking at is not a &quot;ToOne&quot; associðŸ”µ</abbr></span>
<span class="-491768544454322511" onmouseenter="enter('-491768544454322511');" onmouseout="out('-491768544454322511');" style=""> 842                 if (SupportedFieldType.ID.equals(fmd.getFieldType()) &amp;&amp; !p.getName().contains(&quot;.&quot;)) {    </span>
<span class="-6048877223362319653" onmouseenter="enter('-6048877223362319653');" onmouseout="out('-6048877223362319653');" style=""> 843                     return p.getName();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846         }                                                                                                </span>
<span  style=""> 847                                                                                                          </span>
<span class="-7942857982942474001" onmouseenter="enter('-7942857982942474001');" onmouseout="out('-7942857982942474001');" style=""> 848         throw new ServiceException(&quot;Could not determine ID field for &quot; + cmd.getCeilingType());          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 849     }                                                                                                    </span>
<span  style=""> 850                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 851     @Override                                                                                            </span>
<span class="-6109521015369402099" onmouseenter="enter('-6109521015369402099');" onmouseout="out('-6109521015369402099');" style=""> 852     public PersistenceResponse add(PersistencePackageRequest request) throws ServiceException {          </span>
<span class="-2588522872292014988" onmouseenter="enter('-2588522872292014988');" onmouseout="out('-2588522872292014988');" style=""> 853         return add(request, true);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 854     }                                                                                                    </span>
<span  style=""> 855                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 856     @Override                                                                                            </span>
<span class="8827553339909366249" onmouseenter="enter('8827553339909366249');" onmouseout="out('8827553339909366249');" style=""><abbr title=" 857     public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 857     public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 858         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 859         try {                                                                                            </span>
<span class="4836544755641051591" onmouseenter="enter('4836544755641051591');" onmouseout="out('4836544755641051591');" style=""> 860             if (request.isUpdateLookupType()) {                                                          </span>
<span class="-2082930136830103093" onmouseenter="enter('-2082930136830103093');" onmouseout="out('-2082930136830103093');" style=""> 861                 if (pkg.getSectionCrumbs() != null &amp;&amp; pkg.getSectionCrumbs().length &gt; 0) {               </span>
<span class="-6120347482693188577" onmouseenter="enter('-6120347482693188577');" onmouseout="out('-6120347482693188577');" style=""> 862                     SectionCrumb sc = pkg.getSectionCrumbs()[0];                                         </span>
<span class="7706557227331502134" onmouseenter="enter('7706557227331502134');" onmouseout="out('7706557227331502134');" style=""> 863                     if (StringUtils.isNotBlank(sc.getSectionIdentifier())) {                             </span>
<span class="7371017383769084435" onmouseenter="enter('7371017383769084435');" onmouseout="out('7371017383769084435');" style=""> 864                         pkg.setSecurityCeilingEntityFullyQualifiedClassname(sc.getSectionIdentifier());  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 865                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866                 }                                                                                        </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 867                 if (transactional) {                                                                     </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 868                     return service.update(pkg);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 869                 } else {                                                                                 </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 870                     return service.nonTransactionalUpdate(pkg);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 871                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 872             } else {                                                                                     </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 873                 if (transactional) {                                                                     </span>
<span class="4552670565637379723" onmouseenter="enter('4552670565637379723');" onmouseout="out('4552670565637379723');" style=""> 874                     return service.add(pkg);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 875                 } else {                                                                                 </span>
<span class="6732121152740224457" onmouseenter="enter('6732121152740224457');" onmouseout="out('6732121152740224457');" style=""> 876                     return service.nonTransactionalAdd(pkg);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 879         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 880             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 881             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883     }                                                                                                    </span>
<span  style=""> 884                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 885     @Override                                                                                            </span>
<span class="-2168493081511676385" onmouseenter="enter('-2168493081511676385');" onmouseout="out('-2168493081511676385');" style=""> 886     public PersistenceResponse update(PersistencePackageRequest request) throws ServiceException {       </span>
<span class="-1915092381367502552" onmouseenter="enter('-1915092381367502552');" onmouseout="out('-1915092381367502552');" style=""> 887         return update(request, true);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888     }                                                                                                    </span>
<span  style=""> 889                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 890     @Override                                                                                            </span>
<span class="-3035175746782535545" onmouseenter="enter('-3035175746782535545');" onmouseout="out('-3035175746782535545');" style=""><abbr title=" 891     public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 891     public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws SeðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 892         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 893         try {                                                                                            </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 894             if (transactional) {                                                                         </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 895                 return service.update(pkg);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 896             } else {                                                                                     </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 897                 return service.nonTransactionalUpdate(pkg);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 898             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 899         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 900             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 901             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 902         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 903     }                                                                                                    </span>
<span  style=""> 904                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 905     @Override                                                                                            </span>
<span class="-1312385666630581282" onmouseenter="enter('-1312385666630581282');" onmouseout="out('-1312385666630581282');" style=""> 906     public PersistenceResponse inspect(PersistencePackageRequest request)                                </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 907             throws ServiceException {                                                                    </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 908         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="2565705442671799096" onmouseenter="enter('2565705442671799096');" onmouseout="out('2565705442671799096');" style=""> 909         return service.inspect(pkg);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 910     }                                                                                                    </span>
<span  style=""> 911                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 912     @Override                                                                                            </span>
<span class="-2409492513544163046" onmouseenter="enter('-2409492513544163046');" onmouseout="out('-2409492513544163046');" style=""> 913     public PersistenceResponse remove(PersistencePackageRequest request)                                 </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 914             throws ServiceException {                                                                    </span>
<span class="1818424953510541932" onmouseenter="enter('1818424953510541932');" onmouseout="out('1818424953510541932');" style=""> 915         return remove(request, true);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 916     }                                                                                                    </span>
<span  style=""> 917                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 918     @Override                                                                                            </span>
<span class="-9050585893076336114" onmouseenter="enter('-9050585893076336114');" onmouseout="out('-9050585893076336114');" style=""><abbr title=" 919     public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 919     public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws SeðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 920         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 921         try {                                                                                            </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 922             if (transactional) {                                                                         </span>
<span class="-5643605501598977706" onmouseenter="enter('-5643605501598977706');" onmouseout="out('-5643605501598977706');" style=""> 923                 return service.remove(pkg);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 924             } else {                                                                                     </span>
<span class="-8250836311704581891" onmouseenter="enter('-8250836311704581891');" onmouseout="out('-8250836311704581891');" style=""> 925                 return service.nonTransactionalRemove(pkg);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 926             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 927         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 928             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 929             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 930         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 933     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 934      * &lt;p&gt;                                                                                               </span>
<span class="3729604611716511130" onmouseenter="enter('3729604611716511130');" onmouseout="out('3729604611716511130');" style=""><abbr title=" 935      * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} contained within the"> 935      * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} cðŸ”µ</abbr></span>
<span class="-7341678569298188314" onmouseenter="enter('-7341678569298188314');" onmouseout="out('-7341678569298188314');" style=""> 936      * given &lt;b&gt;originalRequest&lt;/b&gt; has a validationFailure = true                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 937      *                                                                                                   </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 938      * &lt;p&gt;                                                                                               </span>
<span class="-7716663654145973669" onmouseenter="enter('-7716663654145973669');" onmouseout="out('-7716663654145973669');" style=""><abbr title=" 939      * This will also check for a cause of {@link ConstraintViolationException} and add a gloal error to that."> 939      * This will also check for a cause of {@link ConstraintViolationException} and add a gloal error to ðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 940      */                                                                                                  </span>
<span class="807801721535748536" onmouseenter="enter('807801721535748536');" onmouseout="out('807801721535748536');" style=""><abbr title=" 941     protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequest originalRequest) {"> 941     protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequestðŸ”µ</abbr></span>
<span class="5399941146961217832" onmouseenter="enter('5399941146961217832');" onmouseout="out('5399941146961217832');" style=""> 942         if (e.containsCause(ConstraintViolationException.class)) {                                       </span>
<span class="-5214743212244855970" onmouseenter="enter('-5214743212244855970');" onmouseout="out('-5214743212244855970');" style=""> 943             e.getEntity().addGlobalValidationError(&quot;constraintViolationError&quot;);                          </span>
<span class="4509625189679774854" onmouseenter="enter('4509625189679774854');" onmouseout="out('4509625189679774854');" style=""> 944         } else if (!e.getEntity().isValidationFailure()) {                                               </span>
<span class="-4984910861440118934" onmouseenter="enter('-4984910861440118934');" onmouseout="out('-4984910861440118934');" style=""> 945             e.getEntity().setValidationFailure(true);                                                    </span>
<span class="-6792721057862982153" onmouseenter="enter('-6792721057862982153');" onmouseout="out('-6792721057862982153');" style=""> 946             e.getEntity().addGlobalValidationError(e.getMessage());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 947         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 948     }                                                                                                    </span>
<span  style=""> 949                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 950     @Override                                                                                            </span>
<span class="5311420287927073238" onmouseenter="enter('5311420287927073238');" onmouseout="out('5311420287927073238');" style=""> 951     public PersistenceResponse fetch(PersistencePackageRequest request)                                  </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 952             throws ServiceException {                                                                    </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 953         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span  style=""> 954                                                                                                          </span>
<span class="-5375974030412648260" onmouseenter="enter('-5375974030412648260');" onmouseout="out('-5375974030412648260');" style=""> 955         CriteriaTransferObject cto = getDefaultCto();                                                    </span>
<span class="-1800505558210996683" onmouseenter="enter('-1800505558210996683');" onmouseout="out('-1800505558210996683');" style=""> 956         if (request.getFilterAndSortCriteria() != null) {                                                </span>
<span class="629113105269586037" onmouseenter="enter('629113105269586037');" onmouseout="out('629113105269586037');" style=""> 957             cto.addAll(Arrays.asList(request.getFilterAndSortCriteria()));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 958         }                                                                                                </span>
<span  style=""> 959                                                                                                          </span>
<span class="-3823245946626813984" onmouseenter="enter('-3823245946626813984');" onmouseout="out('-3823245946626813984');" style=""> 960         if (request.getMaxResults() != null) {                                                           </span>
<span class="-8351200142276180335" onmouseenter="enter('-8351200142276180335');" onmouseout="out('-8351200142276180335');" style=""> 961             cto.setMaxResults(request.getMaxResults());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962         }                                                                                                </span>
<span  style=""> 963                                                                                                          </span>
<span class="-690040157024225203" onmouseenter="enter('-690040157024225203');" onmouseout="out('-690040157024225203');" style=""> 964         if (request.getStartIndex() == null) {                                                           </span>
<span class="2764779885143665984" onmouseenter="enter('2764779885143665984');" onmouseout="out('2764779885143665984');" style=""> 965             cto.setFirstResult(0);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 966         } else {                                                                                         </span>
<span class="-6350611603682358812" onmouseenter="enter('-6350611603682358812');" onmouseout="out('-6350611603682358812');" style=""> 967             cto.setFirstResult(request.getStartIndex());                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 968         }                                                                                                </span>
<span  style=""> 969                                                                                                          </span>
<span class="-1342097346218425419" onmouseenter="enter('-1342097346218425419');" onmouseout="out('-1342097346218425419');" style=""> 970         if (request.getMaxIndex() != null) {                                                             </span>
<span class="-8120529832746798414" onmouseenter="enter('-8120529832746798414');" onmouseout="out('-8120529832746798414');" style=""> 971             Integer startIndex = request.getStartIndex() != null ? request.getStartIndex() : 0;          </span>
<span class="-6682475132360394674" onmouseenter="enter('-6682475132360394674');" onmouseout="out('-6682475132360394674');" style=""> 972             int requestedMaxResults = request.getMaxIndex() - startIndex + 1;                            </span>
<span class="-4912375422916056974" onmouseenter="enter('-4912375422916056974');" onmouseout="out('-4912375422916056974');" style=""> 973             if (requestedMaxResults &gt;= 0 &amp;&amp; requestedMaxResults &lt; cto.getMaxResults()) {                 </span>
<span class="-1275291600011289156" onmouseenter="enter('-1275291600011289156');" onmouseout="out('-1275291600011289156');" style=""> 974                 cto.setMaxResults(requestedMaxResults);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 976         }                                                                                                </span>
<span  style=""> 977                                                                                                          </span>
<span class="1589811072437566840" onmouseenter="enter('1589811072437566840');" onmouseout="out('1589811072437566840');" style=""> 978         cto.setLastId(request.getLastId());                                                              </span>
<span class="4489054305431733195" onmouseenter="enter('4489054305431733195');" onmouseout="out('4489054305431733195');" style=""> 979         cto.setFirstId(request.getFirstId());                                                            </span>
<span class="7683513281487176699" onmouseenter="enter('7683513281487176699');" onmouseout="out('7683513281487176699');" style=""> 980         cto.setUpperCount(request.getUpperCount());                                                      </span>
<span class="-8031307621948936245" onmouseenter="enter('-8031307621948936245');" onmouseout="out('-8031307621948936245');" style=""> 981         cto.setLowerCount(request.getLowerCount());                                                      </span>
<span class="63997933306934756" onmouseenter="enter('63997933306934756');" onmouseout="out('63997933306934756');" style=""> 982         if (request.getPageSize() != null) {                                                             </span>
<span class="-7018914636118190968" onmouseenter="enter('-7018914636118190968');" onmouseout="out('-7018914636118190968');" style=""> 983             cto.setMaxResults(request.getPageSize());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984         }                                                                                                </span>
<span class="5284762326708873211" onmouseenter="enter('5284762326708873211');" onmouseout="out('5284762326708873211');" style=""> 985         cto.setPresentationFetch(request.getPresentationFetch());                                        </span>
<span  style=""> 986                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 987 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 988 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 989                                                                                                          </span>
<span class="-734873492845948502" onmouseenter="enter('-734873492845948502');" onmouseout="out('-734873492845948502');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 990         return service.fetch(pkg, cto);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 991     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 992                                                                                                          </span>
<span class="1747080010822063537" onmouseenter="enter('1747080010822063537');" onmouseout="out('1747080010822063537');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 993     protected CriteriaTransferObject getDefaultCto() {                                                   </span>
<span class="-7937218466133346867" onmouseenter="enter('-7937218466133346867');" onmouseout="out('-7937218466133346867');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 994         CriteriaTransferObject cto = new CriteriaTransferObject();                                       </span>
<span class="-792606519014114045" onmouseenter="enter('-792606519014114045');" onmouseout="out('-792606519014114045');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 995         cto.setMaxResults(getDefaultMaxResults());                                                       </span>
<span class="6058297727948666853" onmouseenter="enter('6058297727948666853');" onmouseout="out('6058297727948666853');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 996         return cto;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 997     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 998                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 999     @Override                                                                                            </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">1000 =======                                                                                                  </span>
<span class="8885053060558966919" onmouseenter="enter('8885053060558966919');" onmouseout="out('8885053060558966919');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1001         if (request.isFolderedLookup()) {                                                                </span>
<span class="3703526123616875051" onmouseenter="enter('3703526123616875051');" onmouseout="out('3703526123616875051');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1002             cto.setFolderLookup(true);                                                                   </span>
<span class="1820221740933941643" onmouseenter="enter('1820221740933941643');" onmouseout="out('1820221740933941643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1003             cto.setFolderId(request.getFolderId());                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1004         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1005                                                                                                          </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1006         if (extensionManager != null) {                                                                  </span>
<span class="371414988916191718" onmouseenter="enter('371414988916191718');" onmouseout="out('371414988916191718');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1007             extensionManager.getProxy().modifyFetchCriteriaTransferObject(request, cto);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1008         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1009                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">1010 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-734873492845948502" onmouseenter="enter('-734873492845948502');" onmouseout="out('-734873492845948502');" style="">1011         return service.fetch(pkg, cto);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1012     }                                                                                                    </span>
<span  style="">1013                                                                                                          </span>
<span class="1747080010822063537" onmouseenter="enter('1747080010822063537');" onmouseout="out('1747080010822063537');" style="">1014     protected CriteriaTransferObject getDefaultCto() {                                                   </span>
<span class="-7937218466133346867" onmouseenter="enter('-7937218466133346867');" onmouseout="out('-7937218466133346867');" style="">1015         CriteriaTransferObject cto = new CriteriaTransferObject();                                       </span>
<span class="-792606519014114045" onmouseenter="enter('-792606519014114045');" onmouseout="out('-792606519014114045');" style="">1016         cto.setMaxResults(getDefaultMaxResults());                                                       </span>
<span class="6058297727948666853" onmouseenter="enter('6058297727948666853');" onmouseout="out('6058297727948666853');" style="">1017         return cto;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1018     }                                                                                                    </span>
<span  style="">1019                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1020     @Override                                                                                            </span>
<span class="8883083618394394837" onmouseenter="enter('8883083618394394837');" onmouseout="out('8883083618394394837');" style="">1021     public String getForeignEntityName(String owningClass, String id) {                                  </span>
<span class="-872554261283939929" onmouseenter="enter('-872554261283939929');" onmouseout="out('-872554261283939929');" style="">1022         if (owningClass == null || id == null) {                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1023             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1024         }                                                                                                </span>
<span  style="">1025                                                                                                          </span>
<span class="3468023357463508719" onmouseenter="enter('3468023357463508719');" onmouseout="out('3468023357463508719');" style="">1026         DynamicEntityDao dynamicEntityDao = getDynamicEntityDao(owningClass);                            </span>
<span class="7635620295149838730" onmouseenter="enter('7635620295149838730');" onmouseout="out('7635620295149838730');" style="">1027         Class&lt;?&gt; clazz = dynamicEntityDao.getImplClass(owningClass);                                     </span>
<span class="6841796057846720752" onmouseenter="enter('6841796057846720752');" onmouseout="out('6841796057846720752');" style="">1028         Object foreignEntity = dynamicEntityDao.find(clazz, toIdFieldType(id, clazz));                   </span>
<span  style="">1029                                                                                                          </span>
<span class="6094352409442952488" onmouseenter="enter('6094352409442952488');" onmouseout="out('6094352409442952488');" style="">1030         if (foreignEntity instanceof AdminMainEntity) {                                                  </span>
<span class="-5844179197625315876" onmouseenter="enter('-5844179197625315876');" onmouseout="out('-5844179197625315876');" style="">1031             return ((AdminMainEntity) foreignEntity).getMainEntityName();                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1032         }                                                                                                </span>
<span  style="">1033                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1034         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1035     }                                                                                                    </span>
<span  style="">1036                                                                                                          </span>
<span class="-1537571071296717959" onmouseenter="enter('-1537571071296717959');" onmouseout="out('-1537571071296717959');" style="">1037     protected DynamicEntityDao getDynamicEntityDao(String owningClass) {                                 </span>
<span class="8951596410601292775" onmouseenter="enter('8951596410601292775');" onmouseout="out('8951596410601292775');" style="">1038         return PersistenceManagerFactory.getPersistenceManager(owningClass).getDynamicEntityDao();       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1039     }                                                                                                    </span>
<span  style="">1040                                                                                                          </span>
<span class="7239398670151774953" onmouseenter="enter('7239398670151774953');" onmouseout="out('7239398670151774953');" style="">1041     protected int getDefaultMaxResults() {                                                               </span>
<span class="-1067455107038749142" onmouseenter="enter('-1067455107038749142');" onmouseout="out('-1067455107038749142');" style="">1042         return BLCSystemProperty.resolveIntSystemProperty(&quot;admin.default.max.results&quot;, 50);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1043     }                                                                                                    </span>
<span  style="">1044                                                                                                          </span>
<span class="8333077553386092776" onmouseenter="enter('8333077553386092776');" onmouseout="out('8333077553386092776');" style="">1045     protected Object toIdFieldType(String id, Class&lt;?&gt; entityClass) {                                    </span>
<span class="4110349594135807695" onmouseenter="enter('4110349594135807695');" onmouseout="out('4110349594135807695');" style="">1046         Class&lt;?&gt; idFieldClass = dynamicDaoHelper.getIdField(entityClass).getType();                      </span>
<span class="-2186353433511684671" onmouseenter="enter('-2186353433511684671');" onmouseout="out('-2186353433511684671');" style="">1047         if (Long.class.isAssignableFrom(idFieldClass)) {                                                 </span>
<span class="5572754406141306162" onmouseenter="enter('5572754406141306162');" onmouseout="out('5572754406141306162');" style="">1048             return Long.parseLong(id);                                                                   </span>
<span class="-3847313633493236310" onmouseenter="enter('-3847313633493236310');" onmouseout="out('-3847313633493236310');" style="">1049         } else if (Integer.class.isAssignableFrom(idFieldClass)) {                                       </span>
<span class="3211402984454379456" onmouseenter="enter('3211402984454379456');" onmouseout="out('3211402984454379456');" style="">1050             return Integer.parseInt(id);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1051         }                                                                                                </span>
<span class="-3074727595953522219" onmouseenter="enter('-3074727595953522219');" onmouseout="out('-3074727595953522219');" style="">1052         return id;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1053     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1054 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-3339060969767811416" onmouseenter="enter('-3339060969767811416');" onmouseout="out('-3339060969767811416');" style="">   3  * BroadleafCommerce Open Admin Platform                                                                 </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-8794511651793620694" onmouseenter="enter('-8794511651793620694');" onmouseout="out('-8794511651793620694');" style="">  18 package org.broadleafcommerce.openadmin.server.service;                                                  </span>
<span  style="">  19                                                                                                          </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  20 import org.apache.commons.lang3.ArrayUtils;                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-6287859968194756382" onmouseenter="enter('-6287859968194756382');" onmouseout="out('-6287859968194756382');" style="">  24 import org.broadleafcommerce.common.admin.domain.AdminMainEntity;                                        </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  25 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  26 import org.broadleafcommerce.common.persistence.EntityConfiguration;                                     </span>
<span class="-6648433550510659033" onmouseenter="enter('-6648433550510659033');" onmouseout="out('-6648433550510659033');" style="">  27 import org.broadleafcommerce.common.presentation.client.AddMethodType;                                   </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  28 import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                              </span>
<span class="2428099238642943960" onmouseenter="enter('2428099238642943960');" onmouseout="out('2428099238642943960');" style="">  29 import org.broadleafcommerce.common.util.BLCMessageUtils;                                                </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  30 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="5951235614759861305" onmouseenter="enter('5951235614759861305');" onmouseout="out('5951235614759861305');" style="">  31 import org.broadleafcommerce.common.util.dao.DynamicDaoHelper;                                           </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  32 import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                       </span>
<span class="-3361215363157046739" onmouseenter="enter('-3361215363157046739');" onmouseout="out('-3361215363157046739');" style="">  33 import org.broadleafcommerce.openadmin.dto.AdornedTargetCollectionMetadata;                              </span>
<span class="-1781055592725563383" onmouseenter="enter('-1781055592725563383');" onmouseout="out('-1781055592725563383');" style="">  34 import org.broadleafcommerce.openadmin.dto.AdornedTargetList;                                            </span>
<span class="-6140296335181984013" onmouseenter="enter('-6140296335181984013');" onmouseout="out('-6140296335181984013');" style="">  35 import org.broadleafcommerce.openadmin.dto.BasicCollectionMetadata;                                      </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  36 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  37 import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                </span>
<span class="-3165611006566133086" onmouseenter="enter('-3165611006566133086');" onmouseout="out('-3165611006566133086');" style="">  38 import org.broadleafcommerce.openadmin.dto.CollectionMetadata;                                           </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  39 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  40 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  41 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  42 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  43 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="2672462771965160264" onmouseenter="enter('2672462771965160264');" onmouseout="out('2672462771965160264');" style="">  44 import org.broadleafcommerce.openadmin.dto.GroupMetadata;                                                </span>
<span class="826821438795056004" onmouseenter="enter('826821438795056004');" onmouseout="out('826821438795056004');" style="">  45 import org.broadleafcommerce.openadmin.dto.MapMetadata;                                                  </span>
<span class="-7888875133556467044" onmouseenter="enter('-7888875133556467044');" onmouseout="out('-7888875133556467044');" style="">  46 import org.broadleafcommerce.openadmin.dto.MapStructure;                                                 </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  47 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  48 import org.broadleafcommerce.openadmin.dto.Property;                                                     </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  49 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="5662236005419086618" onmouseenter="enter('5662236005419086618');" onmouseout="out('5662236005419086618');" style="">  50 import org.broadleafcommerce.openadmin.dto.TabMetadata;                                                  </span>
<span class="2699062320492900877" onmouseenter="enter('2699062320492900877');" onmouseout="out('2699062320492900877');" style="">  51 import org.broadleafcommerce.openadmin.exception.EntityNotFoundException;                                </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  52 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-2178507335566770341" onmouseenter="enter('-2178507335566770341');" onmouseout="out('-2178507335566770341');" style="">  53 import org.broadleafcommerce.openadmin.server.domain.FetchPageRequest;                                   </span>
<span class="4410643013278245372" onmouseenter="enter('4410643013278245372');" onmouseout="out('4410643013278245372');" style="">  54 import org.broadleafcommerce.openadmin.server.domain.PersistencePackageRequest;                          </span>
<span class="6597629584583725664" onmouseenter="enter('6597629584583725664');" onmouseout="out('6597629584583725664');" style="">  55 import org.broadleafcommerce.openadmin.server.factory.PersistencePackageFactory;                         </span>
<span class="7062965872140905778" onmouseenter="enter('7062965872140905778');" onmouseout="out('7062965872140905778');" style="">  56 import org.broadleafcommerce.openadmin.server.service.extension.CriteriaTransferObjectExtensionManager;  </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  57 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;             </span>
<span class="-8603256547657551769" onmouseenter="enter('-8603256547657551769');" onmouseout="out('-8603256547657551769');" style="">  58 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceResponse;                   </span>
<span class="-3086540061138981164" onmouseenter="enter('-3086540061138981164');" onmouseout="out('-3086540061138981164');" style="">  59 import org.broadleafcommerce.openadmin.server.service.persistence.module.BasicPersistenceModule;         </span>
<span class="-7452009352681558215" onmouseenter="enter('-7452009352681558215');" onmouseout="out('-7452009352681558215');" style="">  60 import org.broadleafcommerce.openadmin.web.form.entity.DynamicEntityFormInfo;                            </span>
<span class="8035715143965725316" onmouseenter="enter('8035715143965725316');" onmouseout="out('8035715143965725316');" style="">  61 import org.broadleafcommerce.openadmin.web.form.entity.EntityForm;                                       </span>
<span class="6015559832933397076" onmouseenter="enter('6015559832933397076');" onmouseout="out('6015559832933397076');" style="">  62 import org.broadleafcommerce.openadmin.web.form.entity.Field;                                            </span>
<span class="7834442097514100117" onmouseenter="enter('7834442097514100117');" onmouseout="out('7834442097514100117');" style="">  63 import org.broadleafcommerce.openadmin.web.form.entity.Tab;                                              </span>
<span class="-5699213192866872541" onmouseenter="enter('-5699213192866872541');" onmouseout="out('-5699213192866872541');" style="">  64 import org.hibernate.exception.ConstraintViolationException;                                             </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  65 import org.springframework.stereotype.Service;                                                           </span>
<span  style="">  66                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  67 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  68 import java.util.Arrays;                                                                                 </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  69 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  70 import java.util.List;                                                                                   </span>
<span class="174663421494487417" onmouseenter="enter('174663421494487417');" onmouseout="out('174663421494487417');" style="">  71 import java.util.ListIterator;                                                                           </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  72 import java.util.Map;                                                                                    </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  73 import java.util.Map.Entry;                                                                              </span>
<span  style="">  74                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  75 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  76 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  77 import javax.persistence.PersistenceContext;                                                             </span>
<span  style="">  78                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  79 /**                                                                                                      </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  80  * @author Andre Azzolini (apazzolini)                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  81  */                                                                                                      </span>
<span class="2205005937568393687" onmouseenter="enter('2205005937568393687');" onmouseout="out('2205005937568393687');" style="">  82 @Service(&quot;blAdminEntityService&quot;)                                                                         </span>
<span class="-2691323185499418706" onmouseenter="enter('-2691323185499418706');" onmouseout="out('-2691323185499418706');" style="">  83 public class AdminEntityServiceImpl implements AdminEntityService {                                      </span>
<span  style="">  84                                                                                                          </span>
<span class="6898728355289688423" onmouseenter="enter('6898728355289688423');" onmouseout="out('6898728355289688423');" style="">  85     protected static final Log LOG = LogFactory.getLog(AdminEntityServiceImpl.class);                    </span>
<span  style="">  86                                                                                                          </span>
<span class="6303589118895976221" onmouseenter="enter('6303589118895976221');" onmouseout="out('6303589118895976221');" style="">  87     @Resource(name = &quot;blDynamicEntityRemoteService&quot;)                                                     </span>
<span class="1505564706419640906" onmouseenter="enter('1505564706419640906');" onmouseout="out('1505564706419640906');" style="">  88     protected DynamicEntityService service;                                                              </span>
<span  style="">  89                                                                                                          </span>
<span class="-5295563268582613053" onmouseenter="enter('-5295563268582613053');" onmouseout="out('-5295563268582613053');" style="">  90     @Resource(name = &quot;blPersistencePackageFactory&quot;)                                                      </span>
<span class="5077122885687298736" onmouseenter="enter('5077122885687298736');" onmouseout="out('5077122885687298736');" style="">  91     protected PersistencePackageFactory persistencePackageFactory;                                       </span>
<span  style="">  92                                                                                                          </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style="">  93     @PersistenceContext(unitName = &quot;blPU&quot;)                                                               </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  94     protected EntityManager em;                                                                          </span>
<span  style="">  95                                                                                                          </span>
<span class="6650882675825573659" onmouseenter="enter('6650882675825573659');" onmouseout="out('6650882675825573659');" style="">  96     @Resource(name = &quot;blEntityConfiguration&quot;)                                                            </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  97     protected EntityConfiguration entityConfiguration;                                                   </span>
<span  style="">  98                                                                                                          </span>
<span class="-2309360235309114106" onmouseenter="enter('-2309360235309114106');" onmouseout="out('-2309360235309114106');" style="">  99     @Resource                                                                                            </span>
<span class="5773081278430031986" onmouseenter="enter('5773081278430031986');" onmouseout="out('5773081278430031986');" style=""> 100     protected CriteriaTransferObjectExtensionManager extensionManager;                                   </span>
<span  style=""> 101                                                                                                          </span>
<span class="6769863436851689394" onmouseenter="enter('6769863436851689394');" onmouseout="out('6769863436851689394');" style=""> 102     protected DynamicDaoHelper dynamicDaoHelper = new DynamicDaoHelperImpl();                            </span>
<span  style=""> 103                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 104     @Override                                                                                            </span>
<span class="689806418400872386" onmouseenter="enter('689806418400872386');" onmouseout="out('689806418400872386');" style=""> 105     public PersistenceResponse getClassMetadata(PersistencePackageRequest request)                       </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 106             throws ServiceException {                                                                    </span>
<span class="-477483751520958137" onmouseenter="enter('-477483751520958137');" onmouseout="out('-477483751520958137');" style=""> 107         PersistenceResponse response = inspect(request);                                                 </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 108         ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                           </span>
<span class="4495915987564569811" onmouseenter="enter('4495915987564569811');" onmouseout="out('4495915987564569811');" style=""> 109         cmd.setCeilingType(request.getCeilingEntityClassname());                                         </span>
<span class="-7633911880463002125" onmouseenter="enter('-7633911880463002125');" onmouseout="out('-7633911880463002125');" style=""> 110         cmd.setSecurityCeilingType(request.getSecurityCeilingEntityClassname());                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 111         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112     }                                                                                                    </span>
<span  style=""> 113                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 114     @Override                                                                                            </span>
<span class="6442257948747151854" onmouseenter="enter('6442257948747151854');" onmouseout="out('6442257948747151854');" style=""> 115     public PersistenceResponse getRecords(PersistencePackageRequest request) throws ServiceException {   </span>
<span class="-8968772654133629352" onmouseenter="enter('-8968772654133629352');" onmouseout="out('-8968772654133629352');" style=""> 116         return fetch(request);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117     }                                                                                                    </span>
<span  style=""> 118                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 119     @Override                                                                                            </span>
<span class="4020809512296494224" onmouseenter="enter('4020809512296494224');" onmouseout="out('4020809512296494224');" style=""><abbr title=" 120     public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd, boolean isCollectionRequest)"> 120     public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd,ðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 121             throws ServiceException {                                                                    </span>
<span class="-5399859376019632364" onmouseenter="enter('-5399859376019632364');" onmouseout="out('-5399859376019632364');" style=""> 122         String idProperty = getIdProperty(cmd);                                                          </span>
<span  style=""> 123                                                                                                          </span>
<span class="1207908904787390154" onmouseenter="enter('1207908904787390154');" onmouseout="out('1207908904787390154');" style=""> 124         FilterAndSortCriteria fasc = new FilterAndSortCriteria(idProperty);                              </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 125         fasc.setFilterValue(id);                                                                         </span>
<span class="-8339504512820574544" onmouseenter="enter('-8339504512820574544');" onmouseout="out('-8339504512820574544');" style=""> 126         request.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 127                                                                                                          </span>
<span class="-1381837102214910163" onmouseenter="enter('-1381837102214910163');" onmouseout="out('-1381837102214910163');" style=""> 128         PersistenceResponse response = fetch(request);                                                   </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 129         Entity[] entities = response.getDynamicResultSet().getRecords();                                 </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 130         if (ArrayUtils.isEmpty(entities)) {                                                              </span>
<span class="3317501704848962820" onmouseenter="enter('3317501704848962820');" onmouseout="out('3317501704848962820');" style=""> 131             String celiningEntity = request.getCeilingEntityClassname();                                 </span>
<span class="1970293616538386874" onmouseenter="enter('1970293616538386874');" onmouseout="out('1970293616538386874');" style=""><abbr title=" 132             throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiningEntity, id));"> 132             throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiniðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133         }                                                                                                </span>
<span  style=""> 134                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 135         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136     }                                                                                                    </span>
<span  style=""> 137                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 138     @Override                                                                                            </span>
<span class="-7201975922678164147" onmouseenter="enter('-7201975922678164147');" onmouseout="out('-7201975922678164147');" style=""><abbr title=" 139     public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 139     public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 140         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 140         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 141         // If the entity form has dynamic forms inside of it, we need to persist those as well.          </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 142         // They are typically done in their own custom persistence handlers, which will get triggered    </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 143         // based on the criteria specific in the PersistencePackage.                                     </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 144         for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 145             DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                  </span>
<span  style=""> 146                                                                                                          </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 147             if (info.getCustomCriteriaOverride() != null) {                                              </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 148                 customCriteria = info.getCustomCriteriaOverride();                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 149             } else {                                                                                     </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 150                 String propertyName = info.getPropertyName();                                            </span>
<span class="3293102538279717811" onmouseenter="enter('3293102538279717811');" onmouseout="out('3293102538279717811');" style=""> 151                 String propertyValue;                                                                    </span>
<span class="3903441351658368829" onmouseenter="enter('3903441351658368829');" onmouseout="out('3903441351658368829');" style=""> 152                 if (entityForm.getFields().containsKey(propertyName)) {                                  </span>
<span class="-3364727408470092918" onmouseenter="enter('-3364727408470092918');" onmouseout="out('-3364727408470092918');" style=""> 153                     propertyValue = entityForm.findField(propertyName).getValue();                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 154                 } else {                                                                                 </span>
<span class="6725656947693910623" onmouseenter="enter('6725656947693910623');" onmouseout="out('6725656947693910623');" style=""> 155                     propertyValue = info.getPropertyValue();                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                 }                                                                                        </span>
<span class="-5306746194951417463" onmouseenter="enter('-5306746194951417463');" onmouseout="out('-5306746194951417463');" style=""><abbr title=" 157                 customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue};"> 157                 customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158             }                                                                                            </span>
<span  style=""> 159                                                                                                          </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 160             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 160             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriterðŸ”µ</abbr></span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 161             ppr.addSubRequest(info.getPropertyName(), subRequest);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 163         return add(ppr);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164     }                                                                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 166     @Override                                                                                            </span>
<span class="2877208390579447415" onmouseenter="enter('2877208390579447415');" onmouseout="out('2877208390579447415');" style=""><abbr title=" 167     public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 167     public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 168         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 168         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="5530250091258169917" onmouseenter="enter('5530250091258169917');" onmouseout="out('5530250091258169917');" style=""> 169         ppr.setRequestingEntityName(entityForm.getMainEntityName());                                     </span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 170         // If the entity form has dynamic forms inside of it, we need to persist those as well.          </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 171         // They are typically done in their own custom persistence handlers, which will get triggered    </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 172         // based on the criteria specific in the PersistencePackage.                                     </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 173         for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 174             DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                  </span>
<span  style=""> 175                                                                                                          </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 176             if (info.getCustomCriteriaOverride() != null) {                                              </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 177                 customCriteria = info.getCustomCriteriaOverride();                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 178             } else {                                                                                     </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 179                 String propertyName = info.getPropertyName();                                            </span>
<span class="8503945409701800913" onmouseenter="enter('8503945409701800913');" onmouseout="out('8503945409701800913');" style=""> 180                 String propertyValue = entityForm.findField(propertyName).getValue();                    </span>
<span class="-4083933246171517436" onmouseenter="enter('-4083933246171517436');" onmouseout="out('-4083933246171517436');" style=""><abbr title=" 181                 customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue };"> 181                 customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182             }                                                                                            </span>
<span  style=""> 183                                                                                                          </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 184             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 184             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriterðŸ”µ</abbr></span>
<span class="3320363489874291671" onmouseenter="enter('3320363489874291671');" onmouseout="out('3320363489874291671');" style=""> 185             subRequest.withSecurityCeilingEntityClassname(info.getSecurityCeilingClassName());           </span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 186             ppr.addSubRequest(info.getPropertyName(), subRequest);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187         }                                                                                                </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 188         return update(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189     }                                                                                                    </span>
<span  style=""> 190                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 191     @Override                                                                                            </span>
<span class="369147730756947995" onmouseenter="enter('369147730756947995');" onmouseout="out('369147730756947995');" style=""><abbr title=" 192     public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb)"> 192     public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 193             throws ServiceException {                                                                    </span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 194         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 194         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 195         return remove(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196     }                                                                                                    </span>
<span  style=""> 197                                                                                                          </span>
<span class="-4457012513682950961" onmouseenter="enter('-4457012513682950961');" onmouseout="out('-4457012513682950961');" style=""> 198     protected List&lt;Property&gt; getPropertiesFromEntityForm(EntityForm entityForm) {                        </span>
<span class="5502280122802762543" onmouseenter="enter('5502280122802762543');" onmouseout="out('5502280122802762543');" style=""> 199         List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;(entityForm.getFields().size());              </span>
<span  style=""> 200                                                                                                          </span>
<span class="-1983225226345189396" onmouseenter="enter('-1983225226345189396');" onmouseout="out('-1983225226345189396');" style=""> 201         for (Entry&lt;String, Field&gt; entry : entityForm.getFields().entrySet()) {                           </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 202             Property p = new Property();                                                                 </span>
<span class="1947374185751812962" onmouseenter="enter('1947374185751812962');" onmouseout="out('1947374185751812962');" style=""> 203             p.setName(entry.getKey());                                                                   </span>
<span class="-7008764564116424461" onmouseenter="enter('-7008764564116424461');" onmouseout="out('-7008764564116424461');" style=""> 204             p.setValue(entry.getValue().getValue());                                                     </span>
<span class="4978688160201726577" onmouseenter="enter('4978688160201726577');" onmouseout="out('4978688160201726577');" style=""> 205             p.setDisplayValue(entry.getValue().getDisplayValue());                                       </span>
<span class="9200882176886832259" onmouseenter="enter('9200882176886832259');" onmouseout="out('9200882176886832259');" style=""> 206             p.setIsDirty(entry.getValue().getIsDirty());                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 207             properties.add(p);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208         }                                                                                                </span>
<span  style=""> 209                                                                                                          </span>
<span class="7053686412803007774" onmouseenter="enter('7053686412803007774');" onmouseout="out('7053686412803007774');" style=""> 210         return properties;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211     }                                                                                                    </span>
<span  style=""> 212                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 213     @Override                                                                                            </span>
<span class="7722997034713089523" onmouseenter="enter('7722997034713089523');" onmouseout="out('7722997034713089523');" style=""><abbr title=" 214 public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumbs) {"> 214 public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriteria, ðŸ”µ</abbr></span>
<span class="-704234828580880941" onmouseenter="enter('-704234828580880941');" onmouseout="out('-704234828580880941');" style=""> 215         // Ensure the ID property is on the form                                                         </span>
<span class="-5311876513799607800" onmouseenter="enter('-5311876513799607800');" onmouseout="out('-5311876513799607800');" style=""> 216         Field idField = entityForm.findField(entityForm.getIdProperty());                                </span>
<span class="-5694238240637206409" onmouseenter="enter('-5694238240637206409');" onmouseout="out('-5694238240637206409');" style=""> 217         if (idField == null) {                                                                           </span>
<span class="250587265755875585" onmouseenter="enter('250587265755875585');" onmouseout="out('250587265755875585');" style=""> 218             idField = new Field();                                                                       </span>
<span class="7054903396669057342" onmouseenter="enter('7054903396669057342');" onmouseout="out('7054903396669057342');" style=""> 219             idField.setName(entityForm.getIdProperty());                                                 </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 220             idField.setValue(entityForm.getId());                                                        </span>
<span class="-7557326149225538579" onmouseenter="enter('-7557326149225538579');" onmouseout="out('-7557326149225538579');" style=""> 221             entityForm.getFields().put(entityForm.getIdProperty(), idField);                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 222         } else {                                                                                         </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 223             idField.setValue(entityForm.getId());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224         }                                                                                                </span>
<span  style=""> 225                                                                                                          </span>
<span class="2582109723187805610" onmouseenter="enter('2582109723187805610');" onmouseout="out('2582109723187805610');" style=""> 226         List&lt;Property&gt; propList = getPropertiesFromEntityForm(entityForm);                               </span>
<span class="-5301080913609099643" onmouseenter="enter('-5301080913609099643');" onmouseout="out('-5301080913609099643');" style=""> 227         Property[] properties = new Property[propList.size()];                                           </span>
<span class="-3900695733940297394" onmouseenter="enter('-3900695733940297394');" onmouseout="out('-3900695733940297394');" style=""> 228         properties = propList.toArray(properties);                                                       </span>
<span  style=""> 229                                                                                                          </span>
<span class="-4105415098036700385" onmouseenter="enter('-4105415098036700385');" onmouseout="out('-4105415098036700385');" style=""> 230         Entity entity = new Entity();                                                                    </span>
<span class="-2371781861505771230" onmouseenter="enter('-2371781861505771230');" onmouseout="out('-2371781861505771230');" style=""> 231         entity.setProperties(properties);                                                                </span>
<span class="2583214667713512490" onmouseenter="enter('2583214667713512490');" onmouseout="out('2583214667713512490');" style=""> 232         String entityType = entityForm.getEntityType();                                                  </span>
<span class="-96692239825780670" onmouseenter="enter('-96692239825780670');" onmouseout="out('-96692239825780670');" style=""> 233         if (StringUtils.isEmpty(entityType)) {                                                           </span>
<span class="-1511101492052020501" onmouseenter="enter('-1511101492052020501');" onmouseout="out('-1511101492052020501');" style=""> 234             entityType = entityForm.getCeilingEntityClassname();                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235         }                                                                                                </span>
<span class="7921575741096618275" onmouseenter="enter('7921575741096618275');" onmouseout="out('7921575741096618275');" style=""> 236         entity.setType(new String[]{entityType});                                                        </span>
<span  style=""> 237                                                                                                          </span>
<span class="2943675610735544566" onmouseenter="enter('2943675610735544566');" onmouseout="out('2943675610735544566');" style=""> 238         PersistencePackageRequest ppr = PersistencePackageRequest.standard()                             </span>
<span class="-2471313258794916634" onmouseenter="enter('-2471313258794916634');" onmouseout="out('-2471313258794916634');" style=""> 239                 .withEntity(entity)                                                                      </span>
<span class="5641680747003306930" onmouseenter="enter('5641680747003306930');" onmouseout="out('5641680747003306930');" style=""> 240                 .withCustomCriteria(customCriteria)                                                      </span>
<span class="3304977465026105541" onmouseenter="enter('3304977465026105541');" onmouseout="out('3304977465026105541');" style=""> 241                 .withCeilingEntityClassname(entityForm.getCeilingEntityClassname())                      </span>
<span class="-600959917227055027" onmouseenter="enter('-600959917227055027');" onmouseout="out('-600959917227055027');" style=""> 242                 .withSectionCrumbs(sectionCrumbs)                                                        </span>
<span class="745722289441255857" onmouseenter="enter('745722289441255857');" onmouseout="out('745722289441255857');" style=""> 243                 .withRequestingEntityName(entityForm.getMainEntityName());                               </span>
<span class="-1955805470028526694" onmouseenter="enter('-1955805470028526694');" onmouseout="out('-1955805470028526694');" style=""> 244         return ppr;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245     }                                                                                                    </span>
<span  style=""> 246                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 247     @Override                                                                                            </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 248     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 248     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity ðŸ”µ</abbr></span>
<span class="6970881093397655354" onmouseenter="enter('6970881093397655354');" onmouseout="out('6970881093397655354');" style=""><abbr title=" 249             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId)"> 249             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, StrinðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 250             throws ServiceException {                                                                    </span>
<span class="-8379471421074460507" onmouseenter="enter('-8379471421074460507');" onmouseout="out('-8379471421074460507');" style=""><abbr title=" 251         return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty, collectionItemId, sectionCrumbs, alternateId, null);"> 251         return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252     }                                                                                                    </span>
<span  style=""> 253                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 254     @Override                                                                                            </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 255     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 255     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity ðŸ”µ</abbr></span>
<span class="-7996433221423208195" onmouseenter="enter('-7996433221423208195');" onmouseout="out('-7996433221423208195');" style=""><abbr title=" 256             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId,"> 256             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, StrinðŸ”µ</abbr></span>
<span class="4731322974144125980" onmouseenter="enter('4731322974144125980');" onmouseout="out('4731322974144125980');" style=""> 257             String[] customCriteria) throws ServiceException {                                           </span>
<span class="-279994379320395128" onmouseenter="enter('-279994379320395128');" onmouseout="out('-279994379320395128');" style=""><abbr title=" 258         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs);"> 258         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetaðŸ”µ</abbr></span>
<span  style=""> 259                                                                                                          </span>
<span class="-1281430943574994988" onmouseenter="enter('-1281430943574994988');" onmouseout="out('-1281430943574994988');" style=""> 260         ppr.addCustomCriteria(customCriteria);                                                           </span>
<span  style=""> 261                                                                                                          </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 262         FieldMetadata md = collectionProperty.getMetadata();                                             </span>
<span class="3724000031963826131" onmouseenter="enter('3724000031963826131');" onmouseout="out('3724000031963826131');" style=""><abbr title=" 263         String containingEntityId = getContextSpecificRelationshipId(containingClassMetadata, containingEntity,"> 263         String containingEntityId = getContextSpecificRelationshipId(containingClassMetadata, containingEðŸ”µ</abbr></span>
<span class="-7103210414980095383" onmouseenter="enter('-7103210414980095383');" onmouseout="out('-7103210414980095383');" style=""> 264                 collectionProperty.getName());                                                           </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 265         ppr.setSectionEntityField(collectionProperty.getName());                                         </span>
<span  style=""> 266                                                                                                          </span>
<span class="6887268983731320356" onmouseenter="enter('6887268983731320356');" onmouseout="out('6887268983731320356');" style=""> 267         PersistenceResponse response;                                                                    </span>
<span  style=""> 268                                                                                                          </span>
<span class="-5961537470500127604" onmouseenter="enter('-5961537470500127604');" onmouseout="out('-5961537470500127604');" style=""> 269         if (md instanceof AdornedTargetCollectionMetadata) {                                             </span>
<span class="8356058175939814254" onmouseenter="enter('8356058175939814254');" onmouseout="out('8356058175939814254');" style=""><abbr title=" 270             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());"> 270             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFielðŸ”µ</abbr></span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 271             fasc.setFilterValue(containingEntityId);                                                     </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 272             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 273                                                                                                          </span>
<span class="-3458751872436187064" onmouseenter="enter('-3458751872436187064');" onmouseout="out('-3458751872436187064');" style=""> 274             fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName() + &quot;Target&quot;);  </span>
<span class="-3598598531395908508" onmouseenter="enter('-3598598531395908508');" onmouseout="out('-3598598531395908508');" style=""> 275             fasc.setFilterValue(collectionItemId);                                                       </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 276             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 277                                                                                                          </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 278             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="-5748606955827926888" onmouseenter="enter('-5748606955827926888');" onmouseout="out('-5748606955827926888');" style=""> 279                 fasc = new FilterAndSortCriteria(ppr.getAdornedList().getIdProperty());                  </span>
<span class="7811712685421146637" onmouseenter="enter('7811712685421146637');" onmouseout="out('7811712685421146637');" style=""> 280                 fasc.setFilterValue(alternateId);                                                        </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 281                 ppr.addFilterAndSortCriteria(fasc);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282             }                                                                                            </span>
<span  style=""> 283                                                                                                          </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 284             response = fetch(ppr);                                                                       </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 285             Entity[] entities = response.getDynamicResultSet().getRecords();                             </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 286             if (ArrayUtils.isEmpty(entities)) {                                                          </span>
<span class="-6945066260128413327" onmouseenter="enter('-6945066260128413327');" onmouseout="out('-6945066260128413327');" style=""> 287                 String altId = (!StringUtils.isEmpty(alternateId)) ? alternateId : &quot;&quot;;                   </span>
<span class="6252787461298878948" onmouseenter="enter('6252787461298878948');" onmouseout="out('6252787461298878948');" style=""><abbr title=" 288                 throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%s], id [%s], targetId [%s], alternateId [%s] &quot;,"> 288                 throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%ðŸ”µ</abbr></span>
<span class="-631993348779519244" onmouseenter="enter('-631993348779519244');" onmouseout="out('-631993348779519244');" style=""><abbr title=" 289                         ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), containingEntityId, collectionItemId, altId));"> 289                         ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), cðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 291         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="8401290555692845532" onmouseenter="enter('8401290555692845532');" onmouseout="out('8401290555692845532');" style=""> 292             MapMetadata mmd = (MapMetadata) md;                                                          </span>
<span class="-9165857322565832123" onmouseenter="enter('-9165857322565832123');" onmouseout="out('-9165857322565832123');" style=""> 293             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());</span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 294             fasc.setFilterValue(containingEntityId);                                                     </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 295             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 296                                                                                                          </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 297             response = fetch(ppr);                                                                       </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 298             Entity[] entities = response.getDynamicResultSet().getRecords();                             </span>
<span class="-7031469698370723184" onmouseenter="enter('-7031469698370723184');" onmouseout="out('-7031469698370723184');" style=""> 299             for (Entity e : entities) {                                                                  </span>
<span class="5353809260142967112" onmouseenter="enter('5353809260142967112');" onmouseout="out('5353809260142967112');" style=""> 300                 String idProperty = getIdProperty(containingClassMetadata);                              </span>
<span class="5591331798883124479" onmouseenter="enter('5591331798883124479');" onmouseout="out('5591331798883124479');" style=""> 301                 if (mmd.isSimpleValue()) {                                                               </span>
<span class="-4161155795101164165" onmouseenter="enter('-4161155795101164165');" onmouseout="out('-4161155795101164165');" style=""> 302                     idProperty = &quot;key&quot;;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303                 }                                                                                        </span>
<span class="8921593406962610258" onmouseenter="enter('8921593406962610258');" onmouseout="out('8921593406962610258');" style=""> 304                 Property p = e.getPMap().get(idProperty);                                                </span>
<span class="6407772199744557069" onmouseenter="enter('6407772199744557069');" onmouseout="out('6407772199744557069');" style=""> 305                 if (p.getValue().equals(collectionItemId)) {                                             </span>
<span class="-7132868348925489606" onmouseenter="enter('-7132868348925489606');" onmouseout="out('-7132868348925489606');" style=""> 306                     response.setEntity(e);                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 307                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 310         } else {                                                                                         </span>
<span class="8229323461389456522" onmouseenter="enter('8229323461389456522');" onmouseout="out('8229323461389456522');" style=""><abbr title=" 311             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not an &quot; +"> 311             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="8394443338285651390" onmouseenter="enter('8394443338285651390');" onmouseout="out('8394443338285651390');" style=""><abbr title=" 312                     &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));"> 312                     &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.gðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313         }                                                                                                </span>
<span  style=""> 314                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 315         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316     }                                                                                                    </span>
<span  style=""> 317                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 318     @Override                                                                                            </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 319     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 319     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity contðŸ”µ</abbr></span>
<span class="-8940960037863570008" onmouseenter="enter('-8940960037863570008');" onmouseout="out('-8940960037863570008');" style=""><abbr title=" 320             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 320             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxInðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 321             throws ServiceException {                                                                    </span>
<span class="4618756740023180601" onmouseenter="enter('4618756740023180601');" onmouseout="out('4618756740023180601');" style=""><abbr title=" 322         return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, startIndex,"> 322         return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fasðŸ”µ</abbr></span>
<span class="2241863538673887409" onmouseenter="enter('2241863538673887409');" onmouseout="out('2241863538673887409');" style=""> 323                 maxIndex, null, sectionCrumb);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324     }                                                                                                    </span>
<span  style=""> 325                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 326     @Override                                                                                            </span>
<span class="-7201231903947653503" onmouseenter="enter('-7201231903947653503');" onmouseout="out('-7201231903947653503');" style=""><abbr title=" 327     public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 327     public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, EntityðŸ”µ</abbr></span>
<span class="418251651311673518" onmouseenter="enter('418251651311673518');" onmouseout="out('418251651311673518');" style=""><abbr title=" 328             Property collectionProperty, FilterAndSortCriteria[] fascs, FetchPageRequest fetchPageRequest,"> 328             Property collectionProperty, FilterAndSortCriteria[] fascs, FetchPageRequest fetchPageRequestðŸ”µ</abbr></span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 329             String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {          </span>
<span class="7874520314895198323" onmouseenter="enter('7874520314895198323');" onmouseout="out('7874520314895198323');" style=""><abbr title=" 330         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs)"> 330         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetaðŸ”µ</abbr></span>
<span class="-7469251084029012642" onmouseenter="enter('-7469251084029012642');" onmouseout="out('-7469251084029012642');" style=""> 331             .withFilterAndSortCriteria(fascs)                                                            </span>
<span class="-7573135850576319031" onmouseenter="enter('-7573135850576319031');" onmouseout="out('-7573135850576319031');" style=""> 332             .withStartIndex(fetchPageRequest.getStartIndex())                                            </span>
<span class="-3581511696188385312" onmouseenter="enter('-3581511696188385312');" onmouseout="out('-3581511696188385312');" style=""> 333             .withMaxIndex(fetchPageRequest.getMaxIndex())                                                </span>
<span class="-8590301553347003975" onmouseenter="enter('-8590301553347003975');" onmouseout="out('-8590301553347003975');" style=""> 334             .withFirstId(fetchPageRequest.getFirstId())                                                  </span>
<span class="2671174632142808768" onmouseenter="enter('2671174632142808768');" onmouseout="out('2671174632142808768');" style=""> 335             .withLastId(fetchPageRequest.getLastId())                                                    </span>
<span class="-6593991434037097050" onmouseenter="enter('-6593991434037097050');" onmouseout="out('-6593991434037097050');" style=""> 336             .withLowerCount(fetchPageRequest.getLowerCount())                                            </span>
<span class="-117029417959198312" onmouseenter="enter('-117029417959198312');" onmouseout="out('-117029417959198312');" style=""> 337             .withUpperCount(fetchPageRequest.getUpperCount())                                            </span>
<span class="-4278016885305366423" onmouseenter="enter('-4278016885305366423');" onmouseout="out('-4278016885305366423');" style=""> 338             .withPageSize(fetchPageRequest.getPageSize())                                                </span>
<span class="-6582704259903712752" onmouseenter="enter('-6582704259903712752');" onmouseout="out('-6582704259903712752');" style=""> 339             .withPresentationFetch(true);                                                                </span>
<span  style=""> 340                                                                                                          </span>
<span class="-3273025574919321412" onmouseenter="enter('-3273025574919321412');" onmouseout="out('-3273025574919321412');" style=""> 341         FilterAndSortCriteria fasc;                                                                      </span>
<span  style=""> 342                                                                                                          </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 343         FieldMetadata md = collectionProperty.getMetadata();                                             </span>
<span class="-4862294775264679708" onmouseenter="enter('-4862294775264679708');" onmouseout="out('-4862294775264679708');" style=""> 344         String collectionCeilingClass = null;                                                            </span>
<span  style=""> 345                                                                                                          </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 346         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 347             fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                      </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 348             collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();             </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 349         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="5713965317772328276" onmouseenter="enter('5713965317772328276');" onmouseout="out('5713965317772328276');" style=""> 350             fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());             </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 351             collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();             </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 352         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 353             fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 354         } else {                                                                                         </span>
<span class="-7764689527754153249" onmouseenter="enter('-7764689527754153249');" onmouseout="out('-7764689527754153249');" style=""><abbr title=" 355             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not a &quot; +"> 355             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="9018729105513046766" onmouseenter="enter('9018729105513046766');" onmouseout="out('9018729105513046766');" style=""><abbr title=" 356                     &quot;collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));"> 356                     &quot;collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357         }                                                                                                </span>
<span  style=""> 358                                                                                                          </span>
<span class="4254518413777245486" onmouseenter="enter('4254518413777245486');" onmouseout="out('4254518413777245486');" style=""> 359         String id;                                                                                       </span>
<span class="4803324110888028956" onmouseenter="enter('4803324110888028956');" onmouseout="out('4803324110888028956');" style=""> 360         if (idValueOverride == null) {                                                                   </span>
<span class="-7725769379673096748" onmouseenter="enter('-7725769379673096748');" onmouseout="out('-7725769379673096748');" style=""><abbr title=" 361             id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionProperty.getName());"> 361             id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionPrðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 362         } else {                                                                                         </span>
<span class="-8702106967230782193" onmouseenter="enter('-8702106967230782193');" onmouseout="out('-8702106967230782193');" style=""> 363             id = idValueOverride;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364         }                                                                                                </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 365         fasc.setFilterValue(id);                                                                         </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 366         ppr.addFilterAndSortCriteria(fasc);                                                              </span>
<span  style=""> 367                                                                                                          </span>
<span class="427990645680582522" onmouseenter="enter('427990645680582522');" onmouseout="out('427990645680582522');" style=""> 368         if (collectionCeilingClass != null) {                                                            </span>
<span class="-6816699203213465846" onmouseenter="enter('-6816699203213465846');" onmouseout="out('-6816699203213465846');" style=""> 369             ppr.setCeilingEntityClassname(collectionCeilingClass);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370         }                                                                                                </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 371         ppr.setSectionEntityField(collectionProperty.getName());                                         </span>
<span  style=""> 372                                                                                                          </span>
<span class="4509000565359254391" onmouseenter="enter('4509000565359254391');" onmouseout="out('4509000565359254391');" style=""> 373         return fetch(ppr);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374     }                                                                                                    </span>
<span  style=""> 375                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 376     @Override                                                                                            </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 377     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 377     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity contðŸ”µ</abbr></span>
<span class="509622451136715712" onmouseenter="enter('509622451136715712');" onmouseout="out('509622451136715712');" style=""><abbr title=" 378             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex,"> 378             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxInðŸ”µ</abbr></span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 379             String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {          </span>
<span class="-1197294568643910019" onmouseenter="enter('-1197294568643910019');" onmouseout="out('-1197294568643910019');" style=""><abbr title=" 380         FetchPageRequest pageRequest = new FetchPageRequest().withStartIndex(startIndex).withMaxIndex(maxIndex);"> 380         FetchPageRequest pageRequest = new FetchPageRequest().withStartIndex(startIndex).withMaxIndex(maxðŸ”µ</abbr></span>
<span class="-1074537376579155932" onmouseenter="enter('-1074537376579155932');" onmouseout="out('-1074537376579155932');" style=""><abbr title=" 381         return getPagedRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs,"> 381         return getPagedRecordsForCollection(containingClassMetadata, containingEntity, collectionPropertyðŸ”µ</abbr></span>
<span class="-3163237569846875940" onmouseenter="enter('-3163237569846875940');" onmouseout="out('-3163237569846875940');" style=""> 382                 pageRequest, idValueOverride, sectionCrumbs);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383     }                                                                                                    </span>
<span  style=""> 384                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 385     @Override                                                                                            </span>
<span class="-3841297295714521949" onmouseenter="enter('-3841297295714521949');" onmouseout="out('-3841297295714521949');" style=""><abbr title=" 386     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 386     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, EnðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 387             throws ServiceException {                                                                    </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 388         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                     </span>
<span  style=""> 389                                                                                                          </span>
<span class="-733567857055224528" onmouseenter="enter('-733567857055224528');" onmouseout="out('-733567857055224528');" style=""> 390         PersistenceResponse response = getClassMetadata(ppr);                                            </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 391         ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                           </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 392         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 393             if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])</span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 394                     &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                  </span>
<span class="8095643692447388517" onmouseenter="enter('8095643692447388517');" onmouseout="out('8095643692447388517');" style=""><abbr title=" 395                 PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, startIndex, maxIndex, sectionCrumb);"> 395                 PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, sðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 396                 map.put(p.getName(), response2.getDynamicResultSet());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398         }                                                                                                </span>
<span  style=""> 399                                                                                                          </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 400         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 401     }                                                                                                    </span>
<span  style=""> 402                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 403     @Override                                                                                            </span>
<span class="-3628970257678085943" onmouseenter="enter('-3628970257678085943');" onmouseout="out('-3628970257678085943');" style=""><abbr title=" 404     public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity containingEntity,"> 404     public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity contðŸ”µ</abbr></span>
<span class="-4231090245204295086" onmouseenter="enter('-4231090245204295086');" onmouseout="out('-4231090245204295086');" style=""><abbr title=" 405                                                                            List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 405                                                                            List&lt;SectionCrumb&gt; sectionCrumðŸ”µ</abbr></span>
<span class="-2409741133586104337" onmouseenter="enter('-2409741133586104337');" onmouseout="out('-2409741133586104337');" style=""> 406         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;&gt;();                                             </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 407         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="4164210101311278906" onmouseenter="enter('4164210101311278906');" onmouseout="out('4164210101311278906');" style=""> 408             FieldMetadata fieldMetadata = p.getMetadata();                                               </span>
<span class="-4624883475289984299" onmouseenter="enter('-4624883475289984299');" onmouseout="out('-4624883475289984299');" style=""><abbr title=" 409             boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEntity.getType()[0]);"> 409             boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEðŸ”µ</abbr></span>
<span class="527509468046610128" onmouseenter="enter('527509468046610128');" onmouseout="out('527509468046610128');" style=""> 410             if (fieldAvailable &amp;&amp; fieldMetadata instanceof CollectionMetadata) {                         </span>
<span class="889550045664327310" onmouseenter="enter('889550045664327310');" onmouseout="out('889550045664327310');" style=""> 411                 FetchPageRequest pageRequest = new FetchPageRequest()                                    </span>
<span class="7756015397659671998" onmouseenter="enter('7756015397659671998');" onmouseout="out('7756015397659671998');" style=""> 412                         .withPageSize(Integer.MAX_VALUE);                                                </span>
<span class="-5742395122034161641" onmouseenter="enter('-5742395122034161641');" onmouseout="out('-5742395122034161641');" style=""><abbr title=" 413                 PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pageRequest, null, sectionCrumb);"> 413                 PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pðŸ”µ</abbr></span>
<span class="7448530828258193539" onmouseenter="enter('7448530828258193539');" onmouseout="out('7448530828258193539');" style=""> 414                 map.put(p.getName(), resp.getDynamicResultSet());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416         }                                                                                                </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 417         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 418     }                                                                                                    </span>
<span  style=""> 419                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 420     @Override                                                                                            </span>
<span class="3589590817922421749" onmouseenter="enter('3589590817922421749');" onmouseout="out('3589590817922421749');" style=""><abbr title=" 421     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb)"> 421     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, EnðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 422             throws ServiceException {                                                                    </span>
<span  style=""> 423                                                                                                          </span>
<span class="7186594912669123504" onmouseenter="enter('7186594912669123504');" onmouseout="out('7186594912669123504');" style=""> 424         return getRecordsForAllSubCollections(ppr, containingEntity, null, null, sectionCrumb);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 425     }                                                                                                    </span>
<span  style=""> 426                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 427     @Override                                                                                            </span>
<span class="-7386306397684799123" onmouseenter="enter('-7386306397684799123');" onmouseout="out('-7386306397684799123');" style=""><abbr title=" 428     public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb,"> 428     public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntðŸ”µ</abbr></span>
<span class="-5959215544738911709" onmouseenter="enter('-5959215544738911709');" onmouseout="out('-5959215544738911709');" style=""> 429             String currentTabName) throws ServiceException {                                             </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 430         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                     </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 431         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 432             if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])</span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 433                     &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                  </span>
<span  style=""> 434                                                                                                          </span>
<span class="-8882071661255371966" onmouseenter="enter('-8882071661255371966');" onmouseout="out('-8882071661255371966');" style=""> 435                 CollectionMetadata collectionMetadata = (CollectionMetadata) p.getMetadata();            </span>
<span  style=""> 436                                                                                                          </span>
<span class="-6866172471902490379" onmouseenter="enter('-6866172471902490379');" onmouseout="out('-6866172471902490379');" style=""><abbr title=" 437                 // Give preference to the Group since EntityForm.addListGrid() gives preference to the Group"> 437                 // Give preference to the Group since EntityForm.addListGrid() gives preference to the GrðŸ”µ</abbr></span>
<span class="5847566346942070760" onmouseenter="enter('5847566346942070760');" onmouseout="out('5847566346942070760');" style=""> 438                 TabMetadata tabMetadata = cmd.getTabMetadataUsingGroupKey(collectionMetadata.getGroup());</span>
<span class="5004852122593217272" onmouseenter="enter('5004852122593217272');" onmouseout="out('5004852122593217272');" style=""> 439                 if (tabMetadata == null) {                                                               </span>
<span class="231191347318133709" onmouseenter="enter('231191347318133709');" onmouseout="out('231191347318133709');" style=""> 440                     tabMetadata = cmd.getTabMetadataUsingTabKey(collectionMetadata.getTab());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441                 }                                                                                        </span>
<span  style=""> 442                                                                                                          </span>
<span class="-3015386838727954630" onmouseenter="enter('-3015386838727954630');" onmouseout="out('-3015386838727954630');" style=""><abbr title=" 443                 String tabName = tabMetadata == null ? collectionMetadata.getTab() : tabMetadata.getTabName();"> 443                 String tabName = tabMetadata == null ? collectionMetadata.getTab() : tabMetadata.getTabNaðŸ”µ</abbr></span>
<span class="-7179383252706615246" onmouseenter="enter('-7179383252706615246');" onmouseout="out('-7179383252706615246');" style=""><abbr title=" 444                 int tabOrder = tabMetadata == null ? collectionMetadata.getTabOrder() : tabMetadata.getTabOrder();"> 444                 int tabOrder = tabMetadata == null ? collectionMetadata.getTabOrder() : tabMetadata.getTaðŸ”µ</abbr></span>
<span class="-1384994182862418254" onmouseenter="enter('-1384994182862418254');" onmouseout="out('-1384994182862418254');" style=""> 445                 updateTabInfo(collectionMetadata, cmd, tabName, tabOrder);                               </span>
<span  style=""> 446                                                                                                          </span>
<span class="8686774820240993219" onmouseenter="enter('8686774820240993219');" onmouseout="out('8686774820240993219');" style=""> 447                 if (collectionMetadata.getLazyFetch() != null &amp;&amp; collectionMetadata.getLazyFetch()       </span>
<span class="5105727312979860339" onmouseenter="enter('5105727312979860339');" onmouseout="out('5105727312979860339');" style=""> 448                         &amp;&amp; tabName.toUpperCase().startsWith(currentTabName.toUpperCase())                </span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 449                         &amp;&amp; !collectionMetadata.getManualFetch()) {                                       </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 450                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 450                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, nulðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 451                     map.put(p.getName(), response2.getDynamicResultSet());                               </span>
<span class="8148681537408196343" onmouseenter="enter('8148681537408196343');" onmouseout="out('8148681537408196343');" style=""><abbr title=" 452                 } else if (collectionMetadata.getLazyFetch() != null &amp;&amp; !collectionMetadata.getLazyFetch()"> 452                 } else if (collectionMetadata.getLazyFetch() != null &amp;&amp; !collectionMetadata.getLazyFetch(ðŸ”µ</abbr></span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 453                         &amp;&amp; !collectionMetadata.getManualFetch()) {                                       </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 454                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 454                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, nulðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 455                     map.put(p.getName(), response2.getDynamicResultSet());                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 456                 } else {                                                                                 </span>
<span class="4201070416549217756" onmouseenter="enter('4201070416549217756');" onmouseout="out('4201070416549217756');" style=""> 457                     DynamicResultSet drs = new DynamicResultSet();                                       </span>
<span class="133064617150058408" onmouseenter="enter('133064617150058408');" onmouseout="out('133064617150058408');" style=""> 458                     Map&lt;String, Tab&gt; tabMap = new HashMap&lt;String, Tab&gt;();                                </span>
<span class="52154028506366978" onmouseenter="enter('52154028506366978');" onmouseout="out('52154028506366978');" style=""> 459                     Tab tab = new Tab();                                                                 </span>
<span class="7573724056713363868" onmouseenter="enter('7573724056713363868');" onmouseout="out('7573724056713363868');" style=""> 460                     tab.setKey(tabName);                                                                 </span>
<span class="6935872114105155637" onmouseenter="enter('6935872114105155637');" onmouseout="out('6935872114105155637');" style=""> 461                     tab.setTitle(BLCMessageUtils.getMessage(tabName));                                   </span>
<span class="-3862389491808527983" onmouseenter="enter('-3862389491808527983');" onmouseout="out('-3862389491808527983');" style=""> 462                     tab.setOrder(tabOrder);                                                              </span>
<span class="-8730262596017656059" onmouseenter="enter('-8730262596017656059');" onmouseout="out('-8730262596017656059');" style=""> 463                     tabMap.put(tab.getTitle(), tab);                                                     </span>
<span class="6973540073738050016" onmouseenter="enter('6973540073738050016');" onmouseout="out('6973540073738050016');" style=""> 464                     drs.setUnselectedTabMetadata(tabMap);                                                </span>
<span class="-3072709309961217124" onmouseenter="enter('-3072709309961217124');" onmouseout="out('-3072709309961217124');" style=""> 465                     drs.setTotalRecords(0);                                                              </span>
<span class="8982521778669319238" onmouseenter="enter('8982521778669319238');" onmouseout="out('8982521778669319238');" style=""> 466                     drs.setStartIndex(0);                                                                </span>
<span class="-2316590965963048275" onmouseenter="enter('-2316590965963048275');" onmouseout="out('-2316590965963048275');" style=""> 467                     drs.setBatchId(1);                                                                   </span>
<span class="6524963296885553626" onmouseenter="enter('6524963296885553626');" onmouseout="out('6524963296885553626');" style=""> 468                     drs.setClassMetaData(null);                                                          </span>
<span class="5830489670252814572" onmouseenter="enter('5830489670252814572');" onmouseout="out('5830489670252814572');" style=""> 469                     drs.setPageSize(1);                                                                  </span>
<span class="-3474843426091445352" onmouseenter="enter('-3474843426091445352');" onmouseout="out('-3474843426091445352');" style=""> 470                     drs.setRecords(new Entity[0]);                                                       </span>
<span class="5333638146813618055" onmouseenter="enter('5333638146813618055');" onmouseout="out('5333638146813618055');" style=""> 471                     map.put(p.getName(), drs);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474         }                                                                                                </span>
<span  style=""> 475                                                                                                          </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 476         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477     }                                                                                                    </span>
<span  style=""> 478                                                                                                          </span>
<span class="-8906234562852924572" onmouseenter="enter('-8906234562852924572');" onmouseout="out('-8906234562852924572');" style=""><abbr title=" 479     protected void updateTabInfo(CollectionMetadata fmd, ClassMetadata cmd, String tabName, int tabOrder) {"> 479     protected void updateTabInfo(CollectionMetadata fmd, ClassMetadata cmd, String tabName, int tabOrder)ðŸ”µ</abbr></span>
<span class="6418671463533151954" onmouseenter="enter('6418671463533151954');" onmouseout="out('6418671463533151954');" style=""> 480         boolean tabInfoFound = false;                                                                    </span>
<span class="5408213491241477604" onmouseenter="enter('5408213491241477604');" onmouseout="out('5408213491241477604');" style=""> 481         Map&lt;String, TabMetadata&gt; tabMetadataMap = cmd.getTabAndGroupMetadata();                          </span>
<span class="-2540078251533437241" onmouseenter="enter('-2540078251533437241');" onmouseout="out('-2540078251533437241');" style=""> 482         for (String tabKey : tabMetadataMap.keySet()) {                                                  </span>
<span class="7583512444437065393" onmouseenter="enter('7583512444437065393');" onmouseout="out('7583512444437065393');" style=""> 483             Map&lt;String, GroupMetadata&gt; groupMetadataMap = tabMetadataMap.get(tabKey).getGroupMetadata(); </span>
<span class="-5526517230184735053" onmouseenter="enter('-5526517230184735053');" onmouseout="out('-5526517230184735053');" style=""> 484             for (String groupKey : groupMetadataMap.keySet()) {                                          </span>
<span class="98584842541508129" onmouseenter="enter('98584842541508129');" onmouseout="out('98584842541508129');" style=""><abbr title=" 485                 if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equals(fmd.getGroup())) {"> 485                 if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equaðŸ”µ</abbr></span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 486                     tabName = tabMetadataMap.get(tabKey).getTabName();                                   </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 487                     tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                 </span>
<span class="4945701621495059563" onmouseenter="enter('4945701621495059563');" onmouseout="out('4945701621495059563');" style=""> 488                     tabInfoFound = true;                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 489                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491             }                                                                                            </span>
<span class="1550248699436795528" onmouseenter="enter('1550248699436795528');" onmouseout="out('1550248699436795528');" style=""> 492             if (tabInfoFound) {                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 493                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494             }                                                                                            </span>
<span class="6331731299217129446" onmouseenter="enter('6331731299217129446');" onmouseout="out('6331731299217129446');" style=""> 495             if (tabKey.equals(tabName) || tabMetadataMap.get(tabKey).getTabName().equals(tabName)) {     </span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 496                 tabName = tabMetadataMap.get(tabKey).getTabName();                                       </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 497                 tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500     }                                                                                                    </span>
<span  style=""> 501                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 502     @Override                                                                                            </span>
<span class="2611376483592856297" onmouseenter="enter('2611376483592856297');" onmouseout="out('2611376483592856297');" style=""><abbr title=" 503     public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field,"> 503     public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, ðŸ”µ</abbr></span>
<span class="6733854382866461502" onmouseenter="enter('6733854382866461502');" onmouseout="out('6733854382866461502');" style=""> 504             Entity parentEntity, List&lt;SectionCrumb&gt; sectionCrumbs)                                       </span>
<span class="-9069306879086868954" onmouseenter="enter('-9069306879086868954');" onmouseout="out('-9069306879086868954');" style=""> 505             throws ServiceException, ClassNotFoundException {                                            </span>
<span class="-8197057147118619768" onmouseenter="enter('-8197057147118619768');" onmouseout="out('-8197057147118619768');" style=""> 506         // Assemble the properties from the entity form                                                  </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 507         List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                             </span>
<span  style=""> 508                                                                                                          </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 509         FieldMetadata md = field.getMetadata();                                                          </span>
<span  style=""> 510                                                                                                          </span>
<span class="-3154651088293222897" onmouseenter="enter('-3154651088293222897');" onmouseout="out('-3154651088293222897');" style=""> 511         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs)        </span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 512                 .withEntity(new Entity());                                                               </span>
<span class="6854684741721952189" onmouseenter="enter('6854684741721952189');" onmouseout="out('6854684741721952189');" style=""> 513         ppr.getEntity().setIsPreAdd(parentEntity.isPreAdd());                                            </span>
<span  style=""> 514                                                                                                          </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 515         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="6607267312947776736" onmouseenter="enter('6607267312947776736');" onmouseout="out('6607267312947776736');" style=""> 516             BasicCollectionMetadata fmd = (BasicCollectionMetadata) md;                                  </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 517             ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                        </span>
<span  style=""> 518                                                                                                          </span>
<span class="-2325626323266423717" onmouseenter="enter('-2325626323266423717');" onmouseout="out('-2325626323266423717');" style=""> 519             // If we&#x27;re looking up an entity instead of trying to create one on the fly, let&#x27;s make sure </span>
<span class="3526840633411573677" onmouseenter="enter('3526840633411573677');" onmouseout="out('3526840633411573677');" style=""><abbr title=" 520             // that we&#x27;re not changing the target entity at all and only creating the association to the id"> 520             // that we&#x27;re not changing the target entity at all and only creating the association to the ðŸ”µ</abbr></span>
<span class="3093503126858687967" onmouseenter="enter('3093503126858687967');" onmouseout="out('3093503126858687967');" style=""> 521             if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP) ||                                   </span>
<span class="6274591046536853861" onmouseenter="enter('6274591046536853861');" onmouseout="out('6274591046536853861');" style=""> 522                     fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                    </span>
<span class="1728529167243720357" onmouseenter="enter('1728529167243720357');" onmouseout="out('1728529167243720357');" style=""> 523                 List&lt;String&gt; fieldsToRemove = new ArrayList&lt;String&gt;();                                   </span>
<span  style=""> 524                                                                                                          </span>
<span class="8261635343050838543" onmouseenter="enter('8261635343050838543');" onmouseout="out('8261635343050838543');" style=""> 525                 String idProp = getIdProperty(mainMetadata);                                             </span>
<span class="7372165960962811555" onmouseenter="enter('7372165960962811555');" onmouseout="out('7372165960962811555');" style=""> 526                 for (String key : entityForm.getFields().keySet()) {                                     </span>
<span class="-3969218055241208355" onmouseenter="enter('-3969218055241208355');" onmouseout="out('-3969218055241208355');" style=""> 527                     if (!idProp.equals(key)) {                                                           </span>
<span class="329726563907215496" onmouseenter="enter('329726563907215496');" onmouseout="out('329726563907215496');" style=""> 528                         fieldsToRemove.add(key);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530                 }                                                                                        </span>
<span  style=""> 531                                                                                                          </span>
<span class="-8204439459370995320" onmouseenter="enter('-8204439459370995320');" onmouseout="out('-8204439459370995320');" style=""> 532                 for (String key : fieldsToRemove) {                                                      </span>
<span class="-3002518314516620728" onmouseenter="enter('-3002518314516620728');" onmouseout="out('-3002518314516620728');" style=""> 533                     ListIterator&lt;Property&gt; li = properties.listIterator();                               </span>
<span class="-3598623445235132470" onmouseenter="enter('-3598623445235132470');" onmouseout="out('-3598623445235132470');" style=""> 534                     while (li.hasNext()) {                                                               </span>
<span class="-4936311913022510436" onmouseenter="enter('-4936311913022510436');" onmouseout="out('-4936311913022510436');" style=""> 535                         if (li.next().getName().equals(key)) {                                           </span>
<span class="-7629195606720709622" onmouseenter="enter('-7629195606720709622');" onmouseout="out('-7629195606720709622');" style=""> 536                             li.remove();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 537                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539                 }                                                                                        </span>
<span  style=""> 540                                                                                                          </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 541                 ppr.setValidateUnsubmittedProperties(false);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542             }                                                                                            </span>
<span  style=""> 543                                                                                                          </span>
<span class="-2511723907351376263" onmouseenter="enter('-2511723907351376263');" onmouseout="out('-2511723907351376263');" style=""> 544             if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                        </span>
<span class="4303470812456182979" onmouseenter="enter('4303470812456182979');" onmouseout="out('4303470812456182979');" style=""> 545                 ppr.setUpdateLookupType(true);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 546             }                                                                                            </span>
<span  style=""> 547                                                                                                          </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 548             Property fp = new Property();                                                                </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 549             fp.setName(ppr.getForeignKey().getManyToField());                                            </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 550             fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));  </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 551             properties.add(fp);                                                                          </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 552         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="-4636884806383263612" onmouseenter="enter('-4636884806383263612');" onmouseout="out('-4636884806383263612');" style=""><abbr title=" 553             ppr.getEntity().setType(new String[] { ppr.getAdornedList().getAdornedTargetEntityClassname() });"> 553             ppr.getEntity().setType(new String[] { ppr.getAdornedList().getAdornedTargetEntityClassname()ðŸ”µ</abbr></span>
<span  style=""> 554                                                                                                          </span>
<span class="-8504901264761703182" onmouseenter="enter('-8504901264761703182');" onmouseout="out('-8504901264761703182');" style=""><abbr title=" 555             String[] maintainedFields = ((AdornedTargetCollectionMetadata) md).getMaintainedAdornedTargetFields();"> 555             String[] maintainedFields = ((AdornedTargetCollectionMetadata) md).getMaintainedAdornedTargetðŸ”µ</abbr></span>
<span class="7296878925630910355" onmouseenter="enter('7296878925630910355');" onmouseout="out('7296878925630910355');" style=""> 556             if (maintainedFields == null || maintainedFields.length == 0) {                              </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 557                 ppr.setValidateUnsubmittedProperties(false);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 558             }                                                                                            </span>
<span  style=""> 559                                                                                                          </span>
<span class="6130424394313681013" onmouseenter="enter('6130424394313681013');" onmouseout="out('6130424394313681013');" style=""> 560             // Fix for an adorned target collection where the link is maintained from a                  </span>
<span class="-1209465127207262219" onmouseenter="enter('-1209465127207262219');" onmouseout="out('-1209465127207262219');" style=""> 561             // ToOne property on a main entity                                                           </span>
<span class="-4782433380384096940" onmouseenter="enter('-4782433380384096940');" onmouseout="out('-4782433380384096940');" style=""><abbr title=" 562             String linkedProperty = ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot; + ppr.getAdornedList().getLinkedIdProperty();"> 562             String linkedProperty = ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot; + ppr.getAdornedListðŸ”µ</abbr></span>
<span class="-7677283136075345929" onmouseenter="enter('-7677283136075345929');" onmouseout="out('-7677283136075345929');" style=""> 563             for (Property p : properties) {                                                              </span>
<span class="-6798041327943240930" onmouseenter="enter('-6798041327943240930');" onmouseout="out('-6798041327943240930');" style=""> 564                 if (p.getName().equals(linkedProperty)) {                                                </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""><abbr title=" 565                     p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));"> 565                     p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getNameðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 568         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 569             ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                        </span>
<span  style=""> 570                                                                                                          </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 571             Property p = new Property();                                                                 </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 572             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 573             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 574             properties.add(p);                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 575         } else {                                                                                         </span>
<span class="6589458496639047773" onmouseenter="enter('6589458496639047773');" onmouseout="out('6589458496639047773');" style=""><abbr title=" 576             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; +"> 576             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="8841076042243319225" onmouseenter="enter('8841076042243319225');" onmouseout="out('8841076042243319225');" style=""> 577                     &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578         }                                                                                                </span>
<span  style=""> 579                                                                                                          </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 580         ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                     </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 581         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 582         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 583             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 585         ppr.setSectionEntityField(sectionField);                                                         </span>
<span  style=""> 586                                                                                                          </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 587         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 588         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 589             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 590         }else {                                                                                          </span>
<span class="1891301505194787668" onmouseenter="enter('1891301505194787668');" onmouseout="out('1891301505194787668');" style=""> 591             Property name = parentEntity.getPMap().get(&quot;name&quot;);                                          </span>
<span class="5844109132794648466" onmouseenter="enter('5844109132794648466');" onmouseout="out('5844109132794648466');" style=""> 592             if(name !=null) {                                                                            </span>
<span class="-827206152183551520" onmouseenter="enter('-827206152183551520');" onmouseout="out('-827206152183551520');" style=""> 593                 ppr.setRequestingEntityName(name.getValue());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 594             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 595         }                                                                                                </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 596         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 597         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 598         ppr.getEntity().setProperties(propArr);                                                          </span>
<span  style=""> 599                                                                                                          </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 600         return add(ppr);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601     }                                                                                                    </span>
<span  style=""> 602                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 603     @Override                                                                                            </span>
<span class="-7675709464639024415" onmouseenter="enter('-7675709464639024415');" onmouseout="out('-7675709464639024415');" style=""><abbr title=" 604     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property"> 604     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadatðŸ”µ</abbr></span>
<span class="-2028598087534015745" onmouseenter="enter('-2028598087534015745');" onmouseout="out('-2028598087534015745');" style=""><abbr title=" 605             field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException, ClassNotFoundException {"> 605             field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ðŸ”µ</abbr></span>
<span class="5486792043368910160" onmouseenter="enter('5486792043368910160');" onmouseout="out('5486792043368910160');" style=""><abbr title=" 606         return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId, null, sectionCrumb);"> 606         return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 607     }                                                                                                    </span>
<span  style=""> 608                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 609     @Override                                                                                            </span>
<span class="397736636649329238" onmouseenter="enter('397736636649329238');" onmouseout="out('397736636649329238');" style=""><abbr title=" 610     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field,"> 610     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadatðŸ”µ</abbr></span>
<span class="-318365979879509230" onmouseenter="enter('-318365979879509230');" onmouseout="out('-318365979879509230');" style=""><abbr title=" 611             Entity parentEntity, String collectionItemId, String alternateId, List&lt;SectionCrumb&gt; sectionCrumbs)"> 611             Entity parentEntity, String collectionItemId, String alternateId, List&lt;SectionCrumb&gt; sectionCðŸ”µ</abbr></span>
<span class="-9069306879086868954" onmouseenter="enter('-9069306879086868954');" onmouseout="out('-9069306879086868954');" style=""> 612             throws ServiceException, ClassNotFoundException {                                            </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 613         List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                             </span>
<span  style=""> 614                                                                                                          </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 615         FieldMetadata md = field.getMetadata();                                                          </span>
<span  style=""> 616                                                                                                          </span>
<span class="-3154651088293222897" onmouseenter="enter('-3154651088293222897');" onmouseout="out('-3154651088293222897');" style=""> 617         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs)        </span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 618                 .withEntity(new Entity());                                                               </span>
<span  style=""> 619                                                                                                          </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 620         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="6607267312947776736" onmouseenter="enter('6607267312947776736');" onmouseout="out('6607267312947776736');" style=""> 621             BasicCollectionMetadata fmd = (BasicCollectionMetadata) md;                                  </span>
<span class="226826482246311757" onmouseenter="enter('226826482246311757');" onmouseout="out('226826482246311757');" style=""> 622             ppr.setCeilingEntityClassname(fmd.getCollectionCeilingEntity());                             </span>
<span class="-5249561197408255652" onmouseenter="enter('-5249561197408255652');" onmouseout="out('-5249561197408255652');" style=""> 623             ppr.getEntity().setType(new String[] { fmd.getCollectionCeilingEntity() });                  </span>
<span  style=""> 624                                                                                                          </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 625             Property fp = new Property();                                                                </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 626             fp.setName(ppr.getForeignKey().getManyToField());                                            </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 627             fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));  </span>
<span class="8450408142962005401" onmouseenter="enter('8450408142962005401');" onmouseout="out('8450408142962005401');" style=""> 628             if (!properties.contains(fp)) {                                                              </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 629                 properties.add(fp);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630             }                                                                                            </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 631         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="-736797126069743382" onmouseenter="enter('-736797126069743382');" onmouseout="out('-736797126069743382');" style=""> 632             String adornedTargetEntityClassname = ppr.getAdornedList().getAdornedTargetEntityClassname();</span>
<span class="-3984105731247699024" onmouseenter="enter('-3984105731247699024');" onmouseout="out('-3984105731247699024');" style=""> 633             ppr.setCeilingEntityClassname(adornedTargetEntityClassname);                                 </span>
<span class="-4067322056629005576" onmouseenter="enter('-4067322056629005576');" onmouseout="out('-4067322056629005576');" style=""> 634             ppr.getEntity().setType(new String[] {adornedTargetEntityClassname});                        </span>
<span  style=""> 635                                                                                                          </span>
<span class="2404180692851035070" onmouseenter="enter('2404180692851035070');" onmouseout="out('2404180692851035070');" style=""> 636             for (Property property : properties) {                                                       </span>
<span class="-3911962540946632188" onmouseenter="enter('-3911962540946632188');" onmouseout="out('-3911962540946632188');" style=""> 637                 if (property.getName().equals(ppr.getAdornedList().getLinkedObjectPath() +               </span>
<span class="2022280188845233855" onmouseenter="enter('2022280188845233855');" onmouseout="out('2022280188845233855');" style=""> 638                                     &quot;.&quot; + ppr.getAdornedList().getLinkedIdProperty())) {                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 639                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 641             }                                                                                            </span>
<span  style=""> 642                                                                                                          </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 643             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 644                 Property p = new Property();                                                             </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 645                 p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                 </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 646                 p.setValue(alternateId);                                                                 </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 647                 if (!properties.contains(p)) {                                                           </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 648                     properties.add(p);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 650             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 651         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 652             ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                        </span>
<span  style=""> 653                                                                                                          </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 654             Property p = new Property();                                                                 </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 655             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 656             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 657             properties.add(p);                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 658         } else {                                                                                         </span>
<span class="6589458496639047773" onmouseenter="enter('6589458496639047773');" onmouseout="out('6589458496639047773');" style=""><abbr title=" 659             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; +"> 659             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="8841076042243319225" onmouseenter="enter('8841076042243319225');" onmouseout="out('8841076042243319225');" style=""> 660                     &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661         }                                                                                                </span>
<span  style=""> 662                                                                                                          </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 663         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 664         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 665             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 666         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 667         ppr.setSectionEntityField(sectionField);                                                         </span>
<span  style=""> 668                                                                                                          </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 669         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 670         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 671             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672         }                                                                                                </span>
<span  style=""> 673                                                                                                          </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 674         Property p = new Property();                                                                     </span>
<span class="76365074730046782" onmouseenter="enter('76365074730046782');" onmouseout="out('76365074730046782');" style=""> 675         p.setName(entityForm.getIdProperty());                                                           </span>
<span class="-4252521779434663948" onmouseenter="enter('-4252521779434663948');" onmouseout="out('-4252521779434663948');" style=""> 676         p.setValue(collectionItemId);                                                                    </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 677         if (!properties.contains(p)) {                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 678             properties.add(p);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 679         }                                                                                                </span>
<span  style=""> 680                                                                                                          </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 681         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 682         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 683         ppr.getEntity().setProperties(propArr);                                                          </span>
<span  style=""> 684                                                                                                          </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 685         return update(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 686     }                                                                                                    </span>
<span  style=""> 687                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 688     @Override                                                                                            </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 689     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 689     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, EntiðŸ”µ</abbr></span>
<span class="7718985087288552750" onmouseenter="enter('7718985087288552750');" onmouseout="out('7718985087288552750');" style=""><abbr title=" 690                 String itemId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {"> 690                 String itemId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceExceptionðŸ”µ</abbr></span>
<span class="1153666597088080540" onmouseenter="enter('1153666597088080540');" onmouseout="out('1153666597088080540');" style=""><abbr title=" 691         return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectionCrumbs);"> 691         return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectiðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692     }                                                                                                    </span>
<span  style=""> 693                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 694     @Override                                                                                            </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 695     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 695     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, EntiðŸ”µ</abbr></span>
<span class="-7641167286743654353" onmouseenter="enter('-7641167286743654353');" onmouseout="out('-7641167286743654353');" style=""><abbr title=" 696             String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {"> 696             String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ðŸ”µ</abbr></span>
<span class="6439752407856920746" onmouseenter="enter('6439752407856920746');" onmouseout="out('6439752407856920746');" style=""> 697         List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;();                                           </span>
<span  style=""> 698                                                                                                          </span>
<span class="-7639830684562317861" onmouseenter="enter('-7639830684562317861');" onmouseout="out('-7639830684562317861');" style=""> 699         Property p;                                                                                      </span>
<span class="5073856407409165319" onmouseenter="enter('5073856407409165319');" onmouseout="out('5073856407409165319');" style=""> 700         String parentId = getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()); </span>
<span  style=""> 701                                                                                                          </span>
<span class="255305470667416020" onmouseenter="enter('255305470667416020');" onmouseout="out('255305470667416020');" style=""><abbr title=" 702         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(field.getMetadata(), sectionCrumbs)"> 702         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(field.getMetadata(), sectiðŸ”µ</abbr></span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 703                 .withEntity(new Entity());                                                               </span>
<span  style=""> 704                                                                                                          </span>
<span class="6642416971497632068" onmouseenter="enter('6642416971497632068');" onmouseout="out('6642416971497632068');" style=""> 705         if (field.getMetadata() instanceof BasicCollectionMetadata) {                                    </span>
<span class="5195082360751194411" onmouseenter="enter('5195082360751194411');" onmouseout="out('5195082360751194411');" style=""> 706             BasicCollectionMetadata fmd = (BasicCollectionMetadata) field.getMetadata();                 </span>
<span  style=""> 707                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 708             p = new Property();                                                                          </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 709             p.setName(&quot;id&quot;);                                                                             </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 710             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 711             properties.add(p);                                                                           </span>
<span  style=""> 712                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 713             p = new Property();                                                                          </span>
<span class="736571882968420419" onmouseenter="enter('736571882968420419');" onmouseout="out('736571882968420419');" style=""> 714             p.setName(ppr.getForeignKey().getManyToField());                                             </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 715             p.setValue(parentId);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 716             properties.add(p);                                                                           </span>
<span  style=""> 717                                                                                                          </span>
<span class="6632512256771168785" onmouseenter="enter('6632512256771168785');" onmouseout="out('6632512256771168785');" style=""> 718             ppr.getEntity().setType(new String[]{fmd.getCollectionCeilingEntity()});                     </span>
<span class="2294469176396117772" onmouseenter="enter('2294469176396117772');" onmouseout="out('2294469176396117772');" style=""> 719         } else if (field.getMetadata() instanceof AdornedTargetCollectionMetadata) {                     </span>
<span class="-1689031862376375101" onmouseenter="enter('-1689031862376375101');" onmouseout="out('-1689031862376375101');" style=""> 720             AdornedTargetList adornedList = ppr.getAdornedList();                                        </span>
<span  style=""> 721                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 722             p = new Property();                                                                          </span>
<span class="-8312107819432651962" onmouseenter="enter('-8312107819432651962');" onmouseout="out('-8312107819432651962');" style=""> 723             p.setName(adornedList.getLinkedObjectPath() + &quot;.&quot; + adornedList.getLinkedIdProperty());      </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 724             p.setValue(parentId);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 725             properties.add(p);                                                                           </span>
<span  style=""> 726                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 727             p = new Property();                                                                          </span>
<span class="371368176127783534" onmouseenter="enter('371368176127783534');" onmouseout="out('371368176127783534');" style=""> 728             p.setName(adornedList.getTargetObjectPath() + &quot;.&quot; + adornedList.getTargetIdProperty());      </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 729             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 730             properties.add(p);                                                                           </span>
<span  style=""> 731                                                                                                          </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 732             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 733                 p = new Property();                                                                      </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 734                 p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                 </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 735                 p.setValue(alternateId);                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 736                 properties.add(p);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 737             }                                                                                            </span>
<span  style=""> 738                                                                                                          </span>
<span class="-2729449254338899005" onmouseenter="enter('-2729449254338899005');" onmouseout="out('-2729449254338899005');" style=""> 739             ppr.getEntity().setType(new String[]{adornedList.getAdornedTargetEntityClassname()});        </span>
<span class="7912118845776081771" onmouseenter="enter('7912118845776081771');" onmouseout="out('7912118845776081771');" style=""> 740         } else if (field.getMetadata() instanceof MapMetadata) {                                         </span>
<span class="2366674339618495793" onmouseenter="enter('2366674339618495793');" onmouseout="out('2366674339618495793');" style=""> 741             MapMetadata fmd = (MapMetadata) field.getMetadata();                                         </span>
<span  style=""> 742                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 743             p = new Property();                                                                          </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 744             p.setName(&quot;id&quot;);                                                                             </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 745             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 746             properties.add(p);                                                                           </span>
<span  style=""> 747                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 748             p = new Property();                                                                          </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 749             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 750             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 751             properties.add(p);                                                                           </span>
<span  style=""> 752                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 753             p = new Property();                                                                          </span>
<span class="-5579409047855153374" onmouseenter="enter('-5579409047855153374');" onmouseout="out('-5579409047855153374');" style=""> 754             p.setName(&quot;priorKey&quot;);                                                                       </span>
<span class="-4418910479857896781" onmouseenter="enter('-4418910479857896781');" onmouseout="out('-4418910479857896781');" style=""> 755             p.setValue(priorKey);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 756             properties.add(p);                                                                           </span>
<span  style=""> 757                                                                                                          </span>
<span class="6290651600977544526" onmouseenter="enter('6290651600977544526');" onmouseout="out('6290651600977544526');" style=""> 758             MapStructure mapStructure = ppr.getMapStructure();                                           </span>
<span  style=""> 759                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 760             p = new Property();                                                                          </span>
<span class="-8796819570859336354" onmouseenter="enter('-8796819570859336354');" onmouseout="out('-8796819570859336354');" style=""> 761             p.setName(mapStructure.getKeyPropertyName());                                                </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 762             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 763             properties.add(p);                                                                           </span>
<span  style=""> 764                                                                                                          </span>
<span class="-3538327046279125798" onmouseenter="enter('-3538327046279125798');" onmouseout="out('-3538327046279125798');" style=""> 765             ppr.getEntity().setType(new String[] { fmd.getTargetClass() });                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 766         }                                                                                                </span>
<span  style=""> 767                                                                                                          </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 768         ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                     </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 769         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 770         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 771             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 772         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 773         ppr.setSectionEntityField(sectionField);                                                         </span>
<span  style=""> 774                                                                                                          </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 775         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 776         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 777             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 778         }                                                                                                </span>
<span  style=""> 779                                                                                                          </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 780         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 781         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 782         ppr.getEntity().setProperties(propArr);                                                          </span>
<span  style=""> 783                                                                                                          </span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 784         return remove(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785     }                                                                                                    </span>
<span  style=""> 786                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 787     @Override                                                                                            </span>
<span class="4282644893410961184" onmouseenter="enter('4282644893410961184');" onmouseout="out('4282644893410961184');" style=""><abbr title=" 788     public String getContextSpecificRelationshipId(ClassMetadata cmd, Entity entity, String propertyName) {"> 788     public String getContextSpecificRelationshipId(ClassMetadata cmd, Entity entity, String propertyName)ðŸ”µ</abbr></span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style=""> 789         String prefix;                                                                                   </span>
<span class="-4471312176558876108" onmouseenter="enter('-4471312176558876108');" onmouseout="out('-4471312176558876108');" style=""> 790         if (propertyName.contains(&quot;.&quot;)) {                                                                </span>
<span class="1236521803185463300" onmouseenter="enter('1236521803185463300');" onmouseout="out('1236521803185463300');" style=""> 791             prefix = propertyName.substring(0, propertyName.lastIndexOf(&quot;.&quot;));                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 792         } else {                                                                                         </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style=""> 793             prefix = &quot;&quot;;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 794         }                                                                                                </span>
<span  style=""> 795                                                                                                          </span>
<span class="2108963067613019567" onmouseenter="enter('2108963067613019567');" onmouseout="out('2108963067613019567');" style=""> 796         if (prefix.equals(&quot;&quot;)) {                                                                         </span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 797             return entity.findProperty(&quot;id&quot;).getValue();                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 798         } else {                                                                                         </span>
<span class="2912662671806002044" onmouseenter="enter('2912662671806002044');" onmouseout="out('2912662671806002044');" style=""><abbr title=" 799             //we need to check all the parts of the prefix. For example, the prefix could include an @Embedded class like"> 799             //we need to check all the parts of the prefix. For example, the prefix could include an @EmbðŸ”µ</abbr></span>
<span class="-6847147968781015235" onmouseenter="enter('-6847147968781015235');" onmouseout="out('-6847147968781015235');" style=""><abbr title=" 800             //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the @Embedded does"> 800             //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the ðŸ”µ</abbr></span>
<span class="-9096360951865760456" onmouseenter="enter('-9096360951865760456');" onmouseout="out('-9096360951865760456');" style=""> 801             //not have an id property - nor should it.                                                   </span>
<span class="8843283418167771984" onmouseenter="enter('8843283418167771984');" onmouseout="out('8843283418167771984');" style=""> 802             String[] prefixParts = prefix.split(&quot;\\.&quot;);                                                  </span>
<span class="-7822949011963974832" onmouseenter="enter('-7822949011963974832');" onmouseout="out('-7822949011963974832');" style=""> 803             for (int j = 0; j &lt; prefixParts.length; j++) {                                               </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 804                 StringBuilder sb = new StringBuilder();                                                  </span>
<span class="2290448841761568128" onmouseenter="enter('2290448841761568128');" onmouseout="out('2290448841761568128');" style=""> 805                 for (int x = 0; x &lt; prefixParts.length - j; x++) {                                       </span>
<span class="1036821456394348565" onmouseenter="enter('1036821456394348565');" onmouseout="out('1036821456394348565');" style=""> 806                     sb.append(prefixParts[x]);                                                           </span>
<span class="837864378579548727" onmouseenter="enter('837864378579548727');" onmouseout="out('837864378579548727');" style=""> 807                     if (x &lt; prefixParts.length - j - 1) {                                                </span>
<span class="2682813583155160314" onmouseenter="enter('2682813583155160314');" onmouseout="out('2682813583155160314');" style=""> 808                         sb.append(&quot;.&quot;);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810                 }                                                                                        </span>
<span class="-7912523814943214188" onmouseenter="enter('-7912523814943214188');" onmouseout="out('-7912523814943214188');" style=""> 811                 String tempPrefix = sb.toString();                                                       </span>
<span  style=""> 812                                                                                                          </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 813                 for (Property property : entity.getProperties()) {                                       </span>
<span class="-7524924011426943089" onmouseenter="enter('-7524924011426943089');" onmouseout="out('-7524924011426943089');" style=""> 814                     if (property.getName().startsWith(tempPrefix)) {                                     </span>
<span class="-577685276283853994" onmouseenter="enter('-577685276283853994');" onmouseout="out('-577685276283853994');" style=""><abbr title=" 815                         //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the current prefix level"> 815                         //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the cðŸ”µ</abbr></span>
<span class="6988170330009622433" onmouseenter="enter('6988170330009622433');" onmouseout="out('6988170330009622433');" style=""><abbr title=" 816                         //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAttributes.id"> 816                         //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAðŸ”µ</abbr></span>
<span class="-1849094327471901943" onmouseenter="enter('-1849094327471901943');" onmouseout="out('-1849094327471901943');" style=""><abbr title=" 817                         if (StringUtils.countMatches(property.getName().replace(tempPrefix, &quot;&quot;), &quot;.&quot;) == 1) {"> 817                         if (StringUtils.countMatches(property.getName().replace(tempPrefix, &quot;&quot;), &quot;.&quot;) == ðŸ”µ</abbr></span>
<span class="-8594951258528203905" onmouseenter="enter('-8594951258528203905');" onmouseout="out('-8594951258528203905');" style=""> 818                             if (cmd.getPMap().containsKey(property.getName())) {                         </span>
<span class="-7732609283402352986" onmouseenter="enter('-7732609283402352986');" onmouseout="out('-7732609283402352986');" style=""><abbr title=" 819                                 BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.getName()).getMetadata();"> 819                                 BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.gðŸ”µ</abbr></span>
<span class="-2874474282821972662" onmouseenter="enter('-2874474282821972662');" onmouseout="out('-2874474282821972662');" style=""> 820                                 if (md.getFieldType().equals(SupportedFieldType.ID)) {                   </span>
<span class="-1836186832588240544" onmouseenter="enter('-1836186832588240544');" onmouseout="out('-1836186832588240544');" style=""> 821                                     return property.getValue();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 826                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828         }                                                                                                </span>
<span class="6467699841617564408" onmouseenter="enter('6467699841617564408');" onmouseout="out('6467699841617564408');" style=""> 829         if (!prefix.contains(&quot;.&quot;)) {                                                                     </span>
<span class="-6458727047245688221" onmouseenter="enter('-6458727047245688221');" onmouseout="out('-6458727047245688221');" style=""><abbr title=" 830             //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restrictedPriceLists on OfferImpl)"> 830             //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restricðŸ”µ</abbr></span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 831             return entity.findProperty(&quot;id&quot;).getValue();                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 832         }                                                                                                </span>
<span class="-8024958864039426916" onmouseenter="enter('-8024958864039426916');" onmouseout="out('-8024958864039426916');" style=""> 833         throw new RuntimeException(&quot;Unable to establish a relationship id&quot;);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 834     }                                                                                                    </span>
<span  style=""> 835                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 836     @Override                                                                                            </span>
<span class="-3908255710031606050" onmouseenter="enter('-3908255710031606050');" onmouseout="out('-3908255710031606050');" style=""> 837     public String getIdProperty(ClassMetadata cmd) throws ServiceException {                             </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 838         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-1029066852878262358" onmouseenter="enter('-1029066852878262358');" onmouseout="out('-1029066852878262358');" style=""> 839             if (p.getMetadata() instanceof BasicFieldMetadata) {                                         </span>
<span class="-5664285287189453326" onmouseenter="enter('-5664285287189453326');" onmouseout="out('-5664285287189453326');" style=""> 840                 BasicFieldMetadata fmd = (BasicFieldMetadata) p.getMetadata();                           </span>
<span class="513655466689307970" onmouseenter="enter('513655466689307970');" onmouseout="out('513655466689307970');" style=""><abbr title=" 841                 //check for ID type and also make sure the field we&#x27;re looking at is not a &quot;ToOne&quot; association"> 841                 //check for ID type and also make sure the field we&#x27;re looking at is not a &quot;ToOne&quot; associðŸ”µ</abbr></span>
<span class="-491768544454322511" onmouseenter="enter('-491768544454322511');" onmouseout="out('-491768544454322511');" style=""> 842                 if (SupportedFieldType.ID.equals(fmd.getFieldType()) &amp;&amp; !p.getName().contains(&quot;.&quot;)) {    </span>
<span class="-6048877223362319653" onmouseenter="enter('-6048877223362319653');" onmouseout="out('-6048877223362319653');" style=""> 843                     return p.getName();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846         }                                                                                                </span>
<span  style=""> 847                                                                                                          </span>
<span class="-7942857982942474001" onmouseenter="enter('-7942857982942474001');" onmouseout="out('-7942857982942474001');" style=""> 848         throw new ServiceException(&quot;Could not determine ID field for &quot; + cmd.getCeilingType());          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 849     }                                                                                                    </span>
<span  style=""> 850                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 851     @Override                                                                                            </span>
<span class="-6109521015369402099" onmouseenter="enter('-6109521015369402099');" onmouseout="out('-6109521015369402099');" style=""> 852     public PersistenceResponse add(PersistencePackageRequest request) throws ServiceException {          </span>
<span class="-2588522872292014988" onmouseenter="enter('-2588522872292014988');" onmouseout="out('-2588522872292014988');" style=""> 853         return add(request, true);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 854     }                                                                                                    </span>
<span  style=""> 855                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 856     @Override                                                                                            </span>
<span class="8827553339909366249" onmouseenter="enter('8827553339909366249');" onmouseout="out('8827553339909366249');" style=""><abbr title=" 857     public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 857     public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 858         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 859         try {                                                                                            </span>
<span class="4836544755641051591" onmouseenter="enter('4836544755641051591');" onmouseout="out('4836544755641051591');" style=""> 860             if (request.isUpdateLookupType()) {                                                          </span>
<span class="-2082930136830103093" onmouseenter="enter('-2082930136830103093');" onmouseout="out('-2082930136830103093');" style=""> 861                 if (pkg.getSectionCrumbs() != null &amp;&amp; pkg.getSectionCrumbs().length &gt; 0) {               </span>
<span class="-6120347482693188577" onmouseenter="enter('-6120347482693188577');" onmouseout="out('-6120347482693188577');" style=""> 862                     SectionCrumb sc = pkg.getSectionCrumbs()[0];                                         </span>
<span class="7706557227331502134" onmouseenter="enter('7706557227331502134');" onmouseout="out('7706557227331502134');" style=""> 863                     if (StringUtils.isNotBlank(sc.getSectionIdentifier())) {                             </span>
<span class="7371017383769084435" onmouseenter="enter('7371017383769084435');" onmouseout="out('7371017383769084435');" style=""> 864                         pkg.setSecurityCeilingEntityFullyQualifiedClassname(sc.getSectionIdentifier());  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 865                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866                 }                                                                                        </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 867                 if (transactional) {                                                                     </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 868                     return service.update(pkg);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 869                 } else {                                                                                 </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 870                     return service.nonTransactionalUpdate(pkg);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 871                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 872             } else {                                                                                     </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 873                 if (transactional) {                                                                     </span>
<span class="4552670565637379723" onmouseenter="enter('4552670565637379723');" onmouseout="out('4552670565637379723');" style=""> 874                     return service.add(pkg);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 875                 } else {                                                                                 </span>
<span class="6732121152740224457" onmouseenter="enter('6732121152740224457');" onmouseout="out('6732121152740224457');" style=""> 876                     return service.nonTransactionalAdd(pkg);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 879         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 880             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 881             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 882         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883     }                                                                                                    </span>
<span  style=""> 884                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 885     @Override                                                                                            </span>
<span class="-2168493081511676385" onmouseenter="enter('-2168493081511676385');" onmouseout="out('-2168493081511676385');" style=""> 886     public PersistenceResponse update(PersistencePackageRequest request) throws ServiceException {       </span>
<span class="-1915092381367502552" onmouseenter="enter('-1915092381367502552');" onmouseout="out('-1915092381367502552');" style=""> 887         return update(request, true);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 888     }                                                                                                    </span>
<span  style=""> 889                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 890     @Override                                                                                            </span>
<span class="-3035175746782535545" onmouseenter="enter('-3035175746782535545');" onmouseout="out('-3035175746782535545');" style=""><abbr title=" 891     public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 891     public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws SeðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 892         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 893         try {                                                                                            </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 894             if (transactional) {                                                                         </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 895                 return service.update(pkg);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 896             } else {                                                                                     </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 897                 return service.nonTransactionalUpdate(pkg);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 898             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 899         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 900             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 901             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 902         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 903     }                                                                                                    </span>
<span  style=""> 904                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 905     @Override                                                                                            </span>
<span class="-1312385666630581282" onmouseenter="enter('-1312385666630581282');" onmouseout="out('-1312385666630581282');" style=""> 906     public PersistenceResponse inspect(PersistencePackageRequest request)                                </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 907             throws ServiceException {                                                                    </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 908         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="2565705442671799096" onmouseenter="enter('2565705442671799096');" onmouseout="out('2565705442671799096');" style=""> 909         return service.inspect(pkg);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 910     }                                                                                                    </span>
<span  style=""> 911                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 912     @Override                                                                                            </span>
<span class="-2409492513544163046" onmouseenter="enter('-2409492513544163046');" onmouseout="out('-2409492513544163046');" style=""> 913     public PersistenceResponse remove(PersistencePackageRequest request)                                 </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 914             throws ServiceException {                                                                    </span>
<span class="1818424953510541932" onmouseenter="enter('1818424953510541932');" onmouseout="out('1818424953510541932');" style=""> 915         return remove(request, true);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 916     }                                                                                                    </span>
<span  style=""> 917                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 918     @Override                                                                                            </span>
<span class="-9050585893076336114" onmouseenter="enter('-9050585893076336114');" onmouseout="out('-9050585893076336114');" style=""><abbr title=" 919     public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 919     public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws SeðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 920         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 921         try {                                                                                            </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 922             if (transactional) {                                                                         </span>
<span class="-5643605501598977706" onmouseenter="enter('-5643605501598977706');" onmouseout="out('-5643605501598977706');" style=""> 923                 return service.remove(pkg);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 924             } else {                                                                                     </span>
<span class="-8250836311704581891" onmouseenter="enter('-8250836311704581891');" onmouseout="out('-8250836311704581891');" style=""> 925                 return service.nonTransactionalRemove(pkg);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 926             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 927         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 928             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 929             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 930         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931     }                                                                                                    </span>
<span  style=""> 932                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 933     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 934      * &lt;p&gt;                                                                                               </span>
<span class="3729604611716511130" onmouseenter="enter('3729604611716511130');" onmouseout="out('3729604611716511130');" style=""><abbr title=" 935      * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} contained within the"> 935      * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} cðŸ”µ</abbr></span>
<span class="-7341678569298188314" onmouseenter="enter('-7341678569298188314');" onmouseout="out('-7341678569298188314');" style=""> 936      * given &lt;b&gt;originalRequest&lt;/b&gt; has a validationFailure = true                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 937      *                                                                                                   </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 938      * &lt;p&gt;                                                                                               </span>
<span class="-7716663654145973669" onmouseenter="enter('-7716663654145973669');" onmouseout="out('-7716663654145973669');" style=""><abbr title=" 939      * This will also check for a cause of {@link ConstraintViolationException} and add a gloal error to that."> 939      * This will also check for a cause of {@link ConstraintViolationException} and add a gloal error to ðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 940      */                                                                                                  </span>
<span class="807801721535748536" onmouseenter="enter('807801721535748536');" onmouseout="out('807801721535748536');" style=""><abbr title=" 941     protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequest originalRequest) {"> 941     protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequestðŸ”µ</abbr></span>
<span class="5399941146961217832" onmouseenter="enter('5399941146961217832');" onmouseout="out('5399941146961217832');" style=""> 942         if (e.containsCause(ConstraintViolationException.class)) {                                       </span>
<span class="-5214743212244855970" onmouseenter="enter('-5214743212244855970');" onmouseout="out('-5214743212244855970');" style=""> 943             e.getEntity().addGlobalValidationError(&quot;constraintViolationError&quot;);                          </span>
<span class="4509625189679774854" onmouseenter="enter('4509625189679774854');" onmouseout="out('4509625189679774854');" style=""> 944         } else if (!e.getEntity().isValidationFailure()) {                                               </span>
<span class="-4984910861440118934" onmouseenter="enter('-4984910861440118934');" onmouseout="out('-4984910861440118934');" style=""> 945             e.getEntity().setValidationFailure(true);                                                    </span>
<span class="-6792721057862982153" onmouseenter="enter('-6792721057862982153');" onmouseout="out('-6792721057862982153');" style=""> 946             e.getEntity().addGlobalValidationError(e.getMessage());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 947         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 948     }                                                                                                    </span>
<span  style=""> 949                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 950     @Override                                                                                            </span>
<span class="5311420287927073238" onmouseenter="enter('5311420287927073238');" onmouseout="out('5311420287927073238');" style=""> 951     public PersistenceResponse fetch(PersistencePackageRequest request)                                  </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 952             throws ServiceException {                                                                    </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 953         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span  style=""> 954                                                                                                          </span>
<span class="-5375974030412648260" onmouseenter="enter('-5375974030412648260');" onmouseout="out('-5375974030412648260');" style=""> 955         CriteriaTransferObject cto = getDefaultCto();                                                    </span>
<span class="-1800505558210996683" onmouseenter="enter('-1800505558210996683');" onmouseout="out('-1800505558210996683');" style=""> 956         if (request.getFilterAndSortCriteria() != null) {                                                </span>
<span class="629113105269586037" onmouseenter="enter('629113105269586037');" onmouseout="out('629113105269586037');" style=""> 957             cto.addAll(Arrays.asList(request.getFilterAndSortCriteria()));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 958         }                                                                                                </span>
<span  style=""> 959                                                                                                          </span>
<span class="-3823245946626813984" onmouseenter="enter('-3823245946626813984');" onmouseout="out('-3823245946626813984');" style=""> 960         if (request.getMaxResults() != null) {                                                           </span>
<span class="-8351200142276180335" onmouseenter="enter('-8351200142276180335');" onmouseout="out('-8351200142276180335');" style=""> 961             cto.setMaxResults(request.getMaxResults());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 962         }                                                                                                </span>
<span  style=""> 963                                                                                                          </span>
<span class="-690040157024225203" onmouseenter="enter('-690040157024225203');" onmouseout="out('-690040157024225203');" style=""> 964         if (request.getStartIndex() == null) {                                                           </span>
<span class="2764779885143665984" onmouseenter="enter('2764779885143665984');" onmouseout="out('2764779885143665984');" style=""> 965             cto.setFirstResult(0);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 966         } else {                                                                                         </span>
<span class="-6350611603682358812" onmouseenter="enter('-6350611603682358812');" onmouseout="out('-6350611603682358812');" style=""> 967             cto.setFirstResult(request.getStartIndex());                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 968         }                                                                                                </span>
<span  style=""> 969                                                                                                          </span>
<span class="-1342097346218425419" onmouseenter="enter('-1342097346218425419');" onmouseout="out('-1342097346218425419');" style=""> 970         if (request.getMaxIndex() != null) {                                                             </span>
<span class="-8120529832746798414" onmouseenter="enter('-8120529832746798414');" onmouseout="out('-8120529832746798414');" style=""> 971             Integer startIndex = request.getStartIndex() != null ? request.getStartIndex() : 0;          </span>
<span class="-6682475132360394674" onmouseenter="enter('-6682475132360394674');" onmouseout="out('-6682475132360394674');" style=""> 972             int requestedMaxResults = request.getMaxIndex() - startIndex + 1;                            </span>
<span class="-4912375422916056974" onmouseenter="enter('-4912375422916056974');" onmouseout="out('-4912375422916056974');" style=""> 973             if (requestedMaxResults &gt;= 0 &amp;&amp; requestedMaxResults &lt; cto.getMaxResults()) {                 </span>
<span class="-1275291600011289156" onmouseenter="enter('-1275291600011289156');" onmouseout="out('-1275291600011289156');" style=""> 974                 cto.setMaxResults(requestedMaxResults);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 975             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 976         }                                                                                                </span>
<span  style=""> 977                                                                                                          </span>
<span class="1589811072437566840" onmouseenter="enter('1589811072437566840');" onmouseout="out('1589811072437566840');" style=""> 978         cto.setLastId(request.getLastId());                                                              </span>
<span class="4489054305431733195" onmouseenter="enter('4489054305431733195');" onmouseout="out('4489054305431733195');" style=""> 979         cto.setFirstId(request.getFirstId());                                                            </span>
<span class="7683513281487176699" onmouseenter="enter('7683513281487176699');" onmouseout="out('7683513281487176699');" style=""> 980         cto.setUpperCount(request.getUpperCount());                                                      </span>
<span class="-8031307621948936245" onmouseenter="enter('-8031307621948936245');" onmouseout="out('-8031307621948936245');" style=""> 981         cto.setLowerCount(request.getLowerCount());                                                      </span>
<span class="63997933306934756" onmouseenter="enter('63997933306934756');" onmouseout="out('63997933306934756');" style=""> 982         if (request.getPageSize() != null) {                                                             </span>
<span class="-7018914636118190968" onmouseenter="enter('-7018914636118190968');" onmouseout="out('-7018914636118190968');" style=""> 983             cto.setMaxResults(request.getPageSize());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 984         }                                                                                                </span>
<span class="5284762326708873211" onmouseenter="enter('5284762326708873211');" onmouseout="out('5284762326708873211');" style=""> 985         cto.setPresentationFetch(request.getPresentationFetch());                                        </span>
<span  style=""> 986                                                                                                          </span>
<span class="8885053060558966919" onmouseenter="enter('8885053060558966919');" onmouseout="out('8885053060558966919');" style=""> 987         if (request.isFolderedLookup()) {                                                                </span>
<span class="3703526123616875051" onmouseenter="enter('3703526123616875051');" onmouseout="out('3703526123616875051');" style=""> 988             cto.setFolderLookup(true);                                                                   </span>
<span class="1820221740933941643" onmouseenter="enter('1820221740933941643');" onmouseout="out('1820221740933941643');" style=""> 989             cto.setFolderId(request.getFolderId());                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 990         }                                                                                                </span>
<span  style=""> 991                                                                                                          </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 992         if (extensionManager != null) {                                                                  </span>
<span class="371414988916191718" onmouseenter="enter('371414988916191718');" onmouseout="out('371414988916191718');" style=""> 993             extensionManager.getProxy().modifyFetchCriteriaTransferObject(request, cto);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 994         }                                                                                                </span>
<span  style=""> 995                                                                                                          </span>
<span class="-734873492845948502" onmouseenter="enter('-734873492845948502');" onmouseout="out('-734873492845948502');" style=""> 996         return service.fetch(pkg, cto);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 997     }                                                                                                    </span>
<span  style=""> 998                                                                                                          </span>
<span class="1747080010822063537" onmouseenter="enter('1747080010822063537');" onmouseout="out('1747080010822063537');" style=""> 999     protected CriteriaTransferObject getDefaultCto() {                                                   </span>
<span class="-7937218466133346867" onmouseenter="enter('-7937218466133346867');" onmouseout="out('-7937218466133346867');" style="">1000         CriteriaTransferObject cto = new CriteriaTransferObject();                                       </span>
<span class="-792606519014114045" onmouseenter="enter('-792606519014114045');" onmouseout="out('-792606519014114045');" style="">1001         cto.setMaxResults(getDefaultMaxResults());                                                       </span>
<span class="6058297727948666853" onmouseenter="enter('6058297727948666853');" onmouseout="out('6058297727948666853');" style="">1002         return cto;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1003     }                                                                                                    </span>
<span  style="">1004                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1005     @Override                                                                                            </span>
<span class="8883083618394394837" onmouseenter="enter('8883083618394394837');" onmouseout="out('8883083618394394837');" style="">1006     public String getForeignEntityName(String owningClass, String id) {                                  </span>
<span class="-872554261283939929" onmouseenter="enter('-872554261283939929');" onmouseout="out('-872554261283939929');" style="">1007         if (owningClass == null || id == null) {                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1008             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1009         }                                                                                                </span>
<span  style="">1010                                                                                                          </span>
<span class="3468023357463508719" onmouseenter="enter('3468023357463508719');" onmouseout="out('3468023357463508719');" style="">1011         DynamicEntityDao dynamicEntityDao = getDynamicEntityDao(owningClass);                            </span>
<span class="7635620295149838730" onmouseenter="enter('7635620295149838730');" onmouseout="out('7635620295149838730');" style="">1012         Class&lt;?&gt; clazz = dynamicEntityDao.getImplClass(owningClass);                                     </span>
<span class="6841796057846720752" onmouseenter="enter('6841796057846720752');" onmouseout="out('6841796057846720752');" style="">1013         Object foreignEntity = dynamicEntityDao.find(clazz, toIdFieldType(id, clazz));                   </span>
<span  style="">1014                                                                                                          </span>
<span class="6094352409442952488" onmouseenter="enter('6094352409442952488');" onmouseout="out('6094352409442952488');" style="">1015         if (foreignEntity instanceof AdminMainEntity) {                                                  </span>
<span class="-5844179197625315876" onmouseenter="enter('-5844179197625315876');" onmouseout="out('-5844179197625315876');" style="">1016             return ((AdminMainEntity) foreignEntity).getMainEntityName();                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1017         }                                                                                                </span>
<span  style="">1018                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1019         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1020     }                                                                                                    </span>
<span  style="">1021                                                                                                          </span>
<span class="-1537571071296717959" onmouseenter="enter('-1537571071296717959');" onmouseout="out('-1537571071296717959');" style="">1022     protected DynamicEntityDao getDynamicEntityDao(String owningClass) {                                 </span>
<span class="8951596410601292775" onmouseenter="enter('8951596410601292775');" onmouseout="out('8951596410601292775');" style="">1023         return PersistenceManagerFactory.getPersistenceManager(owningClass).getDynamicEntityDao();       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1024     }                                                                                                    </span>
<span  style="">1025                                                                                                          </span>
<span class="7239398670151774953" onmouseenter="enter('7239398670151774953');" onmouseout="out('7239398670151774953');" style="">1026     protected int getDefaultMaxResults() {                                                               </span>
<span class="-1067455107038749142" onmouseenter="enter('-1067455107038749142');" onmouseout="out('-1067455107038749142');" style="">1027         return BLCSystemProperty.resolveIntSystemProperty(&quot;admin.default.max.results&quot;, 50);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1028     }                                                                                                    </span>
<span  style="">1029                                                                                                          </span>
<span class="8333077553386092776" onmouseenter="enter('8333077553386092776');" onmouseout="out('8333077553386092776');" style="">1030     protected Object toIdFieldType(String id, Class&lt;?&gt; entityClass) {                                    </span>
<span class="4110349594135807695" onmouseenter="enter('4110349594135807695');" onmouseout="out('4110349594135807695');" style="">1031         Class&lt;?&gt; idFieldClass = dynamicDaoHelper.getIdField(entityClass).getType();                      </span>
<span class="-2186353433511684671" onmouseenter="enter('-2186353433511684671');" onmouseout="out('-2186353433511684671');" style="">1032         if (Long.class.isAssignableFrom(idFieldClass)) {                                                 </span>
<span class="5572754406141306162" onmouseenter="enter('5572754406141306162');" onmouseout="out('5572754406141306162');" style="">1033             return Long.parseLong(id);                                                                   </span>
<span class="-3847313633493236310" onmouseenter="enter('-3847313633493236310');" onmouseout="out('-3847313633493236310');" style="">1034         } else if (Integer.class.isAssignableFrom(idFieldClass)) {                                       </span>
<span class="3211402984454379456" onmouseenter="enter('3211402984454379456');" onmouseout="out('3211402984454379456');" style="">1035             return Integer.parseInt(id);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1036         }                                                                                                </span>
<span class="-3074727595953522219" onmouseenter="enter('-3074727595953522219');" onmouseout="out('-3074727595953522219');" style="">1037         return id;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1038     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1039 }                                                                                                        </span>













</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-3339060969767811416" onmouseenter="enter('-3339060969767811416');" onmouseout="out('-3339060969767811416');" style="">   3  * BroadleafCommerce Open Admin Platform                                                                 </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-8794511651793620694" onmouseenter="enter('-8794511651793620694');" onmouseout="out('-8794511651793620694');" style="">  18 package org.broadleafcommerce.openadmin.server.service;                                                  </span>
<span  style="">  19                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  20 import java.util.ArrayList;                                                                              </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  21 import java.util.Arrays;                                                                                 </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  22 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  23 import java.util.List;                                                                                   </span>
<span class="174663421494487417" onmouseenter="enter('174663421494487417');" onmouseout="out('174663421494487417');" style="">  24 import java.util.ListIterator;                                                                           </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  25 import java.util.Map.Entry;                                                                              </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  26 import java.util.Map;                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  27 import javax.annotation.Resource;                                                                        </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  28 import javax.persistence.EntityManager;                                                                  </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  29 import javax.persistence.PersistenceContext;                                                             </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  30 import org.apache.commons.lang3.ArrayUtils;                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  31 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  32 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  33 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="-6287859968194756382" onmouseenter="enter('-6287859968194756382');" onmouseout="out('-6287859968194756382');" style="">  34 import org.broadleafcommerce.common.admin.domain.AdminMainEntity;                                        </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  35 import org.broadleafcommerce.common.exception.ServiceException;                                          </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  36 import org.broadleafcommerce.common.persistence.EntityConfiguration;                                     </span>
<span class="-6648433550510659033" onmouseenter="enter('-6648433550510659033');" onmouseout="out('-6648433550510659033');" style="">  37 import org.broadleafcommerce.common.presentation.client.AddMethodType;                                   </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  38 import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                              </span>
<span class="2428099238642943960" onmouseenter="enter('2428099238642943960');" onmouseout="out('2428099238642943960');" style="">  39 import org.broadleafcommerce.common.util.BLCMessageUtils;                                                </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  40 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="5951235614759861305" onmouseenter="enter('5951235614759861305');" onmouseout="out('5951235614759861305');" style="">  41 import org.broadleafcommerce.common.util.dao.DynamicDaoHelper;                                           </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  42 import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                       </span>
<span class="-3361215363157046739" onmouseenter="enter('-3361215363157046739');" onmouseout="out('-3361215363157046739');" style="">  43 import org.broadleafcommerce.openadmin.dto.AdornedTargetCollectionMetadata;                              </span>
<span class="-1781055592725563383" onmouseenter="enter('-1781055592725563383');" onmouseout="out('-1781055592725563383');" style="">  44 import org.broadleafcommerce.openadmin.dto.AdornedTargetList;                                            </span>
<span class="-6140296335181984013" onmouseenter="enter('-6140296335181984013');" onmouseout="out('-6140296335181984013');" style="">  45 import org.broadleafcommerce.openadmin.dto.BasicCollectionMetadata;                                      </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  46 import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                           </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  47 import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                </span>
<span class="-3165611006566133086" onmouseenter="enter('-3165611006566133086');" onmouseout="out('-3165611006566133086');" style="">  48 import org.broadleafcommerce.openadmin.dto.CollectionMetadata;                                           </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  49 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                       </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  50 import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                             </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  51 import org.broadleafcommerce.openadmin.dto.Entity;                                                       </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  52 import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  53 import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                        </span>
<span class="2672462771965160264" onmouseenter="enter('2672462771965160264');" onmouseout="out('2672462771965160264');" style="">  54 import org.broadleafcommerce.openadmin.dto.GroupMetadata;                                                </span>
<span class="826821438795056004" onmouseenter="enter('826821438795056004');" onmouseout="out('826821438795056004');" style="">  55 import org.broadleafcommerce.openadmin.dto.MapMetadata;                                                  </span>
<span class="-7888875133556467044" onmouseenter="enter('-7888875133556467044');" onmouseout="out('-7888875133556467044');" style="">  56 import org.broadleafcommerce.openadmin.dto.MapStructure;                                                 </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  57 import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                           </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  58 import org.broadleafcommerce.openadmin.dto.Property;                                                     </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  59 import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                 </span>
<span class="5662236005419086618" onmouseenter="enter('5662236005419086618');" onmouseout="out('5662236005419086618');" style="">  60 import org.broadleafcommerce.openadmin.dto.TabMetadata;                                                  </span>
<span class="2699062320492900877" onmouseenter="enter('2699062320492900877');" onmouseout="out('2699062320492900877');" style="">  61 import org.broadleafcommerce.openadmin.exception.EntityNotFoundException;                                </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  62 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                      </span>
<span class="-2178507335566770341" onmouseenter="enter('-2178507335566770341');" onmouseout="out('-2178507335566770341');" style="">  63 import org.broadleafcommerce.openadmin.server.domain.FetchPageRequest;                                   </span>
<span class="4410643013278245372" onmouseenter="enter('4410643013278245372');" onmouseout="out('4410643013278245372');" style="">  64 import org.broadleafcommerce.openadmin.server.domain.PersistencePackageRequest;                          </span>
<span class="6597629584583725664" onmouseenter="enter('6597629584583725664');" onmouseout="out('6597629584583725664');" style="">  65 import org.broadleafcommerce.openadmin.server.factory.PersistencePackageFactory;                         </span>
<span class="7062965872140905778" onmouseenter="enter('7062965872140905778');" onmouseout="out('7062965872140905778');" style="">  66 import org.broadleafcommerce.openadmin.server.service.extension.CriteriaTransferObjectExtensionManager;  </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  67 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;             </span>
<span class="-8603256547657551769" onmouseenter="enter('-8603256547657551769');" onmouseout="out('-8603256547657551769');" style="">  68 import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceResponse;                   </span>
<span class="-3086540061138981164" onmouseenter="enter('-3086540061138981164');" onmouseout="out('-3086540061138981164');" style="">  69 import org.broadleafcommerce.openadmin.server.service.persistence.module.BasicPersistenceModule;         </span>
<span class="-7452009352681558215" onmouseenter="enter('-7452009352681558215');" onmouseout="out('-7452009352681558215');" style="">  70 import org.broadleafcommerce.openadmin.web.form.entity.DynamicEntityFormInfo;                            </span>
<span class="8035715143965725316" onmouseenter="enter('8035715143965725316');" onmouseout="out('8035715143965725316');" style="">  71 import org.broadleafcommerce.openadmin.web.form.entity.EntityForm;                                       </span>
<span class="6015559832933397076" onmouseenter="enter('6015559832933397076');" onmouseout="out('6015559832933397076');" style="">  72 import org.broadleafcommerce.openadmin.web.form.entity.Field;                                            </span>
<span class="7834442097514100117" onmouseenter="enter('7834442097514100117');" onmouseout="out('7834442097514100117');" style="">  73 import org.broadleafcommerce.openadmin.web.form.entity.Tab;                                              </span>
<span class="-5699213192866872541" onmouseenter="enter('-5699213192866872541');" onmouseout="out('-5699213192866872541');" style="">  74 import org.hibernate.exception.ConstraintViolationException;                                             </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  75 import org.springframework.stereotype.Service;                                                           </span>
<span  style="">  76                                                                                                          </span>
<span  style="">  77                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  78 /**                                                                                                      </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  79  * @author Andre Azzolini (apazzolini)                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  80  */                                                                                                      </span>
<span class="2205005937568393687" onmouseenter="enter('2205005937568393687');" onmouseout="out('2205005937568393687');" style="">  81 @Service(&quot;blAdminEntityService&quot;)                                                                         </span>
<span class="-2691323185499418706" onmouseenter="enter('-2691323185499418706');" onmouseout="out('-2691323185499418706');" style="">  82 public class AdminEntityServiceImpl implements AdminEntityService {                                      </span>
<span class="6898728355289688423" onmouseenter="enter('6898728355289688423');" onmouseout="out('6898728355289688423');" style="">  83     protected static final Log LOG = LogFactory.getLog(AdminEntityServiceImpl.class);                    </span>
<span  style="">  84                                                                                                          </span>
<span class="6303589118895976221" onmouseenter="enter('6303589118895976221');" onmouseout="out('6303589118895976221');" style="">  85     @Resource(name = &quot;blDynamicEntityRemoteService&quot;)                                                     </span>
<span class="1505564706419640906" onmouseenter="enter('1505564706419640906');" onmouseout="out('1505564706419640906');" style="">  86     protected DynamicEntityService service;                                                              </span>
<span  style="">  87                                                                                                          </span>
<span class="-5295563268582613053" onmouseenter="enter('-5295563268582613053');" onmouseout="out('-5295563268582613053');" style="">  88     @Resource(name = &quot;blPersistencePackageFactory&quot;)                                                      </span>
<span class="5077122885687298736" onmouseenter="enter('5077122885687298736');" onmouseout="out('5077122885687298736');" style="">  89     protected PersistencePackageFactory persistencePackageFactory;                                       </span>
<span  style="">  90                                                                                                          </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style="">  91     @PersistenceContext(unitName = &quot;blPU&quot;)                                                               </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  92     protected EntityManager em;                                                                          </span>
<span  style="">  93                                                                                                          </span>
<span class="6650882675825573659" onmouseenter="enter('6650882675825573659');" onmouseout="out('6650882675825573659');" style="">  94     @Resource(name = &quot;blEntityConfiguration&quot;)                                                            </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  95     protected EntityConfiguration entityConfiguration;                                                   </span>
<span  style="">  96                                                                                                          </span>
<span class="-2309360235309114106" onmouseenter="enter('-2309360235309114106');" onmouseout="out('-2309360235309114106');" style="">  97     @Resource                                                                                            </span>
<span class="5773081278430031986" onmouseenter="enter('5773081278430031986');" onmouseout="out('5773081278430031986');" style="">  98     protected CriteriaTransferObjectExtensionManager extensionManager;                                   </span>
<span  style="">  99                                                                                                          </span>
<span class="6769863436851689394" onmouseenter="enter('6769863436851689394');" onmouseout="out('6769863436851689394');" style=""> 100     protected DynamicDaoHelper dynamicDaoHelper = new DynamicDaoHelperImpl();                            </span>
<span  style=""> 101                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 102     @Override                                                                                            </span>
<span class="689806418400872386" onmouseenter="enter('689806418400872386');" onmouseout="out('689806418400872386');" style=""> 103     public PersistenceResponse getClassMetadata(PersistencePackageRequest request)                       </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 104             throws ServiceException {                                                                    </span>
<span class="-477483751520958137" onmouseenter="enter('-477483751520958137');" onmouseout="out('-477483751520958137');" style=""> 105         PersistenceResponse response = inspect(request);                                                 </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 106         ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                           </span>
<span class="4495915987564569811" onmouseenter="enter('4495915987564569811');" onmouseout="out('4495915987564569811');" style=""> 107         cmd.setCeilingType(request.getCeilingEntityClassname());                                         </span>
<span class="-7633911880463002125" onmouseenter="enter('-7633911880463002125');" onmouseout="out('-7633911880463002125');" style=""> 108         cmd.setSecurityCeilingType(request.getSecurityCeilingEntityClassname());                         </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 109         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110     }                                                                                                    </span>
<span  style=""> 111                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 112     @Override                                                                                            </span>
<span class="6442257948747151854" onmouseenter="enter('6442257948747151854');" onmouseout="out('6442257948747151854');" style=""> 113     public PersistenceResponse getRecords(PersistencePackageRequest request) throws ServiceException {   </span>
<span class="-8968772654133629352" onmouseenter="enter('-8968772654133629352');" onmouseout="out('-8968772654133629352');" style=""> 114         return fetch(request);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115     }                                                                                                    </span>
<span  style=""> 116                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 117     @Override                                                                                            </span>
<span class="4020809512296494224" onmouseenter="enter('4020809512296494224');" onmouseout="out('4020809512296494224');" style=""><abbr title=" 118     public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd, boolean isCollectionRequest)"> 118     public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd,ðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 119             throws ServiceException {                                                                    </span>
<span class="-5399859376019632364" onmouseenter="enter('-5399859376019632364');" onmouseout="out('-5399859376019632364');" style=""> 120         String idProperty = getIdProperty(cmd);                                                          </span>
<span  style=""> 121                                                                                                          </span>
<span class="1207908904787390154" onmouseenter="enter('1207908904787390154');" onmouseout="out('1207908904787390154');" style=""> 122         FilterAndSortCriteria fasc = new FilterAndSortCriteria(idProperty);                              </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 123         fasc.setFilterValue(id);                                                                         </span>
<span class="-8339504512820574544" onmouseenter="enter('-8339504512820574544');" onmouseout="out('-8339504512820574544');" style=""> 124         request.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 125                                                                                                          </span>
<span class="-1381837102214910163" onmouseenter="enter('-1381837102214910163');" onmouseout="out('-1381837102214910163');" style=""> 126         PersistenceResponse response = fetch(request);                                                   </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 127         Entity[] entities = response.getDynamicResultSet().getRecords();                                 </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 128         if (ArrayUtils.isEmpty(entities)) {                                                              </span>
<span class="3317501704848962820" onmouseenter="enter('3317501704848962820');" onmouseout="out('3317501704848962820');" style=""> 129             String celiningEntity = request.getCeilingEntityClassname();                                 </span>
<span class="1970293616538386874" onmouseenter="enter('1970293616538386874');" onmouseout="out('1970293616538386874');" style=""><abbr title=" 130             throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiningEntity, id));"> 130             throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiniðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131         }                                                                                                </span>
<span  style=""> 132                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 133         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134     }                                                                                                    </span>
<span  style=""> 135                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 136     @Override                                                                                            </span>
<span class="-7201975922678164147" onmouseenter="enter('-7201975922678164147');" onmouseout="out('-7201975922678164147');" style=""><abbr title=" 137     public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 137     public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 138         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 138         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 139         // If the entity form has dynamic forms inside of it, we need to persist those as well.          </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 140         // They are typically done in their own custom persistence handlers, which will get triggered    </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 141         // based on the criteria specific in the PersistencePackage.                                     </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 142         for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 143             DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                  </span>
<span  style=""> 144                                                                                                          </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 145             if (info.getCustomCriteriaOverride() != null) {                                              </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 146                 customCriteria = info.getCustomCriteriaOverride();                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 147             } else {                                                                                     </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 148                 String propertyName = info.getPropertyName();                                            </span>
<span class="3293102538279717811" onmouseenter="enter('3293102538279717811');" onmouseout="out('3293102538279717811');" style=""> 149                 String propertyValue;                                                                    </span>
<span class="3903441351658368829" onmouseenter="enter('3903441351658368829');" onmouseout="out('3903441351658368829');" style=""> 150                 if (entityForm.getFields().containsKey(propertyName)) {                                  </span>
<span class="-3364727408470092918" onmouseenter="enter('-3364727408470092918');" onmouseout="out('-3364727408470092918');" style=""> 151                     propertyValue = entityForm.findField(propertyName).getValue();                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 152                 } else {                                                                                 </span>
<span class="6725656947693910623" onmouseenter="enter('6725656947693910623');" onmouseout="out('6725656947693910623');" style=""> 153                     propertyValue = info.getPropertyValue();                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154                 }                                                                                        </span>
<span class="-5306746194951417463" onmouseenter="enter('-5306746194951417463');" onmouseout="out('-5306746194951417463');" style=""><abbr title=" 155                 customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue};"> 155                 customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156             }                                                                                            </span>
<span  style=""> 157                                                                                                          </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 158             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 158             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriterðŸ”µ</abbr></span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 159             ppr.addSubRequest(info.getPropertyName(), subRequest);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160         }                                                                                                </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 161         return add(ppr);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162     }                                                                                                    </span>
<span  style=""> 163                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 164     @Override                                                                                            </span>
<span class="2877208390579447415" onmouseenter="enter('2877208390579447415');" onmouseout="out('2877208390579447415');" style=""><abbr title=" 165     public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 165     public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 166         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 166         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="5530250091258169917" onmouseenter="enter('5530250091258169917');" onmouseout="out('5530250091258169917');" style=""> 167         ppr.setRequestingEntityName(entityForm.getMainEntityName());                                     </span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 168         // If the entity form has dynamic forms inside of it, we need to persist those as well.          </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 169         // They are typically done in their own custom persistence handlers, which will get triggered    </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 170         // based on the criteria specific in the PersistencePackage.                                     </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 171         for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 172             DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                  </span>
<span  style=""> 173                                                                                                          </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 174             if (info.getCustomCriteriaOverride() != null) {                                              </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 175                 customCriteria = info.getCustomCriteriaOverride();                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 176             } else {                                                                                     </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 177                 String propertyName = info.getPropertyName();                                            </span>
<span class="8503945409701800913" onmouseenter="enter('8503945409701800913');" onmouseout="out('8503945409701800913');" style=""> 178                 String propertyValue = entityForm.findField(propertyName).getValue();                    </span>
<span class="-4083933246171517436" onmouseenter="enter('-4083933246171517436');" onmouseout="out('-4083933246171517436');" style=""><abbr title=" 179                 customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue };"> 179                 customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180             }                                                                                            </span>
<span  style=""> 181                                                                                                          </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 182             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 182             PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriterðŸ”µ</abbr></span>
<span class="3320363489874291671" onmouseenter="enter('3320363489874291671');" onmouseout="out('3320363489874291671');" style=""> 183             subRequest.withSecurityCeilingEntityClassname(info.getSecurityCeilingClassName());           </span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 184             ppr.addSubRequest(info.getPropertyName(), subRequest);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185         }                                                                                                </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 186         return update(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187     }                                                                                                    </span>
<span  style=""> 188                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 189     @Override                                                                                            </span>
<span class="369147730756947995" onmouseenter="enter('369147730756947995');" onmouseout="out('369147730756947995');" style=""><abbr title=" 190     public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb)"> 190     public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 191             throws ServiceException {                                                                    </span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""><abbr title=" 192         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);"> 192         PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb)ðŸ”µ</abbr></span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 193         return remove(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span  style=""> 195                                                                                                          </span>
<span class="-4457012513682950961" onmouseenter="enter('-4457012513682950961');" onmouseout="out('-4457012513682950961');" style=""> 196     protected List&lt;Property&gt; getPropertiesFromEntityForm(EntityForm entityForm) {                        </span>
<span class="5502280122802762543" onmouseenter="enter('5502280122802762543');" onmouseout="out('5502280122802762543');" style=""> 197         List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;(entityForm.getFields().size());              </span>
<span  style=""> 198                                                                                                          </span>
<span class="-1983225226345189396" onmouseenter="enter('-1983225226345189396');" onmouseout="out('-1983225226345189396');" style=""> 199         for (Entry&lt;String, Field&gt; entry : entityForm.getFields().entrySet()) {                           </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 200             Property p = new Property();                                                                 </span>
<span class="1947374185751812962" onmouseenter="enter('1947374185751812962');" onmouseout="out('1947374185751812962');" style=""> 201             p.setName(entry.getKey());                                                                   </span>
<span class="-7008764564116424461" onmouseenter="enter('-7008764564116424461');" onmouseout="out('-7008764564116424461');" style=""> 202             p.setValue(entry.getValue().getValue());                                                     </span>
<span class="4978688160201726577" onmouseenter="enter('4978688160201726577');" onmouseout="out('4978688160201726577');" style=""> 203             p.setDisplayValue(entry.getValue().getDisplayValue());                                       </span>
<span class="9200882176886832259" onmouseenter="enter('9200882176886832259');" onmouseout="out('9200882176886832259');" style=""> 204             p.setIsDirty(entry.getValue().getIsDirty());                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 205             properties.add(p);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206         }                                                                                                </span>
<span  style=""> 207                                                                                                          </span>
<span class="7053686412803007774" onmouseenter="enter('7053686412803007774');" onmouseout="out('7053686412803007774');" style=""> 208         return properties;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209     }                                                                                                    </span>
<span  style=""> 210                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 211     @Override                                                                                            </span>
<span class="7722997034713089523" onmouseenter="enter('7722997034713089523');" onmouseout="out('7722997034713089523');" style=""><abbr title=" 212     public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumbs) {"> 212     public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriterðŸ”µ</abbr></span>
<span class="-704234828580880941" onmouseenter="enter('-704234828580880941');" onmouseout="out('-704234828580880941');" style=""> 213         // Ensure the ID property is on the form                                                         </span>
<span class="-5311876513799607800" onmouseenter="enter('-5311876513799607800');" onmouseout="out('-5311876513799607800');" style=""> 214         Field idField = entityForm.findField(entityForm.getIdProperty());                                </span>
<span class="-5694238240637206409" onmouseenter="enter('-5694238240637206409');" onmouseout="out('-5694238240637206409');" style=""> 215         if (idField == null) {                                                                           </span>
<span class="250587265755875585" onmouseenter="enter('250587265755875585');" onmouseout="out('250587265755875585');" style=""> 216             idField = new Field();                                                                       </span>
<span class="7054903396669057342" onmouseenter="enter('7054903396669057342');" onmouseout="out('7054903396669057342');" style=""> 217             idField.setName(entityForm.getIdProperty());                                                 </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 218             idField.setValue(entityForm.getId());                                                        </span>
<span class="-7557326149225538579" onmouseenter="enter('-7557326149225538579');" onmouseout="out('-7557326149225538579');" style=""> 219             entityForm.getFields().put(entityForm.getIdProperty(), idField);                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 220         } else {                                                                                         </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 221             idField.setValue(entityForm.getId());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222         }                                                                                                </span>
<span class="2582109723187805610" onmouseenter="enter('2582109723187805610');" onmouseout="out('2582109723187805610');" style=""> 223         List&lt;Property&gt; propList = getPropertiesFromEntityForm(entityForm);                               </span>
<span class="-5301080913609099643" onmouseenter="enter('-5301080913609099643');" onmouseout="out('-5301080913609099643');" style=""> 224         Property[] properties = new Property[propList.size()];                                           </span>
<span class="-3900695733940297394" onmouseenter="enter('-3900695733940297394');" onmouseout="out('-3900695733940297394');" style=""> 225         properties = propList.toArray(properties);                                                       </span>
<span class="-4105415098036700385" onmouseenter="enter('-4105415098036700385');" onmouseout="out('-4105415098036700385');" style=""> 226         Entity entity = new Entity();                                                                    </span>
<span class="-2371781861505771230" onmouseenter="enter('-2371781861505771230');" onmouseout="out('-2371781861505771230');" style=""> 227         entity.setProperties(properties);                                                                </span>
<span class="2583214667713512490" onmouseenter="enter('2583214667713512490');" onmouseout="out('2583214667713512490');" style=""> 228         String entityType = entityForm.getEntityType();                                                  </span>
<span class="-96692239825780670" onmouseenter="enter('-96692239825780670');" onmouseout="out('-96692239825780670');" style=""> 229         if (StringUtils.isEmpty(entityType)) {                                                           </span>
<span class="-1511101492052020501" onmouseenter="enter('-1511101492052020501');" onmouseout="out('-1511101492052020501');" style=""> 230             entityType = entityForm.getCeilingEntityClassname();                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231         }                                                                                                </span>
<span class="-7205921586429744061" onmouseenter="enter('-7205921586429744061');" onmouseout="out('-7205921586429744061');" style=""> 232         entity.setType(new String[]{ entityType });                                                      </span>
<span class="8057498010797650283" onmouseenter="enter('8057498010797650283');" onmouseout="out('8057498010797650283');" style=""><abbr title=" 233         PersistencePackageRequest ppr = PersistencePackageRequest.standard().withEntity(entity).withCustomCriteria(customCriteria).withCeilingEntityClassname(entityForm.getCeilingEntityClassname()).withSectionCrumbs(sectionCrumbs).withRequestingEntityName(entityForm.getMainEntityName());"> 233         PersistencePackageRequest ppr = PersistencePackageRequest.standard().withEntity(entity).withCustoðŸ”µ</abbr></span>
<span class="-1955805470028526694" onmouseenter="enter('-1955805470028526694');" onmouseout="out('-1955805470028526694');" style=""> 234         return ppr;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235     }                                                                                                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 237     @Override                                                                                            </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 238     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 238     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity ðŸ”µ</abbr></span>
<span class="6970881093397655354" onmouseenter="enter('6970881093397655354');" onmouseout="out('6970881093397655354');" style=""><abbr title=" 239             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId)"> 239             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, StrinðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 240             throws ServiceException {                                                                    </span>
<span class="-8379471421074460507" onmouseenter="enter('-8379471421074460507');" onmouseout="out('-8379471421074460507');" style=""><abbr title=" 241         return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty, collectionItemId, sectionCrumbs, alternateId, null);"> 241         return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242     }                                                                                                    </span>
<span  style=""> 243                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 244     @Override                                                                                            </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 245     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 245     public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity ðŸ”µ</abbr></span>
<span class="-7996433221423208195" onmouseenter="enter('-7996433221423208195');" onmouseout="out('-7996433221423208195');" style=""><abbr title=" 246             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId,"> 246             Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, StrinðŸ”µ</abbr></span>
<span class="4731322974144125980" onmouseenter="enter('4731322974144125980');" onmouseout="out('4731322974144125980');" style=""> 247             String[] customCriteria) throws ServiceException {                                           </span>
<span class="-279994379320395128" onmouseenter="enter('-279994379320395128');" onmouseout="out('-279994379320395128');" style=""><abbr title=" 248         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs);"> 248         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetaðŸ”µ</abbr></span>
<span  style=""> 249                                                                                                          </span>
<span class="-1281430943574994988" onmouseenter="enter('-1281430943574994988');" onmouseout="out('-1281430943574994988');" style=""> 250         ppr.addCustomCriteria(customCriteria);                                                           </span>
<span  style=""> 251                                                                                                          </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 252         FieldMetadata md = collectionProperty.getMetadata();                                             </span>
<span class="3724000031963826131" onmouseenter="enter('3724000031963826131');" onmouseout="out('3724000031963826131');" style=""><abbr title=" 253         String containingEntityId = getContextSpecificRelationshipId(containingClassMetadata, containingEntity,"> 253         String containingEntityId = getContextSpecificRelationshipId(containingClassMetadata, containingEðŸ”µ</abbr></span>
<span class="-7103210414980095383" onmouseenter="enter('-7103210414980095383');" onmouseout="out('-7103210414980095383');" style=""> 254                 collectionProperty.getName());                                                           </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 255         ppr.setSectionEntityField(collectionProperty.getName());                                         </span>
<span  style=""> 256                                                                                                          </span>
<span class="6887268983731320356" onmouseenter="enter('6887268983731320356');" onmouseout="out('6887268983731320356');" style=""> 257         PersistenceResponse response;                                                                    </span>
<span  style=""> 258                                                                                                          </span>
<span class="-5961537470500127604" onmouseenter="enter('-5961537470500127604');" onmouseout="out('-5961537470500127604');" style=""> 259         if (md instanceof AdornedTargetCollectionMetadata) {                                             </span>
<span class="8356058175939814254" onmouseenter="enter('8356058175939814254');" onmouseout="out('8356058175939814254');" style=""><abbr title=" 260             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());"> 260             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFielðŸ”µ</abbr></span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 261             fasc.setFilterValue(containingEntityId);                                                     </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 262             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 263                                                                                                          </span>
<span class="-3458751872436187064" onmouseenter="enter('-3458751872436187064');" onmouseout="out('-3458751872436187064');" style=""> 264             fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName() + &quot;Target&quot;);  </span>
<span class="-3598598531395908508" onmouseenter="enter('-3598598531395908508');" onmouseout="out('-3598598531395908508');" style=""> 265             fasc.setFilterValue(collectionItemId);                                                       </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 266             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 267                                                                                                          </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 268             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="-5748606955827926888" onmouseenter="enter('-5748606955827926888');" onmouseout="out('-5748606955827926888');" style=""> 269                 fasc = new FilterAndSortCriteria(ppr.getAdornedList().getIdProperty());                  </span>
<span class="7811712685421146637" onmouseenter="enter('7811712685421146637');" onmouseout="out('7811712685421146637');" style=""> 270                 fasc.setFilterValue(alternateId);                                                        </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 271                 ppr.addFilterAndSortCriteria(fasc);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272             }                                                                                            </span>
<span  style=""> 273                                                                                                          </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 274             response = fetch(ppr);                                                                       </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 275             Entity[] entities = response.getDynamicResultSet().getRecords();                             </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 276             if (ArrayUtils.isEmpty(entities)) {                                                          </span>
<span class="-6945066260128413327" onmouseenter="enter('-6945066260128413327');" onmouseout="out('-6945066260128413327');" style=""> 277                 String altId = (!StringUtils.isEmpty(alternateId)) ? alternateId : &quot;&quot;;                   </span>
<span class="6252787461298878948" onmouseenter="enter('6252787461298878948');" onmouseout="out('6252787461298878948');" style=""><abbr title=" 278                 throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%s], id [%s], targetId [%s], alternateId [%s] &quot;,"> 278                 throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%ðŸ”µ</abbr></span>
<span class="-631993348779519244" onmouseenter="enter('-631993348779519244');" onmouseout="out('-631993348779519244');" style=""><abbr title=" 279                         ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), containingEntityId, collectionItemId, altId));"> 279                         ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), cðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 281         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="8401290555692845532" onmouseenter="enter('8401290555692845532');" onmouseout="out('8401290555692845532');" style=""> 282             MapMetadata mmd = (MapMetadata) md;                                                          </span>
<span class="-9165857322565832123" onmouseenter="enter('-9165857322565832123');" onmouseout="out('-9165857322565832123');" style=""> 283             FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());</span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 284             fasc.setFilterValue(containingEntityId);                                                     </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 285             ppr.addFilterAndSortCriteria(fasc);                                                          </span>
<span  style=""> 286                                                                                                          </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 287             response = fetch(ppr);                                                                       </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 288             Entity[] entities = response.getDynamicResultSet().getRecords();                             </span>
<span class="-7031469698370723184" onmouseenter="enter('-7031469698370723184');" onmouseout="out('-7031469698370723184');" style=""> 289             for (Entity e : entities) {                                                                  </span>
<span class="5353809260142967112" onmouseenter="enter('5353809260142967112');" onmouseout="out('5353809260142967112');" style=""> 290                 String idProperty = getIdProperty(containingClassMetadata);                              </span>
<span class="5591331798883124479" onmouseenter="enter('5591331798883124479');" onmouseout="out('5591331798883124479');" style=""> 291                 if (mmd.isSimpleValue()) {                                                               </span>
<span class="-4161155795101164165" onmouseenter="enter('-4161155795101164165');" onmouseout="out('-4161155795101164165');" style=""> 292                     idProperty = &quot;key&quot;;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293                 }                                                                                        </span>
<span class="8921593406962610258" onmouseenter="enter('8921593406962610258');" onmouseout="out('8921593406962610258');" style=""> 294                 Property p = e.getPMap().get(idProperty);                                                </span>
<span class="6407772199744557069" onmouseenter="enter('6407772199744557069');" onmouseout="out('6407772199744557069');" style=""> 295                 if (p.getValue().equals(collectionItemId)) {                                             </span>
<span class="-7132868348925489606" onmouseenter="enter('-7132868348925489606');" onmouseout="out('-7132868348925489606');" style=""> 296                     response.setEntity(e);                                                               </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 297                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 300         } else {                                                                                         </span>
<span class="8229323461389456522" onmouseenter="enter('8229323461389456522');" onmouseout="out('8229323461389456522');" style=""><abbr title=" 301             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not an &quot; +"> 301             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="8394443338285651390" onmouseenter="enter('8394443338285651390');" onmouseout="out('8394443338285651390');" style=""><abbr title=" 302                     &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));"> 302                     &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.gðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303         }                                                                                                </span>
<span  style=""> 304                                                                                                          </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 305         return response;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 308     @Override                                                                                            </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 309     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 309     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity contðŸ”µ</abbr></span>
<span class="-8940960037863570008" onmouseenter="enter('-8940960037863570008');" onmouseout="out('-8940960037863570008');" style=""><abbr title=" 310             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 310             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxInðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 311             throws ServiceException {                                                                    </span>
<span class="4618756740023180601" onmouseenter="enter('4618756740023180601');" onmouseout="out('4618756740023180601');" style=""><abbr title=" 312         return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, startIndex,"> 312         return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fasðŸ”µ</abbr></span>
<span class="2241863538673887409" onmouseenter="enter('2241863538673887409');" onmouseout="out('2241863538673887409');" style=""> 313                 maxIndex, null, sectionCrumb);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314     }                                                                                                    </span>
<span  style=""> 315                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 316     @Override                                                                                            </span>
<span class="-7201231903947653503" onmouseenter="enter('-7201231903947653503');" onmouseout="out('-7201231903947653503');" style=""><abbr title=" 317     public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 317     public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, EntityðŸ”µ</abbr></span>
<span class="418251651311673518" onmouseenter="enter('418251651311673518');" onmouseout="out('418251651311673518');" style=""><abbr title=" 318             Property collectionProperty, FilterAndSortCriteria[] fascs, FetchPageRequest fetchPageRequest,"> 318             Property collectionProperty, FilterAndSortCriteria[] fascs, FetchPageRequest fetchPageRequestðŸ”µ</abbr></span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 319             String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {          </span>
<span class="7874520314895198323" onmouseenter="enter('7874520314895198323');" onmouseout="out('7874520314895198323');" style=""><abbr title=" 320         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs)"> 320         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetaðŸ”µ</abbr></span>
<span class="-7469251084029012642" onmouseenter="enter('-7469251084029012642');" onmouseout="out('-7469251084029012642');" style=""> 321             .withFilterAndSortCriteria(fascs)                                                            </span>
<span class="-7573135850576319031" onmouseenter="enter('-7573135850576319031');" onmouseout="out('-7573135850576319031');" style=""> 322             .withStartIndex(fetchPageRequest.getStartIndex())                                            </span>
<span class="-3581511696188385312" onmouseenter="enter('-3581511696188385312');" onmouseout="out('-3581511696188385312');" style=""> 323             .withMaxIndex(fetchPageRequest.getMaxIndex())                                                </span>
<span class="-8590301553347003975" onmouseenter="enter('-8590301553347003975');" onmouseout="out('-8590301553347003975');" style=""> 324             .withFirstId(fetchPageRequest.getFirstId())                                                  </span>
<span class="2671174632142808768" onmouseenter="enter('2671174632142808768');" onmouseout="out('2671174632142808768');" style=""> 325             .withLastId(fetchPageRequest.getLastId())                                                    </span>
<span class="-6593991434037097050" onmouseenter="enter('-6593991434037097050');" onmouseout="out('-6593991434037097050');" style=""> 326             .withLowerCount(fetchPageRequest.getLowerCount())                                            </span>
<span class="-117029417959198312" onmouseenter="enter('-117029417959198312');" onmouseout="out('-117029417959198312');" style=""> 327             .withUpperCount(fetchPageRequest.getUpperCount())                                            </span>
<span class="-4278016885305366423" onmouseenter="enter('-4278016885305366423');" onmouseout="out('-4278016885305366423');" style=""> 328             .withPageSize(fetchPageRequest.getPageSize())                                                </span>
<span class="-6582704259903712752" onmouseenter="enter('-6582704259903712752');" onmouseout="out('-6582704259903712752');" style=""> 329             .withPresentationFetch(true);                                                                </span>
<span  style=""> 330                                                                                                          </span>
<span class="-3273025574919321412" onmouseenter="enter('-3273025574919321412');" onmouseout="out('-3273025574919321412');" style=""> 331         FilterAndSortCriteria fasc;                                                                      </span>
<span  style=""> 332                                                                                                          </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 333         FieldMetadata md = collectionProperty.getMetadata();                                             </span>
<span class="-4862294775264679708" onmouseenter="enter('-4862294775264679708');" onmouseout="out('-4862294775264679708');" style=""> 334         String collectionCeilingClass = null;                                                            </span>
<span  style=""> 335                                                                                                          </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 336         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 337             fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                      </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 338             collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();             </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 339         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="5713965317772328276" onmouseenter="enter('5713965317772328276');" onmouseout="out('5713965317772328276');" style=""> 340             fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());             </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 341             collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();             </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 342         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 343             fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 344         } else {                                                                                         </span>
<span class="-7764689527754153249" onmouseenter="enter('-7764689527754153249');" onmouseout="out('-7764689527754153249');" style=""><abbr title=" 345             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not a &quot; +"> 345             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="9018729105513046766" onmouseenter="enter('9018729105513046766');" onmouseout="out('9018729105513046766');" style=""><abbr title=" 346                     &quot;collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));"> 346                     &quot;collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347         }                                                                                                </span>
<span  style=""> 348                                                                                                          </span>
<span class="4254518413777245486" onmouseenter="enter('4254518413777245486');" onmouseout="out('4254518413777245486');" style=""> 349         String id;                                                                                       </span>
<span class="4803324110888028956" onmouseenter="enter('4803324110888028956');" onmouseout="out('4803324110888028956');" style=""> 350         if (idValueOverride == null) {                                                                   </span>
<span class="-7725769379673096748" onmouseenter="enter('-7725769379673096748');" onmouseout="out('-7725769379673096748');" style=""><abbr title=" 351             id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionProperty.getName());"> 351             id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionPrðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 352         } else {                                                                                         </span>
<span class="-8702106967230782193" onmouseenter="enter('-8702106967230782193');" onmouseout="out('-8702106967230782193');" style=""> 353             id = idValueOverride;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354         }                                                                                                </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 355         fasc.setFilterValue(id);                                                                         </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 356         ppr.addFilterAndSortCriteria(fasc);                                                              </span>
<span  style=""> 357                                                                                                          </span>
<span class="427990645680582522" onmouseenter="enter('427990645680582522');" onmouseout="out('427990645680582522');" style=""> 358         if (collectionCeilingClass != null) {                                                            </span>
<span class="-6816699203213465846" onmouseenter="enter('-6816699203213465846');" onmouseout="out('-6816699203213465846');" style=""> 359             ppr.setCeilingEntityClassname(collectionCeilingClass);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360         }                                                                                                </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 361         ppr.setSectionEntityField(collectionProperty.getName());                                         </span>
<span  style=""> 362                                                                                                          </span>
<span class="4509000565359254391" onmouseenter="enter('4509000565359254391');" onmouseout="out('4509000565359254391');" style=""> 363         return fetch(ppr);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364     }                                                                                                    </span>
<span  style=""> 365                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 366     @Override                                                                                            </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 367     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 367     public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity contðŸ”µ</abbr></span>
<span class="509622451136715712" onmouseenter="enter('509622451136715712');" onmouseout="out('509622451136715712');" style=""><abbr title=" 368             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex,"> 368             Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxInðŸ”µ</abbr></span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 369             String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {          </span>
<span class="-1197294568643910019" onmouseenter="enter('-1197294568643910019');" onmouseout="out('-1197294568643910019');" style=""><abbr title=" 370         FetchPageRequest pageRequest = new FetchPageRequest().withStartIndex(startIndex).withMaxIndex(maxIndex);"> 370         FetchPageRequest pageRequest = new FetchPageRequest().withStartIndex(startIndex).withMaxIndex(maxðŸ”µ</abbr></span>
<span class="-1074537376579155932" onmouseenter="enter('-1074537376579155932');" onmouseout="out('-1074537376579155932');" style=""><abbr title=" 371         return getPagedRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs,"> 371         return getPagedRecordsForCollection(containingClassMetadata, containingEntity, collectionPropertyðŸ”µ</abbr></span>
<span class="-3163237569846875940" onmouseenter="enter('-3163237569846875940');" onmouseout="out('-3163237569846875940');" style=""> 372                 pageRequest, idValueOverride, sectionCrumbs);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373     }                                                                                                    </span>
<span  style=""> 374                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 375     @Override                                                                                            </span>
<span class="-3841297295714521949" onmouseenter="enter('-3841297295714521949');" onmouseout="out('-3841297295714521949');" style=""><abbr title=" 376     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 376     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, EnðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 377             throws ServiceException {                                                                    </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 378         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                     </span>
<span  style=""> 379                                                                                                          </span>
<span class="-733567857055224528" onmouseenter="enter('-733567857055224528');" onmouseout="out('-733567857055224528');" style=""> 380         PersistenceResponse response = getClassMetadata(ppr);                                            </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 381         ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                           </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 382         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 383             if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])</span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 384                     &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                  </span>
<span class="8095643692447388517" onmouseenter="enter('8095643692447388517');" onmouseout="out('8095643692447388517');" style=""><abbr title=" 385                 PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, startIndex, maxIndex, sectionCrumb);"> 385                 PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, sðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 386                 map.put(p.getName(), response2.getDynamicResultSet());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388         }                                                                                                </span>
<span  style=""> 389                                                                                                          </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 390         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 391     }                                                                                                    </span>
<span  style=""> 392                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 393     @Override                                                                                            </span>
<span class="-3628970257678085943" onmouseenter="enter('-3628970257678085943');" onmouseout="out('-3628970257678085943');" style=""><abbr title=" 394     public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity containingEntity,"> 394     public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity contðŸ”µ</abbr></span>
<span class="-4231090245204295086" onmouseenter="enter('-4231090245204295086');" onmouseout="out('-4231090245204295086');" style=""><abbr title=" 395                                                                            List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 395                                                                            List&lt;SectionCrumb&gt; sectionCrumðŸ”µ</abbr></span>
<span class="-2409741133586104337" onmouseenter="enter('-2409741133586104337');" onmouseout="out('-2409741133586104337');" style=""> 396         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;&gt;();                                             </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 397         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="4164210101311278906" onmouseenter="enter('4164210101311278906');" onmouseout="out('4164210101311278906');" style=""> 398             FieldMetadata fieldMetadata = p.getMetadata();                                               </span>
<span class="-4624883475289984299" onmouseenter="enter('-4624883475289984299');" onmouseout="out('-4624883475289984299');" style=""><abbr title=" 399             boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEntity.getType()[0]);"> 399             boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEðŸ”µ</abbr></span>
<span class="527509468046610128" onmouseenter="enter('527509468046610128');" onmouseout="out('527509468046610128');" style=""> 400             if (fieldAvailable &amp;&amp; fieldMetadata instanceof CollectionMetadata) {                         </span>
<span class="889550045664327310" onmouseenter="enter('889550045664327310');" onmouseout="out('889550045664327310');" style=""> 401                 FetchPageRequest pageRequest = new FetchPageRequest()                                    </span>
<span class="7756015397659671998" onmouseenter="enter('7756015397659671998');" onmouseout="out('7756015397659671998');" style=""> 402                         .withPageSize(Integer.MAX_VALUE);                                                </span>
<span class="-5742395122034161641" onmouseenter="enter('-5742395122034161641');" onmouseout="out('-5742395122034161641');" style=""><abbr title=" 403                 PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pageRequest, null, sectionCrumb);"> 403                 PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pðŸ”µ</abbr></span>
<span class="7448530828258193539" onmouseenter="enter('7448530828258193539');" onmouseout="out('7448530828258193539');" style=""> 404                 map.put(p.getName(), resp.getDynamicResultSet());                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406         }                                                                                                </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 407         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408     }                                                                                                    </span>
<span  style=""> 409                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 410     @Override                                                                                            </span>
<span class="3589590817922421749" onmouseenter="enter('3589590817922421749');" onmouseout="out('3589590817922421749');" style=""><abbr title=" 411     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb)"> 411     public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, EnðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 412             throws ServiceException {                                                                    </span>
<span  style=""> 413                                                                                                          </span>
<span class="7186594912669123504" onmouseenter="enter('7186594912669123504');" onmouseout="out('7186594912669123504');" style=""> 414         return getRecordsForAllSubCollections(ppr, containingEntity, null, null, sectionCrumb);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415     }                                                                                                    </span>
<span  style=""> 416                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 417     @Override                                                                                            </span>
<span class="-7386306397684799123" onmouseenter="enter('-7386306397684799123');" onmouseout="out('-7386306397684799123');" style=""><abbr title=" 418     public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb,"> 418     public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntðŸ”µ</abbr></span>
<span class="-5959215544738911709" onmouseenter="enter('-5959215544738911709');" onmouseout="out('-5959215544738911709');" style=""> 419             String currentTabName) throws ServiceException {                                             </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 420         Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                     </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 421         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 422             if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])</span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 423                     &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                  </span>
<span  style=""> 424                                                                                                          </span>
<span class="-8882071661255371966" onmouseenter="enter('-8882071661255371966');" onmouseout="out('-8882071661255371966');" style=""> 425                 CollectionMetadata collectionMetadata = (CollectionMetadata) p.getMetadata();            </span>
<span  style=""> 426                                                                                                          </span>
<span class="-6866172471902490379" onmouseenter="enter('-6866172471902490379');" onmouseout="out('-6866172471902490379');" style=""><abbr title=" 427                 // Give preference to the Group since EntityForm.addListGrid() gives preference to the Group"> 427                 // Give preference to the Group since EntityForm.addListGrid() gives preference to the GrðŸ”µ</abbr></span>
<span class="5847566346942070760" onmouseenter="enter('5847566346942070760');" onmouseout="out('5847566346942070760');" style=""> 428                 TabMetadata tabMetadata = cmd.getTabMetadataUsingGroupKey(collectionMetadata.getGroup());</span>
<span class="5004852122593217272" onmouseenter="enter('5004852122593217272');" onmouseout="out('5004852122593217272');" style=""> 429                 if (tabMetadata == null) {                                                               </span>
<span class="231191347318133709" onmouseenter="enter('231191347318133709');" onmouseout="out('231191347318133709');" style=""> 430                     tabMetadata = cmd.getTabMetadataUsingTabKey(collectionMetadata.getTab());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431                 }                                                                                        </span>
<span  style=""> 432                                                                                                          </span>
<span class="-3015386838727954630" onmouseenter="enter('-3015386838727954630');" onmouseout="out('-3015386838727954630');" style=""><abbr title=" 433                 String tabName = tabMetadata == null ? collectionMetadata.getTab() : tabMetadata.getTabName();"> 433                 String tabName = tabMetadata == null ? collectionMetadata.getTab() : tabMetadata.getTabNaðŸ”µ</abbr></span>
<span class="-7179383252706615246" onmouseenter="enter('-7179383252706615246');" onmouseout="out('-7179383252706615246');" style=""><abbr title=" 434                 int tabOrder = tabMetadata == null ? collectionMetadata.getTabOrder() : tabMetadata.getTabOrder();"> 434                 int tabOrder = tabMetadata == null ? collectionMetadata.getTabOrder() : tabMetadata.getTaðŸ”µ</abbr></span>
<span class="-1384994182862418254" onmouseenter="enter('-1384994182862418254');" onmouseout="out('-1384994182862418254');" style=""> 435                 updateTabInfo(collectionMetadata, cmd, tabName, tabOrder);                               </span>
<span  style=""> 436                                                                                                          </span>
<span class="8686774820240993219" onmouseenter="enter('8686774820240993219');" onmouseout="out('8686774820240993219');" style=""> 437                 if (collectionMetadata.getLazyFetch() != null &amp;&amp; collectionMetadata.getLazyFetch()       </span>
<span class="5105727312979860339" onmouseenter="enter('5105727312979860339');" onmouseout="out('5105727312979860339');" style=""> 438                         &amp;&amp; tabName.toUpperCase().startsWith(currentTabName.toUpperCase())                </span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 439                         &amp;&amp; !collectionMetadata.getManualFetch()) {                                       </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 440                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 440                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, nulðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 441                     map.put(p.getName(), response2.getDynamicResultSet());                               </span>
<span class="8148681537408196343" onmouseenter="enter('8148681537408196343');" onmouseout="out('8148681537408196343');" style=""><abbr title=" 442                 } else if (collectionMetadata.getLazyFetch() != null &amp;&amp; !collectionMetadata.getLazyFetch()"> 442                 } else if (collectionMetadata.getLazyFetch() != null &amp;&amp; !collectionMetadata.getLazyFetch(ðŸ”µ</abbr></span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 443                         &amp;&amp; !collectionMetadata.getManualFetch()) {                                       </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 444                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 444                     PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, nulðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 445                     map.put(p.getName(), response2.getDynamicResultSet());                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 446                 } else {                                                                                 </span>
<span class="4201070416549217756" onmouseenter="enter('4201070416549217756');" onmouseout="out('4201070416549217756');" style=""> 447                     DynamicResultSet drs = new DynamicResultSet();                                       </span>
<span class="133064617150058408" onmouseenter="enter('133064617150058408');" onmouseout="out('133064617150058408');" style=""> 448                     Map&lt;String, Tab&gt; tabMap = new HashMap&lt;String, Tab&gt;();                                </span>
<span class="52154028506366978" onmouseenter="enter('52154028506366978');" onmouseout="out('52154028506366978');" style=""> 449                     Tab tab = new Tab();                                                                 </span>
<span class="7573724056713363868" onmouseenter="enter('7573724056713363868');" onmouseout="out('7573724056713363868');" style=""> 450                     tab.setKey(tabName);                                                                 </span>
<span class="6935872114105155637" onmouseenter="enter('6935872114105155637');" onmouseout="out('6935872114105155637');" style=""> 451                     tab.setTitle(BLCMessageUtils.getMessage(tabName));                                   </span>
<span class="-3862389491808527983" onmouseenter="enter('-3862389491808527983');" onmouseout="out('-3862389491808527983');" style=""> 452                     tab.setOrder(tabOrder);                                                              </span>
<span class="-8730262596017656059" onmouseenter="enter('-8730262596017656059');" onmouseout="out('-8730262596017656059');" style=""> 453                     tabMap.put(tab.getTitle(), tab);                                                     </span>
<span class="6973540073738050016" onmouseenter="enter('6973540073738050016');" onmouseout="out('6973540073738050016');" style=""> 454                     drs.setUnselectedTabMetadata(tabMap);                                                </span>
<span class="-3072709309961217124" onmouseenter="enter('-3072709309961217124');" onmouseout="out('-3072709309961217124');" style=""> 455                     drs.setTotalRecords(0);                                                              </span>
<span class="8982521778669319238" onmouseenter="enter('8982521778669319238');" onmouseout="out('8982521778669319238');" style=""> 456                     drs.setStartIndex(0);                                                                </span>
<span class="-2316590965963048275" onmouseenter="enter('-2316590965963048275');" onmouseout="out('-2316590965963048275');" style=""> 457                     drs.setBatchId(1);                                                                   </span>
<span class="6524963296885553626" onmouseenter="enter('6524963296885553626');" onmouseout="out('6524963296885553626');" style=""> 458                     drs.setClassMetaData(null);                                                          </span>
<span class="5830489670252814572" onmouseenter="enter('5830489670252814572');" onmouseout="out('5830489670252814572');" style=""> 459                     drs.setPageSize(1);                                                                  </span>
<span class="-3474843426091445352" onmouseenter="enter('-3474843426091445352');" onmouseout="out('-3474843426091445352');" style=""> 460                     drs.setRecords(new Entity[0]);                                                       </span>
<span class="5333638146813618055" onmouseenter="enter('5333638146813618055');" onmouseout="out('5333638146813618055');" style=""> 461                     map.put(p.getName(), drs);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 462                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 464         }                                                                                                </span>
<span  style=""> 465                                                                                                          </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 466         return map;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467     }                                                                                                    </span>
<span  style=""> 468                                                                                                          </span>
<span class="-8906234562852924572" onmouseenter="enter('-8906234562852924572');" onmouseout="out('-8906234562852924572');" style=""><abbr title=" 469     protected void updateTabInfo(CollectionMetadata fmd, ClassMetadata cmd, String tabName, int tabOrder) {"> 469     protected void updateTabInfo(CollectionMetadata fmd, ClassMetadata cmd, String tabName, int tabOrder)ðŸ”µ</abbr></span>
<span class="6418671463533151954" onmouseenter="enter('6418671463533151954');" onmouseout="out('6418671463533151954');" style=""> 470         boolean tabInfoFound = false;                                                                    </span>
<span class="5408213491241477604" onmouseenter="enter('5408213491241477604');" onmouseout="out('5408213491241477604');" style=""> 471         Map&lt;String, TabMetadata&gt; tabMetadataMap = cmd.getTabAndGroupMetadata();                          </span>
<span class="-2540078251533437241" onmouseenter="enter('-2540078251533437241');" onmouseout="out('-2540078251533437241');" style=""> 472         for (String tabKey : tabMetadataMap.keySet()) {                                                  </span>
<span class="7583512444437065393" onmouseenter="enter('7583512444437065393');" onmouseout="out('7583512444437065393');" style=""> 473             Map&lt;String, GroupMetadata&gt; groupMetadataMap = tabMetadataMap.get(tabKey).getGroupMetadata(); </span>
<span class="-5526517230184735053" onmouseenter="enter('-5526517230184735053');" onmouseout="out('-5526517230184735053');" style=""> 474             for (String groupKey : groupMetadataMap.keySet()) {                                          </span>
<span class="98584842541508129" onmouseenter="enter('98584842541508129');" onmouseout="out('98584842541508129');" style=""><abbr title=" 475                 if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equals(fmd.getGroup())) {"> 475                 if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equaðŸ”µ</abbr></span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 476                     tabName = tabMetadataMap.get(tabKey).getTabName();                                   </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 477                     tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                 </span>
<span class="4945701621495059563" onmouseenter="enter('4945701621495059563');" onmouseout="out('4945701621495059563');" style=""> 478                     tabInfoFound = true;                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 479                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481             }                                                                                            </span>
<span class="1550248699436795528" onmouseenter="enter('1550248699436795528');" onmouseout="out('1550248699436795528');" style=""> 482             if (tabInfoFound) {                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 483                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484             }                                                                                            </span>
<span class="6331731299217129446" onmouseenter="enter('6331731299217129446');" onmouseout="out('6331731299217129446');" style=""> 485             if (tabKey.equals(tabName) || tabMetadataMap.get(tabKey).getTabName().equals(tabName)) {     </span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 486                 tabName = tabMetadataMap.get(tabKey).getTabName();                                       </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 487                 tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490     }                                                                                                    </span>
<span  style=""> 491                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 492     @Override                                                                                            </span>
<span class="978674739146073386" onmouseenter="enter('978674739146073386');" onmouseout="out('978674739146073386');" style=""><abbr title=" 493     public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field, Entity parentEntity, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException, ClassNotFoundException {"> 493     public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, ðŸ”µ</abbr></span>
<span class="-8197057147118619768" onmouseenter="enter('-8197057147118619768');" onmouseout="out('-8197057147118619768');" style=""> 494         // Assemble the properties from the entity form                                                  </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 495         List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                             </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 496         FieldMetadata md = field.getMetadata();                                                          </span>
<span class="-5515662251397603925" onmouseenter="enter('-5515662251397603925');" onmouseout="out('-5515662251397603925');" style=""><abbr title=" 497         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs).withEntity(new Entity());"> 497         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs).withEntðŸ”µ</abbr></span>
<span class="6854684741721952189" onmouseenter="enter('6854684741721952189');" onmouseout="out('6854684741721952189');" style=""> 498         ppr.getEntity().setIsPreAdd(parentEntity.isPreAdd());                                            </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 499         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="-996348376888288134" onmouseenter="enter('-996348376888288134');" onmouseout="out('-996348376888288134');" style=""> 500             BasicCollectionMetadata fmd = ((BasicCollectionMetadata) (md));                              </span>
<span class="4527283831819348025" onmouseenter="enter('4527283831819348025');" onmouseout="out('4527283831819348025');" style=""> 501             ppr.getEntity().setType(new String[]{ entityForm.getEntityType() });                         </span>
<span class="-2325626323266423717" onmouseenter="enter('-2325626323266423717');" onmouseout="out('-2325626323266423717');" style=""> 502             // If we&#x27;re looking up an entity instead of trying to create one on the fly, let&#x27;s make sure </span>
<span class="3526840633411573677" onmouseenter="enter('3526840633411573677');" onmouseout="out('3526840633411573677');" style=""><abbr title=" 503             // that we&#x27;re not changing the target entity at all and only creating the association to the id"> 503             // that we&#x27;re not changing the target entity at all and only creating the association to the ðŸ”µ</abbr></span>
<span class="-3426717809873890889" onmouseenter="enter('-3426717809873890889');" onmouseout="out('-3426717809873890889');" style=""><abbr title=" 504             if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP) || fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {"> 504             if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP) || fmd.getAddMethodType().equals(AddMðŸ”µ</abbr></span>
<span class="1728529167243720357" onmouseenter="enter('1728529167243720357');" onmouseout="out('1728529167243720357');" style=""> 505                 List&lt;String&gt; fieldsToRemove = new ArrayList&lt;String&gt;();                                   </span>
<span class="8261635343050838543" onmouseenter="enter('8261635343050838543');" onmouseout="out('8261635343050838543');" style=""> 506                 String idProp = getIdProperty(mainMetadata);                                             </span>
<span class="7372165960962811555" onmouseenter="enter('7372165960962811555');" onmouseout="out('7372165960962811555');" style=""> 507                 for (String key : entityForm.getFields().keySet()) {                                     </span>
<span class="-3969218055241208355" onmouseenter="enter('-3969218055241208355');" onmouseout="out('-3969218055241208355');" style=""> 508                     if (!idProp.equals(key)) {                                                           </span>
<span class="329726563907215496" onmouseenter="enter('329726563907215496');" onmouseout="out('329726563907215496');" style=""> 509                         fieldsToRemove.add(key);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511                 }                                                                                        </span>
<span class="-8204439459370995320" onmouseenter="enter('-8204439459370995320');" onmouseout="out('-8204439459370995320');" style=""> 512                 for (String key : fieldsToRemove) {                                                      </span>
<span class="-3002518314516620728" onmouseenter="enter('-3002518314516620728');" onmouseout="out('-3002518314516620728');" style=""> 513                     ListIterator&lt;Property&gt; li = properties.listIterator();                               </span>
<span class="-3598623445235132470" onmouseenter="enter('-3598623445235132470');" onmouseout="out('-3598623445235132470');" style=""> 514                     while (li.hasNext()) {                                                               </span>
<span class="-4936311913022510436" onmouseenter="enter('-4936311913022510436');" onmouseout="out('-4936311913022510436');" style=""> 515                         if (li.next().getName().equals(key)) {                                           </span>
<span class="-7629195606720709622" onmouseenter="enter('-7629195606720709622');" onmouseout="out('-7629195606720709622');" style=""> 516                             li.remove();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519                 }                                                                                        </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 520                 ppr.setValidateUnsubmittedProperties(false);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521             }                                                                                            </span>
<span class="-2511723907351376263" onmouseenter="enter('-2511723907351376263');" onmouseout="out('-2511723907351376263');" style=""> 522             if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                        </span>
<span class="4303470812456182979" onmouseenter="enter('4303470812456182979');" onmouseout="out('4303470812456182979');" style=""> 523                 ppr.setUpdateLookupType(true);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 524             }                                                                                            </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 525             Property fp = new Property();                                                                </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 526             fp.setName(ppr.getForeignKey().getManyToField());                                            </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 527             fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));  </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 528             properties.add(fp);                                                                          </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 529         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="3086234042815196151" onmouseenter="enter('3086234042815196151');" onmouseout="out('3086234042815196151');" style=""><abbr title=" 530             ppr.getEntity().setType(new String[]{ ppr.getAdornedList().getAdornedTargetEntityClassname() });"> 530             ppr.getEntity().setType(new String[]{ ppr.getAdornedList().getAdornedTargetEntityClassname() ðŸ”µ</abbr></span>
<span class="-5429442376258869769" onmouseenter="enter('-5429442376258869769');" onmouseout="out('-5429442376258869769');" style=""><abbr title=" 531             String[] maintainedFields = ((AdornedTargetCollectionMetadata) (md)).getMaintainedAdornedTargetFields();"> 531             String[] maintainedFields = ((AdornedTargetCollectionMetadata) (md)).getMaintainedAdornedTargðŸ”µ</abbr></span>
<span class="7919114190729069612" onmouseenter="enter('7919114190729069612');" onmouseout="out('7919114190729069612');" style=""> 532             if ((maintainedFields == null) || (maintainedFields.length == 0)) {                          </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 533                 ppr.setValidateUnsubmittedProperties(false);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 534             }                                                                                            </span>
<span class="6130424394313681013" onmouseenter="enter('6130424394313681013');" onmouseout="out('6130424394313681013');" style=""> 535             // Fix for an adorned target collection where the link is maintained from a                  </span>
<span class="-1209465127207262219" onmouseenter="enter('-1209465127207262219');" onmouseout="out('-1209465127207262219');" style=""> 536             // ToOne property on a main entity                                                           </span>
<span class="4704956230818847810" onmouseenter="enter('4704956230818847810');" onmouseout="out('4704956230818847810');" style=""><abbr title=" 537             String linkedProperty = (ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot;) + ppr.getAdornedList().getLinkedIdProperty();"> 537             String linkedProperty = (ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot;) + ppr.getAdornedLiðŸ”µ</abbr></span>
<span class="-7677283136075345929" onmouseenter="enter('-7677283136075345929');" onmouseout="out('-7677283136075345929');" style=""> 538             for (Property p : properties) {                                                              </span>
<span class="-6798041327943240930" onmouseenter="enter('-6798041327943240930');" onmouseout="out('-6798041327943240930');" style=""> 539                 if (p.getName().equals(linkedProperty)) {                                                </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""><abbr title=" 540                     p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));"> 540                     p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getNameðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 543         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="4527283831819348025" onmouseenter="enter('4527283831819348025');" onmouseout="out('4527283831819348025');" style=""> 544             ppr.getEntity().setType(new String[]{ entityForm.getEntityType() });                         </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 545             Property p = new Property();                                                                 </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 546             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 547             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 548             properties.add(p);                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 549         } else {                                                                                         </span>
<span class="3827268852064024242" onmouseenter="enter('3827268852064024242');" onmouseout="out('3827268852064024242');" style=""><abbr title=" 550             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; + &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));"> 550             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551         }                                                                                                </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 552         ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                     </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 553         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 554         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 555             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 557         ppr.setSectionEntityField(sectionField);                                                         </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 558         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 559         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 560             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 561         } else {                                                                                         </span>
<span class="1891301505194787668" onmouseenter="enter('1891301505194787668');" onmouseout="out('1891301505194787668');" style=""> 562             Property name = parentEntity.getPMap().get(&quot;name&quot;);                                          </span>
<span class="8801601261434726216" onmouseenter="enter('8801601261434726216');" onmouseout="out('8801601261434726216');" style=""> 563             if (name != null) {                                                                          </span>
<span class="-827206152183551520" onmouseenter="enter('-827206152183551520');" onmouseout="out('-827206152183551520');" style=""> 564                 ppr.setRequestingEntityName(name.getValue());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 565             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566         }                                                                                                </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 567         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 568         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 569         ppr.getEntity().setProperties(propArr);                                                          </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 570         return add(ppr);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 571     }                                                                                                    </span>
<span  style=""> 572                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 573     @Override                                                                                            </span>
<span class="-7675709464639024415" onmouseenter="enter('-7675709464639024415');" onmouseout="out('-7675709464639024415');" style=""><abbr title=" 574     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property"> 574     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadatðŸ”µ</abbr></span>
<span class="-2028598087534015745" onmouseenter="enter('-2028598087534015745');" onmouseout="out('-2028598087534015745');" style=""><abbr title=" 575             field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException, ClassNotFoundException {"> 575             field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ðŸ”µ</abbr></span>
<span class="5486792043368910160" onmouseenter="enter('5486792043368910160');" onmouseout="out('5486792043368910160');" style=""><abbr title=" 576         return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId, null, sectionCrumb);"> 576         return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577     }                                                                                                    </span>
<span  style=""> 578                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 579     @Override                                                                                            </span>
<span class="-8500453202004680860" onmouseenter="enter('-8500453202004680860');" onmouseout="out('-8500453202004680860');" style=""><abbr title=" 580     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field, Entity parentEntity, String collectionItemId, String alternateId, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException, ClassNotFoundException {"> 580     public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadatðŸ”µ</abbr></span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 581         List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                             </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 582         FieldMetadata md = field.getMetadata();                                                          </span>
<span class="-5515662251397603925" onmouseenter="enter('-5515662251397603925');" onmouseout="out('-5515662251397603925');" style=""><abbr title=" 583         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs).withEntity(new Entity());"> 583         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs).withEntðŸ”µ</abbr></span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 584         if (md instanceof BasicCollectionMetadata) {                                                     </span>
<span class="-996348376888288134" onmouseenter="enter('-996348376888288134');" onmouseout="out('-996348376888288134');" style=""> 585             BasicCollectionMetadata fmd = ((BasicCollectionMetadata) (md));                              </span>
<span class="226826482246311757" onmouseenter="enter('226826482246311757');" onmouseout="out('226826482246311757');" style=""> 586             ppr.setCeilingEntityClassname(fmd.getCollectionCeilingEntity());                             </span>
<span class="2848518480694514644" onmouseenter="enter('2848518480694514644');" onmouseout="out('2848518480694514644');" style=""> 587             ppr.getEntity().setType(new String[]{ fmd.getCollectionCeilingEntity() });                   </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 588             Property fp = new Property();                                                                </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 589             fp.setName(ppr.getForeignKey().getManyToField());                                            </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 590             fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));  </span>
<span class="8450408142962005401" onmouseenter="enter('8450408142962005401');" onmouseout="out('8450408142962005401');" style=""> 591             if (!properties.contains(fp)) {                                                              </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 592                 properties.add(fp);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593             }                                                                                            </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 594         } else if (md instanceof AdornedTargetCollectionMetadata) {                                      </span>
<span class="-736797126069743382" onmouseenter="enter('-736797126069743382');" onmouseout="out('-736797126069743382');" style=""> 595             String adornedTargetEntityClassname = ppr.getAdornedList().getAdornedTargetEntityClassname();</span>
<span class="-3984105731247699024" onmouseenter="enter('-3984105731247699024');" onmouseout="out('-3984105731247699024');" style=""> 596             ppr.setCeilingEntityClassname(adornedTargetEntityClassname);                                 </span>
<span class="-7359121964386012681" onmouseenter="enter('-7359121964386012681');" onmouseout="out('-7359121964386012681');" style=""> 597             ppr.getEntity().setType(new String[]{ adornedTargetEntityClassname });                       </span>
<span class="2404180692851035070" onmouseenter="enter('2404180692851035070');" onmouseout="out('2404180692851035070');" style=""> 598             for (Property property : properties) {                                                       </span>
<span class="1609017707919890941" onmouseenter="enter('1609017707919890941');" onmouseout="out('1609017707919890941');" style=""><abbr title=" 599                 if (property.getName().equals((ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot;) + ppr.getAdornedList().getLinkedIdProperty())) {"> 599                 if (property.getName().equals((ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot;) + ppr.geðŸ”µ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 600                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 601                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 602             }                                                                                            </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 603             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 604                 Property p = new Property();                                                             </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 605                 p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                 </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 606                 p.setValue(alternateId);                                                                 </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 607                 if (!properties.contains(p)) {                                                           </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 608                     properties.add(p);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 610             }                                                                                            </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 611         } else if (md instanceof MapMetadata) {                                                          </span>
<span class="4527283831819348025" onmouseenter="enter('4527283831819348025');" onmouseout="out('4527283831819348025');" style=""> 612             ppr.getEntity().setType(new String[]{ entityForm.getEntityType() });                         </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 613             Property p = new Property();                                                                 </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 614             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 615             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 616             properties.add(p);                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 617         } else {                                                                                         </span>
<span class="3827268852064024242" onmouseenter="enter('3827268852064024242');" onmouseout="out('3827268852064024242');" style=""><abbr title=" 618             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; + &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));"> 618             throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] wasðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 619         }                                                                                                </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 620         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 621         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 622             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 623         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 624         ppr.setSectionEntityField(sectionField);                                                         </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 625         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 626         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 627             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 628         }                                                                                                </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 629         Property p = new Property();                                                                     </span>
<span class="76365074730046782" onmouseenter="enter('76365074730046782');" onmouseout="out('76365074730046782');" style=""> 630         p.setName(entityForm.getIdProperty());                                                           </span>
<span class="-4252521779434663948" onmouseenter="enter('-4252521779434663948');" onmouseout="out('-4252521779434663948');" style=""> 631         p.setValue(collectionItemId);                                                                    </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 632         if (!properties.contains(p)) {                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 633             properties.add(p);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634         }                                                                                                </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 635         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 636         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 637         ppr.getEntity().setProperties(propArr);                                                          </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 638         return update(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639     }                                                                                                    </span>
<span  style=""> 640                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 641     @Override                                                                                            </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 642     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 642     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, EntiðŸ”µ</abbr></span>
<span class="7718985087288552750" onmouseenter="enter('7718985087288552750');" onmouseout="out('7718985087288552750');" style=""><abbr title=" 643                 String itemId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {"> 643                 String itemId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceExceptionðŸ”µ</abbr></span>
<span class="1153666597088080540" onmouseenter="enter('1153666597088080540');" onmouseout="out('1153666597088080540');" style=""><abbr title=" 644         return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectionCrumbs);"> 644         return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectiðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645     }                                                                                                    </span>
<span  style=""> 646                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 647     @Override                                                                                            </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 648     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 648     public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, EntiðŸ”µ</abbr></span>
<span class="-7641167286743654353" onmouseenter="enter('-7641167286743654353');" onmouseout="out('-7641167286743654353');" style=""><abbr title=" 649             String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {"> 649             String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ðŸ”µ</abbr></span>
<span class="6439752407856920746" onmouseenter="enter('6439752407856920746');" onmouseout="out('6439752407856920746');" style=""> 650         List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;();                                           </span>
<span  style=""> 651                                                                                                          </span>
<span class="-7639830684562317861" onmouseenter="enter('-7639830684562317861');" onmouseout="out('-7639830684562317861');" style=""> 652         Property p;                                                                                      </span>
<span class="5073856407409165319" onmouseenter="enter('5073856407409165319');" onmouseout="out('5073856407409165319');" style=""> 653         String parentId = getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()); </span>
<span  style=""> 654                                                                                                          </span>
<span class="255305470667416020" onmouseenter="enter('255305470667416020');" onmouseout="out('255305470667416020');" style=""><abbr title=" 655         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(field.getMetadata(), sectionCrumbs)"> 655         PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(field.getMetadata(), sectiðŸ”µ</abbr></span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 656                 .withEntity(new Entity());                                                               </span>
<span  style=""> 657                                                                                                          </span>
<span class="6642416971497632068" onmouseenter="enter('6642416971497632068');" onmouseout="out('6642416971497632068');" style=""> 658         if (field.getMetadata() instanceof BasicCollectionMetadata) {                                    </span>
<span class="5195082360751194411" onmouseenter="enter('5195082360751194411');" onmouseout="out('5195082360751194411');" style=""> 659             BasicCollectionMetadata fmd = (BasicCollectionMetadata) field.getMetadata();                 </span>
<span  style=""> 660                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 661             p = new Property();                                                                          </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 662             p.setName(&quot;id&quot;);                                                                             </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 663             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 664             properties.add(p);                                                                           </span>
<span  style=""> 665                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 666             p = new Property();                                                                          </span>
<span class="736571882968420419" onmouseenter="enter('736571882968420419');" onmouseout="out('736571882968420419');" style=""> 667             p.setName(ppr.getForeignKey().getManyToField());                                             </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 668             p.setValue(parentId);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 669             properties.add(p);                                                                           </span>
<span  style=""> 670                                                                                                          </span>
<span class="6632512256771168785" onmouseenter="enter('6632512256771168785');" onmouseout="out('6632512256771168785');" style=""> 671             ppr.getEntity().setType(new String[]{fmd.getCollectionCeilingEntity()});                     </span>
<span class="2294469176396117772" onmouseenter="enter('2294469176396117772');" onmouseout="out('2294469176396117772');" style=""> 672         } else if (field.getMetadata() instanceof AdornedTargetCollectionMetadata) {                     </span>
<span class="-1689031862376375101" onmouseenter="enter('-1689031862376375101');" onmouseout="out('-1689031862376375101');" style=""> 673             AdornedTargetList adornedList = ppr.getAdornedList();                                        </span>
<span  style=""> 674                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 675             p = new Property();                                                                          </span>
<span class="-8312107819432651962" onmouseenter="enter('-8312107819432651962');" onmouseout="out('-8312107819432651962');" style=""> 676             p.setName(adornedList.getLinkedObjectPath() + &quot;.&quot; + adornedList.getLinkedIdProperty());      </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 677             p.setValue(parentId);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 678             properties.add(p);                                                                           </span>
<span  style=""> 679                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 680             p = new Property();                                                                          </span>
<span class="371368176127783534" onmouseenter="enter('371368176127783534');" onmouseout="out('371368176127783534');" style=""> 681             p.setName(adornedList.getTargetObjectPath() + &quot;.&quot; + adornedList.getTargetIdProperty());      </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 682             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 683             properties.add(p);                                                                           </span>
<span  style=""> 684                                                                                                          </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 685             if (!StringUtils.isEmpty(alternateId)) {                                                     </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 686                 p = new Property();                                                                      </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 687                 p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                 </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 688                 p.setValue(alternateId);                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 689                 properties.add(p);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 690             }                                                                                            </span>
<span  style=""> 691                                                                                                          </span>
<span class="-2729449254338899005" onmouseenter="enter('-2729449254338899005');" onmouseout="out('-2729449254338899005');" style=""> 692             ppr.getEntity().setType(new String[]{adornedList.getAdornedTargetEntityClassname()});        </span>
<span class="7912118845776081771" onmouseenter="enter('7912118845776081771');" onmouseout="out('7912118845776081771');" style=""> 693         } else if (field.getMetadata() instanceof MapMetadata) {                                         </span>
<span class="2366674339618495793" onmouseenter="enter('2366674339618495793');" onmouseout="out('2366674339618495793');" style=""> 694             MapMetadata fmd = (MapMetadata) field.getMetadata();                                         </span>
<span  style=""> 695                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 696             p = new Property();                                                                          </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 697             p.setName(&quot;id&quot;);                                                                             </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 698             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 699             properties.add(p);                                                                           </span>
<span  style=""> 700                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 701             p = new Property();                                                                          </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 702             p.setName(&quot;symbolicId&quot;);                                                                     </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 703             p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 704             properties.add(p);                                                                           </span>
<span  style=""> 705                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 706             p = new Property();                                                                          </span>
<span class="-5579409047855153374" onmouseenter="enter('-5579409047855153374');" onmouseout="out('-5579409047855153374');" style=""> 707             p.setName(&quot;priorKey&quot;);                                                                       </span>
<span class="-4418910479857896781" onmouseenter="enter('-4418910479857896781');" onmouseout="out('-4418910479857896781');" style=""> 708             p.setValue(priorKey);                                                                        </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 709             properties.add(p);                                                                           </span>
<span  style=""> 710                                                                                                          </span>
<span class="6290651600977544526" onmouseenter="enter('6290651600977544526');" onmouseout="out('6290651600977544526');" style=""> 711             MapStructure mapStructure = ppr.getMapStructure();                                           </span>
<span  style=""> 712                                                                                                          </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 713             p = new Property();                                                                          </span>
<span class="-8796819570859336354" onmouseenter="enter('-8796819570859336354');" onmouseout="out('-8796819570859336354');" style=""> 714             p.setName(mapStructure.getKeyPropertyName());                                                </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 715             p.setValue(itemId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 716             properties.add(p);                                                                           </span>
<span  style=""> 717                                                                                                          </span>
<span class="-3538327046279125798" onmouseenter="enter('-3538327046279125798');" onmouseout="out('-3538327046279125798');" style=""> 718             ppr.getEntity().setType(new String[] { fmd.getTargetClass() });                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 719         }                                                                                                </span>
<span  style=""> 720                                                                                                          </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 721         ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                     </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 722         String sectionField = field.getName();                                                           </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 723         if (sectionField.contains(&quot;.&quot;)) {                                                                </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 724             sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 725         }                                                                                                </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 726         ppr.setSectionEntityField(sectionField);                                                         </span>
<span  style=""> 727                                                                                                          </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 728         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY); </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 729         if (parentNameProp != null) {                                                                    </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 730             ppr.setRequestingEntityName(parentNameProp.getValue());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 731         }                                                                                                </span>
<span  style=""> 732                                                                                                          </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 733         Property[] propArr = new Property[properties.size()];                                            </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 734         properties.toArray(propArr);                                                                     </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 735         ppr.getEntity().setProperties(propArr);                                                          </span>
<span  style=""> 736                                                                                                          </span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 737         return remove(ppr);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738     }                                                                                                    </span>
<span  style=""> 739                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 740     @Override                                                                                            </span>
<span class="4282644893410961184" onmouseenter="enter('4282644893410961184');" onmouseout="out('4282644893410961184');" style=""><abbr title=" 741     public String getContextSpecificRelationshipId(ClassMetadata cmd, Entity entity, String propertyName) {"> 741     public String getContextSpecificRelationshipId(ClassMetadata cmd, Entity entity, String propertyName)ðŸ”µ</abbr></span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style=""> 742         String prefix;                                                                                   </span>
<span class="-4471312176558876108" onmouseenter="enter('-4471312176558876108');" onmouseout="out('-4471312176558876108');" style=""> 743         if (propertyName.contains(&quot;.&quot;)) {                                                                </span>
<span class="1236521803185463300" onmouseenter="enter('1236521803185463300');" onmouseout="out('1236521803185463300');" style=""> 744             prefix = propertyName.substring(0, propertyName.lastIndexOf(&quot;.&quot;));                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 745         } else {                                                                                         </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style=""> 746             prefix = &quot;&quot;;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 747         }                                                                                                </span>
<span  style=""> 748                                                                                                          </span>
<span class="2108963067613019567" onmouseenter="enter('2108963067613019567');" onmouseout="out('2108963067613019567');" style=""> 749         if (prefix.equals(&quot;&quot;)) {                                                                         </span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 750             return entity.findProperty(&quot;id&quot;).getValue();                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 751         } else {                                                                                         </span>
<span class="2912662671806002044" onmouseenter="enter('2912662671806002044');" onmouseout="out('2912662671806002044');" style=""><abbr title=" 752             //we need to check all the parts of the prefix. For example, the prefix could include an @Embedded class like"> 752             //we need to check all the parts of the prefix. For example, the prefix could include an @EmbðŸ”µ</abbr></span>
<span class="-6847147968781015235" onmouseenter="enter('-6847147968781015235');" onmouseout="out('-6847147968781015235');" style=""><abbr title=" 753             //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the @Embedded does"> 753             //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the ðŸ”µ</abbr></span>
<span class="-9096360951865760456" onmouseenter="enter('-9096360951865760456');" onmouseout="out('-9096360951865760456');" style=""> 754             //not have an id property - nor should it.                                                   </span>
<span class="8843283418167771984" onmouseenter="enter('8843283418167771984');" onmouseout="out('8843283418167771984');" style=""> 755             String[] prefixParts = prefix.split(&quot;\\.&quot;);                                                  </span>
<span class="-7822949011963974832" onmouseenter="enter('-7822949011963974832');" onmouseout="out('-7822949011963974832');" style=""> 756             for (int j = 0; j &lt; prefixParts.length; j++) {                                               </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 757                 StringBuilder sb = new StringBuilder();                                                  </span>
<span class="2290448841761568128" onmouseenter="enter('2290448841761568128');" onmouseout="out('2290448841761568128');" style=""> 758                 for (int x = 0; x &lt; prefixParts.length - j; x++) {                                       </span>
<span class="1036821456394348565" onmouseenter="enter('1036821456394348565');" onmouseout="out('1036821456394348565');" style=""> 759                     sb.append(prefixParts[x]);                                                           </span>
<span class="837864378579548727" onmouseenter="enter('837864378579548727');" onmouseout="out('837864378579548727');" style=""> 760                     if (x &lt; prefixParts.length - j - 1) {                                                </span>
<span class="2682813583155160314" onmouseenter="enter('2682813583155160314');" onmouseout="out('2682813583155160314');" style=""> 761                         sb.append(&quot;.&quot;);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 762                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763                 }                                                                                        </span>
<span class="-7912523814943214188" onmouseenter="enter('-7912523814943214188');" onmouseout="out('-7912523814943214188');" style=""> 764                 String tempPrefix = sb.toString();                                                       </span>
<span  style=""> 765                                                                                                          </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 766                 for (Property property : entity.getProperties()) {                                       </span>
<span class="-7524924011426943089" onmouseenter="enter('-7524924011426943089');" onmouseout="out('-7524924011426943089');" style=""> 767                     if (property.getName().startsWith(tempPrefix)) {                                     </span>
<span class="-577685276283853994" onmouseenter="enter('-577685276283853994');" onmouseout="out('-577685276283853994');" style=""><abbr title=" 768                         //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the current prefix level"> 768                         //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the cðŸ”µ</abbr></span>
<span class="6988170330009622433" onmouseenter="enter('6988170330009622433');" onmouseout="out('6988170330009622433');" style=""><abbr title=" 769                         //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAttributes.id"> 769                         //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAðŸ”µ</abbr></span>
<span class="-1849094327471901943" onmouseenter="enter('-1849094327471901943');" onmouseout="out('-1849094327471901943');" style=""><abbr title=" 770                         if (StringUtils.countMatches(property.getName().replace(tempPrefix, &quot;&quot;), &quot;.&quot;) == 1) {"> 770                         if (StringUtils.countMatches(property.getName().replace(tempPrefix, &quot;&quot;), &quot;.&quot;) == ðŸ”µ</abbr></span>
<span class="-8594951258528203905" onmouseenter="enter('-8594951258528203905');" onmouseout="out('-8594951258528203905');" style=""> 771                             if (cmd.getPMap().containsKey(property.getName())) {                         </span>
<span class="-7732609283402352986" onmouseenter="enter('-7732609283402352986');" onmouseout="out('-7732609283402352986');" style=""><abbr title=" 772                                 BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.getName()).getMetadata();"> 772                                 BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.gðŸ”µ</abbr></span>
<span class="-2874474282821972662" onmouseenter="enter('-2874474282821972662');" onmouseout="out('-2874474282821972662');" style=""> 773                                 if (md.getFieldType().equals(SupportedFieldType.ID)) {                   </span>
<span class="-1836186832588240544" onmouseenter="enter('-1836186832588240544');" onmouseout="out('-1836186832588240544');" style=""> 774                                     return property.getValue();                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 775                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 777                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 778                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 781         }                                                                                                </span>
<span class="6467699841617564408" onmouseenter="enter('6467699841617564408');" onmouseout="out('6467699841617564408');" style=""> 782         if (!prefix.contains(&quot;.&quot;)) {                                                                     </span>
<span class="-6458727047245688221" onmouseenter="enter('-6458727047245688221');" onmouseout="out('-6458727047245688221');" style=""><abbr title=" 783             //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restrictedPriceLists on OfferImpl)"> 783             //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restricðŸ”µ</abbr></span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 784             return entity.findProperty(&quot;id&quot;).getValue();                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 785         }                                                                                                </span>
<span class="-8024958864039426916" onmouseenter="enter('-8024958864039426916');" onmouseout="out('-8024958864039426916');" style=""> 786         throw new RuntimeException(&quot;Unable to establish a relationship id&quot;);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 787     }                                                                                                    </span>
<span  style=""> 788                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 789     @Override                                                                                            </span>
<span class="-3908255710031606050" onmouseenter="enter('-3908255710031606050');" onmouseout="out('-3908255710031606050');" style=""> 790     public String getIdProperty(ClassMetadata cmd) throws ServiceException {                             </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 791         for (Property p : cmd.getProperties()) {                                                         </span>
<span class="-1029066852878262358" onmouseenter="enter('-1029066852878262358');" onmouseout="out('-1029066852878262358');" style=""> 792             if (p.getMetadata() instanceof BasicFieldMetadata) {                                         </span>
<span class="-5664285287189453326" onmouseenter="enter('-5664285287189453326');" onmouseout="out('-5664285287189453326');" style=""> 793                 BasicFieldMetadata fmd = (BasicFieldMetadata) p.getMetadata();                           </span>
<span class="513655466689307970" onmouseenter="enter('513655466689307970');" onmouseout="out('513655466689307970');" style=""><abbr title=" 794                 //check for ID type and also make sure the field we&#x27;re looking at is not a &quot;ToOne&quot; association"> 794                 //check for ID type and also make sure the field we&#x27;re looking at is not a &quot;ToOne&quot; associðŸ”µ</abbr></span>
<span class="-491768544454322511" onmouseenter="enter('-491768544454322511');" onmouseout="out('-491768544454322511');" style=""> 795                 if (SupportedFieldType.ID.equals(fmd.getFieldType()) &amp;&amp; !p.getName().contains(&quot;.&quot;)) {    </span>
<span class="-6048877223362319653" onmouseenter="enter('-6048877223362319653');" onmouseout="out('-6048877223362319653');" style=""> 796                     return p.getName();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 797                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 798             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 799         }                                                                                                </span>
<span  style=""> 800                                                                                                          </span>
<span class="-7942857982942474001" onmouseenter="enter('-7942857982942474001');" onmouseout="out('-7942857982942474001');" style=""> 801         throw new ServiceException(&quot;Could not determine ID field for &quot; + cmd.getCeilingType());          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 802     }                                                                                                    </span>
<span  style=""> 803                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 804     @Override                                                                                            </span>
<span class="-6109521015369402099" onmouseenter="enter('-6109521015369402099');" onmouseout="out('-6109521015369402099');" style=""> 805     public PersistenceResponse add(PersistencePackageRequest request) throws ServiceException {          </span>
<span class="-2588522872292014988" onmouseenter="enter('-2588522872292014988');" onmouseout="out('-2588522872292014988');" style=""> 806         return add(request, true);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 807     }                                                                                                    </span>
<span  style=""> 808                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 809     @Override                                                                                            </span>
<span class="8827553339909366249" onmouseenter="enter('8827553339909366249');" onmouseout="out('8827553339909366249');" style=""><abbr title=" 810     public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 810     public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 811         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 812         try {                                                                                            </span>
<span class="4836544755641051591" onmouseenter="enter('4836544755641051591');" onmouseout="out('4836544755641051591');" style=""> 813             if (request.isUpdateLookupType()) {                                                          </span>
<span class="-2082930136830103093" onmouseenter="enter('-2082930136830103093');" onmouseout="out('-2082930136830103093');" style=""> 814                 if (pkg.getSectionCrumbs() != null &amp;&amp; pkg.getSectionCrumbs().length &gt; 0) {               </span>
<span class="-6120347482693188577" onmouseenter="enter('-6120347482693188577');" onmouseout="out('-6120347482693188577');" style=""> 815                     SectionCrumb sc = pkg.getSectionCrumbs()[0];                                         </span>
<span class="7706557227331502134" onmouseenter="enter('7706557227331502134');" onmouseout="out('7706557227331502134');" style=""> 816                     if (StringUtils.isNotBlank(sc.getSectionIdentifier())) {                             </span>
<span class="7371017383769084435" onmouseenter="enter('7371017383769084435');" onmouseout="out('7371017383769084435');" style=""> 817                         pkg.setSecurityCeilingEntityFullyQualifiedClassname(sc.getSectionIdentifier());  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819                 }                                                                                        </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 820                 if (transactional) {                                                                     </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 821                     return service.update(pkg);                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 822                 } else {                                                                                 </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 823                     return service.nonTransactionalUpdate(pkg);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 825             } else {                                                                                     </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 826                 if (transactional) {                                                                     </span>
<span class="4552670565637379723" onmouseenter="enter('4552670565637379723');" onmouseout="out('4552670565637379723');" style=""> 827                     return service.add(pkg);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 828                 } else {                                                                                 </span>
<span class="6732121152740224457" onmouseenter="enter('6732121152740224457');" onmouseout="out('6732121152740224457');" style=""> 829                     return service.nonTransactionalAdd(pkg);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 830                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 831             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 832         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 833             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 834             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 835         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 836     }                                                                                                    </span>
<span  style=""> 837                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 838     @Override                                                                                            </span>
<span class="-2168493081511676385" onmouseenter="enter('-2168493081511676385');" onmouseout="out('-2168493081511676385');" style=""> 839     public PersistenceResponse update(PersistencePackageRequest request) throws ServiceException {       </span>
<span class="-1915092381367502552" onmouseenter="enter('-1915092381367502552');" onmouseout="out('-1915092381367502552');" style=""> 840         return update(request, true);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 841     }                                                                                                    </span>
<span  style=""> 842                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 843     @Override                                                                                            </span>
<span class="-3035175746782535545" onmouseenter="enter('-3035175746782535545');" onmouseout="out('-3035175746782535545');" style=""><abbr title=" 844     public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 844     public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws SeðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 845         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 846         try {                                                                                            </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 847             if (transactional) {                                                                         </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 848                 return service.update(pkg);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 849             } else {                                                                                     </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 850                 return service.nonTransactionalUpdate(pkg);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 851             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 852         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 853             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 854             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 856     }                                                                                                    </span>
<span  style=""> 857                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 858     @Override                                                                                            </span>
<span class="-1312385666630581282" onmouseenter="enter('-1312385666630581282');" onmouseout="out('-1312385666630581282');" style=""> 859     public PersistenceResponse inspect(PersistencePackageRequest request)                                </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 860             throws ServiceException {                                                                    </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 861         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="2565705442671799096" onmouseenter="enter('2565705442671799096');" onmouseout="out('2565705442671799096');" style=""> 862         return service.inspect(pkg);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 863     }                                                                                                    </span>
<span  style=""> 864                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 865     @Override                                                                                            </span>
<span class="-2409492513544163046" onmouseenter="enter('-2409492513544163046');" onmouseout="out('-2409492513544163046');" style=""> 866     public PersistenceResponse remove(PersistencePackageRequest request)                                 </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 867             throws ServiceException {                                                                    </span>
<span class="1818424953510541932" onmouseenter="enter('1818424953510541932');" onmouseout="out('1818424953510541932');" style=""> 868         return remove(request, true);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 869     }                                                                                                    </span>
<span  style=""> 870                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 871     @Override                                                                                            </span>
<span class="-9050585893076336114" onmouseenter="enter('-9050585893076336114');" onmouseout="out('-9050585893076336114');" style=""><abbr title=" 872     public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 872     public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws SeðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 873         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 874         try {                                                                                            </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 875             if (transactional) {                                                                         </span>
<span class="-5643605501598977706" onmouseenter="enter('-5643605501598977706');" onmouseout="out('-5643605501598977706');" style=""> 876                 return service.remove(pkg);                                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 877             } else {                                                                                     </span>
<span class="-8250836311704581891" onmouseenter="enter('-8250836311704581891');" onmouseout="out('-8250836311704581891');" style=""> 878                 return service.nonTransactionalRemove(pkg);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879             }                                                                                            </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 880         } catch (ValidationException e) {                                                                </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 881             ensureEntityMarkedAsValidationFailure(e, request);                                           </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 882             return new PersistenceResponse().withEntity(e.getEntity());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884     }                                                                                                    </span>
<span  style=""> 885                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 886     /**                                                                                                  </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 887      * &lt;p&gt;                                                                                               </span>
<span class="3729604611716511130" onmouseenter="enter('3729604611716511130');" onmouseout="out('3729604611716511130');" style=""><abbr title=" 888      * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} contained within the"> 888      * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} cðŸ”µ</abbr></span>
<span class="-7341678569298188314" onmouseenter="enter('-7341678569298188314');" onmouseout="out('-7341678569298188314');" style=""> 889      * given &lt;b&gt;originalRequest&lt;/b&gt; has a validationFailure = true                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 890      *                                                                                                   </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 891      * &lt;p&gt;                                                                                               </span>
<span class="-7716663654145973669" onmouseenter="enter('-7716663654145973669');" onmouseout="out('-7716663654145973669');" style=""><abbr title=" 892      * This will also check for a cause of {@link ConstraintViolationException} and add a gloal error to that."> 892      * This will also check for a cause of {@link ConstraintViolationException} and add a gloal error to ðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 893      */                                                                                                  </span>
<span class="807801721535748536" onmouseenter="enter('807801721535748536');" onmouseout="out('807801721535748536');" style=""><abbr title=" 894     protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequest originalRequest) {"> 894     protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequestðŸ”µ</abbr></span>
<span class="5399941146961217832" onmouseenter="enter('5399941146961217832');" onmouseout="out('5399941146961217832');" style=""> 895         if (e.containsCause(ConstraintViolationException.class)) {                                       </span>
<span class="-5214743212244855970" onmouseenter="enter('-5214743212244855970');" onmouseout="out('-5214743212244855970');" style=""> 896             e.getEntity().addGlobalValidationError(&quot;constraintViolationError&quot;);                          </span>
<span class="4509625189679774854" onmouseenter="enter('4509625189679774854');" onmouseout="out('4509625189679774854');" style=""> 897         } else if (!e.getEntity().isValidationFailure()) {                                               </span>
<span class="-4984910861440118934" onmouseenter="enter('-4984910861440118934');" onmouseout="out('-4984910861440118934');" style=""> 898             e.getEntity().setValidationFailure(true);                                                    </span>
<span class="-6792721057862982153" onmouseenter="enter('-6792721057862982153');" onmouseout="out('-6792721057862982153');" style=""> 899             e.getEntity().addGlobalValidationError(e.getMessage());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 900         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 901     }                                                                                                    </span>
<span  style=""> 902                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 903     @Override                                                                                            </span>
<span class="-4347820832692876212" onmouseenter="enter('-4347820832692876212');" onmouseout="out('-4347820832692876212');" style=""> 904     public PersistenceResponse fetch(PersistencePackageRequest request) throws ServiceException {        </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 905         PersistencePackage pkg = persistencePackageFactory.create(request);                              </span>
<span class="-5375974030412648260" onmouseenter="enter('-5375974030412648260');" onmouseout="out('-5375974030412648260');" style=""> 906         CriteriaTransferObject cto = getDefaultCto();                                                    </span>
<span class="-1800505558210996683" onmouseenter="enter('-1800505558210996683');" onmouseout="out('-1800505558210996683');" style=""> 907         if (request.getFilterAndSortCriteria() != null) {                                                </span>
<span class="629113105269586037" onmouseenter="enter('629113105269586037');" onmouseout="out('629113105269586037');" style=""> 908             cto.addAll(Arrays.asList(request.getFilterAndSortCriteria()));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 909         }                                                                                                </span>
<span class="-3823245946626813984" onmouseenter="enter('-3823245946626813984');" onmouseout="out('-3823245946626813984');" style=""> 910         if (request.getMaxResults() != null) {                                                           </span>
<span class="-8351200142276180335" onmouseenter="enter('-8351200142276180335');" onmouseout="out('-8351200142276180335');" style=""> 911             cto.setMaxResults(request.getMaxResults());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 912         }                                                                                                </span>
<span class="-690040157024225203" onmouseenter="enter('-690040157024225203');" onmouseout="out('-690040157024225203');" style=""> 913         if (request.getStartIndex() == null) {                                                           </span>
<span class="2764779885143665984" onmouseenter="enter('2764779885143665984');" onmouseout="out('2764779885143665984');" style=""> 914             cto.setFirstResult(0);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 915         } else {                                                                                         </span>
<span class="-6350611603682358812" onmouseenter="enter('-6350611603682358812');" onmouseout="out('-6350611603682358812');" style=""> 916             cto.setFirstResult(request.getStartIndex());                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 917         }                                                                                                </span>
<span class="-1342097346218425419" onmouseenter="enter('-1342097346218425419');" onmouseout="out('-1342097346218425419');" style=""> 918         if (request.getMaxIndex() != null) {                                                             </span>
<span class="3706232384854761975" onmouseenter="enter('3706232384854761975');" onmouseout="out('3706232384854761975');" style=""> 919             Integer startIndex = (request.getStartIndex() != null) ? request.getStartIndex() : 0;        </span>
<span class="-7608440079948637331" onmouseenter="enter('-7608440079948637331');" onmouseout="out('-7608440079948637331');" style=""> 920             int requestedMaxResults = (request.getMaxIndex() - startIndex) + 1;                          </span>
<span class="-4247304128979709189" onmouseenter="enter('-4247304128979709189');" onmouseout="out('-4247304128979709189');" style=""> 921             if ((requestedMaxResults &gt;= 0) &amp;&amp; (requestedMaxResults &lt; cto.getMaxResults())) {             </span>
<span class="-1275291600011289156" onmouseenter="enter('-1275291600011289156');" onmouseout="out('-1275291600011289156');" style=""> 922                 cto.setMaxResults(requestedMaxResults);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 923             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 924         }                                                                                                </span>
<span class="1589811072437566840" onmouseenter="enter('1589811072437566840');" onmouseout="out('1589811072437566840');" style=""> 925         cto.setLastId(request.getLastId());                                                              </span>
<span class="4489054305431733195" onmouseenter="enter('4489054305431733195');" onmouseout="out('4489054305431733195');" style=""> 926         cto.setFirstId(request.getFirstId());                                                            </span>
<span class="7683513281487176699" onmouseenter="enter('7683513281487176699');" onmouseout="out('7683513281487176699');" style=""> 927         cto.setUpperCount(request.getUpperCount());                                                      </span>
<span class="-8031307621948936245" onmouseenter="enter('-8031307621948936245');" onmouseout="out('-8031307621948936245');" style=""> 928         cto.setLowerCount(request.getLowerCount());                                                      </span>
<span class="63997933306934756" onmouseenter="enter('63997933306934756');" onmouseout="out('63997933306934756');" style=""> 929         if (request.getPageSize() != null) {                                                             </span>
<span class="-7018914636118190968" onmouseenter="enter('-7018914636118190968');" onmouseout="out('-7018914636118190968');" style=""> 930             cto.setMaxResults(request.getPageSize());                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931         }                                                                                                </span>
<span class="5284762326708873211" onmouseenter="enter('5284762326708873211');" onmouseout="out('5284762326708873211');" style=""> 932         cto.setPresentationFetch(request.getPresentationFetch());                                        </span>
<span class="8885053060558966919" onmouseenter="enter('8885053060558966919');" onmouseout="out('8885053060558966919');" style=""> 933         if (request.isFolderedLookup()) {                                                                </span>
<span class="3703526123616875051" onmouseenter="enter('3703526123616875051');" onmouseout="out('3703526123616875051');" style=""> 934             cto.setFolderLookup(true);                                                                   </span>
<span class="1820221740933941643" onmouseenter="enter('1820221740933941643');" onmouseout="out('1820221740933941643');" style=""> 935             cto.setFolderId(request.getFolderId());                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 936         }                                                                                                </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style=""> 937         if (extensionManager != null) {                                                                  </span>
<span class="371414988916191718" onmouseenter="enter('371414988916191718');" onmouseout="out('371414988916191718');" style=""> 938             extensionManager.getProxy().modifyFetchCriteriaTransferObject(request, cto);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 939         }                                                                                                </span>
<span class="-734873492845948502" onmouseenter="enter('-734873492845948502');" onmouseout="out('-734873492845948502');" style=""> 940         return service.fetch(pkg, cto);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 941     }                                                                                                    </span>
<span  style=""> 942                                                                                                          </span>
<span class="1747080010822063537" onmouseenter="enter('1747080010822063537');" onmouseout="out('1747080010822063537');" style=""> 943     protected CriteriaTransferObject getDefaultCto() {                                                   </span>
<span class="-7937218466133346867" onmouseenter="enter('-7937218466133346867');" onmouseout="out('-7937218466133346867');" style=""> 944         CriteriaTransferObject cto = new CriteriaTransferObject();                                       </span>
<span class="-792606519014114045" onmouseenter="enter('-792606519014114045');" onmouseout="out('-792606519014114045');" style=""> 945         cto.setMaxResults(getDefaultMaxResults());                                                       </span>
<span class="6058297727948666853" onmouseenter="enter('6058297727948666853');" onmouseout="out('6058297727948666853');" style=""> 946         return cto;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 947     }                                                                                                    </span>
<span  style=""> 948                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 949     @Override                                                                                            </span>
<span class="8883083618394394837" onmouseenter="enter('8883083618394394837');" onmouseout="out('8883083618394394837');" style=""> 950     public String getForeignEntityName(String owningClass, String id) {                                  </span>
<span class="-872554261283939929" onmouseenter="enter('-872554261283939929');" onmouseout="out('-872554261283939929');" style=""> 951         if (owningClass == null || id == null) {                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 952             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 953         }                                                                                                </span>
<span  style=""> 954                                                                                                          </span>
<span class="3468023357463508719" onmouseenter="enter('3468023357463508719');" onmouseout="out('3468023357463508719');" style=""> 955         DynamicEntityDao dynamicEntityDao = getDynamicEntityDao(owningClass);                            </span>
<span class="7635620295149838730" onmouseenter="enter('7635620295149838730');" onmouseout="out('7635620295149838730');" style=""> 956         Class&lt;?&gt; clazz = dynamicEntityDao.getImplClass(owningClass);                                     </span>
<span class="6841796057846720752" onmouseenter="enter('6841796057846720752');" onmouseout="out('6841796057846720752');" style=""> 957         Object foreignEntity = dynamicEntityDao.find(clazz, toIdFieldType(id, clazz));                   </span>
<span  style=""> 958                                                                                                          </span>
<span class="6094352409442952488" onmouseenter="enter('6094352409442952488');" onmouseout="out('6094352409442952488');" style=""> 959         if (foreignEntity instanceof AdminMainEntity) {                                                  </span>
<span class="-5844179197625315876" onmouseenter="enter('-5844179197625315876');" onmouseout="out('-5844179197625315876');" style=""> 960             return ((AdminMainEntity) foreignEntity).getMainEntityName();                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 961         }                                                                                                </span>
<span  style=""> 962                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 963         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 964     }                                                                                                    </span>
<span  style=""> 965                                                                                                          </span>
<span class="-1537571071296717959" onmouseenter="enter('-1537571071296717959');" onmouseout="out('-1537571071296717959');" style=""> 966     protected DynamicEntityDao getDynamicEntityDao(String owningClass) {                                 </span>
<span class="8951596410601292775" onmouseenter="enter('8951596410601292775');" onmouseout="out('8951596410601292775');" style=""> 967         return PersistenceManagerFactory.getPersistenceManager(owningClass).getDynamicEntityDao();       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 968     }                                                                                                    </span>
<span  style=""> 969                                                                                                          </span>
<span class="7239398670151774953" onmouseenter="enter('7239398670151774953');" onmouseout="out('7239398670151774953');" style=""> 970     protected int getDefaultMaxResults() {                                                               </span>
<span class="-1067455107038749142" onmouseenter="enter('-1067455107038749142');" onmouseout="out('-1067455107038749142');" style=""> 971         return BLCSystemProperty.resolveIntSystemProperty(&quot;admin.default.max.results&quot;, 50);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 972     }                                                                                                    </span>
<span  style=""> 973                                                                                                          </span>
<span class="8333077553386092776" onmouseenter="enter('8333077553386092776');" onmouseout="out('8333077553386092776');" style=""> 974     protected Object toIdFieldType(String id, Class&lt;?&gt; entityClass) {                                    </span>
<span class="4110349594135807695" onmouseenter="enter('4110349594135807695');" onmouseout="out('4110349594135807695');" style=""> 975         Class&lt;?&gt; idFieldClass = dynamicDaoHelper.getIdField(entityClass).getType();                      </span>
<span class="-6896169397974441548" onmouseenter="enter('-6896169397974441548');" onmouseout="out('-6896169397974441548');" style=""> 976         if (java.lang.Long.class.isAssignableFrom(idFieldClass)) {                                       </span>
<span class="5572754406141306162" onmouseenter="enter('5572754406141306162');" onmouseout="out('5572754406141306162');" style=""> 977             return Long.parseLong(id);                                                                   </span>
<span class="-8926467174013316531" onmouseenter="enter('-8926467174013316531');" onmouseout="out('-8926467174013316531');" style=""> 978         } else if (java.lang.Integer.class.isAssignableFrom(idFieldClass)) {                             </span>
<span class="3211402984454379456" onmouseenter="enter('3211402984454379456');" onmouseout="out('3211402984454379456');" style=""> 979             return Integer.parseInt(id);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 980         }                                                                                                </span>
<span class="-3074727595953522219" onmouseenter="enter('-3074727595953522219');" onmouseout="out('-3074727595953522219');" style=""> 981         return id;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 982     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 983 }                                                                                                        </span>





































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-3339060969767811416" onmouseenter="enter('-3339060969767811416');" onmouseout="out('-3339060969767811416');" style="">   3   * BroadleafCommerce Open Admin Platform                                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-8794511651793620694" onmouseenter="enter('-8794511651793620694');" onmouseout="out('-8794511651793620694');" style="">  18  package org.broadleafcommerce.openadmin.server.service;                                                           </span>
<span  style="">  19                                                                                                                    </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  20  import org.apache.commons.lang3.ArrayUtils;                                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="-6287859968194756382" onmouseenter="enter('-6287859968194756382');" onmouseout="out('-6287859968194756382');" style="">  24  import org.broadleafcommerce.common.admin.domain.AdminMainEntity;                                                 </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  25  import org.broadleafcommerce.common.exception.ServiceException;                                                   </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  26  import org.broadleafcommerce.common.persistence.EntityConfiguration;                                              </span>
<span class="-6648433550510659033" onmouseenter="enter('-6648433550510659033');" onmouseout="out('-6648433550510659033');" style="">  27  import org.broadleafcommerce.common.presentation.client.AddMethodType;                                            </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  28  import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                                       </span>
<span class="2428099238642943960" onmouseenter="enter('2428099238642943960');" onmouseout="out('2428099238642943960');" style="">  29  import org.broadleafcommerce.common.util.BLCMessageUtils;                                                         </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  30  import org.broadleafcommerce.common.util.BLCSystemProperty;                                                       </span>
<span class="5951235614759861305" onmouseenter="enter('5951235614759861305');" onmouseout="out('5951235614759861305');" style="">  31  import org.broadleafcommerce.common.util.dao.DynamicDaoHelper;                                                    </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  32  import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                                </span>
<span class="-3361215363157046739" onmouseenter="enter('-3361215363157046739');" onmouseout="out('-3361215363157046739');" style="">  33  import org.broadleafcommerce.openadmin.dto.AdornedTargetCollectionMetadata;                                       </span>
<span class="-1781055592725563383" onmouseenter="enter('-1781055592725563383');" onmouseout="out('-1781055592725563383');" style="">  34  import org.broadleafcommerce.openadmin.dto.AdornedTargetList;                                                     </span>
<span class="-6140296335181984013" onmouseenter="enter('-6140296335181984013');" onmouseout="out('-6140296335181984013');" style="">  35  import org.broadleafcommerce.openadmin.dto.BasicCollectionMetadata;                                               </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  36  import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                                    </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  37  import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                         </span>
<span class="-3165611006566133086" onmouseenter="enter('-3165611006566133086');" onmouseout="out('-3165611006566133086');" style="">  38  import org.broadleafcommerce.openadmin.dto.CollectionMetadata;                                                    </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  39  import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                                </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  40  import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                                      </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  41  import org.broadleafcommerce.openadmin.dto.Entity;                                                                </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  42  import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                         </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  43  import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                                 </span>
<span class="2672462771965160264" onmouseenter="enter('2672462771965160264');" onmouseout="out('2672462771965160264');" style="">  44  import org.broadleafcommerce.openadmin.dto.GroupMetadata;                                                         </span>
<span class="826821438795056004" onmouseenter="enter('826821438795056004');" onmouseout="out('826821438795056004');" style="">  45  import org.broadleafcommerce.openadmin.dto.MapMetadata;                                                           </span>
<span class="-7888875133556467044" onmouseenter="enter('-7888875133556467044');" onmouseout="out('-7888875133556467044');" style="">  46  import org.broadleafcommerce.openadmin.dto.MapStructure;                                                          </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  47  import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                                    </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  48  import org.broadleafcommerce.openadmin.dto.Property;                                                              </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  49  import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                          </span>
<span class="5662236005419086618" onmouseenter="enter('5662236005419086618');" onmouseout="out('5662236005419086618');" style="">  50  import org.broadleafcommerce.openadmin.dto.TabMetadata;                                                           </span>
<span class="2699062320492900877" onmouseenter="enter('2699062320492900877');" onmouseout="out('2699062320492900877');" style="">  51  import org.broadleafcommerce.openadmin.exception.EntityNotFoundException;                                         </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  52  import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                               </span>
<span class="-2178507335566770341" onmouseenter="enter('-2178507335566770341');" onmouseout="out('-2178507335566770341');" style="">  53  import org.broadleafcommerce.openadmin.server.domain.FetchPageRequest;                                            </span>
<span class="4410643013278245372" onmouseenter="enter('4410643013278245372');" onmouseout="out('4410643013278245372');" style="">  54  import org.broadleafcommerce.openadmin.server.domain.PersistencePackageRequest;                                   </span>
<span class="6597629584583725664" onmouseenter="enter('6597629584583725664');" onmouseout="out('6597629584583725664');" style="">  55  import org.broadleafcommerce.openadmin.server.factory.PersistencePackageFactory;                                  </span>

<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  56  import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;                      </span>
<span class="-8603256547657551769" onmouseenter="enter('-8603256547657551769');" onmouseout="out('-8603256547657551769');" style="">  57  import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceResponse;                            </span>
<span class="-3086540061138981164" onmouseenter="enter('-3086540061138981164');" onmouseout="out('-3086540061138981164');" style="">  58  import org.broadleafcommerce.openadmin.server.service.persistence.module.BasicPersistenceModule;                  </span>
<span class="-7452009352681558215" onmouseenter="enter('-7452009352681558215');" onmouseout="out('-7452009352681558215');" style="">  59  import org.broadleafcommerce.openadmin.web.form.entity.DynamicEntityFormInfo;                                     </span>
<span class="8035715143965725316" onmouseenter="enter('8035715143965725316');" onmouseout="out('8035715143965725316');" style="">  60  import org.broadleafcommerce.openadmin.web.form.entity.EntityForm;                                                </span>
<span class="6015559832933397076" onmouseenter="enter('6015559832933397076');" onmouseout="out('6015559832933397076');" style="">  61  import org.broadleafcommerce.openadmin.web.form.entity.Field;                                                     </span>
<span class="7834442097514100117" onmouseenter="enter('7834442097514100117');" onmouseout="out('7834442097514100117');" style="">  62  import org.broadleafcommerce.openadmin.web.form.entity.Tab;                                                       </span>
<span class="-5699213192866872541" onmouseenter="enter('-5699213192866872541');" onmouseout="out('-5699213192866872541');" style="">  63  import org.hibernate.exception.ConstraintViolationException;                                                      </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  64  import org.springframework.stereotype.Service;                                                                    </span>
<span  style="">  65                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  66  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  67  import java.util.Arrays;                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  68  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  69  import java.util.List;                                                                                            </span>
<span class="174663421494487417" onmouseenter="enter('174663421494487417');" onmouseout="out('174663421494487417');" style="">  70  import java.util.ListIterator;                                                                                    </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  71  import java.util.Map;                                                                                             </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  72  import java.util.Map.Entry;                                                                                       </span>
<span  style="">  73                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  74  import javax.annotation.Resource;                                                                                 </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  75  import javax.persistence.EntityManager;                                                                           </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  76  import javax.persistence.PersistenceContext;                                                                      </span>
<span  style="">  77                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  78  /**                                                                                                               </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  79   * @author Andre Azzolini (apazzolini)                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  80   */                                                                                                               </span>
<span class="2205005937568393687" onmouseenter="enter('2205005937568393687');" onmouseout="out('2205005937568393687');" style="">  81  @Service(&quot;blAdminEntityService&quot;)                                                                                  </span>
<span class="-2691323185499418706" onmouseenter="enter('-2691323185499418706');" onmouseout="out('-2691323185499418706');" style="">  82  public class AdminEntityServiceImpl implements AdminEntityService {                                               </span>
<span  style="">  83                                                                                                                    </span>
<span class="6898728355289688423" onmouseenter="enter('6898728355289688423');" onmouseout="out('6898728355289688423');" style="">  84      protected static final Log LOG = LogFactory.getLog(AdminEntityServiceImpl.class);                             </span>
<span  style="">  85                                                                                                                    </span>
<span class="6303589118895976221" onmouseenter="enter('6303589118895976221');" onmouseout="out('6303589118895976221');" style="">  86      @Resource(name = &quot;blDynamicEntityRemoteService&quot;)                                                              </span>
<span class="1505564706419640906" onmouseenter="enter('1505564706419640906');" onmouseout="out('1505564706419640906');" style="">  87      protected DynamicEntityService service;                                                                       </span>
<span  style="">  88                                                                                                                    </span>
<span class="-5295563268582613053" onmouseenter="enter('-5295563268582613053');" onmouseout="out('-5295563268582613053');" style="">  89      @Resource(name = &quot;blPersistencePackageFactory&quot;)                                                               </span>
<span class="5077122885687298736" onmouseenter="enter('5077122885687298736');" onmouseout="out('5077122885687298736');" style="">  90      protected PersistencePackageFactory persistencePackageFactory;                                                </span>
<span  style="">  91                                                                                                                    </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style="">  92      @PersistenceContext(unitName = &quot;blPU&quot;)                                                                        </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  93      protected EntityManager em;                                                                                   </span>
<span  style="">  94                                                                                                                    </span>
<span class="6650882675825573659" onmouseenter="enter('6650882675825573659');" onmouseout="out('6650882675825573659');" style="">  95      @Resource(name = &quot;blEntityConfiguration&quot;)                                                                     </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  96      protected EntityConfiguration entityConfiguration;                                                            </span>



<span  style="">  97                                                                                                                    </span>
<span class="6769863436851689394" onmouseenter="enter('6769863436851689394');" onmouseout="out('6769863436851689394');" style="">  98      protected DynamicDaoHelper dynamicDaoHelper = new DynamicDaoHelperImpl();                                     </span>
<span  style="">  99                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 100      @Override                                                                                                     </span>
<span class="689806418400872386" onmouseenter="enter('689806418400872386');" onmouseout="out('689806418400872386');" style=""> 101      public PersistenceResponse getClassMetadata(PersistencePackageRequest request)                                </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 102              throws ServiceException {                                                                             </span>
<span class="-477483751520958137" onmouseenter="enter('-477483751520958137');" onmouseout="out('-477483751520958137');" style=""> 103          PersistenceResponse response = inspect(request);                                                          </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 104          ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                                    </span>
<span class="4495915987564569811" onmouseenter="enter('4495915987564569811');" onmouseout="out('4495915987564569811');" style=""> 105          cmd.setCeilingType(request.getCeilingEntityClassname());                                                  </span>
<span class="-7633911880463002125" onmouseenter="enter('-7633911880463002125');" onmouseout="out('-7633911880463002125');" style=""> 106          cmd.setSecurityCeilingType(request.getSecurityCeilingEntityClassname());                                  </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 107          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108      }                                                                                                             </span>
<span  style=""> 109                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 110      @Override                                                                                                     </span>
<span class="6442257948747151854" onmouseenter="enter('6442257948747151854');" onmouseout="out('6442257948747151854');" style=""> 111      public PersistenceResponse getRecords(PersistencePackageRequest request) throws ServiceException {            </span>
<span class="-8968772654133629352" onmouseenter="enter('-8968772654133629352');" onmouseout="out('-8968772654133629352');" style=""> 112          return fetch(request);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113      }                                                                                                             </span>
<span  style=""> 114                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 115      @Override                                                                                                     </span>
<span class="4020809512296494224" onmouseenter="enter('4020809512296494224');" onmouseout="out('4020809512296494224');" style=""><abbr title=" 116      public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd, boolean isCollectionRequest)"> 116      public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd, boolean ðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 117              throws ServiceException {                                                                             </span>
<span class="-5399859376019632364" onmouseenter="enter('-5399859376019632364');" onmouseout="out('-5399859376019632364');" style=""> 118          String idProperty = getIdProperty(cmd);                                                                   </span>
<span  style=""> 119                                                                                                                    </span>
<span class="1207908904787390154" onmouseenter="enter('1207908904787390154');" onmouseout="out('1207908904787390154');" style=""> 120          FilterAndSortCriteria fasc = new FilterAndSortCriteria(idProperty);                                       </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 121          fasc.setFilterValue(id);                                                                                  </span>
<span class="-8339504512820574544" onmouseenter="enter('-8339504512820574544');" onmouseout="out('-8339504512820574544');" style=""> 122          request.addFilterAndSortCriteria(fasc);                                                                   </span>
<span  style=""> 123                                                                                                                    </span>
<span class="-1381837102214910163" onmouseenter="enter('-1381837102214910163');" onmouseout="out('-1381837102214910163');" style=""> 124          PersistenceResponse response = fetch(request);                                                            </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 125          Entity[] entities = response.getDynamicResultSet().getRecords();                                          </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 126          if (ArrayUtils.isEmpty(entities)) {                                                                       </span>
<span class="3317501704848962820" onmouseenter="enter('3317501704848962820');" onmouseout="out('3317501704848962820');" style=""> 127              String celiningEntity = request.getCeilingEntityClassname();                                          </span>
<span class="1970293616538386874" onmouseenter="enter('1970293616538386874');" onmouseout="out('1970293616538386874');" style=""><abbr title=" 128              throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiningEntity, id));"> 128              throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiningEntity,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129          }                                                                                                         </span>
<span  style=""> 130                                                                                                                    </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 131          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132      }                                                                                                             </span>
<span  style=""> 133                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 134      @Override                                                                                                     </span>
<span class="-7201975922678164147" onmouseenter="enter('-7201975922678164147');" onmouseout="out('-7201975922678164147');" style=""><abbr title=" 135      public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 135      public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectioðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""> 136          PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);        </span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 137          // If the entity form has dynamic forms inside of it, we need to persist those as well.                   </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 138          // They are typically done in their own custom persistence handlers, which will get triggered             </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 139          // based on the criteria specific in the PersistencePackage.                                              </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 140          for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                         </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 141              DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                           </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 143              if (info.getCustomCriteriaOverride() != null) {                                                       </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 144                  customCriteria = info.getCustomCriteriaOverride();                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 145              } else {                                                                                              </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 146                  String propertyName = info.getPropertyName();                                                     </span>
<span class="3293102538279717811" onmouseenter="enter('3293102538279717811');" onmouseout="out('3293102538279717811');" style=""> 147                  String propertyValue;                                                                             </span>
<span class="3903441351658368829" onmouseenter="enter('3903441351658368829');" onmouseout="out('3903441351658368829');" style=""> 148                  if (entityForm.getFields().containsKey(propertyName)) {                                           </span>
<span class="-3364727408470092918" onmouseenter="enter('-3364727408470092918');" onmouseout="out('-3364727408470092918');" style=""> 149                      propertyValue = entityForm.findField(propertyName).getValue();                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 150                  } else {                                                                                          </span>
<span class="6725656947693910623" onmouseenter="enter('6725656947693910623');" onmouseout="out('6725656947693910623');" style=""> 151                      propertyValue = info.getPropertyValue();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                  }                                                                                                 </span>
<span class="-5306746194951417463" onmouseenter="enter('-5306746194951417463');" onmouseout="out('-5306746194951417463');" style=""><abbr title=" 153                  customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue};"> 153                  customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, propertyVðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154              }                                                                                                     </span>
<span  style=""> 155                                                                                                                    </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 156              PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 156              PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectiðŸ”µ</abbr></span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 157              ppr.addSubRequest(info.getPropertyName(), subRequest);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158          }                                                                                                         </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 159          return add(ppr);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160      }                                                                                                             </span>
<span  style=""> 161                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 162      @Override                                                                                                     </span>
<span class="2877208390579447415" onmouseenter="enter('2877208390579447415');" onmouseout="out('2877208390579447415');" style=""><abbr title=" 163      public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 163      public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; secðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""> 164          PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);        </span>
<span class="5530250091258169917" onmouseenter="enter('5530250091258169917');" onmouseout="out('5530250091258169917');" style=""> 165          ppr.setRequestingEntityName(entityForm.getMainEntityName());                                              </span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 166          // If the entity form has dynamic forms inside of it, we need to persist those as well.                   </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 167          // They are typically done in their own custom persistence handlers, which will get triggered             </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 168          // based on the criteria specific in the PersistencePackage.                                              </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 169          for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                         </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 170              DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                           </span>
<span  style=""> 171                                                                                                                    </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 172              if (info.getCustomCriteriaOverride() != null) {                                                       </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 173                  customCriteria = info.getCustomCriteriaOverride();                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 174              } else {                                                                                              </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 175                  String propertyName = info.getPropertyName();                                                     </span>
<span class="8503945409701800913" onmouseenter="enter('8503945409701800913');" onmouseout="out('8503945409701800913');" style=""> 176                  String propertyValue = entityForm.findField(propertyName).getValue();                             </span>
<span class="-4083933246171517436" onmouseenter="enter('-4083933246171517436');" onmouseout="out('-4083933246171517436');" style=""><abbr title=" 177                  customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue };"> 177                  customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName, propertyðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178              }                                                                                                     </span>
<span  style=""> 179                                                                                                                    </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 180              PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 180              PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectiðŸ”µ</abbr></span>
<span class="3320363489874291671" onmouseenter="enter('3320363489874291671');" onmouseout="out('3320363489874291671');" style=""> 181              subRequest.withSecurityCeilingEntityClassname(info.getSecurityCeilingClassName());                    </span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 182              ppr.addSubRequest(info.getPropertyName(), subRequest);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183          }                                                                                                         </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 184          return update(ppr);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185      }                                                                                                             </span>
<span  style=""> 186                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 187      @Override                                                                                                     </span>
<span class="369147730756947995" onmouseenter="enter('369147730756947995');" onmouseout="out('369147730756947995');" style=""><abbr title=" 188      public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb)"> 188      public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; secðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 189              throws ServiceException {                                                                             </span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""> 190          PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);        </span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 191          return remove(ppr);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192      }                                                                                                             </span>
<span  style=""> 193                                                                                                                    </span>
<span class="-4457012513682950961" onmouseenter="enter('-4457012513682950961');" onmouseout="out('-4457012513682950961');" style=""> 194      protected List&lt;Property&gt; getPropertiesFromEntityForm(EntityForm entityForm) {                                 </span>
<span class="5502280122802762543" onmouseenter="enter('5502280122802762543');" onmouseout="out('5502280122802762543');" style=""> 195          List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;(entityForm.getFields().size());                       </span>
<span  style=""> 196                                                                                                                    </span>
<span class="-1983225226345189396" onmouseenter="enter('-1983225226345189396');" onmouseout="out('-1983225226345189396');" style=""> 197          for (Entry&lt;String, Field&gt; entry : entityForm.getFields().entrySet()) {                                    </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 198              Property p = new Property();                                                                          </span>
<span class="1947374185751812962" onmouseenter="enter('1947374185751812962');" onmouseout="out('1947374185751812962');" style=""> 199              p.setName(entry.getKey());                                                                            </span>
<span class="-7008764564116424461" onmouseenter="enter('-7008764564116424461');" onmouseout="out('-7008764564116424461');" style=""> 200              p.setValue(entry.getValue().getValue());                                                              </span>
<span class="4978688160201726577" onmouseenter="enter('4978688160201726577');" onmouseout="out('4978688160201726577');" style=""> 201              p.setDisplayValue(entry.getValue().getDisplayValue());                                                </span>
<span class="9200882176886832259" onmouseenter="enter('9200882176886832259');" onmouseout="out('9200882176886832259');" style=""> 202              p.setIsDirty(entry.getValue().getIsDirty());                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 203              properties.add(p);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204          }                                                                                                         </span>
<span  style=""> 205                                                                                                                    </span>
<span class="7053686412803007774" onmouseenter="enter('7053686412803007774');" onmouseout="out('7053686412803007774');" style=""> 206          return properties;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207      }                                                                                                             </span>
<span  style=""> 208                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +    @Override                                                                                                     </span>
<span class="7722997034713089523" onmouseenter="enter('7722997034713089523');" onmouseout="out('7722997034713089523');" style=""><abbr title=" 210      public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumbs) {"> 210      public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriteria, List&lt;ðŸ”µ</abbr></span>
<span class="-704234828580880941" onmouseenter="enter('-704234828580880941');" onmouseout="out('-704234828580880941');" style=""> 211          // Ensure the ID property is on the form                                                                  </span>
<span class="-5311876513799607800" onmouseenter="enter('-5311876513799607800');" onmouseout="out('-5311876513799607800');" style=""> 212          Field idField = entityForm.findField(entityForm.getIdProperty());                                         </span>
<span class="-5694238240637206409" onmouseenter="enter('-5694238240637206409');" onmouseout="out('-5694238240637206409');" style=""> 213          if (idField == null) {                                                                                    </span>
<span class="250587265755875585" onmouseenter="enter('250587265755875585');" onmouseout="out('250587265755875585');" style=""> 214              idField = new Field();                                                                                </span>
<span class="7054903396669057342" onmouseenter="enter('7054903396669057342');" onmouseout="out('7054903396669057342');" style=""> 215              idField.setName(entityForm.getIdProperty());                                                          </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 216              idField.setValue(entityForm.getId());                                                                 </span>
<span class="-7557326149225538579" onmouseenter="enter('-7557326149225538579');" onmouseout="out('-7557326149225538579');" style=""> 217              entityForm.getFields().put(entityForm.getIdProperty(), idField);                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 218          } else {                                                                                                  </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 219              idField.setValue(entityForm.getId());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220          }                                                                                                         </span>
<span  style=""> 221                                                                                                                    </span>
<span class="2582109723187805610" onmouseenter="enter('2582109723187805610');" onmouseout="out('2582109723187805610');" style=""> 222          List&lt;Property&gt; propList = getPropertiesFromEntityForm(entityForm);                                        </span>
<span class="-5301080913609099643" onmouseenter="enter('-5301080913609099643');" onmouseout="out('-5301080913609099643');" style=""> 223          Property[] properties = new Property[propList.size()];                                                    </span>
<span class="-3900695733940297394" onmouseenter="enter('-3900695733940297394');" onmouseout="out('-3900695733940297394');" style=""> 224          properties = propList.toArray(properties);                                                                </span>
<span  style=""> 225                                                                                                                    </span>
<span class="-4105415098036700385" onmouseenter="enter('-4105415098036700385');" onmouseout="out('-4105415098036700385');" style=""> 226          Entity entity = new Entity();                                                                             </span>
<span class="-2371781861505771230" onmouseenter="enter('-2371781861505771230');" onmouseout="out('-2371781861505771230');" style=""> 227          entity.setProperties(properties);                                                                         </span>
<span class="2583214667713512490" onmouseenter="enter('2583214667713512490');" onmouseout="out('2583214667713512490');" style=""> 228          String entityType = entityForm.getEntityType();                                                           </span>
<span class="-96692239825780670" onmouseenter="enter('-96692239825780670');" onmouseout="out('-96692239825780670');" style=""> 229          if (StringUtils.isEmpty(entityType)) {                                                                    </span>
<span class="-1511101492052020501" onmouseenter="enter('-1511101492052020501');" onmouseout="out('-1511101492052020501');" style=""> 230              entityType = entityForm.getCeilingEntityClassname();                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231          }                                                                                                         </span>
<span class="7921575741096618275" onmouseenter="enter('7921575741096618275');" onmouseout="out('7921575741096618275');" style=""> 232          entity.setType(new String[]{entityType});                                                                 </span>
<span  style=""> 233                                                                                                                    </span>
<span class="2943675610735544566" onmouseenter="enter('2943675610735544566');" onmouseout="out('2943675610735544566');" style=""> 234          PersistencePackageRequest ppr = PersistencePackageRequest.standard()                                      </span>
<span class="-2471313258794916634" onmouseenter="enter('-2471313258794916634');" onmouseout="out('-2471313258794916634');" style=""> 235                  .withEntity(entity)                                                                               </span>
<span class="5641680747003306930" onmouseenter="enter('5641680747003306930');" onmouseout="out('5641680747003306930');" style=""> 236                  .withCustomCriteria(customCriteria)                                                               </span>
<span class="3304977465026105541" onmouseenter="enter('3304977465026105541');" onmouseout="out('3304977465026105541');" style=""> 237                  .withCeilingEntityClassname(entityForm.getCeilingEntityClassname())                               </span>
<span class="-600959917227055027" onmouseenter="enter('-600959917227055027');" onmouseout="out('-600959917227055027');" style=""> 238                  .withSectionCrumbs(sectionCrumbs)                                                                 </span>
<span class="745722289441255857" onmouseenter="enter('745722289441255857');" onmouseout="out('745722289441255857');" style=""> 239                  .withRequestingEntityName(entityForm.getMainEntityName());                                        </span>
<span class="-1955805470028526694" onmouseenter="enter('-1955805470028526694');" onmouseout="out('-1955805470028526694');" style=""> 240          return ppr;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241      }                                                                                                             </span>
<span  style=""> 242                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 243      @Override                                                                                                     </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 244      public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 244      public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containinðŸ”µ</abbr></span>
<span class="6970881093397655354" onmouseenter="enter('6970881093397655354');" onmouseout="out('6970881093397655354');" style=""><abbr title=" 245              Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId)"> 245              Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternaðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 246              throws ServiceException {                                                                             </span>
<span class="-8379471421074460507" onmouseenter="enter('-8379471421074460507');" onmouseout="out('-8379471421074460507');" style=""><abbr title=" 247          return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty, collectionItemId, sectionCrumbs, alternateId, null);"> 247          return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty, collectiðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248      }                                                                                                             </span>
<span  style=""> 249                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 250      @Override                                                                                                     </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 251      public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 251      public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containinðŸ”µ</abbr></span>
<span class="-7996433221423208195" onmouseenter="enter('-7996433221423208195');" onmouseout="out('-7996433221423208195');" style=""><abbr title=" 252              Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId,"> 252              Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternaðŸ”µ</abbr></span>
<span class="4731322974144125980" onmouseenter="enter('4731322974144125980');" onmouseout="out('4731322974144125980');" style=""> 253              String[] customCriteria) throws ServiceException {                                                    </span>
<span class="-279994379320395128" onmouseenter="enter('-279994379320395128');" onmouseout="out('-279994379320395128');" style=""><abbr title=" 254          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs);"> 254          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sðŸ”µ</abbr></span>
<span  style=""> 255                                                                                                                    </span>
<span class="-1281430943574994988" onmouseenter="enter('-1281430943574994988');" onmouseout="out('-1281430943574994988');" style=""> 256          ppr.addCustomCriteria(customCriteria);                                                                    </span>
<span  style=""> 257                                                                                                                    </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 258          FieldMetadata md = collectionProperty.getMetadata();                                                      </span>
<span class="3724000031963826131" onmouseenter="enter('3724000031963826131');" onmouseout="out('3724000031963826131');" style=""> 259          String containingEntityId = getContextSpecificRelationshipId(containingClassMetadata, containingEntity,   </span>
<span class="-7103210414980095383" onmouseenter="enter('-7103210414980095383');" onmouseout="out('-7103210414980095383');" style=""> 260                  collectionProperty.getName());                                                                    </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 261          ppr.setSectionEntityField(collectionProperty.getName());                                                  </span>
<span  style=""> 262                                                                                                                    </span>
<span class="6887268983731320356" onmouseenter="enter('6887268983731320356');" onmouseout="out('6887268983731320356');" style=""> 263          PersistenceResponse response;                                                                             </span>
<span  style=""> 264                                                                                                                    </span>
<span class="-5961537470500127604" onmouseenter="enter('-5961537470500127604');" onmouseout="out('-5961537470500127604');" style=""> 265          if (md instanceof AdornedTargetCollectionMetadata) {                                                      </span>
<span class="8356058175939814254" onmouseenter="enter('8356058175939814254');" onmouseout="out('8356058175939814254');" style=""> 266              FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());</span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 267              fasc.setFilterValue(containingEntityId);                                                              </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 268              ppr.addFilterAndSortCriteria(fasc);                                                                   </span>
<span  style=""> 269                                                                                                                    </span>
<span class="-3458751872436187064" onmouseenter="enter('-3458751872436187064');" onmouseout="out('-3458751872436187064');" style=""> 270              fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName() + &quot;Target&quot;);           </span>
<span class="-3598598531395908508" onmouseenter="enter('-3598598531395908508');" onmouseout="out('-3598598531395908508');" style=""> 271              fasc.setFilterValue(collectionItemId);                                                                </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 272              ppr.addFilterAndSortCriteria(fasc);                                                                   </span>
<span  style=""> 273                                                                                                                    </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 274              if (!StringUtils.isEmpty(alternateId)) {                                                              </span>
<span class="-5748606955827926888" onmouseenter="enter('-5748606955827926888');" onmouseout="out('-5748606955827926888');" style=""> 275                  fasc = new FilterAndSortCriteria(ppr.getAdornedList().getIdProperty());                           </span>
<span class="7811712685421146637" onmouseenter="enter('7811712685421146637');" onmouseout="out('7811712685421146637');" style=""> 276                  fasc.setFilterValue(alternateId);                                                                 </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 277                  ppr.addFilterAndSortCriteria(fasc);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278              }                                                                                                     </span>
<span  style=""> 279                                                                                                                    </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 280              response = fetch(ppr);                                                                                </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 281              Entity[] entities = response.getDynamicResultSet().getRecords();                                      </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 282              if (ArrayUtils.isEmpty(entities)) {                                                                   </span>
<span class="-6945066260128413327" onmouseenter="enter('-6945066260128413327');" onmouseout="out('-6945066260128413327');" style=""> 283                  String altId = (!StringUtils.isEmpty(alternateId)) ? alternateId : &quot;&quot;;                            </span>
<span class="6252787461298878948" onmouseenter="enter('6252787461298878948');" onmouseout="out('6252787461298878948');" style=""><abbr title=" 284                  throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%s], id [%s], targetId [%s], alternateId [%s] &quot;,"> 284                  throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%s], id [%ðŸ”µ</abbr></span>
<span class="-631993348779519244" onmouseenter="enter('-631993348779519244');" onmouseout="out('-631993348779519244');" style=""><abbr title=" 285                          ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), containingEntityId, collectionItemId, altId));"> 285                          ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), containingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286              }                                                                                                     </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 287          } else if (md instanceof MapMetadata) {                                                                   </span>
<span class="8401290555692845532" onmouseenter="enter('8401290555692845532');" onmouseout="out('8401290555692845532');" style=""> 288              MapMetadata mmd = (MapMetadata) md;                                                                   </span>
<span class="-9165857322565832123" onmouseenter="enter('-9165857322565832123');" onmouseout="out('-9165857322565832123');" style=""> 289              FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());         </span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 290              fasc.setFilterValue(containingEntityId);                                                              </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 291              ppr.addFilterAndSortCriteria(fasc);                                                                   </span>
<span  style=""> 292                                                                                                                    </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 293              response = fetch(ppr);                                                                                </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 294              Entity[] entities = response.getDynamicResultSet().getRecords();                                      </span>
<span class="-7031469698370723184" onmouseenter="enter('-7031469698370723184');" onmouseout="out('-7031469698370723184');" style=""> 295              for (Entity e : entities) {                                                                           </span>
<span class="5353809260142967112" onmouseenter="enter('5353809260142967112');" onmouseout="out('5353809260142967112');" style=""> 296                  String idProperty = getIdProperty(containingClassMetadata);                                       </span>
<span class="5591331798883124479" onmouseenter="enter('5591331798883124479');" onmouseout="out('5591331798883124479');" style=""> 297                  if (mmd.isSimpleValue()) {                                                                        </span>
<span class="-4161155795101164165" onmouseenter="enter('-4161155795101164165');" onmouseout="out('-4161155795101164165');" style=""> 298                      idProperty = &quot;key&quot;;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299                  }                                                                                                 </span>
<span class="8921593406962610258" onmouseenter="enter('8921593406962610258');" onmouseout="out('8921593406962610258');" style=""> 300                  Property p = e.getPMap().get(idProperty);                                                         </span>
<span class="6407772199744557069" onmouseenter="enter('6407772199744557069');" onmouseout="out('6407772199744557069');" style=""> 301                  if (p.getValue().equals(collectionItemId)) {                                                      </span>
<span class="-7132868348925489606" onmouseenter="enter('-7132868348925489606');" onmouseout="out('-7132868348925489606');" style=""> 302                      response.setEntity(e);                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 303                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 305              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 306          } else {                                                                                                  </span>
<span class="8229323461389456522" onmouseenter="enter('8229323461389456522');" onmouseout="out('8229323461389456522');" style=""><abbr title=" 307              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not an &quot; +"> 307              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not an &quot;ðŸ”µ</abbr></span>
<span class="8394443338285651390" onmouseenter="enter('8394443338285651390');" onmouseout="out('8394443338285651390');" style=""><abbr title=" 308                      &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));"> 308                      &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309          }                                                                                                         </span>
<span  style=""> 310                                                                                                                    </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 311          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312      }                                                                                                             </span>
<span  style=""> 313                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 314      @Override                                                                                                     </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 315      public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 315      public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntðŸ”µ</abbr></span>
<span class="-8940960037863570008" onmouseenter="enter('-8940960037863570008');" onmouseout="out('-8940960037863570008');" style=""><abbr title=" 316              Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 316              Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex, ListðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 317              throws ServiceException {                                                                             </span>
<span class="4618756740023180601" onmouseenter="enter('4618756740023180601');" onmouseout="out('4618756740023180601');" style=""><abbr title=" 318          return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, startIndex,"> 318          return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, startðŸ”µ</abbr></span>
<span class="2241863538673887409" onmouseenter="enter('2241863538673887409');" onmouseout="out('2241863538673887409');" style=""> 319                  maxIndex, null, sectionCrumb);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320      }                                                                                                             </span>
<span  style=""> 321                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 322      @Override                                                                                                     </span>
<span class="-7201231903947653503" onmouseenter="enter('-7201231903947653503');" onmouseout="out('-7201231903947653503');" style=""><abbr title=" 323      public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 323      public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, Entity containiðŸ”µ</abbr></span>
<span class="418251651311673518" onmouseenter="enter('418251651311673518');" onmouseout="out('418251651311673518');" style=""> 324              Property collectionProperty, FilterAndSortCriteria[] fascs, FetchPageRequest fetchPageRequest,        </span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 325              String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {                   </span>
<span class="7874520314895198323" onmouseenter="enter('7874520314895198323');" onmouseout="out('7874520314895198323');" style=""><abbr title=" 326          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs)"> 326          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sðŸ”µ</abbr></span>
<span class="-7469251084029012642" onmouseenter="enter('-7469251084029012642');" onmouseout="out('-7469251084029012642');" style=""> 327              .withFilterAndSortCriteria(fascs)                                                                     </span>
<span class="-7573135850576319031" onmouseenter="enter('-7573135850576319031');" onmouseout="out('-7573135850576319031');" style=""> 328              .withStartIndex(fetchPageRequest.getStartIndex())                                                     </span>
<span class="-3581511696188385312" onmouseenter="enter('-3581511696188385312');" onmouseout="out('-3581511696188385312');" style=""> 329              .withMaxIndex(fetchPageRequest.getMaxIndex())                                                         </span>
<span class="-8590301553347003975" onmouseenter="enter('-8590301553347003975');" onmouseout="out('-8590301553347003975');" style=""> 330              .withFirstId(fetchPageRequest.getFirstId())                                                           </span>
<span class="2671174632142808768" onmouseenter="enter('2671174632142808768');" onmouseout="out('2671174632142808768');" style=""> 331              .withLastId(fetchPageRequest.getLastId())                                                             </span>
<span class="-6593991434037097050" onmouseenter="enter('-6593991434037097050');" onmouseout="out('-6593991434037097050');" style=""> 332              .withLowerCount(fetchPageRequest.getLowerCount())                                                     </span>
<span class="-117029417959198312" onmouseenter="enter('-117029417959198312');" onmouseout="out('-117029417959198312');" style=""> 333              .withUpperCount(fetchPageRequest.getUpperCount())                                                     </span>
<span class="-4278016885305366423" onmouseenter="enter('-4278016885305366423');" onmouseout="out('-4278016885305366423');" style=""> 334              .withPageSize(fetchPageRequest.getPageSize())                                                         </span>
<span class="-6582704259903712752" onmouseenter="enter('-6582704259903712752');" onmouseout="out('-6582704259903712752');" style=""> 335              .withPresentationFetch(true);                                                                         </span>
<span  style=""> 336                                                                                                                    </span>
<span class="-3273025574919321412" onmouseenter="enter('-3273025574919321412');" onmouseout="out('-3273025574919321412');" style=""> 337          FilterAndSortCriteria fasc;                                                                               </span>
<span  style=""> 338                                                                                                                    </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 339          FieldMetadata md = collectionProperty.getMetadata();                                                      </span>
<span class="-4862294775264679708" onmouseenter="enter('-4862294775264679708');" onmouseout="out('-4862294775264679708');" style=""> 340          String collectionCeilingClass = null;                                                                     </span>
<span  style=""> 341                                                                                                                    </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 342          if (md instanceof BasicCollectionMetadata) {                                                              </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 343              fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                               </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 344              collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();                      </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 345          } else if (md instanceof AdornedTargetCollectionMetadata) {                                               </span>
<span class="5713965317772328276" onmouseenter="enter('5713965317772328276');" onmouseout="out('5713965317772328276');" style=""> 346              fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());                      </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 347              collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();                      </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 348          } else if (md instanceof MapMetadata) {                                                                   </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 349              fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 350          } else {                                                                                                  </span>
<span class="-7764689527754153249" onmouseenter="enter('-7764689527754153249');" onmouseout="out('-7764689527754153249');" style=""><abbr title=" 351              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not a &quot; +"> 351              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not a &quot; ðŸ”µ</abbr></span>
<span class="9018729105513046766" onmouseenter="enter('9018729105513046766');" onmouseout="out('9018729105513046766');" style=""> 352                      &quot;collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353          }                                                                                                         </span>
<span  style=""> 354                                                                                                                    </span>
<span class="4254518413777245486" onmouseenter="enter('4254518413777245486');" onmouseout="out('4254518413777245486');" style=""> 355          String id;                                                                                                </span>
<span class="4803324110888028956" onmouseenter="enter('4803324110888028956');" onmouseout="out('4803324110888028956');" style=""> 356          if (idValueOverride == null) {                                                                            </span>
<span class="-7725769379673096748" onmouseenter="enter('-7725769379673096748');" onmouseout="out('-7725769379673096748');" style=""><abbr title=" 357              id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionProperty.getName());"> 357              id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionProperty.geðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 358          } else {                                                                                                  </span>
<span class="-8702106967230782193" onmouseenter="enter('-8702106967230782193');" onmouseout="out('-8702106967230782193');" style=""> 359              id = idValueOverride;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 360          }                                                                                                         </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 361          fasc.setFilterValue(id);                                                                                  </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 362          ppr.addFilterAndSortCriteria(fasc);                                                                       </span>
<span  style=""> 363                                                                                                                    </span>
<span class="427990645680582522" onmouseenter="enter('427990645680582522');" onmouseout="out('427990645680582522');" style=""> 364          if (collectionCeilingClass != null) {                                                                     </span>
<span class="-6816699203213465846" onmouseenter="enter('-6816699203213465846');" onmouseout="out('-6816699203213465846');" style=""> 365              ppr.setCeilingEntityClassname(collectionCeilingClass);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366          }                                                                                                         </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 367          ppr.setSectionEntityField(collectionProperty.getName());                                                  </span>
<span  style=""> 368                                                                                                                    </span>
<span class="4509000565359254391" onmouseenter="enter('4509000565359254391');" onmouseout="out('4509000565359254391');" style=""> 369          return fetch(ppr);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 370      }                                                                                                             </span>
<span  style=""> 371                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 372      @Override                                                                                                     </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 373      public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 373      public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntðŸ”µ</abbr></span>
<span class="509622451136715712" onmouseenter="enter('509622451136715712');" onmouseout="out('509622451136715712');" style=""> 374              Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex,     </span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 375              String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {                   </span>
<span class="-1197294568643910019" onmouseenter="enter('-1197294568643910019');" onmouseout="out('-1197294568643910019');" style=""> 376          FetchPageRequest pageRequest = new FetchPageRequest().withStartIndex(startIndex).withMaxIndex(maxIndex);  </span>
<span class="-1074537376579155932" onmouseenter="enter('-1074537376579155932');" onmouseout="out('-1074537376579155932');" style=""> 377          return getPagedRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, </span>
<span class="-3163237569846875940" onmouseenter="enter('-3163237569846875940');" onmouseout="out('-3163237569846875940');" style=""> 378                  pageRequest, idValueOverride, sectionCrumbs);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379      }                                                                                                             </span>
<span  style=""> 380                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 381      @Override                                                                                                     </span>
<span class="-3841297295714521949" onmouseenter="enter('-3841297295714521949');" onmouseout="out('-3841297295714521949');" style=""><abbr title=" 382      public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 382      public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity contðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 383              throws ServiceException {                                                                             </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 384          Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                              </span>
<span  style=""> 385                                                                                                                    </span>
<span class="-733567857055224528" onmouseenter="enter('-733567857055224528');" onmouseout="out('-733567857055224528');" style=""> 386          PersistenceResponse response = getClassMetadata(ppr);                                                     </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 387          ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                                    </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 388          for (Property p : cmd.getProperties()) {                                                                  </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 389              if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])         </span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 390                      &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                           </span>
<span class="8095643692447388517" onmouseenter="enter('8095643692447388517');" onmouseout="out('8095643692447388517');" style=""><abbr title=" 391                  PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, startIndex, maxIndex, sectionCrumb);"> 391                  PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, startIndexðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 392                  map.put(p.getName(), response2.getDynamicResultSet());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394          }                                                                                                         </span>
<span  style=""> 395                                                                                                                    </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 396          return map;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397      }                                                                                                             </span>
<span  style=""> 398                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 399      @Override                                                                                                     </span>
<span class="-3628970257678085943" onmouseenter="enter('-3628970257678085943');" onmouseout="out('-3628970257678085943');" style=""><abbr title=" 400      public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity containingEntity,"> 400      public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity containingEntðŸ”µ</abbr></span>
<span class="-4231090245204295086" onmouseenter="enter('-4231090245204295086');" onmouseout="out('-4231090245204295086');" style=""><abbr title=" 401                                                                             List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 401                                                                             List&lt;SectionCrumb&gt; sectionCrumb) throwsðŸ”µ</abbr></span>
<span class="-2409741133586104337" onmouseenter="enter('-2409741133586104337');" onmouseout="out('-2409741133586104337');" style=""> 402          Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;&gt;();                                                      </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 403          for (Property p : cmd.getProperties()) {                                                                  </span>
<span class="4164210101311278906" onmouseenter="enter('4164210101311278906');" onmouseout="out('4164210101311278906');" style=""> 404              FieldMetadata fieldMetadata = p.getMetadata();                                                        </span>
<span class="-4624883475289984299" onmouseenter="enter('-4624883475289984299');" onmouseout="out('-4624883475289984299');" style=""><abbr title=" 405              boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEntity.getType()[0]);"> 405              boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEntity.getðŸ”µ</abbr></span>
<span class="527509468046610128" onmouseenter="enter('527509468046610128');" onmouseout="out('527509468046610128');" style=""> 406              if (fieldAvailable &amp;&amp; fieldMetadata instanceof CollectionMetadata) {                                  </span>
<span class="889550045664327310" onmouseenter="enter('889550045664327310');" onmouseout="out('889550045664327310');" style=""> 407                  FetchPageRequest pageRequest = new FetchPageRequest()                                             </span>
<span class="7756015397659671998" onmouseenter="enter('7756015397659671998');" onmouseout="out('7756015397659671998');" style=""> 408                          .withPageSize(Integer.MAX_VALUE);                                                         </span>
<span class="-5742395122034161641" onmouseenter="enter('-5742395122034161641');" onmouseout="out('-5742395122034161641');" style=""><abbr title=" 409                  PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pageRequest, null, sectionCrumb);"> 409                  PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pageRequesðŸ”µ</abbr></span>
<span class="7448530828258193539" onmouseenter="enter('7448530828258193539');" onmouseout="out('7448530828258193539');" style=""> 410                  map.put(p.getName(), resp.getDynamicResultSet());                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 411              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412          }                                                                                                         </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 413          return map;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414      }                                                                                                             </span>
<span  style=""> 415                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 416      @Override                                                                                                     </span>
<span class="3589590817922421749" onmouseenter="enter('3589590817922421749');" onmouseout="out('3589590817922421749');" style=""><abbr title=" 417      public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb)"> 417      public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity contðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 418              throws ServiceException {                                                                             </span>
<span  style=""> 419                                                                                                                    </span>
<span class="7186594912669123504" onmouseenter="enter('7186594912669123504');" onmouseout="out('7186594912669123504');" style=""> 420          return getRecordsForAllSubCollections(ppr, containingEntity, null, null, sectionCrumb);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421      }                                                                                                             </span>
<span  style=""> 422                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 423      @Override                                                                                                     </span>
<span class="-7386306397684799123" onmouseenter="enter('-7386306397684799123');" onmouseout="out('-7386306397684799123');" style=""><abbr title=" 424      public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb,"> 424      public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntity, ListðŸ”µ</abbr></span>
<span class="-5959215544738911709" onmouseenter="enter('-5959215544738911709');" onmouseout="out('-5959215544738911709');" style=""> 425              String currentTabName) throws ServiceException {                                                      </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 426          Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                              </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 427          for (Property p : cmd.getProperties()) {                                                                  </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 428              if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])         </span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 429                      &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                           </span>
<span  style=""> 430                                                                                                                    </span>
<span class="-8882071661255371966" onmouseenter="enter('-8882071661255371966');" onmouseout="out('-8882071661255371966');" style=""> 431                  CollectionMetadata collectionMetadata = (CollectionMetadata) p.getMetadata();                     </span>
<span  style=""> 432                                                                                                                    </span>
<span class="-6866172471902490379" onmouseenter="enter('-6866172471902490379');" onmouseout="out('-6866172471902490379');" style=""> 433                  // Give preference to the Group since EntityForm.addListGrid() gives preference to the Group      </span>
<span class="5847566346942070760" onmouseenter="enter('5847566346942070760');" onmouseout="out('5847566346942070760');" style=""> 434                  TabMetadata tabMetadata = cmd.getTabMetadataUsingGroupKey(collectionMetadata.getGroup());         </span>
<span class="5004852122593217272" onmouseenter="enter('5004852122593217272');" onmouseout="out('5004852122593217272');" style=""> 435                  if (tabMetadata == null) {                                                                        </span>
<span class="231191347318133709" onmouseenter="enter('231191347318133709');" onmouseout="out('231191347318133709');" style=""> 436                      tabMetadata = cmd.getTabMetadataUsingTabKey(collectionMetadata.getTab());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437                  }                                                                                                 </span>
<span  style=""> 438                                                                                                                    </span>
<span class="-3015386838727954630" onmouseenter="enter('-3015386838727954630');" onmouseout="out('-3015386838727954630');" style=""> 439                  String tabName = tabMetadata == null ? collectionMetadata.getTab() : tabMetadata.getTabName();    </span>
<span class="-7179383252706615246" onmouseenter="enter('-7179383252706615246');" onmouseout="out('-7179383252706615246');" style=""> 440                  int tabOrder = tabMetadata == null ? collectionMetadata.getTabOrder() : tabMetadata.getTabOrder();</span>
<span class="-1384994182862418254" onmouseenter="enter('-1384994182862418254');" onmouseout="out('-1384994182862418254');" style=""> 441                  updateTabInfo(collectionMetadata, cmd, tabName, tabOrder);                                        </span>
<span  style=""> 442                                                                                                                    </span>
<span class="8686774820240993219" onmouseenter="enter('8686774820240993219');" onmouseout="out('8686774820240993219');" style=""> 443                  if (collectionMetadata.getLazyFetch() != null &amp;&amp; collectionMetadata.getLazyFetch()                </span>
<span class="5105727312979860339" onmouseenter="enter('5105727312979860339');" onmouseout="out('5105727312979860339');" style=""> 444                          &amp;&amp; tabName.toUpperCase().startsWith(currentTabName.toUpperCase())                         </span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 445                          &amp;&amp; !collectionMetadata.getManualFetch()) {                                                </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 446                      PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 446                      PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, ðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 447                      map.put(p.getName(), response2.getDynamicResultSet());                                        </span>
<span class="8148681537408196343" onmouseenter="enter('8148681537408196343');" onmouseout="out('8148681537408196343');" style=""> 448                  } else if (collectionMetadata.getLazyFetch() != null &amp;&amp; !collectionMetadata.getLazyFetch()        </span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 449                          &amp;&amp; !collectionMetadata.getManualFetch()) {                                                </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 450                      PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 450                      PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, ðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 451                      map.put(p.getName(), response2.getDynamicResultSet());                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 452                  } else {                                                                                          </span>
<span class="4201070416549217756" onmouseenter="enter('4201070416549217756');" onmouseout="out('4201070416549217756');" style=""> 453                      DynamicResultSet drs = new DynamicResultSet();                                                </span>
<span class="133064617150058408" onmouseenter="enter('133064617150058408');" onmouseout="out('133064617150058408');" style=""> 454                      Map&lt;String, Tab&gt; tabMap = new HashMap&lt;String, Tab&gt;();                                         </span>
<span class="52154028506366978" onmouseenter="enter('52154028506366978');" onmouseout="out('52154028506366978');" style=""> 455                      Tab tab = new Tab();                                                                          </span>
<span class="7573724056713363868" onmouseenter="enter('7573724056713363868');" onmouseout="out('7573724056713363868');" style=""> 456                      tab.setKey(tabName);                                                                          </span>
<span class="6935872114105155637" onmouseenter="enter('6935872114105155637');" onmouseout="out('6935872114105155637');" style=""> 457                      tab.setTitle(BLCMessageUtils.getMessage(tabName));                                            </span>
<span class="-3862389491808527983" onmouseenter="enter('-3862389491808527983');" onmouseout="out('-3862389491808527983');" style=""> 458                      tab.setOrder(tabOrder);                                                                       </span>
<span class="-8730262596017656059" onmouseenter="enter('-8730262596017656059');" onmouseout="out('-8730262596017656059');" style=""> 459                      tabMap.put(tab.getTitle(), tab);                                                              </span>
<span class="6973540073738050016" onmouseenter="enter('6973540073738050016');" onmouseout="out('6973540073738050016');" style=""> 460                      drs.setUnselectedTabMetadata(tabMap);                                                         </span>
<span class="-3072709309961217124" onmouseenter="enter('-3072709309961217124');" onmouseout="out('-3072709309961217124');" style=""> 461                      drs.setTotalRecords(0);                                                                       </span>
<span class="8982521778669319238" onmouseenter="enter('8982521778669319238');" onmouseout="out('8982521778669319238');" style=""> 462                      drs.setStartIndex(0);                                                                         </span>
<span class="-2316590965963048275" onmouseenter="enter('-2316590965963048275');" onmouseout="out('-2316590965963048275');" style=""> 463                      drs.setBatchId(1);                                                                            </span>
<span class="6524963296885553626" onmouseenter="enter('6524963296885553626');" onmouseout="out('6524963296885553626');" style=""> 464                      drs.setClassMetaData(null);                                                                   </span>
<span class="5830489670252814572" onmouseenter="enter('5830489670252814572');" onmouseout="out('5830489670252814572');" style=""> 465                      drs.setPageSize(1);                                                                           </span>
<span class="-3474843426091445352" onmouseenter="enter('-3474843426091445352');" onmouseout="out('-3474843426091445352');" style=""> 466                      drs.setRecords(new Entity[0]);                                                                </span>
<span class="5333638146813618055" onmouseenter="enter('5333638146813618055');" onmouseout="out('5333638146813618055');" style=""> 467                      map.put(p.getName(), drs);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 468                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470          }                                                                                                         </span>
<span  style=""> 471                                                                                                                    </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 472          return map;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473      }                                                                                                             </span>
<span  style=""> 474                                                                                                                    </span>
<span class="-8906234562852924572" onmouseenter="enter('-8906234562852924572');" onmouseout="out('-8906234562852924572');" style=""> 475      protected void updateTabInfo(CollectionMetadata fmd, ClassMetadata cmd, String tabName, int tabOrder) {       </span>
<span class="6418671463533151954" onmouseenter="enter('6418671463533151954');" onmouseout="out('6418671463533151954');" style=""> 476          boolean tabInfoFound = false;                                                                             </span>
<span class="5408213491241477604" onmouseenter="enter('5408213491241477604');" onmouseout="out('5408213491241477604');" style=""> 477          Map&lt;String, TabMetadata&gt; tabMetadataMap = cmd.getTabAndGroupMetadata();                                   </span>
<span class="-2540078251533437241" onmouseenter="enter('-2540078251533437241');" onmouseout="out('-2540078251533437241');" style=""> 478          for (String tabKey : tabMetadataMap.keySet()) {                                                           </span>
<span class="7583512444437065393" onmouseenter="enter('7583512444437065393');" onmouseout="out('7583512444437065393');" style=""> 479              Map&lt;String, GroupMetadata&gt; groupMetadataMap = tabMetadataMap.get(tabKey).getGroupMetadata();          </span>
<span class="-5526517230184735053" onmouseenter="enter('-5526517230184735053');" onmouseout="out('-5526517230184735053');" style=""> 480              for (String groupKey : groupMetadataMap.keySet()) {                                                   </span>
<span class="98584842541508129" onmouseenter="enter('98584842541508129');" onmouseout="out('98584842541508129');" style=""><abbr title=" 481                  if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equals(fmd.getGroup())) {"> 481                  if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equals(fmd.geðŸ”µ</abbr></span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 482                      tabName = tabMetadataMap.get(tabKey).getTabName();                                            </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 483                      tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                          </span>
<span class="4945701621495059563" onmouseenter="enter('4945701621495059563');" onmouseout="out('4945701621495059563');" style=""> 484                      tabInfoFound = true;                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 485                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 486                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487              }                                                                                                     </span>
<span class="1550248699436795528" onmouseenter="enter('1550248699436795528');" onmouseout="out('1550248699436795528');" style=""> 488              if (tabInfoFound) {                                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 489                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490              }                                                                                                     </span>
<span class="6331731299217129446" onmouseenter="enter('6331731299217129446');" onmouseout="out('6331731299217129446');" style=""> 491              if (tabKey.equals(tabName) || tabMetadataMap.get(tabKey).getTabName().equals(tabName)) {              </span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 492                  tabName = tabMetadataMap.get(tabKey).getTabName();                                                </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 493                  tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496      }                                                                                                             </span>
<span  style=""> 497                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 498      @Override                                                                                                     </span>
<span class="2611376483592856297" onmouseenter="enter('2611376483592856297');" onmouseout="out('2611376483592856297');" style=""><abbr title=" 499      public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field,"> 499      public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property ðŸ”µ</abbr></span>
<span class="6733854382866461502" onmouseenter="enter('6733854382866461502');" onmouseout="out('6733854382866461502');" style=""> 500              Entity parentEntity, List&lt;SectionCrumb&gt; sectionCrumbs)                                                </span>
<span class="-9069306879086868954" onmouseenter="enter('-9069306879086868954');" onmouseout="out('-9069306879086868954');" style=""> 501              throws ServiceException, ClassNotFoundException {                                                     </span>
<span class="-8197057147118619768" onmouseenter="enter('-8197057147118619768');" onmouseout="out('-8197057147118619768');" style=""> 502          // Assemble the properties from the entity form                                                           </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 503          List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                                      </span>
<span  style=""> 504                                                                                                                    </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 505          FieldMetadata md = field.getMetadata();                                                                   </span>
<span  style=""> 506                                                                                                                    </span>
<span class="-3154651088293222897" onmouseenter="enter('-3154651088293222897');" onmouseout="out('-3154651088293222897');" style=""> 507          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs)                 </span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 508                  .withEntity(new Entity());                                                                        </span>
<span class="6854684741721952189" onmouseenter="enter('6854684741721952189');" onmouseout="out('6854684741721952189');" style=""> 509          ppr.getEntity().setIsPreAdd(parentEntity.isPreAdd());                                                     </span>
<span  style=""> 510                                                                                                                    </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 511          if (md instanceof BasicCollectionMetadata) {                                                              </span>
<span class="6607267312947776736" onmouseenter="enter('6607267312947776736');" onmouseout="out('6607267312947776736');" style=""> 512              BasicCollectionMetadata fmd = (BasicCollectionMetadata) md;                                           </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 513              ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                                 </span>
<span  style=""> 514                                                                                                                    </span>
<span class="-2325626323266423717" onmouseenter="enter('-2325626323266423717');" onmouseout="out('-2325626323266423717');" style=""> 515              // If we&#x27;re looking up an entity instead of trying to create one on the fly, let&#x27;s make sure          </span>
<span class="3526840633411573677" onmouseenter="enter('3526840633411573677');" onmouseout="out('3526840633411573677');" style=""> 516              // that we&#x27;re not changing the target entity at all and only creating the association to the id       </span>
<span class="3093503126858687967" onmouseenter="enter('3093503126858687967');" onmouseout="out('3093503126858687967');" style=""> 517              if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP) ||                                            </span>
<span class="6274591046536853861" onmouseenter="enter('6274591046536853861');" onmouseout="out('6274591046536853861');" style=""> 518                      fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                             </span>
<span class="1728529167243720357" onmouseenter="enter('1728529167243720357');" onmouseout="out('1728529167243720357');" style=""> 519                  List&lt;String&gt; fieldsToRemove = new ArrayList&lt;String&gt;();                                            </span>
<span  style=""> 520                                                                                                                    </span>
<span class="8261635343050838543" onmouseenter="enter('8261635343050838543');" onmouseout="out('8261635343050838543');" style=""> 521                  String idProp = getIdProperty(mainMetadata);                                                      </span>
<span class="7372165960962811555" onmouseenter="enter('7372165960962811555');" onmouseout="out('7372165960962811555');" style=""> 522                  for (String key : entityForm.getFields().keySet()) {                                              </span>
<span class="-3969218055241208355" onmouseenter="enter('-3969218055241208355');" onmouseout="out('-3969218055241208355');" style=""> 523                      if (!idProp.equals(key)) {                                                                    </span>
<span class="329726563907215496" onmouseenter="enter('329726563907215496');" onmouseout="out('329726563907215496');" style=""> 524                          fieldsToRemove.add(key);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 525                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 526                  }                                                                                                 </span>
<span  style=""> 527                                                                                                                    </span>
<span class="-8204439459370995320" onmouseenter="enter('-8204439459370995320');" onmouseout="out('-8204439459370995320');" style=""> 528                  for (String key : fieldsToRemove) {                                                               </span>
<span class="-3002518314516620728" onmouseenter="enter('-3002518314516620728');" onmouseout="out('-3002518314516620728');" style=""> 529                      ListIterator&lt;Property&gt; li = properties.listIterator();                                        </span>
<span class="-3598623445235132470" onmouseenter="enter('-3598623445235132470');" onmouseout="out('-3598623445235132470');" style=""> 530                      while (li.hasNext()) {                                                                        </span>
<span class="-4936311913022510436" onmouseenter="enter('-4936311913022510436');" onmouseout="out('-4936311913022510436');" style=""> 531                          if (li.next().getName().equals(key)) {                                                    </span>
<span class="-7629195606720709622" onmouseenter="enter('-7629195606720709622');" onmouseout="out('-7629195606720709622');" style=""> 532                              li.remove();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 534                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535                  }                                                                                                 </span>
<span  style=""> 536                                                                                                                    </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 537                  ppr.setValidateUnsubmittedProperties(false);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538              }                                                                                                     </span>
<span  style=""> 539                                                                                                                    </span>
<span class="-2511723907351376263" onmouseenter="enter('-2511723907351376263');" onmouseout="out('-2511723907351376263');" style=""> 540              if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                                 </span>
<span class="4303470812456182979" onmouseenter="enter('4303470812456182979');" onmouseout="out('4303470812456182979');" style=""> 541                  ppr.setUpdateLookupType(true);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542              }                                                                                                     </span>
<span  style=""> 543                                                                                                                    </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 544              Property fp = new Property();                                                                         </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 545              fp.setName(ppr.getForeignKey().getManyToField());                                                     </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 546              fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));           </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 547              properties.add(fp);                                                                                   </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 548          } else if (md instanceof AdornedTargetCollectionMetadata) {                                               </span>
<span class="-4636884806383263612" onmouseenter="enter('-4636884806383263612');" onmouseout="out('-4636884806383263612');" style=""> 549              ppr.getEntity().setType(new String[] { ppr.getAdornedList().getAdornedTargetEntityClassname() });     </span>
<span  style=""> 550                                                                                                                    </span>
<span class="-8504901264761703182" onmouseenter="enter('-8504901264761703182');" onmouseout="out('-8504901264761703182');" style=""> 551              String[] maintainedFields = ((AdornedTargetCollectionMetadata) md).getMaintainedAdornedTargetFields();</span>
<span class="7296878925630910355" onmouseenter="enter('7296878925630910355');" onmouseout="out('7296878925630910355');" style=""> 552              if (maintainedFields == null || maintainedFields.length == 0) {                                       </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 553                  ppr.setValidateUnsubmittedProperties(false);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554              }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 555 +                                                                                                                  </span>
<span class="6130424394313681013" onmouseenter="enter('6130424394313681013');" onmouseout="out('6130424394313681013');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 556 +            // Fix for an adorned target collection where the link is maintained from a                           </span>
<span class="-1209465127207262219" onmouseenter="enter('-1209465127207262219');" onmouseout="out('-1209465127207262219');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 557 +            // ToOne property on a main entity                                                                    </span>
<span class="-4782433380384096940" onmouseenter="enter('-4782433380384096940');" onmouseout="out('-4782433380384096940');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 558 +            String linkedProperty = ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot; + ppr.getAdornedList().getLinkedIdProperty();"> 558 +            String linkedProperty = ppr.getAdornedList().getLinkedObjectPath() + &quot;.&quot; + ppr.getAdornedList().getLinðŸ”µ</abbr></span>
<span class="-7677283136075345929" onmouseenter="enter('-7677283136075345929');" onmouseout="out('-7677283136075345929');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 559 +            for (Property p : properties) {                                                                       </span>
<span class="-6798041327943240930" onmouseenter="enter('-6798041327943240930');" onmouseout="out('-6798041327943240930');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 560 +                if (p.getName().equals(linkedProperty)) {                                                         </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 561 +                    p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 562 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 563 +            }                                                                                                     </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 564          } else if (md instanceof MapMetadata) {                                                                   </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 565              ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                                 </span>
<span  style=""> 566                                                                                                                    </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 567              Property p = new Property();                                                                          </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 568              p.setName(&quot;symbolicId&quot;);                                                                              </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 569              p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));            </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 570              properties.add(p);                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 571          } else {                                                                                                  </span>
<span class="6589458496639047773" onmouseenter="enter('6589458496639047773');" onmouseout="out('6589458496639047773');" style=""> 572              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; +      </span>
<span class="8841076042243319225" onmouseenter="enter('8841076042243319225');" onmouseout="out('8841076042243319225');" style=""> 573                      &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574          }                                                                                                         </span>
<span  style=""> 575                                                                                                                    </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 576          ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                              </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 577          String sectionField = field.getName();                                                                    </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 578          if (sectionField.contains(&quot;.&quot;)) {                                                                         </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 579              sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 580          }                                                                                                         </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 581          ppr.setSectionEntityField(sectionField);                                                                  </span>
<span  style=""> 582                                                                                                                    </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 583          Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY);          </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 584          if (parentNameProp != null) {                                                                             </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 585              ppr.setRequestingEntityName(parentNameProp.getValue());                                               </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 586          }else {                                                                                                   </span>
<span class="1891301505194787668" onmouseenter="enter('1891301505194787668');" onmouseout="out('1891301505194787668');" style=""> 587              Property name = parentEntity.getPMap().get(&quot;name&quot;);                                                   </span>
<span class="5844109132794648466" onmouseenter="enter('5844109132794648466');" onmouseout="out('5844109132794648466');" style=""> 588              if(name !=null) {                                                                                     </span>
<span class="-827206152183551520" onmouseenter="enter('-827206152183551520');" onmouseout="out('-827206152183551520');" style=""> 589                  ppr.setRequestingEntityName(name.getValue());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 590              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591          }                                                                                                         </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 592          Property[] propArr = new Property[properties.size()];                                                     </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 593          properties.toArray(propArr);                                                                              </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 594          ppr.getEntity().setProperties(propArr);                                                                   </span>
<span  style=""> 595                                                                                                                    </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 596          return add(ppr);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597      }                                                                                                             </span>
<span  style=""> 598                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 599      @Override                                                                                                     </span>
<span class="-7675709464639024415" onmouseenter="enter('-7675709464639024415');" onmouseout="out('-7675709464639024415');" style=""><abbr title=" 600      public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property"> 600      public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, ProperðŸ”µ</abbr></span>
<span class="-2028598087534015745" onmouseenter="enter('-2028598087534015745');" onmouseout="out('-2028598087534015745');" style=""><abbr title=" 601              field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException, ClassNotFoundException {"> 601              field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceExðŸ”µ</abbr></span>
<span class="5486792043368910160" onmouseenter="enter('5486792043368910160');" onmouseout="out('5486792043368910160');" style=""><abbr title=" 602          return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId, null, sectionCrumb);"> 602          return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId, null, seðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 603      }                                                                                                             </span>
<span  style=""> 604                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 605      @Override                                                                                                     </span>
<span class="397736636649329238" onmouseenter="enter('397736636649329238');" onmouseout="out('397736636649329238');" style=""><abbr title=" 606      public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field,"> 606      public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, ProperðŸ”µ</abbr></span>
<span class="-318365979879509230" onmouseenter="enter('-318365979879509230');" onmouseout="out('-318365979879509230');" style=""> 607              Entity parentEntity, String collectionItemId, String alternateId, List&lt;SectionCrumb&gt; sectionCrumbs)   </span>
<span class="-9069306879086868954" onmouseenter="enter('-9069306879086868954');" onmouseout="out('-9069306879086868954');" style=""> 608              throws ServiceException, ClassNotFoundException {                                                     </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 609          List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                                      </span>
<span  style=""> 610                                                                                                                    </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 611          FieldMetadata md = field.getMetadata();                                                                   </span>
<span  style=""> 612                                                                                                                    </span>
<span class="-3154651088293222897" onmouseenter="enter('-3154651088293222897');" onmouseout="out('-3154651088293222897');" style=""> 613          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs)                 </span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 614                  .withEntity(new Entity());                                                                        </span>
<span  style=""> 615                                                                                                                    </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 616          if (md instanceof BasicCollectionMetadata) {                                                              </span>
<span class="6607267312947776736" onmouseenter="enter('6607267312947776736');" onmouseout="out('6607267312947776736');" style=""> 617              BasicCollectionMetadata fmd = (BasicCollectionMetadata) md;                                           </span>
<span class="226826482246311757" onmouseenter="enter('226826482246311757');" onmouseout="out('226826482246311757');" style=""> 618              ppr.setCeilingEntityClassname(fmd.getCollectionCeilingEntity());                                      </span>
<span class="-5249561197408255652" onmouseenter="enter('-5249561197408255652');" onmouseout="out('-5249561197408255652');" style=""> 619              ppr.getEntity().setType(new String[] { fmd.getCollectionCeilingEntity() });                           </span>
<span  style=""> 620                                                                                                                    </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 621              Property fp = new Property();                                                                         </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 622              fp.setName(ppr.getForeignKey().getManyToField());                                                     </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 623              fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));           </span>
<span class="8450408142962005401" onmouseenter="enter('8450408142962005401');" onmouseout="out('8450408142962005401');" style=""> 624              if (!properties.contains(fp)) {                                                                       </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 625                  properties.add(fp);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626              }                                                                                                     </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 627          } else if (md instanceof AdornedTargetCollectionMetadata) {                                               </span>
<span class="-736797126069743382" onmouseenter="enter('-736797126069743382');" onmouseout="out('-736797126069743382');" style=""> 628              String adornedTargetEntityClassname = ppr.getAdornedList().getAdornedTargetEntityClassname();         </span>
<span class="-3984105731247699024" onmouseenter="enter('-3984105731247699024');" onmouseout="out('-3984105731247699024');" style=""> 629              ppr.setCeilingEntityClassname(adornedTargetEntityClassname);                                          </span>
<span class="-4067322056629005576" onmouseenter="enter('-4067322056629005576');" onmouseout="out('-4067322056629005576');" style=""> 630              ppr.getEntity().setType(new String[] {adornedTargetEntityClassname});                                 </span>
<span  style=""> 631                                                                                                                    </span>
<span class="2404180692851035070" onmouseenter="enter('2404180692851035070');" onmouseout="out('2404180692851035070');" style=""> 632              for (Property property : properties) {                                                                </span>
<span class="-3911962540946632188" onmouseenter="enter('-3911962540946632188');" onmouseout="out('-3911962540946632188');" style=""> 633                  if (property.getName().equals(ppr.getAdornedList().getLinkedObjectPath() +                        </span>
<span class="2022280188845233855" onmouseenter="enter('2022280188845233855');" onmouseout="out('2022280188845233855');" style=""> 634                                      &quot;.&quot; + ppr.getAdornedList().getLinkedIdProperty())) {                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 635                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 636                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637              }                                                                                                     </span>
<span  style=""> 638                                                                                                                    </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 639              if (!StringUtils.isEmpty(alternateId)) {                                                              </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 640                  Property p = new Property();                                                                      </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 641                  p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                          </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 642                  p.setValue(alternateId);                                                                          </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 643                  if (!properties.contains(p)) {                                                                    </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 644                      properties.add(p);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646              }                                                                                                     </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 647          } else if (md instanceof MapMetadata) {                                                                   </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 648              ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                                 </span>
<span  style=""> 649                                                                                                                    </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 650              Property p = new Property();                                                                          </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 651              p.setName(&quot;symbolicId&quot;);                                                                              </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 652              p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));            </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 653              properties.add(p);                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 654          } else {                                                                                                  </span>
<span class="6589458496639047773" onmouseenter="enter('6589458496639047773');" onmouseout="out('6589458496639047773');" style=""> 655              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; +      </span>
<span class="8841076042243319225" onmouseenter="enter('8841076042243319225');" onmouseout="out('8841076042243319225');" style=""> 656                      &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 657          }                                                                                                         </span>
<span  style=""> 658                                                                                                                    </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 659          String sectionField = field.getName();                                                                    </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 660          if (sectionField.contains(&quot;.&quot;)) {                                                                         </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 661              sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 662          }                                                                                                         </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 663          ppr.setSectionEntityField(sectionField);                                                                  </span>
<span  style=""> 664                                                                                                                    </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 665          Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY);          </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 666          if (parentNameProp != null) {                                                                             </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 667              ppr.setRequestingEntityName(parentNameProp.getValue());                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 668          } else {                                                                                                  </span>
<span class="1891301505194787668" onmouseenter="enter('1891301505194787668');" onmouseout="out('1891301505194787668');" style=""> 669              Property name = parentEntity.getPMap().get(&quot;name&quot;);                                                   </span>
<span class="5844109132794648466" onmouseenter="enter('5844109132794648466');" onmouseout="out('5844109132794648466');" style=""> 670              if(name !=null) {                                                                                     </span>
<span class="-827206152183551520" onmouseenter="enter('-827206152183551520');" onmouseout="out('-827206152183551520');" style=""> 671                  ppr.setRequestingEntityName(name.getValue());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 673          }                                                                                                         </span>
<span  style=""> 674                                                                                                                    </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 675          Property p = new Property();                                                                              </span>
<span class="76365074730046782" onmouseenter="enter('76365074730046782');" onmouseout="out('76365074730046782');" style=""> 676          p.setName(entityForm.getIdProperty());                                                                    </span>
<span class="-4252521779434663948" onmouseenter="enter('-4252521779434663948');" onmouseout="out('-4252521779434663948');" style=""> 677          p.setValue(collectionItemId);                                                                             </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 678          if (!properties.contains(p)) {                                                                            </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 679              properties.add(p);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 680          }                                                                                                         </span>
<span  style=""> 681                                                                                                                    </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 682          Property[] propArr = new Property[properties.size()];                                                     </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 683          properties.toArray(propArr);                                                                              </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 684          ppr.getEntity().setProperties(propArr);                                                                   </span>
<span  style=""> 685                                                                                                                    </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 686          return update(ppr);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687      }                                                                                                             </span>
<span  style=""> 688                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 689      @Override                                                                                                     </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 690      public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 690      public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentðŸ”µ</abbr></span>
<span class="7718985087288552750" onmouseenter="enter('7718985087288552750');" onmouseout="out('7718985087288552750');" style=""> 691                  String itemId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {       </span>
<span class="1153666597088080540" onmouseenter="enter('1153666597088080540');" onmouseout="out('1153666597088080540');" style=""><abbr title=" 692          return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectionCrumbs);"> 692          return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectionCrumbs)ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693      }                                                                                                             </span>
<span  style=""> 694                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 695      @Override                                                                                                     </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 696      public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 696      public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentðŸ”µ</abbr></span>
<span class="-7641167286743654353" onmouseenter="enter('-7641167286743654353');" onmouseout="out('-7641167286743654353');" style=""><abbr title=" 697              String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {"> 697              String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceExðŸ”µ</abbr></span>
<span class="6439752407856920746" onmouseenter="enter('6439752407856920746');" onmouseout="out('6439752407856920746');" style=""> 698          List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;();                                                    </span>
<span  style=""> 699                                                                                                                    </span>
<span class="-7639830684562317861" onmouseenter="enter('-7639830684562317861');" onmouseout="out('-7639830684562317861');" style=""> 700          Property p;                                                                                               </span>
<span class="5073856407409165319" onmouseenter="enter('5073856407409165319');" onmouseout="out('5073856407409165319');" style=""> 701          String parentId = getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName());          </span>
<span  style=""> 702                                                                                                                    </span>
<span class="255305470667416020" onmouseenter="enter('255305470667416020');" onmouseout="out('255305470667416020');" style=""> 703          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(field.getMetadata(), sectionCrumbs)</span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 704                  .withEntity(new Entity());                                                                        </span>
<span  style=""> 705                                                                                                                    </span>
<span class="6642416971497632068" onmouseenter="enter('6642416971497632068');" onmouseout="out('6642416971497632068');" style=""> 706          if (field.getMetadata() instanceof BasicCollectionMetadata) {                                             </span>
<span class="5195082360751194411" onmouseenter="enter('5195082360751194411');" onmouseout="out('5195082360751194411');" style=""> 707              BasicCollectionMetadata fmd = (BasicCollectionMetadata) field.getMetadata();                          </span>
<span  style=""> 708                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 709              p = new Property();                                                                                   </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 710              p.setName(&quot;id&quot;);                                                                                      </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 711              p.setValue(itemId);                                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 712              properties.add(p);                                                                                    </span>
<span  style=""> 713                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 714              p = new Property();                                                                                   </span>
<span class="736571882968420419" onmouseenter="enter('736571882968420419');" onmouseout="out('736571882968420419');" style=""> 715              p.setName(ppr.getForeignKey().getManyToField());                                                      </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 716              p.setValue(parentId);                                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 717              properties.add(p);                                                                                    </span>
<span  style=""> 718                                                                                                                    </span>
<span class="6632512256771168785" onmouseenter="enter('6632512256771168785');" onmouseout="out('6632512256771168785');" style=""> 719              ppr.getEntity().setType(new String[]{fmd.getCollectionCeilingEntity()});                              </span>
<span class="2294469176396117772" onmouseenter="enter('2294469176396117772');" onmouseout="out('2294469176396117772');" style=""> 720          } else if (field.getMetadata() instanceof AdornedTargetCollectionMetadata) {                              </span>
<span class="-1689031862376375101" onmouseenter="enter('-1689031862376375101');" onmouseout="out('-1689031862376375101');" style=""> 721              AdornedTargetList adornedList = ppr.getAdornedList();                                                 </span>
<span  style=""> 722                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 723              p = new Property();                                                                                   </span>
<span class="-8312107819432651962" onmouseenter="enter('-8312107819432651962');" onmouseout="out('-8312107819432651962');" style=""> 724              p.setName(adornedList.getLinkedObjectPath() + &quot;.&quot; + adornedList.getLinkedIdProperty());               </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 725              p.setValue(parentId);                                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 726              properties.add(p);                                                                                    </span>
<span  style=""> 727                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 728              p = new Property();                                                                                   </span>
<span class="371368176127783534" onmouseenter="enter('371368176127783534');" onmouseout="out('371368176127783534');" style=""> 729              p.setName(adornedList.getTargetObjectPath() + &quot;.&quot; + adornedList.getTargetIdProperty());               </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 730              p.setValue(itemId);                                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 731              properties.add(p);                                                                                    </span>
<span  style=""> 732                                                                                                                    </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 733              if (!StringUtils.isEmpty(alternateId)) {                                                              </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 734                  p = new Property();                                                                               </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 735                  p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                          </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 736                  p.setValue(alternateId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 737                  properties.add(p);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 738              }                                                                                                     </span>
<span  style=""> 739                                                                                                                    </span>
<span class="-2729449254338899005" onmouseenter="enter('-2729449254338899005');" onmouseout="out('-2729449254338899005');" style=""> 740              ppr.getEntity().setType(new String[]{adornedList.getAdornedTargetEntityClassname()});                 </span>
<span class="7912118845776081771" onmouseenter="enter('7912118845776081771');" onmouseout="out('7912118845776081771');" style=""> 741          } else if (field.getMetadata() instanceof MapMetadata) {                                                  </span>
<span class="2366674339618495793" onmouseenter="enter('2366674339618495793');" onmouseout="out('2366674339618495793');" style=""> 742              MapMetadata fmd = (MapMetadata) field.getMetadata();                                                  </span>
<span  style=""> 743                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 744              p = new Property();                                                                                   </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 745              p.setName(&quot;id&quot;);                                                                                      </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 746              p.setValue(itemId);                                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 747              properties.add(p);                                                                                    </span>
<span  style=""> 748                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 749              p = new Property();                                                                                   </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 750              p.setName(&quot;symbolicId&quot;);                                                                              </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 751              p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));            </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 752              properties.add(p);                                                                                    </span>
<span  style=""> 753                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 754              p = new Property();                                                                                   </span>
<span class="-5579409047855153374" onmouseenter="enter('-5579409047855153374');" onmouseout="out('-5579409047855153374');" style=""> 755              p.setName(&quot;priorKey&quot;);                                                                                </span>
<span class="-4418910479857896781" onmouseenter="enter('-4418910479857896781');" onmouseout="out('-4418910479857896781');" style=""> 756              p.setValue(priorKey);                                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 757              properties.add(p);                                                                                    </span>
<span  style=""> 758                                                                                                                    </span>
<span class="6290651600977544526" onmouseenter="enter('6290651600977544526');" onmouseout="out('6290651600977544526');" style=""> 759              MapStructure mapStructure = ppr.getMapStructure();                                                    </span>
<span  style=""> 760                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 761              p = new Property();                                                                                   </span>
<span class="-8796819570859336354" onmouseenter="enter('-8796819570859336354');" onmouseout="out('-8796819570859336354');" style=""> 762              p.setName(mapStructure.getKeyPropertyName());                                                         </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 763              p.setValue(itemId);                                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 764              properties.add(p);                                                                                    </span>
<span  style=""> 765                                                                                                                    </span>
<span class="-3538327046279125798" onmouseenter="enter('-3538327046279125798');" onmouseout="out('-3538327046279125798');" style=""> 766              ppr.getEntity().setType(new String[] { fmd.getTargetClass() });                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767          }                                                                                                         </span>
<span  style=""> 768                                                                                                                    </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 769          ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                              </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 770          String sectionField = field.getName();                                                                    </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 771          if (sectionField.contains(&quot;.&quot;)) {                                                                         </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 772              sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 773          }                                                                                                         </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 774          ppr.setSectionEntityField(sectionField);                                                                  </span>
<span  style=""> 775                                                                                                                    </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 776          Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY);          </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 777          if (parentNameProp != null) {                                                                             </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 778              ppr.setRequestingEntityName(parentNameProp.getValue());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 779          }                                                                                                         </span>
<span  style=""> 780                                                                                                                    </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 781          Property[] propArr = new Property[properties.size()];                                                     </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 782          properties.toArray(propArr);                                                                              </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 783          ppr.getEntity().setProperties(propArr);                                                                   </span>
<span  style=""> 784                                                                                                                    </span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 785          return remove(ppr);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 786      }                                                                                                             </span>
<span  style=""> 787                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 788      @Override                                                                                                     </span>
<span class="4282644893410961184" onmouseenter="enter('4282644893410961184');" onmouseout="out('4282644893410961184');" style=""> 789      public String getContextSpecificRelationshipId(ClassMetadata cmd, Entity entity, String propertyName) {       </span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style=""> 790          String prefix;                                                                                            </span>
<span class="-4471312176558876108" onmouseenter="enter('-4471312176558876108');" onmouseout="out('-4471312176558876108');" style=""> 791          if (propertyName.contains(&quot;.&quot;)) {                                                                         </span>
<span class="1236521803185463300" onmouseenter="enter('1236521803185463300');" onmouseout="out('1236521803185463300');" style=""> 792              prefix = propertyName.substring(0, propertyName.lastIndexOf(&quot;.&quot;));                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 793          } else {                                                                                                  </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style=""> 794              prefix = &quot;&quot;;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 795          }                                                                                                         </span>
<span  style=""> 796                                                                                                                    </span>
<span class="2108963067613019567" onmouseenter="enter('2108963067613019567');" onmouseout="out('2108963067613019567');" style=""> 797          if (prefix.equals(&quot;&quot;)) {                                                                                  </span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 798              return entity.findProperty(&quot;id&quot;).getValue();                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 799          } else {                                                                                                  </span>
<span class="2912662671806002044" onmouseenter="enter('2912662671806002044');" onmouseout="out('2912662671806002044');" style=""><abbr title=" 800              //we need to check all the parts of the prefix. For example, the prefix could include an @Embedded class like"> 800              //we need to check all the parts of the prefix. For example, the prefix could include an @Embedded claðŸ”µ</abbr></span>
<span class="-6847147968781015235" onmouseenter="enter('-6847147968781015235');" onmouseout="out('-6847147968781015235');" style=""><abbr title=" 801              //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the @Embedded does"> 801              //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the @EmbeddedðŸ”µ</abbr></span>
<span class="-9096360951865760456" onmouseenter="enter('-9096360951865760456');" onmouseout="out('-9096360951865760456');" style=""> 802              //not have an id property - nor should it.                                                            </span>
<span class="8843283418167771984" onmouseenter="enter('8843283418167771984');" onmouseout="out('8843283418167771984');" style=""> 803              String[] prefixParts = prefix.split(&quot;\\.&quot;);                                                           </span>
<span class="-7822949011963974832" onmouseenter="enter('-7822949011963974832');" onmouseout="out('-7822949011963974832');" style=""> 804              for (int j = 0; j &lt; prefixParts.length; j++) {                                                        </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 805                  StringBuilder sb = new StringBuilder();                                                           </span>
<span class="2290448841761568128" onmouseenter="enter('2290448841761568128');" onmouseout="out('2290448841761568128');" style=""> 806                  for (int x = 0; x &lt; prefixParts.length - j; x++) {                                                </span>
<span class="1036821456394348565" onmouseenter="enter('1036821456394348565');" onmouseout="out('1036821456394348565');" style=""> 807                      sb.append(prefixParts[x]);                                                                    </span>
<span class="837864378579548727" onmouseenter="enter('837864378579548727');" onmouseout="out('837864378579548727');" style=""> 808                      if (x &lt; prefixParts.length - j - 1) {                                                         </span>
<span class="2682813583155160314" onmouseenter="enter('2682813583155160314');" onmouseout="out('2682813583155160314');" style=""> 809                          sb.append(&quot;.&quot;);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 810                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811                  }                                                                                                 </span>
<span class="-7912523814943214188" onmouseenter="enter('-7912523814943214188');" onmouseout="out('-7912523814943214188');" style=""> 812                  String tempPrefix = sb.toString();                                                                </span>
<span  style=""> 813                                                                                                                    </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 814                  for (Property property : entity.getProperties()) {                                                </span>
<span class="-7524924011426943089" onmouseenter="enter('-7524924011426943089');" onmouseout="out('-7524924011426943089');" style=""> 815                      if (property.getName().startsWith(tempPrefix)) {                                              </span>
<span class="-577685276283853994" onmouseenter="enter('-577685276283853994');" onmouseout="out('-577685276283853994');" style=""><abbr title=" 816                          //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the current prefix level"> 816                          //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the current prðŸ”µ</abbr></span>
<span class="6988170330009622433" onmouseenter="enter('6988170330009622433');" onmouseout="out('6988170330009622433');" style=""><abbr title=" 817                          //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAttributes.id"> 817                          //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAttributesðŸ”µ</abbr></span>
<span class="-1849094327471901943" onmouseenter="enter('-1849094327471901943');" onmouseout="out('-1849094327471901943');" style=""> 818                          if (StringUtils.countMatches(property.getName().replace(tempPrefix, &quot;&quot;), &quot;.&quot;) == 1) {     </span>
<span class="-8594951258528203905" onmouseenter="enter('-8594951258528203905');" onmouseout="out('-8594951258528203905');" style=""> 819                              if (cmd.getPMap().containsKey(property.getName())) {                                  </span>
<span class="-7732609283402352986" onmouseenter="enter('-7732609283402352986');" onmouseout="out('-7732609283402352986');" style=""><abbr title=" 820                                  BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.getName()).getMetadata();"> 820                                  BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.getName())ðŸ”µ</abbr></span>
<span class="-2874474282821972662" onmouseenter="enter('-2874474282821972662');" onmouseout="out('-2874474282821972662');" style=""> 821                                  if (md.getFieldType().equals(SupportedFieldType.ID)) {                            </span>
<span class="-1836186832588240544" onmouseenter="enter('-1836186832588240544');" onmouseout="out('-1836186832588240544');" style=""> 822                                      return property.getValue();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 824                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 825                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 826                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 828              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829          }                                                                                                         </span>
<span class="6467699841617564408" onmouseenter="enter('6467699841617564408');" onmouseout="out('6467699841617564408');" style=""> 830          if (!prefix.contains(&quot;.&quot;)) {                                                                              </span>
<span class="-6458727047245688221" onmouseenter="enter('-6458727047245688221');" onmouseout="out('-6458727047245688221');" style=""><abbr title=" 831              //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restrictedPriceLists on OfferImpl)"> 831              //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restrictedPriceLðŸ”µ</abbr></span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 832              return entity.findProperty(&quot;id&quot;).getValue();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 833          }                                                                                                         </span>
<span class="-8024958864039426916" onmouseenter="enter('-8024958864039426916');" onmouseout="out('-8024958864039426916');" style=""> 834          throw new RuntimeException(&quot;Unable to establish a relationship id&quot;);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 835      }                                                                                                             </span>
<span  style=""> 836                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 837      @Override                                                                                                     </span>
<span class="-3908255710031606050" onmouseenter="enter('-3908255710031606050');" onmouseout="out('-3908255710031606050');" style=""> 838      public String getIdProperty(ClassMetadata cmd) throws ServiceException {                                      </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 839          for (Property p : cmd.getProperties()) {                                                                  </span>
<span class="-1029066852878262358" onmouseenter="enter('-1029066852878262358');" onmouseout="out('-1029066852878262358');" style=""> 840              if (p.getMetadata() instanceof BasicFieldMetadata) {                                                  </span>
<span class="-5664285287189453326" onmouseenter="enter('-5664285287189453326');" onmouseout="out('-5664285287189453326');" style=""> 841                  BasicFieldMetadata fmd = (BasicFieldMetadata) p.getMetadata();                                    </span>
<span class="513655466689307970" onmouseenter="enter('513655466689307970');" onmouseout="out('513655466689307970');" style=""> 842                  //check for ID type and also make sure the field we&#x27;re looking at is not a &quot;ToOne&quot; association    </span>
<span class="-491768544454322511" onmouseenter="enter('-491768544454322511');" onmouseout="out('-491768544454322511');" style=""> 843                  if (SupportedFieldType.ID.equals(fmd.getFieldType()) &amp;&amp; !p.getName().contains(&quot;.&quot;)) {             </span>
<span class="-6048877223362319653" onmouseenter="enter('-6048877223362319653');" onmouseout="out('-6048877223362319653');" style=""> 844                      return p.getName();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 845                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 846              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 847          }                                                                                                         </span>
<span  style=""> 848                                                                                                                    </span>
<span class="-7942857982942474001" onmouseenter="enter('-7942857982942474001');" onmouseout="out('-7942857982942474001');" style=""> 849          throw new ServiceException(&quot;Could not determine ID field for &quot; + cmd.getCeilingType());                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 850      }                                                                                                             </span>
<span  style=""> 851                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 852      @Override                                                                                                     </span>
<span class="-6109521015369402099" onmouseenter="enter('-6109521015369402099');" onmouseout="out('-6109521015369402099');" style=""> 853      public PersistenceResponse add(PersistencePackageRequest request) throws ServiceException {                   </span>
<span class="-2588522872292014988" onmouseenter="enter('-2588522872292014988');" onmouseout="out('-2588522872292014988');" style=""> 854          return add(request, true);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 855      }                                                                                                             </span>
<span  style=""> 856                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 857      @Override                                                                                                     </span>
<span class="8827553339909366249" onmouseenter="enter('8827553339909366249');" onmouseout="out('8827553339909366249');" style=""><abbr title=" 858      public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 858      public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiceExceptiðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 859          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 860          try {                                                                                                     </span>
<span class="4836544755641051591" onmouseenter="enter('4836544755641051591');" onmouseout="out('4836544755641051591');" style=""> 861              if (request.isUpdateLookupType()) {                                                                   </span>
<span class="-2082930136830103093" onmouseenter="enter('-2082930136830103093');" onmouseout="out('-2082930136830103093');" style=""> 862                  if (pkg.getSectionCrumbs() != null &amp;&amp; pkg.getSectionCrumbs().length &gt; 0) {                        </span>
<span class="-6120347482693188577" onmouseenter="enter('-6120347482693188577');" onmouseout="out('-6120347482693188577');" style=""> 863                      SectionCrumb sc = pkg.getSectionCrumbs()[0];                                                  </span>
<span class="7706557227331502134" onmouseenter="enter('7706557227331502134');" onmouseout="out('7706557227331502134');" style=""> 864                      if (StringUtils.isNotBlank(sc.getSectionIdentifier())) {                                      </span>
<span class="7371017383769084435" onmouseenter="enter('7371017383769084435');" onmouseout="out('7371017383769084435');" style=""> 865                          pkg.setSecurityCeilingEntityFullyQualifiedClassname(sc.getSectionIdentifier());           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 867                  }                                                                                                 </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 868                  if (transactional) {                                                                              </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 869                      return service.update(pkg);                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 870                  } else {                                                                                          </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 871                      return service.nonTransactionalUpdate(pkg);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 873              } else {                                                                                              </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 874                  if (transactional) {                                                                              </span>
<span class="4552670565637379723" onmouseenter="enter('4552670565637379723');" onmouseout="out('4552670565637379723');" style=""> 875                      return service.add(pkg);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 876                  } else {                                                                                          </span>
<span class="6732121152740224457" onmouseenter="enter('6732121152740224457');" onmouseout="out('6732121152740224457');" style=""> 877                      return service.nonTransactionalAdd(pkg);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 879              }                                                                                                     </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 880          } catch (ValidationException e) {                                                                         </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 881              ensureEntityMarkedAsValidationFailure(e, request);                                                    </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 882              return new PersistenceResponse().withEntity(e.getEntity());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 884      }                                                                                                             </span>
<span  style=""> 885                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 886      @Override                                                                                                     </span>
<span class="-2168493081511676385" onmouseenter="enter('-2168493081511676385');" onmouseout="out('-2168493081511676385');" style=""> 887      public PersistenceResponse update(PersistencePackageRequest request) throws ServiceException {                </span>
<span class="-1915092381367502552" onmouseenter="enter('-1915092381367502552');" onmouseout="out('-1915092381367502552');" style=""> 888          return update(request, true);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 889      }                                                                                                             </span>
<span  style=""> 890                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 891      @Override                                                                                                     </span>
<span class="-3035175746782535545" onmouseenter="enter('-3035175746782535545');" onmouseout="out('-3035175746782535545');" style=""><abbr title=" 892      public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 892      public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws ServiceExceðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 893          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 894          try {                                                                                                     </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 895              if (transactional) {                                                                                  </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 896                  return service.update(pkg);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 897              } else {                                                                                              </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 898                  return service.nonTransactionalUpdate(pkg);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 899              }                                                                                                     </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 900          } catch (ValidationException e) {                                                                         </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 901              ensureEntityMarkedAsValidationFailure(e, request);                                                    </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 902              return new PersistenceResponse().withEntity(e.getEntity());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 903          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 904      }                                                                                                             </span>
<span  style=""> 905                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 906      @Override                                                                                                     </span>
<span class="-1312385666630581282" onmouseenter="enter('-1312385666630581282');" onmouseout="out('-1312385666630581282');" style=""> 907      public PersistenceResponse inspect(PersistencePackageRequest request)                                         </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 908              throws ServiceException {                                                                             </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 909          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span class="2565705442671799096" onmouseenter="enter('2565705442671799096');" onmouseout="out('2565705442671799096');" style=""> 910          return service.inspect(pkg);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 911      }                                                                                                             </span>
<span  style=""> 912                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 913      @Override                                                                                                     </span>
<span class="-2409492513544163046" onmouseenter="enter('-2409492513544163046');" onmouseout="out('-2409492513544163046');" style=""> 914      public PersistenceResponse remove(PersistencePackageRequest request)                                          </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 915              throws ServiceException {                                                                             </span>
<span class="1818424953510541932" onmouseenter="enter('1818424953510541932');" onmouseout="out('1818424953510541932');" style=""> 916          return remove(request, true);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 917      }                                                                                                             </span>
<span  style=""> 918                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 919      @Override                                                                                                     </span>
<span class="-9050585893076336114" onmouseenter="enter('-9050585893076336114');" onmouseout="out('-9050585893076336114');" style=""><abbr title=" 920      public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 920      public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws ServiceExceðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 921          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 922          try {                                                                                                     </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 923              if (transactional) {                                                                                  </span>
<span class="-5643605501598977706" onmouseenter="enter('-5643605501598977706');" onmouseout="out('-5643605501598977706');" style=""> 924                  return service.remove(pkg);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 925              } else {                                                                                              </span>
<span class="-8250836311704581891" onmouseenter="enter('-8250836311704581891');" onmouseout="out('-8250836311704581891');" style=""> 926                  return service.nonTransactionalRemove(pkg);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 927              }                                                                                                     </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 928          } catch (ValidationException e) {                                                                         </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 929              ensureEntityMarkedAsValidationFailure(e, request);                                                    </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 930              return new PersistenceResponse().withEntity(e.getEntity());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 931          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 932      }                                                                                                             </span>
<span  style=""> 933                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 934      /**                                                                                                           </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 935       * &lt;p&gt;                                                                                                        </span>
<span class="3729604611716511130" onmouseenter="enter('3729604611716511130');" onmouseout="out('3729604611716511130');" style=""><abbr title=" 936       * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} contained within the"> 936       * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} contained ðŸ”µ</abbr></span>
<span class="-7341678569298188314" onmouseenter="enter('-7341678569298188314');" onmouseout="out('-7341678569298188314');" style=""> 937       * given &lt;b&gt;originalRequest&lt;/b&gt; has a validationFailure = true                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 938       *                                                                                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 939       * &lt;p&gt;                                                                                                        </span>
<span class="-7716663654145973669" onmouseenter="enter('-7716663654145973669');" onmouseout="out('-7716663654145973669');" style=""> 940       * This will also check for a cause of {@link ConstraintViolationException} and add a gloal error to that.    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 941       */                                                                                                           </span>
<span class="807801721535748536" onmouseenter="enter('807801721535748536');" onmouseout="out('807801721535748536');" style=""><abbr title=" 942      protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequest originalRequest) {"> 942      protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequest originalðŸ”µ</abbr></span>
<span class="5399941146961217832" onmouseenter="enter('5399941146961217832');" onmouseout="out('5399941146961217832');" style=""> 943          if (e.containsCause(ConstraintViolationException.class)) {                                                </span>
<span class="-5214743212244855970" onmouseenter="enter('-5214743212244855970');" onmouseout="out('-5214743212244855970');" style=""> 944              e.getEntity().addGlobalValidationError(&quot;constraintViolationError&quot;);                                   </span>
<span class="4509625189679774854" onmouseenter="enter('4509625189679774854');" onmouseout="out('4509625189679774854');" style=""> 945          } else if (!e.getEntity().isValidationFailure()) {                                                        </span>
<span class="-4984910861440118934" onmouseenter="enter('-4984910861440118934');" onmouseout="out('-4984910861440118934');" style=""> 946              e.getEntity().setValidationFailure(true);                                                             </span>
<span class="-6792721057862982153" onmouseenter="enter('-6792721057862982153');" onmouseout="out('-6792721057862982153');" style=""> 947              e.getEntity().addGlobalValidationError(e.getMessage());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 948          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 949      }                                                                                                             </span>
<span  style=""> 950                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 951      @Override                                                                                                     </span>
<span class="5311420287927073238" onmouseenter="enter('5311420287927073238');" onmouseout="out('5311420287927073238');" style=""> 952      public PersistenceResponse fetch(PersistencePackageRequest request)                                           </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 953              throws ServiceException {                                                                             </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 954          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span  style=""> 955                                                                                                                    </span>
<span class="-5375974030412648260" onmouseenter="enter('-5375974030412648260');" onmouseout="out('-5375974030412648260');" style=""> 956          CriteriaTransferObject cto = getDefaultCto();                                                             </span>
<span class="-1800505558210996683" onmouseenter="enter('-1800505558210996683');" onmouseout="out('-1800505558210996683');" style=""> 957          if (request.getFilterAndSortCriteria() != null) {                                                         </span>
<span class="629113105269586037" onmouseenter="enter('629113105269586037');" onmouseout="out('629113105269586037');" style=""> 958              cto.addAll(Arrays.asList(request.getFilterAndSortCriteria()));                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 959          }                                                                                                         </span>
<span  style=""> 960                                                                                                                    </span>
<span class="-3823245946626813984" onmouseenter="enter('-3823245946626813984');" onmouseout="out('-3823245946626813984');" style=""> 961          if (request.getMaxResults() != null) {                                                                    </span>
<span class="-8351200142276180335" onmouseenter="enter('-8351200142276180335');" onmouseout="out('-8351200142276180335');" style=""> 962              cto.setMaxResults(request.getMaxResults());                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 963          }                                                                                                         </span>
<span  style=""> 964                                                                                                                    </span>
<span class="-690040157024225203" onmouseenter="enter('-690040157024225203');" onmouseout="out('-690040157024225203');" style=""> 965          if (request.getStartIndex() == null) {                                                                    </span>
<span class="2764779885143665984" onmouseenter="enter('2764779885143665984');" onmouseout="out('2764779885143665984');" style=""> 966              cto.setFirstResult(0);                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 967          } else {                                                                                                  </span>
<span class="-6350611603682358812" onmouseenter="enter('-6350611603682358812');" onmouseout="out('-6350611603682358812');" style=""> 968              cto.setFirstResult(request.getStartIndex());                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 969          }                                                                                                         </span>
<span  style=""> 970                                                                                                                    </span>
<span class="-1342097346218425419" onmouseenter="enter('-1342097346218425419');" onmouseout="out('-1342097346218425419');" style=""> 971          if (request.getMaxIndex() != null) {                                                                      </span>
<span class="-8120529832746798414" onmouseenter="enter('-8120529832746798414');" onmouseout="out('-8120529832746798414');" style=""> 972              Integer startIndex = request.getStartIndex() != null ? request.getStartIndex() : 0;                   </span>
<span class="-6682475132360394674" onmouseenter="enter('-6682475132360394674');" onmouseout="out('-6682475132360394674');" style=""> 973              int requestedMaxResults = request.getMaxIndex() - startIndex + 1;                                     </span>
<span class="-4912375422916056974" onmouseenter="enter('-4912375422916056974');" onmouseout="out('-4912375422916056974');" style=""> 974              if (requestedMaxResults &gt;= 0 &amp;&amp; requestedMaxResults &lt; cto.getMaxResults()) {                          </span>
<span class="-1275291600011289156" onmouseenter="enter('-1275291600011289156');" onmouseout="out('-1275291600011289156');" style=""> 975                  cto.setMaxResults(requestedMaxResults);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 976              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 977          }                                                                                                         </span>
<span  style=""> 978                                                                                                                    </span>
<span class="1589811072437566840" onmouseenter="enter('1589811072437566840');" onmouseout="out('1589811072437566840');" style=""> 979          cto.setLastId(request.getLastId());                                                                       </span>
<span class="4489054305431733195" onmouseenter="enter('4489054305431733195');" onmouseout="out('4489054305431733195');" style=""> 980          cto.setFirstId(request.getFirstId());                                                                     </span>
<span class="7683513281487176699" onmouseenter="enter('7683513281487176699');" onmouseout="out('7683513281487176699');" style=""> 981          cto.setUpperCount(request.getUpperCount());                                                               </span>
<span class="-8031307621948936245" onmouseenter="enter('-8031307621948936245');" onmouseout="out('-8031307621948936245');" style=""> 982          cto.setLowerCount(request.getLowerCount());                                                               </span>
<span class="63997933306934756" onmouseenter="enter('63997933306934756');" onmouseout="out('63997933306934756');" style=""> 983          if (request.getPageSize() != null) {                                                                      </span>
<span class="-7018914636118190968" onmouseenter="enter('-7018914636118190968');" onmouseout="out('-7018914636118190968');" style=""> 984              cto.setMaxResults(request.getPageSize());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 985          }                                                                                                         </span>
<span class="5284762326708873211" onmouseenter="enter('5284762326708873211');" onmouseout="out('5284762326708873211');" style=""> 986          cto.setPresentationFetch(request.getPresentationFetch());                                                 </span>
<span  style=""> 987                                                                                                                    </span>









<span class="-734873492845948502" onmouseenter="enter('-734873492845948502');" onmouseout="out('-734873492845948502');" style=""> 988          return service.fetch(pkg, cto);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 989      }                                                                                                             </span>
<span  style=""> 990                                                                                                                    </span>
<span class="1747080010822063537" onmouseenter="enter('1747080010822063537');" onmouseout="out('1747080010822063537');" style=""> 991      protected CriteriaTransferObject getDefaultCto() {                                                            </span>
<span class="-7937218466133346867" onmouseenter="enter('-7937218466133346867');" onmouseout="out('-7937218466133346867');" style=""> 992          CriteriaTransferObject cto = new CriteriaTransferObject();                                                </span>
<span class="-792606519014114045" onmouseenter="enter('-792606519014114045');" onmouseout="out('-792606519014114045');" style=""> 993          cto.setMaxResults(getDefaultMaxResults());                                                                </span>
<span class="6058297727948666853" onmouseenter="enter('6058297727948666853');" onmouseout="out('6058297727948666853');" style=""> 994          return cto;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 995      }                                                                                                             </span>
<span  style=""> 996                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 997      @Override                                                                                                     </span>
<span class="8883083618394394837" onmouseenter="enter('8883083618394394837');" onmouseout="out('8883083618394394837');" style=""> 998      public String getForeignEntityName(String owningClass, String id) {                                           </span>
<span class="-872554261283939929" onmouseenter="enter('-872554261283939929');" onmouseout="out('-872554261283939929');" style=""> 999          if (owningClass == null || id == null) {                                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1000              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1001          }                                                                                                         </span>
<span  style="">1002                                                                                                                    </span>
<span class="3468023357463508719" onmouseenter="enter('3468023357463508719');" onmouseout="out('3468023357463508719');" style="">1003          DynamicEntityDao dynamicEntityDao = getDynamicEntityDao(owningClass);                                     </span>
<span class="7635620295149838730" onmouseenter="enter('7635620295149838730');" onmouseout="out('7635620295149838730');" style="">1004          Class&lt;?&gt; clazz = dynamicEntityDao.getImplClass(owningClass);                                              </span>
<span class="6841796057846720752" onmouseenter="enter('6841796057846720752');" onmouseout="out('6841796057846720752');" style="">1005          Object foreignEntity = dynamicEntityDao.find(clazz, toIdFieldType(id, clazz));                            </span>
<span  style="">1006                                                                                                                    </span>
<span class="6094352409442952488" onmouseenter="enter('6094352409442952488');" onmouseout="out('6094352409442952488');" style="">1007          if (foreignEntity instanceof AdminMainEntity) {                                                           </span>
<span class="-5844179197625315876" onmouseenter="enter('-5844179197625315876');" onmouseout="out('-5844179197625315876');" style="">1008              return ((AdminMainEntity) foreignEntity).getMainEntityName();                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1009          }                                                                                                         </span>
<span  style="">1010                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1011          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1012      }                                                                                                             </span>
<span  style="">1013                                                                                                                    </span>
<span class="-1537571071296717959" onmouseenter="enter('-1537571071296717959');" onmouseout="out('-1537571071296717959');" style="">1014      protected DynamicEntityDao getDynamicEntityDao(String owningClass) {                                          </span>
<span class="8951596410601292775" onmouseenter="enter('8951596410601292775');" onmouseout="out('8951596410601292775');" style="">1015          return PersistenceManagerFactory.getPersistenceManager(owningClass).getDynamicEntityDao();                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1016      }                                                                                                             </span>
<span  style="">1017                                                                                                                    </span>
<span class="7239398670151774953" onmouseenter="enter('7239398670151774953');" onmouseout="out('7239398670151774953');" style="">1018      protected int getDefaultMaxResults() {                                                                        </span>
<span class="-1067455107038749142" onmouseenter="enter('-1067455107038749142');" onmouseout="out('-1067455107038749142');" style="">1019          return BLCSystemProperty.resolveIntSystemProperty(&quot;admin.default.max.results&quot;, 50);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1020      }                                                                                                             </span>
<span  style="">1021                                                                                                                    </span>
<span class="8333077553386092776" onmouseenter="enter('8333077553386092776');" onmouseout="out('8333077553386092776');" style="">1022      protected Object toIdFieldType(String id, Class&lt;?&gt; entityClass) {                                             </span>
<span class="3604823920885758204" onmouseenter="enter('3604823920885758204');" onmouseout="out('3604823920885758204');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">1023 -        Class&lt;?&gt; idFieldClass = dynamicDaoHelper.getIdField(entityClass, em).getType();                           </span>
<span class="4110349594135807695" onmouseenter="enter('4110349594135807695');" onmouseout="out('4110349594135807695');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">1024 +        Class&lt;?&gt; idFieldClass = dynamicDaoHelper.getIdField(entityClass).getType();                               </span>
<span class="-2186353433511684671" onmouseenter="enter('-2186353433511684671');" onmouseout="out('-2186353433511684671');" style="">1025          if (Long.class.isAssignableFrom(idFieldClass)) {                                                          </span>
<span class="5572754406141306162" onmouseenter="enter('5572754406141306162');" onmouseout="out('5572754406141306162');" style="">1026              return Long.parseLong(id);                                                                            </span>
<span class="-3847313633493236310" onmouseenter="enter('-3847313633493236310');" onmouseout="out('-3847313633493236310');" style="">1027          } else if (Integer.class.isAssignableFrom(idFieldClass)) {                                                </span>
<span class="3211402984454379456" onmouseenter="enter('3211402984454379456');" onmouseout="out('3211402984454379456');" style="">1028              return Integer.parseInt(id);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1029          }                                                                                                         </span>
<span class="-3074727595953522219" onmouseenter="enter('-3074727595953522219');" onmouseout="out('-3074727595953522219');" style="">1030          return id;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1031      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1032  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-3339060969767811416" onmouseenter="enter('-3339060969767811416');" onmouseout="out('-3339060969767811416');" style="">   3   * BroadleafCommerce Open Admin Platform                                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-8794511651793620694" onmouseenter="enter('-8794511651793620694');" onmouseout="out('-8794511651793620694');" style="">  18  package org.broadleafcommerce.openadmin.server.service;                                                           </span>
<span  style="">  19                                                                                                                    </span>
<span class="2359514128542055982" onmouseenter="enter('2359514128542055982');" onmouseout="out('2359514128542055982');" style="">  20  import org.apache.commons.lang3.ArrayUtils;                                                                       </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="-6287859968194756382" onmouseenter="enter('-6287859968194756382');" onmouseout="out('-6287859968194756382');" style="">  24  import org.broadleafcommerce.common.admin.domain.AdminMainEntity;                                                 </span>
<span class="5945096539699516699" onmouseenter="enter('5945096539699516699');" onmouseout="out('5945096539699516699');" style="">  25  import org.broadleafcommerce.common.exception.ServiceException;                                                   </span>
<span class="4111478795314305516" onmouseenter="enter('4111478795314305516');" onmouseout="out('4111478795314305516');" style="">  26  import org.broadleafcommerce.common.persistence.EntityConfiguration;                                              </span>
<span class="-6648433550510659033" onmouseenter="enter('-6648433550510659033');" onmouseout="out('-6648433550510659033');" style="">  27  import org.broadleafcommerce.common.presentation.client.AddMethodType;                                            </span>
<span class="1362364260528215152" onmouseenter="enter('1362364260528215152');" onmouseout="out('1362364260528215152');" style="">  28  import org.broadleafcommerce.common.presentation.client.SupportedFieldType;                                       </span>
<span class="2428099238642943960" onmouseenter="enter('2428099238642943960');" onmouseout="out('2428099238642943960');" style="">  29  import org.broadleafcommerce.common.util.BLCMessageUtils;                                                         </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  30  import org.broadleafcommerce.common.util.BLCSystemProperty;                                                       </span>
<span class="5951235614759861305" onmouseenter="enter('5951235614759861305');" onmouseout="out('5951235614759861305');" style="">  31  import org.broadleafcommerce.common.util.dao.DynamicDaoHelper;                                                    </span>
<span class="2901117953480421393" onmouseenter="enter('2901117953480421393');" onmouseout="out('2901117953480421393');" style="">  32  import org.broadleafcommerce.common.util.dao.DynamicDaoHelperImpl;                                                </span>
<span class="-3361215363157046739" onmouseenter="enter('-3361215363157046739');" onmouseout="out('-3361215363157046739');" style="">  33  import org.broadleafcommerce.openadmin.dto.AdornedTargetCollectionMetadata;                                       </span>
<span class="-1781055592725563383" onmouseenter="enter('-1781055592725563383');" onmouseout="out('-1781055592725563383');" style="">  34  import org.broadleafcommerce.openadmin.dto.AdornedTargetList;                                                     </span>
<span class="-6140296335181984013" onmouseenter="enter('-6140296335181984013');" onmouseout="out('-6140296335181984013');" style="">  35  import org.broadleafcommerce.openadmin.dto.BasicCollectionMetadata;                                               </span>
<span class="4427537537958608766" onmouseenter="enter('4427537537958608766');" onmouseout="out('4427537537958608766');" style="">  36  import org.broadleafcommerce.openadmin.dto.BasicFieldMetadata;                                                    </span>
<span class="-1607559599739253077" onmouseenter="enter('-1607559599739253077');" onmouseout="out('-1607559599739253077');" style="">  37  import org.broadleafcommerce.openadmin.dto.ClassMetadata;                                                         </span>
<span class="-3165611006566133086" onmouseenter="enter('-3165611006566133086');" onmouseout="out('-3165611006566133086');" style="">  38  import org.broadleafcommerce.openadmin.dto.CollectionMetadata;                                                    </span>
<span class="-8970007776478821592" onmouseenter="enter('-8970007776478821592');" onmouseout="out('-8970007776478821592');" style="">  39  import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;                                                </span>
<span class="-4742435063138209714" onmouseenter="enter('-4742435063138209714');" onmouseout="out('-4742435063138209714');" style="">  40  import org.broadleafcommerce.openadmin.dto.DynamicResultSet;                                                      </span>
<span class="-5093421835888664541" onmouseenter="enter('-5093421835888664541');" onmouseout="out('-5093421835888664541');" style="">  41  import org.broadleafcommerce.openadmin.dto.Entity;                                                                </span>
<span class="-8829499667991596741" onmouseenter="enter('-8829499667991596741');" onmouseout="out('-8829499667991596741');" style="">  42  import org.broadleafcommerce.openadmin.dto.FieldMetadata;                                                         </span>
<span class="6369021917986026789" onmouseenter="enter('6369021917986026789');" onmouseout="out('6369021917986026789');" style="">  43  import org.broadleafcommerce.openadmin.dto.FilterAndSortCriteria;                                                 </span>
<span class="2672462771965160264" onmouseenter="enter('2672462771965160264');" onmouseout="out('2672462771965160264');" style="">  44  import org.broadleafcommerce.openadmin.dto.GroupMetadata;                                                         </span>
<span class="826821438795056004" onmouseenter="enter('826821438795056004');" onmouseout="out('826821438795056004');" style="">  45  import org.broadleafcommerce.openadmin.dto.MapMetadata;                                                           </span>
<span class="-7888875133556467044" onmouseenter="enter('-7888875133556467044');" onmouseout="out('-7888875133556467044');" style="">  46  import org.broadleafcommerce.openadmin.dto.MapStructure;                                                          </span>
<span class="5387066876064049952" onmouseenter="enter('5387066876064049952');" onmouseout="out('5387066876064049952');" style="">  47  import org.broadleafcommerce.openadmin.dto.PersistencePackage;                                                    </span>
<span class="1983554291461039357" onmouseenter="enter('1983554291461039357');" onmouseout="out('1983554291461039357');" style="">  48  import org.broadleafcommerce.openadmin.dto.Property;                                                              </span>
<span class="1696571253156436279" onmouseenter="enter('1696571253156436279');" onmouseout="out('1696571253156436279');" style="">  49  import org.broadleafcommerce.openadmin.dto.SectionCrumb;                                                          </span>
<span class="5662236005419086618" onmouseenter="enter('5662236005419086618');" onmouseout="out('5662236005419086618');" style="">  50  import org.broadleafcommerce.openadmin.dto.TabMetadata;                                                           </span>
<span class="2699062320492900877" onmouseenter="enter('2699062320492900877');" onmouseout="out('2699062320492900877');" style="">  51  import org.broadleafcommerce.openadmin.exception.EntityNotFoundException;                                         </span>
<span class="-8828889589519173652" onmouseenter="enter('-8828889589519173652');" onmouseout="out('-8828889589519173652');" style="">  52  import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;                                               </span>
<span class="-2178507335566770341" onmouseenter="enter('-2178507335566770341');" onmouseout="out('-2178507335566770341');" style="">  53  import org.broadleafcommerce.openadmin.server.domain.FetchPageRequest;                                            </span>
<span class="4410643013278245372" onmouseenter="enter('4410643013278245372');" onmouseout="out('4410643013278245372');" style="">  54  import org.broadleafcommerce.openadmin.server.domain.PersistencePackageRequest;                                   </span>
<span class="6597629584583725664" onmouseenter="enter('6597629584583725664');" onmouseout="out('6597629584583725664');" style="">  55  import org.broadleafcommerce.openadmin.server.factory.PersistencePackageFactory;                                  </span>
<span class="7062965872140905778" onmouseenter="enter('7062965872140905778');" onmouseout="out('7062965872140905778');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +import org.broadleafcommerce.openadmin.server.service.extension.CriteriaTransferObjectExtensionManager;           </span>
<span class="97669409268306845" onmouseenter="enter('97669409268306845');" onmouseout="out('97669409268306845');" style="">  57  import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceManagerFactory;                      </span>
<span class="-8603256547657551769" onmouseenter="enter('-8603256547657551769');" onmouseout="out('-8603256547657551769');" style="">  58  import org.broadleafcommerce.openadmin.server.service.persistence.PersistenceResponse;                            </span>
<span class="-3086540061138981164" onmouseenter="enter('-3086540061138981164');" onmouseout="out('-3086540061138981164');" style="">  59  import org.broadleafcommerce.openadmin.server.service.persistence.module.BasicPersistenceModule;                  </span>
<span class="-7452009352681558215" onmouseenter="enter('-7452009352681558215');" onmouseout="out('-7452009352681558215');" style="">  60  import org.broadleafcommerce.openadmin.web.form.entity.DynamicEntityFormInfo;                                     </span>
<span class="8035715143965725316" onmouseenter="enter('8035715143965725316');" onmouseout="out('8035715143965725316');" style="">  61  import org.broadleafcommerce.openadmin.web.form.entity.EntityForm;                                                </span>
<span class="6015559832933397076" onmouseenter="enter('6015559832933397076');" onmouseout="out('6015559832933397076');" style="">  62  import org.broadleafcommerce.openadmin.web.form.entity.Field;                                                     </span>
<span class="7834442097514100117" onmouseenter="enter('7834442097514100117');" onmouseout="out('7834442097514100117');" style="">  63  import org.broadleafcommerce.openadmin.web.form.entity.Tab;                                                       </span>
<span class="-5699213192866872541" onmouseenter="enter('-5699213192866872541');" onmouseout="out('-5699213192866872541');" style="">  64  import org.hibernate.exception.ConstraintViolationException;                                                      </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  65  import org.springframework.stereotype.Service;                                                                    </span>
<span  style="">  66                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  67  import java.util.ArrayList;                                                                                       </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  68  import java.util.Arrays;                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  69  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  70  import java.util.List;                                                                                            </span>
<span class="174663421494487417" onmouseenter="enter('174663421494487417');" onmouseout="out('174663421494487417');" style="">  71  import java.util.ListIterator;                                                                                    </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  72  import java.util.Map;                                                                                             </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  73  import java.util.Map.Entry;                                                                                       </span>
<span  style="">  74                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  75  import javax.annotation.Resource;                                                                                 </span>
<span class="7911938180110628123" onmouseenter="enter('7911938180110628123');" onmouseout="out('7911938180110628123');" style="">  76  import javax.persistence.EntityManager;                                                                           </span>
<span class="3821515051839343306" onmouseenter="enter('3821515051839343306');" onmouseout="out('3821515051839343306');" style="">  77  import javax.persistence.PersistenceContext;                                                                      </span>
<span  style="">  78                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  79  /**                                                                                                               </span>
<span class="-346667533686466806" onmouseenter="enter('-346667533686466806');" onmouseout="out('-346667533686466806');" style="">  80   * @author Andre Azzolini (apazzolini)                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  81   */                                                                                                               </span>
<span class="2205005937568393687" onmouseenter="enter('2205005937568393687');" onmouseout="out('2205005937568393687');" style="">  82  @Service(&quot;blAdminEntityService&quot;)                                                                                  </span>
<span class="-2691323185499418706" onmouseenter="enter('-2691323185499418706');" onmouseout="out('-2691323185499418706');" style="">  83  public class AdminEntityServiceImpl implements AdminEntityService {                                               </span>
<span  style="">  84                                                                                                                    </span>
<span class="6898728355289688423" onmouseenter="enter('6898728355289688423');" onmouseout="out('6898728355289688423');" style="">  85      protected static final Log LOG = LogFactory.getLog(AdminEntityServiceImpl.class);                             </span>
<span  style="">  86                                                                                                                    </span>
<span class="6303589118895976221" onmouseenter="enter('6303589118895976221');" onmouseout="out('6303589118895976221');" style="">  87      @Resource(name = &quot;blDynamicEntityRemoteService&quot;)                                                              </span>
<span class="1505564706419640906" onmouseenter="enter('1505564706419640906');" onmouseout="out('1505564706419640906');" style="">  88      protected DynamicEntityService service;                                                                       </span>
<span  style="">  89                                                                                                                    </span>
<span class="-5295563268582613053" onmouseenter="enter('-5295563268582613053');" onmouseout="out('-5295563268582613053');" style="">  90      @Resource(name = &quot;blPersistencePackageFactory&quot;)                                                               </span>
<span class="5077122885687298736" onmouseenter="enter('5077122885687298736');" onmouseout="out('5077122885687298736');" style="">  91      protected PersistencePackageFactory persistencePackageFactory;                                                </span>
<span  style="">  92                                                                                                                    </span>
<span class="5710637357667853932" onmouseenter="enter('5710637357667853932');" onmouseout="out('5710637357667853932');" style="">  93      @PersistenceContext(unitName = &quot;blPU&quot;)                                                                        </span>
<span class="-5741815223868414625" onmouseenter="enter('-5741815223868414625');" onmouseout="out('-5741815223868414625');" style="">  94      protected EntityManager em;                                                                                   </span>
<span  style="">  95                                                                                                                    </span>
<span class="6650882675825573659" onmouseenter="enter('6650882675825573659');" onmouseout="out('6650882675825573659');" style="">  96      @Resource(name = &quot;blEntityConfiguration&quot;)                                                                     </span>
<span class="-8812870795397979367" onmouseenter="enter('-8812870795397979367');" onmouseout="out('-8812870795397979367');" style="">  97      protected EntityConfiguration entityConfiguration;                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +                                                                                                                  </span>
<span class="-2309360235309114106" onmouseenter="enter('-2309360235309114106');" onmouseout="out('-2309360235309114106');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +    @Resource                                                                                                     </span>
<span class="5773081278430031986" onmouseenter="enter('5773081278430031986');" onmouseout="out('5773081278430031986');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +    protected CriteriaTransferObjectExtensionManager extensionManager;                                            </span>
<span  style=""> 101                                                                                                                    </span>
<span class="6769863436851689394" onmouseenter="enter('6769863436851689394');" onmouseout="out('6769863436851689394');" style=""> 102      protected DynamicDaoHelper dynamicDaoHelper = new DynamicDaoHelperImpl();                                     </span>
<span  style=""> 103                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 104      @Override                                                                                                     </span>
<span class="689806418400872386" onmouseenter="enter('689806418400872386');" onmouseout="out('689806418400872386');" style=""> 105      public PersistenceResponse getClassMetadata(PersistencePackageRequest request)                                </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 106              throws ServiceException {                                                                             </span>
<span class="-477483751520958137" onmouseenter="enter('-477483751520958137');" onmouseout="out('-477483751520958137');" style=""> 107          PersistenceResponse response = inspect(request);                                                          </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 108          ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                                    </span>
<span class="4495915987564569811" onmouseenter="enter('4495915987564569811');" onmouseout="out('4495915987564569811');" style=""> 109          cmd.setCeilingType(request.getCeilingEntityClassname());                                                  </span>
<span class="-7633911880463002125" onmouseenter="enter('-7633911880463002125');" onmouseout="out('-7633911880463002125');" style=""> 110          cmd.setSecurityCeilingType(request.getSecurityCeilingEntityClassname());                                  </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 111          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112      }                                                                                                             </span>
<span  style=""> 113                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 114      @Override                                                                                                     </span>
<span class="6442257948747151854" onmouseenter="enter('6442257948747151854');" onmouseout="out('6442257948747151854');" style=""> 115      public PersistenceResponse getRecords(PersistencePackageRequest request) throws ServiceException {            </span>
<span class="-8968772654133629352" onmouseenter="enter('-8968772654133629352');" onmouseout="out('-8968772654133629352');" style=""> 116          return fetch(request);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117      }                                                                                                             </span>
<span  style=""> 118                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 119      @Override                                                                                                     </span>
<span class="4020809512296494224" onmouseenter="enter('4020809512296494224');" onmouseout="out('4020809512296494224');" style=""><abbr title=" 120      public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd, boolean isCollectionRequest)"> 120      public PersistenceResponse getRecord(PersistencePackageRequest request, String id, ClassMetadata cmd, boolean ðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 121              throws ServiceException {                                                                             </span>
<span class="-5399859376019632364" onmouseenter="enter('-5399859376019632364');" onmouseout="out('-5399859376019632364');" style=""> 122          String idProperty = getIdProperty(cmd);                                                                   </span>
<span  style=""> 123                                                                                                                    </span>
<span class="1207908904787390154" onmouseenter="enter('1207908904787390154');" onmouseout="out('1207908904787390154');" style=""> 124          FilterAndSortCriteria fasc = new FilterAndSortCriteria(idProperty);                                       </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 125          fasc.setFilterValue(id);                                                                                  </span>
<span class="-8339504512820574544" onmouseenter="enter('-8339504512820574544');" onmouseout="out('-8339504512820574544');" style=""> 126          request.addFilterAndSortCriteria(fasc);                                                                   </span>
<span  style=""> 127                                                                                                                    </span>
<span class="-1381837102214910163" onmouseenter="enter('-1381837102214910163');" onmouseout="out('-1381837102214910163');" style=""> 128          PersistenceResponse response = fetch(request);                                                            </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 129          Entity[] entities = response.getDynamicResultSet().getRecords();                                          </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 130          if (ArrayUtils.isEmpty(entities)) {                                                                       </span>
<span class="3317501704848962820" onmouseenter="enter('3317501704848962820');" onmouseout="out('3317501704848962820');" style=""> 131              String celiningEntity = request.getCeilingEntityClassname();                                          </span>
<span class="1970293616538386874" onmouseenter="enter('1970293616538386874');" onmouseout="out('1970293616538386874');" style=""><abbr title=" 132              throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiningEntity, id));"> 132              throw new EntityNotFoundException(String.format(&quot;Could not find Entity %s with ID %s&quot;, celiningEntity,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133          }                                                                                                         </span>
<span  style=""> 134                                                                                                                    </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 135          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136      }                                                                                                             </span>
<span  style=""> 137                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 138      @Override                                                                                                     </span>
<span class="-7201975922678164147" onmouseenter="enter('-7201975922678164147');" onmouseout="out('-7201975922678164147');" style=""><abbr title=" 139      public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 139      public PersistenceResponse addEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectioðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""> 140          PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);        </span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 141          // If the entity form has dynamic forms inside of it, we need to persist those as well.                   </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 142          // They are typically done in their own custom persistence handlers, which will get triggered             </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 143          // based on the criteria specific in the PersistencePackage.                                              </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 144          for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                         </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 145              DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                           </span>
<span  style=""> 146                                                                                                                    </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 147              if (info.getCustomCriteriaOverride() != null) {                                                       </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 148                  customCriteria = info.getCustomCriteriaOverride();                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 149              } else {                                                                                              </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 150                  String propertyName = info.getPropertyName();                                                     </span>
<span class="3293102538279717811" onmouseenter="enter('3293102538279717811');" onmouseout="out('3293102538279717811');" style=""> 151                  String propertyValue;                                                                             </span>
<span class="3903441351658368829" onmouseenter="enter('3903441351658368829');" onmouseout="out('3903441351658368829');" style=""> 152                  if (entityForm.getFields().containsKey(propertyName)) {                                           </span>
<span class="-3364727408470092918" onmouseenter="enter('-3364727408470092918');" onmouseout="out('-3364727408470092918');" style=""> 153                      propertyValue = entityForm.findField(propertyName).getValue();                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 154                  } else {                                                                                          </span>
<span class="6725656947693910623" onmouseenter="enter('6725656947693910623');" onmouseout="out('6725656947693910623');" style=""> 155                      propertyValue = info.getPropertyValue();                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                  }                                                                                                 </span>
<span class="-5306746194951417463" onmouseenter="enter('-5306746194951417463');" onmouseout="out('-5306746194951417463');" style=""><abbr title=" 157                  customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue};"> 157                  customCriteria = new String[] {info.getCriteriaName(), entityForm.getId(), propertyName, propertyVðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158              }                                                                                                     </span>
<span  style=""> 159                                                                                                                    </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 160              PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 160              PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectiðŸ”µ</abbr></span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 161              ppr.addSubRequest(info.getPropertyName(), subRequest);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162          }                                                                                                         </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 163          return add(ppr);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164      }                                                                                                             </span>
<span  style=""> 165                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 166      @Override                                                                                                     </span>
<span class="2877208390579447415" onmouseenter="enter('2877208390579447415');" onmouseout="out('2877208390579447415');" style=""><abbr title=" 167      public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 167      public PersistenceResponse updateEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; secðŸ”µ</abbr></span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""> 168          PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);        </span>
<span class="5530250091258169917" onmouseenter="enter('5530250091258169917');" onmouseout="out('5530250091258169917');" style=""> 169          ppr.setRequestingEntityName(entityForm.getMainEntityName());                                              </span>
<span class="1172992901875404502" onmouseenter="enter('1172992901875404502');" onmouseout="out('1172992901875404502');" style=""> 170          // If the entity form has dynamic forms inside of it, we need to persist those as well.                   </span>
<span class="-2415067027621481887" onmouseenter="enter('-2415067027621481887');" onmouseout="out('-2415067027621481887');" style=""> 171          // They are typically done in their own custom persistence handlers, which will get triggered             </span>
<span class="-4246011613299137487" onmouseenter="enter('-4246011613299137487');" onmouseout="out('-4246011613299137487');" style=""> 172          // based on the criteria specific in the PersistencePackage.                                              </span>
<span class="-6898379861324213017" onmouseenter="enter('-6898379861324213017');" onmouseout="out('-6898379861324213017');" style=""> 173          for (Entry&lt;String, EntityForm&gt; entry : entityForm.getDynamicForms().entrySet()) {                         </span>
<span class="4921820262023916995" onmouseenter="enter('4921820262023916995');" onmouseout="out('4921820262023916995');" style=""> 174              DynamicEntityFormInfo info = entityForm.getDynamicFormInfo(entry.getKey());                           </span>
<span  style=""> 175                                                                                                                    </span>
<span class="-8740801272281121574" onmouseenter="enter('-8740801272281121574');" onmouseout="out('-8740801272281121574');" style=""> 176              if (info.getCustomCriteriaOverride() != null) {                                                       </span>
<span class="778029012819620835" onmouseenter="enter('778029012819620835');" onmouseout="out('778029012819620835');" style=""> 177                  customCriteria = info.getCustomCriteriaOverride();                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 178              } else {                                                                                              </span>
<span class="6576989227163891964" onmouseenter="enter('6576989227163891964');" onmouseout="out('6576989227163891964');" style=""> 179                  String propertyName = info.getPropertyName();                                                     </span>
<span class="8503945409701800913" onmouseenter="enter('8503945409701800913');" onmouseout="out('8503945409701800913');" style=""> 180                  String propertyValue = entityForm.findField(propertyName).getValue();                             </span>
<span class="-4083933246171517436" onmouseenter="enter('-4083933246171517436');" onmouseout="out('-4083933246171517436');" style=""><abbr title=" 181                  customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName, propertyValue };"> 181                  customCriteria = new String[] { info.getCriteriaName(), entityForm.getId(), propertyName, propertyðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182              }                                                                                                     </span>
<span  style=""> 183                                                                                                                    </span>
<span class="-8232444683341924371" onmouseenter="enter('-8232444683341924371');" onmouseout="out('-8232444683341924371');" style=""><abbr title=" 184              PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectionCrumb);"> 184              PersistencePackageRequest subRequest = getRequestForEntityForm(entry.getValue(), customCriteria, sectiðŸ”µ</abbr></span>
<span class="3320363489874291671" onmouseenter="enter('3320363489874291671');" onmouseout="out('3320363489874291671');" style=""> 185              subRequest.withSecurityCeilingEntityClassname(info.getSecurityCeilingClassName());                    </span>
<span class="-1272981255996463145" onmouseenter="enter('-1272981255996463145');" onmouseout="out('-1272981255996463145');" style=""> 186              ppr.addSubRequest(info.getPropertyName(), subRequest);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187          }                                                                                                         </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 188          return update(ppr);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189      }                                                                                                             </span>
<span  style=""> 190                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 191      @Override                                                                                                     </span>
<span class="369147730756947995" onmouseenter="enter('369147730756947995');" onmouseout="out('369147730756947995');" style=""><abbr title=" 192      public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumb)"> 192      public PersistenceResponse removeEntity(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; secðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 193              throws ServiceException {                                                                             </span>
<span class="-5321666247262572163" onmouseenter="enter('-5321666247262572163');" onmouseout="out('-5321666247262572163');" style=""> 194          PersistencePackageRequest ppr = getRequestForEntityForm(entityForm, customCriteria, sectionCrumb);        </span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 195          return remove(ppr);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196      }                                                                                                             </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-4457012513682950961" onmouseenter="enter('-4457012513682950961');" onmouseout="out('-4457012513682950961');" style=""> 198      protected List&lt;Property&gt; getPropertiesFromEntityForm(EntityForm entityForm) {                                 </span>
<span class="5502280122802762543" onmouseenter="enter('5502280122802762543');" onmouseout="out('5502280122802762543');" style=""> 199          List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;(entityForm.getFields().size());                       </span>
<span  style=""> 200                                                                                                                    </span>
<span class="-1983225226345189396" onmouseenter="enter('-1983225226345189396');" onmouseout="out('-1983225226345189396');" style=""> 201          for (Entry&lt;String, Field&gt; entry : entityForm.getFields().entrySet()) {                                    </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 202              Property p = new Property();                                                                          </span>
<span class="1947374185751812962" onmouseenter="enter('1947374185751812962');" onmouseout="out('1947374185751812962');" style=""> 203              p.setName(entry.getKey());                                                                            </span>
<span class="-7008764564116424461" onmouseenter="enter('-7008764564116424461');" onmouseout="out('-7008764564116424461');" style=""> 204              p.setValue(entry.getValue().getValue());                                                              </span>
<span class="4978688160201726577" onmouseenter="enter('4978688160201726577');" onmouseout="out('4978688160201726577');" style=""> 205              p.setDisplayValue(entry.getValue().getDisplayValue());                                                </span>
<span class="9200882176886832259" onmouseenter="enter('9200882176886832259');" onmouseout="out('9200882176886832259');" style=""> 206              p.setIsDirty(entry.getValue().getIsDirty());                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 207              properties.add(p);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208          }                                                                                                         </span>
<span  style=""> 209                                                                                                                    </span>
<span class="7053686412803007774" onmouseenter="enter('7053686412803007774');" onmouseout="out('7053686412803007774');" style=""> 210          return properties;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211      }                                                                                                             </span>
<span  style=""> 212                                                                                                                    </span>

<span class="7722997034713089523" onmouseenter="enter('7722997034713089523');" onmouseout="out('7722997034713089523');" style=""><abbr title=" 213      public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriteria, List&lt;SectionCrumb&gt; sectionCrumbs) {"> 213      public PersistencePackageRequest getRequestForEntityForm(EntityForm entityForm, String[] customCriteria, List&lt;ðŸ”µ</abbr></span>
<span class="-704234828580880941" onmouseenter="enter('-704234828580880941');" onmouseout="out('-704234828580880941');" style=""> 214          // Ensure the ID property is on the form                                                                  </span>
<span class="-5311876513799607800" onmouseenter="enter('-5311876513799607800');" onmouseout="out('-5311876513799607800');" style=""> 215          Field idField = entityForm.findField(entityForm.getIdProperty());                                         </span>
<span class="-5694238240637206409" onmouseenter="enter('-5694238240637206409');" onmouseout="out('-5694238240637206409');" style=""> 216          if (idField == null) {                                                                                    </span>
<span class="250587265755875585" onmouseenter="enter('250587265755875585');" onmouseout="out('250587265755875585');" style=""> 217              idField = new Field();                                                                                </span>
<span class="7054903396669057342" onmouseenter="enter('7054903396669057342');" onmouseout="out('7054903396669057342');" style=""> 218              idField.setName(entityForm.getIdProperty());                                                          </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 219              idField.setValue(entityForm.getId());                                                                 </span>
<span class="-7557326149225538579" onmouseenter="enter('-7557326149225538579');" onmouseout="out('-7557326149225538579');" style=""> 220              entityForm.getFields().put(entityForm.getIdProperty(), idField);                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 221          } else {                                                                                                  </span>
<span class="-8729833749939928561" onmouseenter="enter('-8729833749939928561');" onmouseout="out('-8729833749939928561');" style=""> 222              idField.setValue(entityForm.getId());                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223          }                                                                                                         </span>
<span  style=""> 224                                                                                                                    </span>
<span class="2582109723187805610" onmouseenter="enter('2582109723187805610');" onmouseout="out('2582109723187805610');" style=""> 225          List&lt;Property&gt; propList = getPropertiesFromEntityForm(entityForm);                                        </span>
<span class="-5301080913609099643" onmouseenter="enter('-5301080913609099643');" onmouseout="out('-5301080913609099643');" style=""> 226          Property[] properties = new Property[propList.size()];                                                    </span>
<span class="-3900695733940297394" onmouseenter="enter('-3900695733940297394');" onmouseout="out('-3900695733940297394');" style=""> 227          properties = propList.toArray(properties);                                                                </span>
<span  style=""> 228                                                                                                                    </span>
<span class="-4105415098036700385" onmouseenter="enter('-4105415098036700385');" onmouseout="out('-4105415098036700385');" style=""> 229          Entity entity = new Entity();                                                                             </span>
<span class="-2371781861505771230" onmouseenter="enter('-2371781861505771230');" onmouseout="out('-2371781861505771230');" style=""> 230          entity.setProperties(properties);                                                                         </span>
<span class="2583214667713512490" onmouseenter="enter('2583214667713512490');" onmouseout="out('2583214667713512490');" style=""> 231          String entityType = entityForm.getEntityType();                                                           </span>
<span class="-96692239825780670" onmouseenter="enter('-96692239825780670');" onmouseout="out('-96692239825780670');" style=""> 232          if (StringUtils.isEmpty(entityType)) {                                                                    </span>
<span class="-1511101492052020501" onmouseenter="enter('-1511101492052020501');" onmouseout="out('-1511101492052020501');" style=""> 233              entityType = entityForm.getCeilingEntityClassname();                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234          }                                                                                                         </span>
<span class="7921575741096618275" onmouseenter="enter('7921575741096618275');" onmouseout="out('7921575741096618275');" style=""> 235          entity.setType(new String[]{entityType});                                                                 </span>
<span  style=""> 236                                                                                                                    </span>
<span class="2943675610735544566" onmouseenter="enter('2943675610735544566');" onmouseout="out('2943675610735544566');" style=""> 237          PersistencePackageRequest ppr = PersistencePackageRequest.standard()                                      </span>
<span class="-2471313258794916634" onmouseenter="enter('-2471313258794916634');" onmouseout="out('-2471313258794916634');" style=""> 238                  .withEntity(entity)                                                                               </span>
<span class="5641680747003306930" onmouseenter="enter('5641680747003306930');" onmouseout="out('5641680747003306930');" style=""> 239                  .withCustomCriteria(customCriteria)                                                               </span>
<span class="3304977465026105541" onmouseenter="enter('3304977465026105541');" onmouseout="out('3304977465026105541');" style=""> 240                  .withCeilingEntityClassname(entityForm.getCeilingEntityClassname())                               </span>
<span class="-600959917227055027" onmouseenter="enter('-600959917227055027');" onmouseout="out('-600959917227055027');" style=""> 241                  .withSectionCrumbs(sectionCrumbs)                                                                 </span>
<span class="745722289441255857" onmouseenter="enter('745722289441255857');" onmouseout="out('745722289441255857');" style=""> 242                  .withRequestingEntityName(entityForm.getMainEntityName());                                        </span>
<span class="-1955805470028526694" onmouseenter="enter('-1955805470028526694');" onmouseout="out('-1955805470028526694');" style=""> 243          return ppr;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244      }                                                                                                             </span>
<span  style=""> 245                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 246      @Override                                                                                                     </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 247      public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 247      public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containinðŸ”µ</abbr></span>
<span class="6970881093397655354" onmouseenter="enter('6970881093397655354');" onmouseout="out('6970881093397655354');" style=""><abbr title=" 248              Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId)"> 248              Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternaðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 249              throws ServiceException {                                                                             </span>
<span class="-8379471421074460507" onmouseenter="enter('-8379471421074460507');" onmouseout="out('-8379471421074460507');" style=""><abbr title=" 250          return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty, collectionItemId, sectionCrumbs, alternateId, null);"> 250          return getAdvancedCollectionRecord(containingClassMetadata, containingEntity, collectionProperty, collectiðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251      }                                                                                                             </span>
<span  style=""> 252                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 253      @Override                                                                                                     </span>
<span class="8538648779576173824" onmouseenter="enter('8538648779576173824');" onmouseout="out('8538648779576173824');" style=""><abbr title=" 254      public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containingEntity,"> 254      public PersistenceResponse getAdvancedCollectionRecord(ClassMetadata containingClassMetadata, Entity containinðŸ”µ</abbr></span>
<span class="-7996433221423208195" onmouseenter="enter('-7996433221423208195');" onmouseout="out('-7996433221423208195');" style=""><abbr title=" 255              Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternateId,"> 255              Property collectionProperty, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumbs, String alternaðŸ”µ</abbr></span>
<span class="4731322974144125980" onmouseenter="enter('4731322974144125980');" onmouseout="out('4731322974144125980');" style=""> 256              String[] customCriteria) throws ServiceException {                                                    </span>
<span class="-279994379320395128" onmouseenter="enter('-279994379320395128');" onmouseout="out('-279994379320395128');" style=""><abbr title=" 257          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs);"> 257          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sðŸ”µ</abbr></span>
<span  style=""> 258                                                                                                                    </span>
<span class="-1281430943574994988" onmouseenter="enter('-1281430943574994988');" onmouseout="out('-1281430943574994988');" style=""> 259          ppr.addCustomCriteria(customCriteria);                                                                    </span>
<span  style=""> 260                                                                                                                    </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 261          FieldMetadata md = collectionProperty.getMetadata();                                                      </span>
<span class="3724000031963826131" onmouseenter="enter('3724000031963826131');" onmouseout="out('3724000031963826131');" style=""> 262          String containingEntityId = getContextSpecificRelationshipId(containingClassMetadata, containingEntity,   </span>
<span class="-7103210414980095383" onmouseenter="enter('-7103210414980095383');" onmouseout="out('-7103210414980095383');" style=""> 263                  collectionProperty.getName());                                                                    </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 264          ppr.setSectionEntityField(collectionProperty.getName());                                                  </span>
<span  style=""> 265                                                                                                                    </span>
<span class="6887268983731320356" onmouseenter="enter('6887268983731320356');" onmouseout="out('6887268983731320356');" style=""> 266          PersistenceResponse response;                                                                             </span>
<span  style=""> 267                                                                                                                    </span>
<span class="-5961537470500127604" onmouseenter="enter('-5961537470500127604');" onmouseout="out('-5961537470500127604');" style=""> 268          if (md instanceof AdornedTargetCollectionMetadata) {                                                      </span>
<span class="8356058175939814254" onmouseenter="enter('8356058175939814254');" onmouseout="out('8356058175939814254');" style=""> 269              FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());</span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 270              fasc.setFilterValue(containingEntityId);                                                              </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 271              ppr.addFilterAndSortCriteria(fasc);                                                                   </span>
<span  style=""> 272                                                                                                                    </span>
<span class="-3458751872436187064" onmouseenter="enter('-3458751872436187064');" onmouseout="out('-3458751872436187064');" style=""> 273              fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName() + &quot;Target&quot;);           </span>
<span class="-3598598531395908508" onmouseenter="enter('-3598598531395908508');" onmouseout="out('-3598598531395908508');" style=""> 274              fasc.setFilterValue(collectionItemId);                                                                </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 275              ppr.addFilterAndSortCriteria(fasc);                                                                   </span>
<span  style=""> 276                                                                                                                    </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 277              if (!StringUtils.isEmpty(alternateId)) {                                                              </span>
<span class="-5748606955827926888" onmouseenter="enter('-5748606955827926888');" onmouseout="out('-5748606955827926888');" style=""> 278                  fasc = new FilterAndSortCriteria(ppr.getAdornedList().getIdProperty());                           </span>
<span class="7811712685421146637" onmouseenter="enter('7811712685421146637');" onmouseout="out('7811712685421146637');" style=""> 279                  fasc.setFilterValue(alternateId);                                                                 </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 280                  ppr.addFilterAndSortCriteria(fasc);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281              }                                                                                                     </span>
<span  style=""> 282                                                                                                                    </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 283              response = fetch(ppr);                                                                                </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 284              Entity[] entities = response.getDynamicResultSet().getRecords();                                      </span>
<span class="-6039743970940023103" onmouseenter="enter('-6039743970940023103');" onmouseout="out('-6039743970940023103');" style=""> 285              if (ArrayUtils.isEmpty(entities)) {                                                                   </span>
<span class="-6945066260128413327" onmouseenter="enter('-6945066260128413327');" onmouseout="out('-6945066260128413327');" style=""> 286                  String altId = (!StringUtils.isEmpty(alternateId)) ? alternateId : &quot;&quot;;                            </span>
<span class="6252787461298878948" onmouseenter="enter('6252787461298878948');" onmouseout="out('6252787461298878948');" style=""><abbr title=" 287                  throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%s], id [%s], targetId [%s], alternateId [%s] &quot;,"> 287                  throw new EntityNotFoundException(String.format(&quot;Could not find Entity for [%s], field [%s], id [%ðŸ”µ</abbr></span>
<span class="-631993348779519244" onmouseenter="enter('-631993348779519244');" onmouseout="out('-631993348779519244');" style=""><abbr title=" 288                          ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), containingEntityId, collectionItemId, altId));"> 288                          ppr.getCeilingEntityClassname(), ppr.getAdornedList().getCollectionFieldName(), containingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289              }                                                                                                     </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 290          } else if (md instanceof MapMetadata) {                                                                   </span>
<span class="8401290555692845532" onmouseenter="enter('8401290555692845532');" onmouseout="out('8401290555692845532');" style=""> 291              MapMetadata mmd = (MapMetadata) md;                                                                   </span>
<span class="-9165857322565832123" onmouseenter="enter('-9165857322565832123');" onmouseout="out('-9165857322565832123');" style=""> 292              FilterAndSortCriteria fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());         </span>
<span class="730498867982087519" onmouseenter="enter('730498867982087519');" onmouseout="out('730498867982087519');" style=""> 293              fasc.setFilterValue(containingEntityId);                                                              </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 294              ppr.addFilterAndSortCriteria(fasc);                                                                   </span>
<span  style=""> 295                                                                                                                    </span>
<span class="4549176724684127307" onmouseenter="enter('4549176724684127307');" onmouseout="out('4549176724684127307');" style=""> 296              response = fetch(ppr);                                                                                </span>
<span class="-3453136365149086636" onmouseenter="enter('-3453136365149086636');" onmouseout="out('-3453136365149086636');" style=""> 297              Entity[] entities = response.getDynamicResultSet().getRecords();                                      </span>
<span class="-7031469698370723184" onmouseenter="enter('-7031469698370723184');" onmouseout="out('-7031469698370723184');" style=""> 298              for (Entity e : entities) {                                                                           </span>
<span class="5353809260142967112" onmouseenter="enter('5353809260142967112');" onmouseout="out('5353809260142967112');" style=""> 299                  String idProperty = getIdProperty(containingClassMetadata);                                       </span>
<span class="5591331798883124479" onmouseenter="enter('5591331798883124479');" onmouseout="out('5591331798883124479');" style=""> 300                  if (mmd.isSimpleValue()) {                                                                        </span>
<span class="-4161155795101164165" onmouseenter="enter('-4161155795101164165');" onmouseout="out('-4161155795101164165');" style=""> 301                      idProperty = &quot;key&quot;;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302                  }                                                                                                 </span>
<span class="8921593406962610258" onmouseenter="enter('8921593406962610258');" onmouseout="out('8921593406962610258');" style=""> 303                  Property p = e.getPMap().get(idProperty);                                                         </span>
<span class="6407772199744557069" onmouseenter="enter('6407772199744557069');" onmouseout="out('6407772199744557069');" style=""> 304                  if (p.getValue().equals(collectionItemId)) {                                                      </span>
<span class="-7132868348925489606" onmouseenter="enter('-7132868348925489606');" onmouseout="out('-7132868348925489606');" style=""> 305                      response.setEntity(e);                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 306                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308              }                                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 309          } else {                                                                                                  </span>
<span class="8229323461389456522" onmouseenter="enter('8229323461389456522');" onmouseout="out('8229323461389456522');" style=""><abbr title=" 310              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not an &quot; +"> 310              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not an &quot;ðŸ”µ</abbr></span>
<span class="8394443338285651390" onmouseenter="enter('8394443338285651390');" onmouseout="out('8394443338285651390');" style=""><abbr title=" 311                      &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));"> 311                      &quot;advanced collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312          }                                                                                                         </span>
<span  style=""> 313                                                                                                                    </span>
<span class="-1838489616061912436" onmouseenter="enter('-1838489616061912436');" onmouseout="out('-1838489616061912436');" style=""> 314          return response;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315      }                                                                                                             </span>
<span  style=""> 316                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 317      @Override                                                                                                     </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 318      public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 318      public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntðŸ”µ</abbr></span>
<span class="-8940960037863570008" onmouseenter="enter('-8940960037863570008');" onmouseout="out('-8940960037863570008');" style=""><abbr title=" 319              Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 319              Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex, ListðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 320              throws ServiceException {                                                                             </span>
<span class="4618756740023180601" onmouseenter="enter('4618756740023180601');" onmouseout="out('4618756740023180601');" style=""><abbr title=" 321          return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, startIndex,"> 321          return getRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, startðŸ”µ</abbr></span>
<span class="2241863538673887409" onmouseenter="enter('2241863538673887409');" onmouseout="out('2241863538673887409');" style=""> 322                  maxIndex, null, sectionCrumb);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323      }                                                                                                             </span>
<span  style=""> 324                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 325      @Override                                                                                                     </span>
<span class="-7201231903947653503" onmouseenter="enter('-7201231903947653503');" onmouseout="out('-7201231903947653503');" style=""><abbr title=" 326      public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 326      public PersistenceResponse getPagedRecordsForCollection(ClassMetadata containingClassMetadata, Entity containiðŸ”µ</abbr></span>
<span class="418251651311673518" onmouseenter="enter('418251651311673518');" onmouseout="out('418251651311673518');" style=""> 327              Property collectionProperty, FilterAndSortCriteria[] fascs, FetchPageRequest fetchPageRequest,        </span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 328              String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {                   </span>
<span class="7874520314895198323" onmouseenter="enter('7874520314895198323');" onmouseout="out('7874520314895198323');" style=""><abbr title=" 329          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sectionCrumbs)"> 329          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata(), sðŸ”µ</abbr></span>
<span class="-7469251084029012642" onmouseenter="enter('-7469251084029012642');" onmouseout="out('-7469251084029012642');" style=""> 330              .withFilterAndSortCriteria(fascs)                                                                     </span>
<span class="-7573135850576319031" onmouseenter="enter('-7573135850576319031');" onmouseout="out('-7573135850576319031');" style=""> 331              .withStartIndex(fetchPageRequest.getStartIndex())                                                     </span>
<span class="-3581511696188385312" onmouseenter="enter('-3581511696188385312');" onmouseout="out('-3581511696188385312');" style=""> 332              .withMaxIndex(fetchPageRequest.getMaxIndex())                                                         </span>
<span class="-8590301553347003975" onmouseenter="enter('-8590301553347003975');" onmouseout="out('-8590301553347003975');" style=""> 333              .withFirstId(fetchPageRequest.getFirstId())                                                           </span>
<span class="2671174632142808768" onmouseenter="enter('2671174632142808768');" onmouseout="out('2671174632142808768');" style=""> 334              .withLastId(fetchPageRequest.getLastId())                                                             </span>
<span class="-6593991434037097050" onmouseenter="enter('-6593991434037097050');" onmouseout="out('-6593991434037097050');" style=""> 335              .withLowerCount(fetchPageRequest.getLowerCount())                                                     </span>
<span class="-117029417959198312" onmouseenter="enter('-117029417959198312');" onmouseout="out('-117029417959198312');" style=""> 336              .withUpperCount(fetchPageRequest.getUpperCount())                                                     </span>
<span class="-4278016885305366423" onmouseenter="enter('-4278016885305366423');" onmouseout="out('-4278016885305366423');" style=""> 337              .withPageSize(fetchPageRequest.getPageSize())                                                         </span>
<span class="-6582704259903712752" onmouseenter="enter('-6582704259903712752');" onmouseout="out('-6582704259903712752');" style=""> 338              .withPresentationFetch(true);                                                                         </span>
<span  style=""> 339                                                                                                                    </span>
<span class="-3273025574919321412" onmouseenter="enter('-3273025574919321412');" onmouseout="out('-3273025574919321412');" style=""> 340          FilterAndSortCriteria fasc;                                                                               </span>
<span  style=""> 341                                                                                                                    </span>
<span class="8267317305911636660" onmouseenter="enter('8267317305911636660');" onmouseout="out('8267317305911636660');" style=""> 342          FieldMetadata md = collectionProperty.getMetadata();                                                      </span>
<span class="-4862294775264679708" onmouseenter="enter('-4862294775264679708');" onmouseout="out('-4862294775264679708');" style=""> 343          String collectionCeilingClass = null;                                                                     </span>
<span  style=""> 344                                                                                                                    </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 345          if (md instanceof BasicCollectionMetadata) {                                                              </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 346              fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                               </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 347              collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();                      </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 348          } else if (md instanceof AdornedTargetCollectionMetadata) {                                               </span>
<span class="5713965317772328276" onmouseenter="enter('5713965317772328276');" onmouseout="out('5713965317772328276');" style=""> 349              fasc = new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());                      </span>
<span class="6691218965002726541" onmouseenter="enter('6691218965002726541');" onmouseout="out('6691218965002726541');" style=""> 350              collectionCeilingClass = ((CollectionMetadata) md).getCollectionCeilingEntity();                      </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 351          } else if (md instanceof MapMetadata) {                                                                   </span>
<span class="-8229346739369948" onmouseenter="enter('-8229346739369948');" onmouseout="out('-8229346739369948');" style=""> 352              fasc = new FilterAndSortCriteria(ppr.getForeignKey().getManyToField());                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 353          } else {                                                                                                  </span>
<span class="-7764689527754153249" onmouseenter="enter('-7764689527754153249');" onmouseout="out('-7764689527754153249');" style=""><abbr title=" 354              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not a &quot; +"> 354              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was not a &quot; ðŸ”µ</abbr></span>
<span class="9018729105513046766" onmouseenter="enter('9018729105513046766');" onmouseout="out('9018729105513046766');" style=""> 355                      &quot;collection field.&quot;, collectionProperty.getName(), containingClassMetadata.getCeilingType()));</span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356          }                                                                                                         </span>
<span  style=""> 357                                                                                                                    </span>
<span class="4254518413777245486" onmouseenter="enter('4254518413777245486');" onmouseout="out('4254518413777245486');" style=""> 358          String id;                                                                                                </span>
<span class="4803324110888028956" onmouseenter="enter('4803324110888028956');" onmouseout="out('4803324110888028956');" style=""> 359          if (idValueOverride == null) {                                                                            </span>
<span class="-7725769379673096748" onmouseenter="enter('-7725769379673096748');" onmouseout="out('-7725769379673096748');" style=""><abbr title=" 360              id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionProperty.getName());"> 360              id = getContextSpecificRelationshipId(containingClassMetadata, containingEntity, collectionProperty.geðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 361          } else {                                                                                                  </span>
<span class="-8702106967230782193" onmouseenter="enter('-8702106967230782193');" onmouseout="out('-8702106967230782193');" style=""> 362              id = idValueOverride;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363          }                                                                                                         </span>
<span class="-9072539862345163871" onmouseenter="enter('-9072539862345163871');" onmouseout="out('-9072539862345163871');" style=""> 364          fasc.setFilterValue(id);                                                                                  </span>
<span class="1848811711530646650" onmouseenter="enter('1848811711530646650');" onmouseout="out('1848811711530646650');" style=""> 365          ppr.addFilterAndSortCriteria(fasc);                                                                       </span>
<span  style=""> 366                                                                                                                    </span>
<span class="427990645680582522" onmouseenter="enter('427990645680582522');" onmouseout="out('427990645680582522');" style=""> 367          if (collectionCeilingClass != null) {                                                                     </span>
<span class="-6816699203213465846" onmouseenter="enter('-6816699203213465846');" onmouseout="out('-6816699203213465846');" style=""> 368              ppr.setCeilingEntityClassname(collectionCeilingClass);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369          }                                                                                                         </span>
<span class="8389780494495332992" onmouseenter="enter('8389780494495332992');" onmouseout="out('8389780494495332992');" style=""> 370          ppr.setSectionEntityField(collectionProperty.getName());                                                  </span>
<span  style=""> 371                                                                                                                    </span>
<span class="4509000565359254391" onmouseenter="enter('4509000565359254391');" onmouseout="out('4509000565359254391');" style=""> 372          return fetch(ppr);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373      }                                                                                                             </span>
<span  style=""> 374                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 375      @Override                                                                                                     </span>
<span class="8124015718588453853" onmouseenter="enter('8124015718588453853');" onmouseout="out('8124015718588453853');" style=""><abbr title=" 376      public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntity,"> 376      public PersistenceResponse getRecordsForCollection(ClassMetadata containingClassMetadata, Entity containingEntðŸ”µ</abbr></span>
<span class="509622451136715712" onmouseenter="enter('509622451136715712');" onmouseout="out('509622451136715712');" style=""> 377              Property collectionProperty, FilterAndSortCriteria[] fascs, Integer startIndex, Integer maxIndex,     </span>
<span class="8903671243942909584" onmouseenter="enter('8903671243942909584');" onmouseout="out('8903671243942909584');" style=""> 378              String idValueOverride, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {                   </span>
<span class="-1197294568643910019" onmouseenter="enter('-1197294568643910019');" onmouseout="out('-1197294568643910019');" style=""> 379          FetchPageRequest pageRequest = new FetchPageRequest().withStartIndex(startIndex).withMaxIndex(maxIndex);  </span>
<span class="-1074537376579155932" onmouseenter="enter('-1074537376579155932');" onmouseout="out('-1074537376579155932');" style=""> 380          return getPagedRecordsForCollection(containingClassMetadata, containingEntity, collectionProperty, fascs, </span>
<span class="-3163237569846875940" onmouseenter="enter('-3163237569846875940');" onmouseout="out('-3163237569846875940');" style=""> 381                  pageRequest, idValueOverride, sectionCrumbs);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 382      }                                                                                                             </span>
<span  style=""> 383                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 384      @Override                                                                                                     </span>
<span class="-3841297295714521949" onmouseenter="enter('-3841297295714521949');" onmouseout="out('-3841297295714521949');" style=""><abbr title=" 385      public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, Integer startIndex, Integer maxIndex, List&lt;SectionCrumb&gt; sectionCrumb)"> 385      public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity contðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 386              throws ServiceException {                                                                             </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 387          Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                              </span>
<span  style=""> 388                                                                                                                    </span>
<span class="-733567857055224528" onmouseenter="enter('-733567857055224528');" onmouseout="out('-733567857055224528');" style=""> 389          PersistenceResponse response = getClassMetadata(ppr);                                                     </span>
<span class="7124502243119344538" onmouseenter="enter('7124502243119344538');" onmouseout="out('7124502243119344538');" style=""> 390          ClassMetadata cmd = response.getDynamicResultSet().getClassMetaData();                                    </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 391          for (Property p : cmd.getProperties()) {                                                                  </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 392              if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])         </span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 393                      &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                           </span>
<span class="8095643692447388517" onmouseenter="enter('8095643692447388517');" onmouseout="out('8095643692447388517');" style=""><abbr title=" 394                  PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, startIndex, maxIndex, sectionCrumb);"> 394                  PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, startIndexðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 395                  map.put(p.getName(), response2.getDynamicResultSet());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397          }                                                                                                         </span>
<span  style=""> 398                                                                                                                    </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 399          return map;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400      }                                                                                                             </span>
<span  style=""> 401                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 402      @Override                                                                                                     </span>
<span class="-3628970257678085943" onmouseenter="enter('-3628970257678085943');" onmouseout="out('-3628970257678085943');" style=""><abbr title=" 403      public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity containingEntity,"> 403      public Map&lt;String, DynamicResultSet&gt; getAllRecordsForAllSubCollections(ClassMetadata cmd, Entity containingEntðŸ”µ</abbr></span>
<span class="-4231090245204295086" onmouseenter="enter('-4231090245204295086');" onmouseout="out('-4231090245204295086');" style=""><abbr title=" 404                                                                             List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException {"> 404                                                                             List&lt;SectionCrumb&gt; sectionCrumb) throwsðŸ”µ</abbr></span>
<span class="-2409741133586104337" onmouseenter="enter('-2409741133586104337');" onmouseout="out('-2409741133586104337');" style=""> 405          Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;&gt;();                                                      </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 406          for (Property p : cmd.getProperties()) {                                                                  </span>
<span class="4164210101311278906" onmouseenter="enter('4164210101311278906');" onmouseout="out('4164210101311278906');" style=""> 407              FieldMetadata fieldMetadata = p.getMetadata();                                                        </span>
<span class="-4624883475289984299" onmouseenter="enter('-4624883475289984299');" onmouseout="out('-4624883475289984299');" style=""><abbr title=" 408              boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEntity.getType()[0]);"> 408              boolean fieldAvailable = ArrayUtils.contains(fieldMetadata.getAvailableToTypes(), containingEntity.getðŸ”µ</abbr></span>
<span class="527509468046610128" onmouseenter="enter('527509468046610128');" onmouseout="out('527509468046610128');" style=""> 409              if (fieldAvailable &amp;&amp; fieldMetadata instanceof CollectionMetadata) {                                  </span>
<span class="889550045664327310" onmouseenter="enter('889550045664327310');" onmouseout="out('889550045664327310');" style=""> 410                  FetchPageRequest pageRequest = new FetchPageRequest()                                             </span>
<span class="7756015397659671998" onmouseenter="enter('7756015397659671998');" onmouseout="out('7756015397659671998');" style=""> 411                          .withPageSize(Integer.MAX_VALUE);                                                         </span>
<span class="-5742395122034161641" onmouseenter="enter('-5742395122034161641');" onmouseout="out('-5742395122034161641');" style=""><abbr title=" 412                  PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pageRequest, null, sectionCrumb);"> 412                  PersistenceResponse resp = getPagedRecordsForCollection(cmd, containingEntity, p, null, pageRequesðŸ”µ</abbr></span>
<span class="7448530828258193539" onmouseenter="enter('7448530828258193539');" onmouseout="out('7448530828258193539');" style=""> 413                  map.put(p.getName(), resp.getDynamicResultSet());                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 414              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415          }                                                                                                         </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 416          return map;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 417      }                                                                                                             </span>
<span  style=""> 418                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 419      @Override                                                                                                     </span>
<span class="3589590817922421749" onmouseenter="enter('3589590817922421749');" onmouseout="out('3589590817922421749');" style=""><abbr title=" 420      public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb)"> 420      public Map&lt;String, DynamicResultSet&gt; getRecordsForAllSubCollections(PersistencePackageRequest ppr, Entity contðŸ”µ</abbr></span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 421              throws ServiceException {                                                                             </span>
<span  style=""> 422                                                                                                                    </span>
<span class="7186594912669123504" onmouseenter="enter('7186594912669123504');" onmouseout="out('7186594912669123504');" style=""> 423          return getRecordsForAllSubCollections(ppr, containingEntity, null, null, sectionCrumb);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424      }                                                                                                             </span>
<span  style=""> 425                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 426      @Override                                                                                                     </span>
<span class="-7386306397684799123" onmouseenter="enter('-7386306397684799123');" onmouseout="out('-7386306397684799123');" style=""><abbr title=" 427      public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntity, List&lt;SectionCrumb&gt; sectionCrumb,"> 427      public Map&lt;String, DynamicResultSet&gt; getRecordsForSelectedTab(ClassMetadata cmd, Entity containingEntity, ListðŸ”µ</abbr></span>
<span class="-5959215544738911709" onmouseenter="enter('-5959215544738911709');" onmouseout="out('-5959215544738911709');" style=""> 428              String currentTabName) throws ServiceException {                                                      </span>
<span class="1430355704637725938" onmouseenter="enter('1430355704637725938');" onmouseout="out('1430355704637725938');" style=""> 429          Map&lt;String, DynamicResultSet&gt; map = new HashMap&lt;String, DynamicResultSet&gt;();                              </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 430          for (Property p : cmd.getProperties()) {                                                                  </span>
<span class="-7572287475321253327" onmouseenter="enter('-7572287475321253327');" onmouseout="out('-7572287475321253327');" style=""> 431              if (ArrayUtils.contains(p.getMetadata().getAvailableToTypes(), containingEntity.getType()[0])         </span>
<span class="-9036902236233955298" onmouseenter="enter('-9036902236233955298');" onmouseout="out('-9036902236233955298');" style=""> 432                      &amp;&amp; p.getMetadata() instanceof CollectionMetadata) {                                           </span>
<span  style=""> 433                                                                                                                    </span>
<span class="-8882071661255371966" onmouseenter="enter('-8882071661255371966');" onmouseout="out('-8882071661255371966');" style=""> 434                  CollectionMetadata collectionMetadata = (CollectionMetadata) p.getMetadata();                     </span>
<span  style=""> 435                                                                                                                    </span>
<span class="-6866172471902490379" onmouseenter="enter('-6866172471902490379');" onmouseout="out('-6866172471902490379');" style=""> 436                  // Give preference to the Group since EntityForm.addListGrid() gives preference to the Group      </span>
<span class="5847566346942070760" onmouseenter="enter('5847566346942070760');" onmouseout="out('5847566346942070760');" style=""> 437                  TabMetadata tabMetadata = cmd.getTabMetadataUsingGroupKey(collectionMetadata.getGroup());         </span>
<span class="5004852122593217272" onmouseenter="enter('5004852122593217272');" onmouseout="out('5004852122593217272');" style=""> 438                  if (tabMetadata == null) {                                                                        </span>
<span class="231191347318133709" onmouseenter="enter('231191347318133709');" onmouseout="out('231191347318133709');" style=""> 439                      tabMetadata = cmd.getTabMetadataUsingTabKey(collectionMetadata.getTab());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440                  }                                                                                                 </span>
<span  style=""> 441                                                                                                                    </span>
<span class="-3015386838727954630" onmouseenter="enter('-3015386838727954630');" onmouseout="out('-3015386838727954630');" style=""> 442                  String tabName = tabMetadata == null ? collectionMetadata.getTab() : tabMetadata.getTabName();    </span>
<span class="-7179383252706615246" onmouseenter="enter('-7179383252706615246');" onmouseout="out('-7179383252706615246');" style=""> 443                  int tabOrder = tabMetadata == null ? collectionMetadata.getTabOrder() : tabMetadata.getTabOrder();</span>
<span class="-1384994182862418254" onmouseenter="enter('-1384994182862418254');" onmouseout="out('-1384994182862418254');" style=""> 444                  updateTabInfo(collectionMetadata, cmd, tabName, tabOrder);                                        </span>
<span  style=""> 445                                                                                                                    </span>
<span class="8686774820240993219" onmouseenter="enter('8686774820240993219');" onmouseout="out('8686774820240993219');" style=""> 446                  if (collectionMetadata.getLazyFetch() != null &amp;&amp; collectionMetadata.getLazyFetch()                </span>
<span class="5105727312979860339" onmouseenter="enter('5105727312979860339');" onmouseout="out('5105727312979860339');" style=""> 447                          &amp;&amp; tabName.toUpperCase().startsWith(currentTabName.toUpperCase())                         </span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 448                          &amp;&amp; !collectionMetadata.getManualFetch()) {                                                </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 449                      PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 449                      PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, ðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 450                      map.put(p.getName(), response2.getDynamicResultSet());                                        </span>
<span class="8148681537408196343" onmouseenter="enter('8148681537408196343');" onmouseout="out('8148681537408196343');" style=""> 451                  } else if (collectionMetadata.getLazyFetch() != null &amp;&amp; !collectionMetadata.getLazyFetch()        </span>
<span class="10836030403190991" onmouseenter="enter('10836030403190991');" onmouseout="out('10836030403190991');" style=""> 452                          &amp;&amp; !collectionMetadata.getManualFetch()) {                                                </span>
<span class="-3201228118450814846" onmouseenter="enter('-3201228118450814846');" onmouseout="out('-3201228118450814846');" style=""><abbr title=" 453                      PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, null, sectionCrumb);"> 453                      PersistenceResponse response2 = getRecordsForCollection(cmd, containingEntity, p, null, null, ðŸ”µ</abbr></span>
<span class="8742644723427248515" onmouseenter="enter('8742644723427248515');" onmouseout="out('8742644723427248515');" style=""> 454                      map.put(p.getName(), response2.getDynamicResultSet());                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 455                  } else {                                                                                          </span>
<span class="4201070416549217756" onmouseenter="enter('4201070416549217756');" onmouseout="out('4201070416549217756');" style=""> 456                      DynamicResultSet drs = new DynamicResultSet();                                                </span>
<span class="133064617150058408" onmouseenter="enter('133064617150058408');" onmouseout="out('133064617150058408');" style=""> 457                      Map&lt;String, Tab&gt; tabMap = new HashMap&lt;String, Tab&gt;();                                         </span>
<span class="52154028506366978" onmouseenter="enter('52154028506366978');" onmouseout="out('52154028506366978');" style=""> 458                      Tab tab = new Tab();                                                                          </span>
<span class="7573724056713363868" onmouseenter="enter('7573724056713363868');" onmouseout="out('7573724056713363868');" style=""> 459                      tab.setKey(tabName);                                                                          </span>
<span class="6935872114105155637" onmouseenter="enter('6935872114105155637');" onmouseout="out('6935872114105155637');" style=""> 460                      tab.setTitle(BLCMessageUtils.getMessage(tabName));                                            </span>
<span class="-3862389491808527983" onmouseenter="enter('-3862389491808527983');" onmouseout="out('-3862389491808527983');" style=""> 461                      tab.setOrder(tabOrder);                                                                       </span>
<span class="-8730262596017656059" onmouseenter="enter('-8730262596017656059');" onmouseout="out('-8730262596017656059');" style=""> 462                      tabMap.put(tab.getTitle(), tab);                                                              </span>
<span class="6973540073738050016" onmouseenter="enter('6973540073738050016');" onmouseout="out('6973540073738050016');" style=""> 463                      drs.setUnselectedTabMetadata(tabMap);                                                         </span>
<span class="-3072709309961217124" onmouseenter="enter('-3072709309961217124');" onmouseout="out('-3072709309961217124');" style=""> 464                      drs.setTotalRecords(0);                                                                       </span>
<span class="8982521778669319238" onmouseenter="enter('8982521778669319238');" onmouseout="out('8982521778669319238');" style=""> 465                      drs.setStartIndex(0);                                                                         </span>
<span class="-2316590965963048275" onmouseenter="enter('-2316590965963048275');" onmouseout="out('-2316590965963048275');" style=""> 466                      drs.setBatchId(1);                                                                            </span>
<span class="6524963296885553626" onmouseenter="enter('6524963296885553626');" onmouseout="out('6524963296885553626');" style=""> 467                      drs.setClassMetaData(null);                                                                   </span>
<span class="5830489670252814572" onmouseenter="enter('5830489670252814572');" onmouseout="out('5830489670252814572');" style=""> 468                      drs.setPageSize(1);                                                                           </span>
<span class="-3474843426091445352" onmouseenter="enter('-3474843426091445352');" onmouseout="out('-3474843426091445352');" style=""> 469                      drs.setRecords(new Entity[0]);                                                                </span>
<span class="5333638146813618055" onmouseenter="enter('5333638146813618055');" onmouseout="out('5333638146813618055');" style=""> 470                      map.put(p.getName(), drs);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473          }                                                                                                         </span>
<span  style=""> 474                                                                                                                    </span>
<span class="-7198716596337602362" onmouseenter="enter('-7198716596337602362');" onmouseout="out('-7198716596337602362');" style=""> 475          return map;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476      }                                                                                                             </span>
<span  style=""> 477                                                                                                                    </span>
<span class="-8906234562852924572" onmouseenter="enter('-8906234562852924572');" onmouseout="out('-8906234562852924572');" style=""> 478      protected void updateTabInfo(CollectionMetadata fmd, ClassMetadata cmd, String tabName, int tabOrder) {       </span>
<span class="6418671463533151954" onmouseenter="enter('6418671463533151954');" onmouseout="out('6418671463533151954');" style=""> 479          boolean tabInfoFound = false;                                                                             </span>
<span class="5408213491241477604" onmouseenter="enter('5408213491241477604');" onmouseout="out('5408213491241477604');" style=""> 480          Map&lt;String, TabMetadata&gt; tabMetadataMap = cmd.getTabAndGroupMetadata();                                   </span>
<span class="-2540078251533437241" onmouseenter="enter('-2540078251533437241');" onmouseout="out('-2540078251533437241');" style=""> 481          for (String tabKey : tabMetadataMap.keySet()) {                                                           </span>
<span class="7583512444437065393" onmouseenter="enter('7583512444437065393');" onmouseout="out('7583512444437065393');" style=""> 482              Map&lt;String, GroupMetadata&gt; groupMetadataMap = tabMetadataMap.get(tabKey).getGroupMetadata();          </span>
<span class="-5526517230184735053" onmouseenter="enter('-5526517230184735053');" onmouseout="out('-5526517230184735053');" style=""> 483              for (String groupKey : groupMetadataMap.keySet()) {                                                   </span>
<span class="98584842541508129" onmouseenter="enter('98584842541508129');" onmouseout="out('98584842541508129');" style=""><abbr title=" 484                  if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equals(fmd.getGroup())) {"> 484                  if (groupKey.equals(fmd.getGroup()) || groupMetadataMap.get(groupKey).getGroupName().equals(fmd.geðŸ”µ</abbr></span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 485                      tabName = tabMetadataMap.get(tabKey).getTabName();                                            </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 486                      tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                          </span>
<span class="4945701621495059563" onmouseenter="enter('4945701621495059563');" onmouseout="out('4945701621495059563');" style=""> 487                      tabInfoFound = true;                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 488                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490              }                                                                                                     </span>
<span class="1550248699436795528" onmouseenter="enter('1550248699436795528');" onmouseout="out('1550248699436795528');" style=""> 491              if (tabInfoFound) {                                                                                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 492                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493              }                                                                                                     </span>
<span class="6331731299217129446" onmouseenter="enter('6331731299217129446');" onmouseout="out('6331731299217129446');" style=""> 494              if (tabKey.equals(tabName) || tabMetadataMap.get(tabKey).getTabName().equals(tabName)) {              </span>
<span class="-5232552822030206870" onmouseenter="enter('-5232552822030206870');" onmouseout="out('-5232552822030206870');" style=""> 495                  tabName = tabMetadataMap.get(tabKey).getTabName();                                                </span>
<span class="2828093109844556757" onmouseenter="enter('2828093109844556757');" onmouseout="out('2828093109844556757');" style=""> 496                  tabOrder = tabMetadataMap.get(tabKey).getTabOrder();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499      }                                                                                                             </span>
<span  style=""> 500                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 501      @Override                                                                                                     </span>
<span class="2611376483592856297" onmouseenter="enter('2611376483592856297');" onmouseout="out('2611376483592856297');" style=""><abbr title=" 502      public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field,"> 502      public PersistenceResponse addSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property ðŸ”µ</abbr></span>
<span class="6733854382866461502" onmouseenter="enter('6733854382866461502');" onmouseout="out('6733854382866461502');" style=""> 503              Entity parentEntity, List&lt;SectionCrumb&gt; sectionCrumbs)                                                </span>
<span class="-9069306879086868954" onmouseenter="enter('-9069306879086868954');" onmouseout="out('-9069306879086868954');" style=""> 504              throws ServiceException, ClassNotFoundException {                                                     </span>
<span class="-8197057147118619768" onmouseenter="enter('-8197057147118619768');" onmouseout="out('-8197057147118619768');" style=""> 505          // Assemble the properties from the entity form                                                           </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 506          List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                                      </span>
<span  style=""> 507                                                                                                                    </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 508          FieldMetadata md = field.getMetadata();                                                                   </span>
<span  style=""> 509                                                                                                                    </span>
<span class="-3154651088293222897" onmouseenter="enter('-3154651088293222897');" onmouseout="out('-3154651088293222897');" style=""> 510          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs)                 </span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 511                  .withEntity(new Entity());                                                                        </span>
<span class="6854684741721952189" onmouseenter="enter('6854684741721952189');" onmouseout="out('6854684741721952189');" style=""> 512          ppr.getEntity().setIsPreAdd(parentEntity.isPreAdd());                                                     </span>
<span  style=""> 513                                                                                                                    </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 514          if (md instanceof BasicCollectionMetadata) {                                                              </span>
<span class="6607267312947776736" onmouseenter="enter('6607267312947776736');" onmouseout="out('6607267312947776736');" style=""> 515              BasicCollectionMetadata fmd = (BasicCollectionMetadata) md;                                           </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 516              ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                                 </span>
<span  style=""> 517                                                                                                                    </span>
<span class="-2325626323266423717" onmouseenter="enter('-2325626323266423717');" onmouseout="out('-2325626323266423717');" style=""> 518              // If we&#x27;re looking up an entity instead of trying to create one on the fly, let&#x27;s make sure          </span>
<span class="3526840633411573677" onmouseenter="enter('3526840633411573677');" onmouseout="out('3526840633411573677');" style=""> 519              // that we&#x27;re not changing the target entity at all and only creating the association to the id       </span>
<span class="3093503126858687967" onmouseenter="enter('3093503126858687967');" onmouseout="out('3093503126858687967');" style=""> 520              if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP) ||                                            </span>
<span class="6274591046536853861" onmouseenter="enter('6274591046536853861');" onmouseout="out('6274591046536853861');" style=""> 521                      fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                             </span>
<span class="1728529167243720357" onmouseenter="enter('1728529167243720357');" onmouseout="out('1728529167243720357');" style=""> 522                  List&lt;String&gt; fieldsToRemove = new ArrayList&lt;String&gt;();                                            </span>
<span  style=""> 523                                                                                                                    </span>
<span class="8261635343050838543" onmouseenter="enter('8261635343050838543');" onmouseout="out('8261635343050838543');" style=""> 524                  String idProp = getIdProperty(mainMetadata);                                                      </span>
<span class="7372165960962811555" onmouseenter="enter('7372165960962811555');" onmouseout="out('7372165960962811555');" style=""> 525                  for (String key : entityForm.getFields().keySet()) {                                              </span>
<span class="-3969218055241208355" onmouseenter="enter('-3969218055241208355');" onmouseout="out('-3969218055241208355');" style=""> 526                      if (!idProp.equals(key)) {                                                                    </span>
<span class="329726563907215496" onmouseenter="enter('329726563907215496');" onmouseout="out('329726563907215496');" style=""> 527                          fieldsToRemove.add(key);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529                  }                                                                                                 </span>
<span  style=""> 530                                                                                                                    </span>
<span class="-8204439459370995320" onmouseenter="enter('-8204439459370995320');" onmouseout="out('-8204439459370995320');" style=""> 531                  for (String key : fieldsToRemove) {                                                               </span>
<span class="-3002518314516620728" onmouseenter="enter('-3002518314516620728');" onmouseout="out('-3002518314516620728');" style=""> 532                      ListIterator&lt;Property&gt; li = properties.listIterator();                                        </span>
<span class="-3598623445235132470" onmouseenter="enter('-3598623445235132470');" onmouseout="out('-3598623445235132470');" style=""> 533                      while (li.hasNext()) {                                                                        </span>
<span class="-4936311913022510436" onmouseenter="enter('-4936311913022510436');" onmouseout="out('-4936311913022510436');" style=""> 534                          if (li.next().getName().equals(key)) {                                                    </span>
<span class="-7629195606720709622" onmouseenter="enter('-7629195606720709622');" onmouseout="out('-7629195606720709622');" style=""> 535                              li.remove();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 537                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 538                  }                                                                                                 </span>
<span  style=""> 539                                                                                                                    </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 540                  ppr.setValidateUnsubmittedProperties(false);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541              }                                                                                                     </span>
<span  style=""> 542                                                                                                                    </span>
<span class="-2511723907351376263" onmouseenter="enter('-2511723907351376263');" onmouseout="out('-2511723907351376263');" style=""> 543              if (fmd.getAddMethodType().equals(AddMethodType.LOOKUP_FOR_UPDATE)) {                                 </span>
<span class="4303470812456182979" onmouseenter="enter('4303470812456182979');" onmouseout="out('4303470812456182979');" style=""> 544                  ppr.setUpdateLookupType(true);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545              }                                                                                                     </span>
<span  style=""> 546                                                                                                                    </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 547              Property fp = new Property();                                                                         </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 548              fp.setName(ppr.getForeignKey().getManyToField());                                                     </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 549              fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));           </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 550              properties.add(fp);                                                                                   </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 551          } else if (md instanceof AdornedTargetCollectionMetadata) {                                               </span>
<span class="-4636884806383263612" onmouseenter="enter('-4636884806383263612');" onmouseout="out('-4636884806383263612');" style=""> 552              ppr.getEntity().setType(new String[] { ppr.getAdornedList().getAdornedTargetEntityClassname() });     </span>
<span  style=""> 553                                                                                                                    </span>
<span class="-8504901264761703182" onmouseenter="enter('-8504901264761703182');" onmouseout="out('-8504901264761703182');" style=""> 554              String[] maintainedFields = ((AdornedTargetCollectionMetadata) md).getMaintainedAdornedTargetFields();</span>
<span class="7296878925630910355" onmouseenter="enter('7296878925630910355');" onmouseout="out('7296878925630910355');" style=""> 555              if (maintainedFields == null || maintainedFields.length == 0) {                                       </span>
<span class="-9117076663599786458" onmouseenter="enter('-9117076663599786458');" onmouseout="out('-9117076663599786458');" style=""> 556                  ppr.setValidateUnsubmittedProperties(false);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557              }                                                                                                     </span>









<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 558          } else if (md instanceof MapMetadata) {                                                                   </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 559              ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                                 </span>
<span  style=""> 560                                                                                                                    </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 561              Property p = new Property();                                                                          </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 562              p.setName(&quot;symbolicId&quot;);                                                                              </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 563              p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));            </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 564              properties.add(p);                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 565          } else {                                                                                                  </span>
<span class="6589458496639047773" onmouseenter="enter('6589458496639047773');" onmouseout="out('6589458496639047773');" style=""> 566              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; +      </span>
<span class="8841076042243319225" onmouseenter="enter('8841076042243319225');" onmouseout="out('8841076042243319225');" style=""> 567                      &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 568          }                                                                                                         </span>
<span  style=""> 569                                                                                                                    </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 570          ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                              </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 571          String sectionField = field.getName();                                                                    </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 572          if (sectionField.contains(&quot;.&quot;)) {                                                                         </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 573              sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 574          }                                                                                                         </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 575          ppr.setSectionEntityField(sectionField);                                                                  </span>
<span  style=""> 576                                                                                                                    </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 577          Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY);          </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 578          if (parentNameProp != null) {                                                                             </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 579              ppr.setRequestingEntityName(parentNameProp.getValue());                                               </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 580          }else {                                                                                                   </span>
<span class="1891301505194787668" onmouseenter="enter('1891301505194787668');" onmouseout="out('1891301505194787668');" style=""> 581              Property name = parentEntity.getPMap().get(&quot;name&quot;);                                                   </span>
<span class="5844109132794648466" onmouseenter="enter('5844109132794648466');" onmouseout="out('5844109132794648466');" style=""> 582              if(name !=null) {                                                                                     </span>
<span class="-827206152183551520" onmouseenter="enter('-827206152183551520');" onmouseout="out('-827206152183551520');" style=""> 583                  ppr.setRequestingEntityName(name.getValue());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 584              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585          }                                                                                                         </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 586          Property[] propArr = new Property[properties.size()];                                                     </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 587          properties.toArray(propArr);                                                                              </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 588          ppr.getEntity().setProperties(propArr);                                                                   </span>
<span  style=""> 589                                                                                                                    </span>
<span class="-985359831627570567" onmouseenter="enter('-985359831627570567');" onmouseout="out('-985359831627570567');" style=""> 590          return add(ppr);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 591      }                                                                                                             </span>
<span  style=""> 592                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 593      @Override                                                                                                     </span>
<span class="-7675709464639024415" onmouseenter="enter('-7675709464639024415');" onmouseout="out('-7675709464639024415');" style=""><abbr title=" 594      public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property"> 594      public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, ProperðŸ”µ</abbr></span>
<span class="-2028598087534015745" onmouseenter="enter('-2028598087534015745');" onmouseout="out('-2028598087534015745');" style=""><abbr title=" 595              field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceException, ClassNotFoundException {"> 595              field, Entity parentEntity, String collectionItemId, List&lt;SectionCrumb&gt; sectionCrumb) throws ServiceExðŸ”µ</abbr></span>
<span class="5486792043368910160" onmouseenter="enter('5486792043368910160');" onmouseout="out('5486792043368910160');" style=""><abbr title=" 596          return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId, null, sectionCrumb);"> 596          return updateSubCollectionEntity(entityForm, mainMetadata, field, parentEntity, collectionItemId, null, seðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 597      }                                                                                                             </span>
<span  style=""> 598                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 599      @Override                                                                                                     </span>
<span class="397736636649329238" onmouseenter="enter('397736636649329238');" onmouseout="out('397736636649329238');" style=""><abbr title=" 600      public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, Property field,"> 600      public PersistenceResponse updateSubCollectionEntity(EntityForm entityForm, ClassMetadata mainMetadata, ProperðŸ”µ</abbr></span>
<span class="-318365979879509230" onmouseenter="enter('-318365979879509230');" onmouseout="out('-318365979879509230');" style=""> 601              Entity parentEntity, String collectionItemId, String alternateId, List&lt;SectionCrumb&gt; sectionCrumbs)   </span>
<span class="-9069306879086868954" onmouseenter="enter('-9069306879086868954');" onmouseout="out('-9069306879086868954');" style=""> 602              throws ServiceException, ClassNotFoundException {                                                     </span>
<span class="8705190899755096964" onmouseenter="enter('8705190899755096964');" onmouseout="out('8705190899755096964');" style=""> 603          List&lt;Property&gt; properties = getPropertiesFromEntityForm(entityForm);                                      </span>
<span  style=""> 604                                                                                                                    </span>
<span class="4577121328426425010" onmouseenter="enter('4577121328426425010');" onmouseout="out('4577121328426425010');" style=""> 605          FieldMetadata md = field.getMetadata();                                                                   </span>
<span  style=""> 606                                                                                                                    </span>
<span class="-3154651088293222897" onmouseenter="enter('-3154651088293222897');" onmouseout="out('-3154651088293222897');" style=""> 607          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(md, sectionCrumbs)                 </span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 608                  .withEntity(new Entity());                                                                        </span>
<span  style=""> 609                                                                                                                    </span>
<span class="-1532720970191757712" onmouseenter="enter('-1532720970191757712');" onmouseout="out('-1532720970191757712');" style=""> 610          if (md instanceof BasicCollectionMetadata) {                                                              </span>
<span class="6607267312947776736" onmouseenter="enter('6607267312947776736');" onmouseout="out('6607267312947776736');" style=""> 611              BasicCollectionMetadata fmd = (BasicCollectionMetadata) md;                                           </span>
<span class="226826482246311757" onmouseenter="enter('226826482246311757');" onmouseout="out('226826482246311757');" style=""> 612              ppr.setCeilingEntityClassname(fmd.getCollectionCeilingEntity());                                      </span>
<span class="-5249561197408255652" onmouseenter="enter('-5249561197408255652');" onmouseout="out('-5249561197408255652');" style=""> 613              ppr.getEntity().setType(new String[] { fmd.getCollectionCeilingEntity() });                           </span>
<span  style=""> 614                                                                                                                    </span>
<span class="-3564783493261456851" onmouseenter="enter('-3564783493261456851');" onmouseout="out('-3564783493261456851');" style=""> 615              Property fp = new Property();                                                                         </span>
<span class="-5232342966083128577" onmouseenter="enter('-5232342966083128577');" onmouseout="out('-5232342966083128577');" style=""> 616              fp.setName(ppr.getForeignKey().getManyToField());                                                     </span>
<span class="4652497923226130474" onmouseenter="enter('4652497923226130474');" onmouseout="out('4652497923226130474');" style=""> 617              fp.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));           </span>
<span class="8450408142962005401" onmouseenter="enter('8450408142962005401');" onmouseout="out('8450408142962005401');" style=""> 618              if (!properties.contains(fp)) {                                                                       </span>
<span class="-3721353461799491089" onmouseenter="enter('-3721353461799491089');" onmouseout="out('-3721353461799491089');" style=""> 619                  properties.add(fp);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 620              }                                                                                                     </span>
<span class="205388064165131770" onmouseenter="enter('205388064165131770');" onmouseout="out('205388064165131770');" style=""> 621          } else if (md instanceof AdornedTargetCollectionMetadata) {                                               </span>
<span class="-736797126069743382" onmouseenter="enter('-736797126069743382');" onmouseout="out('-736797126069743382');" style=""> 622              String adornedTargetEntityClassname = ppr.getAdornedList().getAdornedTargetEntityClassname();         </span>
<span class="-3984105731247699024" onmouseenter="enter('-3984105731247699024');" onmouseout="out('-3984105731247699024');" style=""> 623              ppr.setCeilingEntityClassname(adornedTargetEntityClassname);                                          </span>
<span class="-4067322056629005576" onmouseenter="enter('-4067322056629005576');" onmouseout="out('-4067322056629005576');" style=""> 624              ppr.getEntity().setType(new String[] {adornedTargetEntityClassname});                                 </span>
<span  style=""> 625                                                                                                                    </span>
<span class="2404180692851035070" onmouseenter="enter('2404180692851035070');" onmouseout="out('2404180692851035070');" style=""> 626              for (Property property : properties) {                                                                </span>
<span class="-3911962540946632188" onmouseenter="enter('-3911962540946632188');" onmouseout="out('-3911962540946632188');" style=""> 627                  if (property.getName().equals(ppr.getAdornedList().getLinkedObjectPath() +                        </span>
<span class="2022280188845233855" onmouseenter="enter('2022280188845233855');" onmouseout="out('2022280188845233855');" style=""> 628                                      &quot;.&quot; + ppr.getAdornedList().getLinkedIdProperty())) {                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 629                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 631              }                                                                                                     </span>
<span  style=""> 632                                                                                                                    </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 633              if (!StringUtils.isEmpty(alternateId)) {                                                              </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 634                  Property p = new Property();                                                                      </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 635                  p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                          </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 636                  p.setValue(alternateId);                                                                          </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 637                  if (!properties.contains(p)) {                                                                    </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 638                      properties.add(p);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 640              }                                                                                                     </span>
<span class="-5178510075759343040" onmouseenter="enter('-5178510075759343040');" onmouseout="out('-5178510075759343040');" style=""> 641          } else if (md instanceof MapMetadata) {                                                                   </span>
<span class="2392190205235352447" onmouseenter="enter('2392190205235352447');" onmouseout="out('2392190205235352447');" style=""> 642              ppr.getEntity().setType(new String[] { entityForm.getEntityType() });                                 </span>
<span  style=""> 643                                                                                                                    </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 644              Property p = new Property();                                                                          </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 645              p.setName(&quot;symbolicId&quot;);                                                                              </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 646              p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));            </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 647              properties.add(p);                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 648          } else {                                                                                                  </span>
<span class="6589458496639047773" onmouseenter="enter('6589458496639047773');" onmouseout="out('6589458496639047773');" style=""> 649              throw new IllegalArgumentException(String.format(&quot;The specified field [%s] for class [%s] was&quot; +      </span>
<span class="8841076042243319225" onmouseenter="enter('8841076042243319225');" onmouseout="out('8841076042243319225');" style=""> 650                      &quot; not a collection field.&quot;, field.getName(), mainMetadata.getCeilingType()));                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 651          }                                                                                                         </span>
<span  style=""> 652                                                                                                                    </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 653          String sectionField = field.getName();                                                                    </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 654          if (sectionField.contains(&quot;.&quot;)) {                                                                         </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 655              sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 656          }                                                                                                         </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 657          ppr.setSectionEntityField(sectionField);                                                                  </span>
<span  style=""> 658                                                                                                                    </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 659          Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY);          </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 660          if (parentNameProp != null) {                                                                             </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 661              ppr.setRequestingEntityName(parentNameProp.getValue());                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 662 -        } else {                                                                                                  </span>
<span class="1891301505194787668" onmouseenter="enter('1891301505194787668');" onmouseout="out('1891301505194787668');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 663 -            Property name = parentEntity.getPMap().get(&quot;name&quot;);                                                   </span>
<span class="5844109132794648466" onmouseenter="enter('5844109132794648466');" onmouseout="out('5844109132794648466');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 664 -            if(name !=null) {                                                                                     </span>
<span class="-827206152183551520" onmouseenter="enter('-827206152183551520');" onmouseout="out('-827206152183551520');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 665 -                ppr.setRequestingEntityName(name.getValue());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 666 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 667          }                                                                                                         </span>
<span  style=""> 668                                                                                                                    </span>
<span class="5380947615780799183" onmouseenter="enter('5380947615780799183');" onmouseout="out('5380947615780799183');" style=""> 669          Property p = new Property();                                                                              </span>
<span class="76365074730046782" onmouseenter="enter('76365074730046782');" onmouseout="out('76365074730046782');" style=""> 670          p.setName(entityForm.getIdProperty());                                                                    </span>
<span class="-4252521779434663948" onmouseenter="enter('-4252521779434663948');" onmouseout="out('-4252521779434663948');" style=""> 671          p.setValue(collectionItemId);                                                                             </span>
<span class="-4817284555607589253" onmouseenter="enter('-4817284555607589253');" onmouseout="out('-4817284555607589253');" style=""> 672          if (!properties.contains(p)) {                                                                            </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 673              properties.add(p);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 674          }                                                                                                         </span>
<span  style=""> 675                                                                                                                    </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 676          Property[] propArr = new Property[properties.size()];                                                     </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 677          properties.toArray(propArr);                                                                              </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 678          ppr.getEntity().setProperties(propArr);                                                                   </span>
<span  style=""> 679                                                                                                                    </span>
<span class="5994086601338625026" onmouseenter="enter('5994086601338625026');" onmouseout="out('5994086601338625026');" style=""> 680          return update(ppr);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 681      }                                                                                                             </span>
<span  style=""> 682                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 683      @Override                                                                                                     </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 684      public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 684      public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentðŸ”µ</abbr></span>
<span class="7718985087288552750" onmouseenter="enter('7718985087288552750');" onmouseout="out('7718985087288552750');" style=""> 685                  String itemId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {       </span>
<span class="1153666597088080540" onmouseenter="enter('1153666597088080540');" onmouseout="out('1153666597088080540');" style=""><abbr title=" 686          return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectionCrumbs);"> 686          return removeSubCollectionEntity(mainMetadata, field, parentEntity, itemId, null, priorKey, sectionCrumbs)ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 687      }                                                                                                             </span>
<span  style=""> 688                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 689      @Override                                                                                                     </span>
<span class="-8241455209248720515" onmouseenter="enter('-8241455209248720515');" onmouseout="out('-8241455209248720515');" style=""><abbr title=" 690      public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentEntity,"> 690      public PersistenceResponse removeSubCollectionEntity(ClassMetadata mainMetadata, Property field, Entity parentðŸ”µ</abbr></span>
<span class="-7641167286743654353" onmouseenter="enter('-7641167286743654353');" onmouseout="out('-7641167286743654353');" style=""><abbr title=" 691              String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceException {"> 691              String itemId, String alternateId, String priorKey, List&lt;SectionCrumb&gt; sectionCrumbs) throws ServiceExðŸ”µ</abbr></span>
<span class="6439752407856920746" onmouseenter="enter('6439752407856920746');" onmouseout="out('6439752407856920746');" style=""> 692          List&lt;Property&gt; properties = new ArrayList&lt;Property&gt;();                                                    </span>
<span  style=""> 693                                                                                                                    </span>
<span class="-7639830684562317861" onmouseenter="enter('-7639830684562317861');" onmouseout="out('-7639830684562317861');" style=""> 694          Property p;                                                                                               </span>
<span class="5073856407409165319" onmouseenter="enter('5073856407409165319');" onmouseout="out('5073856407409165319');" style=""> 695          String parentId = getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName());          </span>
<span  style=""> 696                                                                                                                    </span>
<span class="255305470667416020" onmouseenter="enter('255305470667416020');" onmouseout="out('255305470667416020');" style=""> 697          PersistencePackageRequest ppr = PersistencePackageRequest.fromMetadata(field.getMetadata(), sectionCrumbs)</span>
<span class="-2781754658716601139" onmouseenter="enter('-2781754658716601139');" onmouseout="out('-2781754658716601139');" style=""> 698                  .withEntity(new Entity());                                                                        </span>
<span  style=""> 699                                                                                                                    </span>
<span class="6642416971497632068" onmouseenter="enter('6642416971497632068');" onmouseout="out('6642416971497632068');" style=""> 700          if (field.getMetadata() instanceof BasicCollectionMetadata) {                                             </span>
<span class="5195082360751194411" onmouseenter="enter('5195082360751194411');" onmouseout="out('5195082360751194411');" style=""> 701              BasicCollectionMetadata fmd = (BasicCollectionMetadata) field.getMetadata();                          </span>
<span  style=""> 702                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 703              p = new Property();                                                                                   </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 704              p.setName(&quot;id&quot;);                                                                                      </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 705              p.setValue(itemId);                                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 706              properties.add(p);                                                                                    </span>
<span  style=""> 707                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 708              p = new Property();                                                                                   </span>
<span class="736571882968420419" onmouseenter="enter('736571882968420419');" onmouseout="out('736571882968420419');" style=""> 709              p.setName(ppr.getForeignKey().getManyToField());                                                      </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 710              p.setValue(parentId);                                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 711              properties.add(p);                                                                                    </span>
<span  style=""> 712                                                                                                                    </span>
<span class="6632512256771168785" onmouseenter="enter('6632512256771168785');" onmouseout="out('6632512256771168785');" style=""> 713              ppr.getEntity().setType(new String[]{fmd.getCollectionCeilingEntity()});                              </span>
<span class="2294469176396117772" onmouseenter="enter('2294469176396117772');" onmouseout="out('2294469176396117772');" style=""> 714          } else if (field.getMetadata() instanceof AdornedTargetCollectionMetadata) {                              </span>
<span class="-1689031862376375101" onmouseenter="enter('-1689031862376375101');" onmouseout="out('-1689031862376375101');" style=""> 715              AdornedTargetList adornedList = ppr.getAdornedList();                                                 </span>
<span  style=""> 716                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 717              p = new Property();                                                                                   </span>
<span class="-8312107819432651962" onmouseenter="enter('-8312107819432651962');" onmouseout="out('-8312107819432651962');" style=""> 718              p.setName(adornedList.getLinkedObjectPath() + &quot;.&quot; + adornedList.getLinkedIdProperty());               </span>
<span class="-4122920870800713041" onmouseenter="enter('-4122920870800713041');" onmouseout="out('-4122920870800713041');" style=""> 719              p.setValue(parentId);                                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 720              properties.add(p);                                                                                    </span>
<span  style=""> 721                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 722              p = new Property();                                                                                   </span>
<span class="371368176127783534" onmouseenter="enter('371368176127783534');" onmouseout="out('371368176127783534');" style=""> 723              p.setName(adornedList.getTargetObjectPath() + &quot;.&quot; + adornedList.getTargetIdProperty());               </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 724              p.setValue(itemId);                                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 725              properties.add(p);                                                                                    </span>
<span  style=""> 726                                                                                                                    </span>
<span class="-2844311454542370667" onmouseenter="enter('-2844311454542370667');" onmouseout="out('-2844311454542370667');" style=""> 727              if (!StringUtils.isEmpty(alternateId)) {                                                              </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 728                  p = new Property();                                                                               </span>
<span class="899102187384180821" onmouseenter="enter('899102187384180821');" onmouseout="out('899102187384180821');" style=""> 729                  p.setName(BasicPersistenceModule.ALTERNATE_ID_PROPERTY);                                          </span>
<span class="-3272799520000758637" onmouseenter="enter('-3272799520000758637');" onmouseout="out('-3272799520000758637');" style=""> 730                  p.setValue(alternateId);                                                                          </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 731                  properties.add(p);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 732              }                                                                                                     </span>
<span  style=""> 733                                                                                                                    </span>
<span class="-2729449254338899005" onmouseenter="enter('-2729449254338899005');" onmouseout="out('-2729449254338899005');" style=""> 734              ppr.getEntity().setType(new String[]{adornedList.getAdornedTargetEntityClassname()});                 </span>
<span class="7912118845776081771" onmouseenter="enter('7912118845776081771');" onmouseout="out('7912118845776081771');" style=""> 735          } else if (field.getMetadata() instanceof MapMetadata) {                                                  </span>
<span class="2366674339618495793" onmouseenter="enter('2366674339618495793');" onmouseout="out('2366674339618495793');" style=""> 736              MapMetadata fmd = (MapMetadata) field.getMetadata();                                                  </span>
<span  style=""> 737                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 738              p = new Property();                                                                                   </span>
<span class="-1751072503082565331" onmouseenter="enter('-1751072503082565331');" onmouseout="out('-1751072503082565331');" style=""> 739              p.setName(&quot;id&quot;);                                                                                      </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 740              p.setValue(itemId);                                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 741              properties.add(p);                                                                                    </span>
<span  style=""> 742                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 743              p = new Property();                                                                                   </span>
<span class="3378476441779339812" onmouseenter="enter('3378476441779339812');" onmouseout="out('3378476441779339812');" style=""> 744              p.setName(&quot;symbolicId&quot;);                                                                              </span>
<span class="-8752313707103211475" onmouseenter="enter('-8752313707103211475');" onmouseout="out('-8752313707103211475');" style=""> 745              p.setValue(getContextSpecificRelationshipId(mainMetadata, parentEntity, field.getName()));            </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 746              properties.add(p);                                                                                    </span>
<span  style=""> 747                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 748              p = new Property();                                                                                   </span>
<span class="-5579409047855153374" onmouseenter="enter('-5579409047855153374');" onmouseout="out('-5579409047855153374');" style=""> 749              p.setName(&quot;priorKey&quot;);                                                                                </span>
<span class="-4418910479857896781" onmouseenter="enter('-4418910479857896781');" onmouseout="out('-4418910479857896781');" style=""> 750              p.setValue(priorKey);                                                                                 </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 751              properties.add(p);                                                                                    </span>
<span  style=""> 752                                                                                                                    </span>
<span class="6290651600977544526" onmouseenter="enter('6290651600977544526');" onmouseout="out('6290651600977544526');" style=""> 753              MapStructure mapStructure = ppr.getMapStructure();                                                    </span>
<span  style=""> 754                                                                                                                    </span>
<span class="-6884139966167613989" onmouseenter="enter('-6884139966167613989');" onmouseout="out('-6884139966167613989');" style=""> 755              p = new Property();                                                                                   </span>
<span class="-8796819570859336354" onmouseenter="enter('-8796819570859336354');" onmouseout="out('-8796819570859336354');" style=""> 756              p.setName(mapStructure.getKeyPropertyName());                                                         </span>
<span class="4197372040503992271" onmouseenter="enter('4197372040503992271');" onmouseout="out('4197372040503992271');" style=""> 757              p.setValue(itemId);                                                                                   </span>
<span class="736474611578603389" onmouseenter="enter('736474611578603389');" onmouseout="out('736474611578603389');" style=""> 758              properties.add(p);                                                                                    </span>
<span  style=""> 759                                                                                                                    </span>
<span class="-3538327046279125798" onmouseenter="enter('-3538327046279125798');" onmouseout="out('-3538327046279125798');" style=""> 760              ppr.getEntity().setType(new String[] { fmd.getTargetClass() });                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 761          }                                                                                                         </span>
<span  style=""> 762                                                                                                                    </span>
<span class="-3925320759437877828" onmouseenter="enter('-3925320759437877828');" onmouseout="out('-3925320759437877828');" style=""> 763          ppr.setCeilingEntityClassname(ppr.getEntity().getType()[0]);                                              </span>
<span class="-4393589425957161443" onmouseenter="enter('-4393589425957161443');" onmouseout="out('-4393589425957161443');" style=""> 764          String sectionField = field.getName();                                                                    </span>
<span class="-701602728013442950" onmouseenter="enter('-701602728013442950');" onmouseout="out('-701602728013442950');" style=""> 765          if (sectionField.contains(&quot;.&quot;)) {                                                                         </span>
<span class="1008181326984973918" onmouseenter="enter('1008181326984973918');" onmouseout="out('1008181326984973918');" style=""> 766              sectionField = sectionField.substring(0, sectionField.lastIndexOf(&quot;.&quot;));                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 767          }                                                                                                         </span>
<span class="9056762315488841677" onmouseenter="enter('9056762315488841677');" onmouseout="out('9056762315488841677');" style=""> 768          ppr.setSectionEntityField(sectionField);                                                                  </span>
<span  style=""> 769                                                                                                                    </span>
<span class="6086226417072608718" onmouseenter="enter('6086226417072608718');" onmouseout="out('6086226417072608718');" style=""> 770          Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY);          </span>
<span class="168232281549210072" onmouseenter="enter('168232281549210072');" onmouseout="out('168232281549210072');" style=""> 771          if (parentNameProp != null) {                                                                             </span>
<span class="4811540857590254797" onmouseenter="enter('4811540857590254797');" onmouseout="out('4811540857590254797');" style=""> 772              ppr.setRequestingEntityName(parentNameProp.getValue());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 773          }                                                                                                         </span>
<span  style=""> 774                                                                                                                    </span>
<span class="6455510541836121112" onmouseenter="enter('6455510541836121112');" onmouseout="out('6455510541836121112');" style=""> 775          Property[] propArr = new Property[properties.size()];                                                     </span>
<span class="7486210140522441062" onmouseenter="enter('7486210140522441062');" onmouseout="out('7486210140522441062');" style=""> 776          properties.toArray(propArr);                                                                              </span>
<span class="9144259901605167079" onmouseenter="enter('9144259901605167079');" onmouseout="out('9144259901605167079');" style=""> 777          ppr.getEntity().setProperties(propArr);                                                                   </span>
<span  style=""> 778                                                                                                                    </span>
<span class="-5906060660943845047" onmouseenter="enter('-5906060660943845047');" onmouseout="out('-5906060660943845047');" style=""> 779          return remove(ppr);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 780      }                                                                                                             </span>
<span  style=""> 781                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 782      @Override                                                                                                     </span>
<span class="4282644893410961184" onmouseenter="enter('4282644893410961184');" onmouseout="out('4282644893410961184');" style=""> 783      public String getContextSpecificRelationshipId(ClassMetadata cmd, Entity entity, String propertyName) {       </span>
<span class="-743200742687355266" onmouseenter="enter('-743200742687355266');" onmouseout="out('-743200742687355266');" style=""> 784          String prefix;                                                                                            </span>
<span class="-4471312176558876108" onmouseenter="enter('-4471312176558876108');" onmouseout="out('-4471312176558876108');" style=""> 785          if (propertyName.contains(&quot;.&quot;)) {                                                                         </span>
<span class="1236521803185463300" onmouseenter="enter('1236521803185463300');" onmouseout="out('1236521803185463300');" style=""> 786              prefix = propertyName.substring(0, propertyName.lastIndexOf(&quot;.&quot;));                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 787          } else {                                                                                                  </span>
<span class="-298949802313756982" onmouseenter="enter('-298949802313756982');" onmouseout="out('-298949802313756982');" style=""> 788              prefix = &quot;&quot;;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 789          }                                                                                                         </span>
<span  style=""> 790                                                                                                                    </span>
<span class="2108963067613019567" onmouseenter="enter('2108963067613019567');" onmouseout="out('2108963067613019567');" style=""> 791          if (prefix.equals(&quot;&quot;)) {                                                                                  </span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 792              return entity.findProperty(&quot;id&quot;).getValue();                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 793          } else {                                                                                                  </span>
<span class="2912662671806002044" onmouseenter="enter('2912662671806002044');" onmouseout="out('2912662671806002044');" style=""><abbr title=" 794              //we need to check all the parts of the prefix. For example, the prefix could include an @Embedded class like"> 794              //we need to check all the parts of the prefix. For example, the prefix could include an @Embedded claðŸ”µ</abbr></span>
<span class="-6847147968781015235" onmouseenter="enter('-6847147968781015235');" onmouseout="out('-6847147968781015235');" style=""><abbr title=" 795              //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the @Embedded does"> 795              //defaultSku.dimension. In this case, we want the id from the defaultSku property, since the @EmbeddedðŸ”µ</abbr></span>
<span class="-9096360951865760456" onmouseenter="enter('-9096360951865760456');" onmouseout="out('-9096360951865760456');" style=""> 796              //not have an id property - nor should it.                                                            </span>
<span class="8843283418167771984" onmouseenter="enter('8843283418167771984');" onmouseout="out('8843283418167771984');" style=""> 797              String[] prefixParts = prefix.split(&quot;\\.&quot;);                                                           </span>
<span class="-7822949011963974832" onmouseenter="enter('-7822949011963974832');" onmouseout="out('-7822949011963974832');" style=""> 798              for (int j = 0; j &lt; prefixParts.length; j++) {                                                        </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 799                  StringBuilder sb = new StringBuilder();                                                           </span>
<span class="2290448841761568128" onmouseenter="enter('2290448841761568128');" onmouseout="out('2290448841761568128');" style=""> 800                  for (int x = 0; x &lt; prefixParts.length - j; x++) {                                                </span>
<span class="1036821456394348565" onmouseenter="enter('1036821456394348565');" onmouseout="out('1036821456394348565');" style=""> 801                      sb.append(prefixParts[x]);                                                                    </span>
<span class="837864378579548727" onmouseenter="enter('837864378579548727');" onmouseout="out('837864378579548727');" style=""> 802                      if (x &lt; prefixParts.length - j - 1) {                                                         </span>
<span class="2682813583155160314" onmouseenter="enter('2682813583155160314');" onmouseout="out('2682813583155160314');" style=""> 803                          sb.append(&quot;.&quot;);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 804                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 805                  }                                                                                                 </span>
<span class="-7912523814943214188" onmouseenter="enter('-7912523814943214188');" onmouseout="out('-7912523814943214188');" style=""> 806                  String tempPrefix = sb.toString();                                                                </span>
<span  style=""> 807                                                                                                                    </span>
<span class="-5346955267205588229" onmouseenter="enter('-5346955267205588229');" onmouseout="out('-5346955267205588229');" style=""> 808                  for (Property property : entity.getProperties()) {                                                </span>
<span class="-7524924011426943089" onmouseenter="enter('-7524924011426943089');" onmouseout="out('-7524924011426943089');" style=""> 809                      if (property.getName().startsWith(tempPrefix)) {                                              </span>
<span class="-577685276283853994" onmouseenter="enter('-577685276283853994');" onmouseout="out('-577685276283853994');" style=""><abbr title=" 810                          //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the current prefix level"> 810                          //make sure there is only one &#x27;.&#x27; to ensure we are looking at properties on the current prðŸ”µ</abbr></span>
<span class="6988170330009622433" onmouseenter="enter('6988170330009622433');" onmouseout="out('6988170330009622433');" style=""><abbr title=" 811                          //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAttributes.id"> 811                          //in the case of the prefix defaultSku, we want defaultSku.id not defaultSku.skuAttributesðŸ”µ</abbr></span>
<span class="-1849094327471901943" onmouseenter="enter('-1849094327471901943');" onmouseout="out('-1849094327471901943');" style=""> 812                          if (StringUtils.countMatches(property.getName().replace(tempPrefix, &quot;&quot;), &quot;.&quot;) == 1) {     </span>
<span class="-8594951258528203905" onmouseenter="enter('-8594951258528203905');" onmouseout="out('-8594951258528203905');" style=""> 813                              if (cmd.getPMap().containsKey(property.getName())) {                                  </span>
<span class="-7732609283402352986" onmouseenter="enter('-7732609283402352986');" onmouseout="out('-7732609283402352986');" style=""><abbr title=" 814                                  BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.getName()).getMetadata();"> 814                                  BasicFieldMetadata md = (BasicFieldMetadata) cmd.getPMap().get(property.getName())ðŸ”µ</abbr></span>
<span class="-2874474282821972662" onmouseenter="enter('-2874474282821972662');" onmouseout="out('-2874474282821972662');" style=""> 815                                  if (md.getFieldType().equals(SupportedFieldType.ID)) {                            </span>
<span class="-1836186832588240544" onmouseenter="enter('-1836186832588240544');" onmouseout="out('-1836186832588240544');" style=""> 816                                      return property.getValue();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 817                                  }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 818                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 819                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 820                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 821                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 822              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 823          }                                                                                                         </span>
<span class="6467699841617564408" onmouseenter="enter('6467699841617564408');" onmouseout="out('6467699841617564408');" style=""> 824          if (!prefix.contains(&quot;.&quot;)) {                                                                              </span>
<span class="-6458727047245688221" onmouseenter="enter('-6458727047245688221');" onmouseout="out('-6458727047245688221');" style=""><abbr title=" 825              //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restrictedPriceLists on OfferImpl)"> 825              //this may be an embedded class directly on the root entity (e.g. embeddablePriceList.restrictedPriceLðŸ”µ</abbr></span>
<span class="7560335858642671921" onmouseenter="enter('7560335858642671921');" onmouseout="out('7560335858642671921');" style=""> 826              return entity.findProperty(&quot;id&quot;).getValue();                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 827          }                                                                                                         </span>
<span class="-8024958864039426916" onmouseenter="enter('-8024958864039426916');" onmouseout="out('-8024958864039426916');" style=""> 828          throw new RuntimeException(&quot;Unable to establish a relationship id&quot;);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 829      }                                                                                                             </span>
<span  style=""> 830                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 831      @Override                                                                                                     </span>
<span class="-3908255710031606050" onmouseenter="enter('-3908255710031606050');" onmouseout="out('-3908255710031606050');" style=""> 832      public String getIdProperty(ClassMetadata cmd) throws ServiceException {                                      </span>
<span class="3681854507729164346" onmouseenter="enter('3681854507729164346');" onmouseout="out('3681854507729164346');" style=""> 833          for (Property p : cmd.getProperties()) {                                                                  </span>
<span class="-1029066852878262358" onmouseenter="enter('-1029066852878262358');" onmouseout="out('-1029066852878262358');" style=""> 834              if (p.getMetadata() instanceof BasicFieldMetadata) {                                                  </span>
<span class="-5664285287189453326" onmouseenter="enter('-5664285287189453326');" onmouseout="out('-5664285287189453326');" style=""> 835                  BasicFieldMetadata fmd = (BasicFieldMetadata) p.getMetadata();                                    </span>
<span class="513655466689307970" onmouseenter="enter('513655466689307970');" onmouseout="out('513655466689307970');" style=""> 836                  //check for ID type and also make sure the field we&#x27;re looking at is not a &quot;ToOne&quot; association    </span>
<span class="-491768544454322511" onmouseenter="enter('-491768544454322511');" onmouseout="out('-491768544454322511');" style=""> 837                  if (SupportedFieldType.ID.equals(fmd.getFieldType()) &amp;&amp; !p.getName().contains(&quot;.&quot;)) {             </span>
<span class="-6048877223362319653" onmouseenter="enter('-6048877223362319653');" onmouseout="out('-6048877223362319653');" style=""> 838                      return p.getName();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 839                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 840              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 841          }                                                                                                         </span>
<span  style=""> 842                                                                                                                    </span>
<span class="-7942857982942474001" onmouseenter="enter('-7942857982942474001');" onmouseout="out('-7942857982942474001');" style=""> 843          throw new ServiceException(&quot;Could not determine ID field for &quot; + cmd.getCeilingType());                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 844      }                                                                                                             </span>
<span  style=""> 845                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 846      @Override                                                                                                     </span>
<span class="-6109521015369402099" onmouseenter="enter('-6109521015369402099');" onmouseout="out('-6109521015369402099');" style=""> 847      public PersistenceResponse add(PersistencePackageRequest request) throws ServiceException {                   </span>
<span class="-2588522872292014988" onmouseenter="enter('-2588522872292014988');" onmouseout="out('-2588522872292014988');" style=""> 848          return add(request, true);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 849      }                                                                                                             </span>
<span  style=""> 850                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 851      @Override                                                                                                     </span>
<span class="8827553339909366249" onmouseenter="enter('8827553339909366249');" onmouseout="out('8827553339909366249');" style=""><abbr title=" 852      public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 852      public PersistenceResponse add(PersistencePackageRequest request, boolean transactional) throws ServiceExceptiðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 853          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 854          try {                                                                                                     </span>
<span class="4836544755641051591" onmouseenter="enter('4836544755641051591');" onmouseout="out('4836544755641051591');" style=""> 855              if (request.isUpdateLookupType()) {                                                                   </span>
<span class="-2082930136830103093" onmouseenter="enter('-2082930136830103093');" onmouseout="out('-2082930136830103093');" style=""> 856                  if (pkg.getSectionCrumbs() != null &amp;&amp; pkg.getSectionCrumbs().length &gt; 0) {                        </span>
<span class="-6120347482693188577" onmouseenter="enter('-6120347482693188577');" onmouseout="out('-6120347482693188577');" style=""> 857                      SectionCrumb sc = pkg.getSectionCrumbs()[0];                                                  </span>
<span class="7706557227331502134" onmouseenter="enter('7706557227331502134');" onmouseout="out('7706557227331502134');" style=""> 858                      if (StringUtils.isNotBlank(sc.getSectionIdentifier())) {                                      </span>
<span class="7371017383769084435" onmouseenter="enter('7371017383769084435');" onmouseout="out('7371017383769084435');" style=""> 859                          pkg.setSecurityCeilingEntityFullyQualifiedClassname(sc.getSectionIdentifier());           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 860                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 861                  }                                                                                                 </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 862                  if (transactional) {                                                                              </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 863                      return service.update(pkg);                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 864                  } else {                                                                                          </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 865                      return service.nonTransactionalUpdate(pkg);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 866                  }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 867              } else {                                                                                              </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 868                  if (transactional) {                                                                              </span>
<span class="4552670565637379723" onmouseenter="enter('4552670565637379723');" onmouseout="out('4552670565637379723');" style=""> 869                      return service.add(pkg);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 870                  } else {                                                                                          </span>
<span class="6732121152740224457" onmouseenter="enter('6732121152740224457');" onmouseout="out('6732121152740224457');" style=""> 871                      return service.nonTransactionalAdd(pkg);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 872                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 873              }                                                                                                     </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 874          } catch (ValidationException e) {                                                                         </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 875              ensureEntityMarkedAsValidationFailure(e, request);                                                    </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 876              return new PersistenceResponse().withEntity(e.getEntity());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 877          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 878      }                                                                                                             </span>
<span  style=""> 879                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 880      @Override                                                                                                     </span>
<span class="-2168493081511676385" onmouseenter="enter('-2168493081511676385');" onmouseout="out('-2168493081511676385');" style=""> 881      public PersistenceResponse update(PersistencePackageRequest request) throws ServiceException {                </span>
<span class="-1915092381367502552" onmouseenter="enter('-1915092381367502552');" onmouseout="out('-1915092381367502552');" style=""> 882          return update(request, true);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 883      }                                                                                                             </span>
<span  style=""> 884                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 885      @Override                                                                                                     </span>
<span class="-3035175746782535545" onmouseenter="enter('-3035175746782535545');" onmouseout="out('-3035175746782535545');" style=""><abbr title=" 886      public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 886      public PersistenceResponse update(PersistencePackageRequest request, boolean transactional) throws ServiceExceðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 887          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 888          try {                                                                                                     </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 889              if (transactional) {                                                                                  </span>
<span class="-6975163634258693396" onmouseenter="enter('-6975163634258693396');" onmouseout="out('-6975163634258693396');" style=""> 890                  return service.update(pkg);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 891              } else {                                                                                              </span>
<span class="-5826933752646050968" onmouseenter="enter('-5826933752646050968');" onmouseout="out('-5826933752646050968');" style=""> 892                  return service.nonTransactionalUpdate(pkg);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 893              }                                                                                                     </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 894          } catch (ValidationException e) {                                                                         </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 895              ensureEntityMarkedAsValidationFailure(e, request);                                                    </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 896              return new PersistenceResponse().withEntity(e.getEntity());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 897          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 898      }                                                                                                             </span>
<span  style=""> 899                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 900      @Override                                                                                                     </span>
<span class="-1312385666630581282" onmouseenter="enter('-1312385666630581282');" onmouseout="out('-1312385666630581282');" style=""> 901      public PersistenceResponse inspect(PersistencePackageRequest request)                                         </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 902              throws ServiceException {                                                                             </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 903          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span class="2565705442671799096" onmouseenter="enter('2565705442671799096');" onmouseout="out('2565705442671799096');" style=""> 904          return service.inspect(pkg);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 905      }                                                                                                             </span>
<span  style=""> 906                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 907      @Override                                                                                                     </span>
<span class="-2409492513544163046" onmouseenter="enter('-2409492513544163046');" onmouseout="out('-2409492513544163046');" style=""> 908      public PersistenceResponse remove(PersistencePackageRequest request)                                          </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 909              throws ServiceException {                                                                             </span>
<span class="1818424953510541932" onmouseenter="enter('1818424953510541932');" onmouseout="out('1818424953510541932');" style=""> 910          return remove(request, true);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 911      }                                                                                                             </span>
<span  style=""> 912                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 913      @Override                                                                                                     </span>
<span class="-9050585893076336114" onmouseenter="enter('-9050585893076336114');" onmouseout="out('-9050585893076336114');" style=""><abbr title=" 914      public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws ServiceException {"> 914      public PersistenceResponse remove(PersistencePackageRequest request, boolean transactional) throws ServiceExceðŸ”µ</abbr></span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 915          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 916          try {                                                                                                     </span>
<span class="2155495557702393463" onmouseenter="enter('2155495557702393463');" onmouseout="out('2155495557702393463');" style=""> 917              if (transactional) {                                                                                  </span>
<span class="-5643605501598977706" onmouseenter="enter('-5643605501598977706');" onmouseout="out('-5643605501598977706');" style=""> 918                  return service.remove(pkg);                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 919              } else {                                                                                              </span>
<span class="-8250836311704581891" onmouseenter="enter('-8250836311704581891');" onmouseout="out('-8250836311704581891');" style=""> 920                  return service.nonTransactionalRemove(pkg);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 921              }                                                                                                     </span>
<span class="-2758815083603308802" onmouseenter="enter('-2758815083603308802');" onmouseout="out('-2758815083603308802');" style=""> 922          } catch (ValidationException e) {                                                                         </span>
<span class="-4464401654019965580" onmouseenter="enter('-4464401654019965580');" onmouseout="out('-4464401654019965580');" style=""> 923              ensureEntityMarkedAsValidationFailure(e, request);                                                    </span>
<span class="-8369034844532548433" onmouseenter="enter('-8369034844532548433');" onmouseout="out('-8369034844532548433');" style=""> 924              return new PersistenceResponse().withEntity(e.getEntity());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 925          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 926      }                                                                                                             </span>
<span  style=""> 927                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 928      /**                                                                                                           </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 929       * &lt;p&gt;                                                                                                        </span>
<span class="3729604611716511130" onmouseenter="enter('3729604611716511130');" onmouseout="out('3729604611716511130');" style=""><abbr title=" 930       * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} contained within the"> 930       * Should be invoked when a {@link ValidationException} is thrown to verify that the {@link Entity} contained ðŸ”µ</abbr></span>
<span class="-7341678569298188314" onmouseenter="enter('-7341678569298188314');" onmouseout="out('-7341678569298188314');" style=""> 931       * given &lt;b&gt;originalRequest&lt;/b&gt; has a validationFailure = true                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 932       *                                                                                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style=""> 933       * &lt;p&gt;                                                                                                        </span>
<span class="-7716663654145973669" onmouseenter="enter('-7716663654145973669');" onmouseout="out('-7716663654145973669');" style=""> 934       * This will also check for a cause of {@link ConstraintViolationException} and add a gloal error to that.    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 935       */                                                                                                           </span>
<span class="807801721535748536" onmouseenter="enter('807801721535748536');" onmouseout="out('807801721535748536');" style=""><abbr title=" 936      protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequest originalRequest) {"> 936      protected void ensureEntityMarkedAsValidationFailure(ValidationException e, PersistencePackageRequest originalðŸ”µ</abbr></span>
<span class="5399941146961217832" onmouseenter="enter('5399941146961217832');" onmouseout="out('5399941146961217832');" style=""> 937          if (e.containsCause(ConstraintViolationException.class)) {                                                </span>
<span class="-5214743212244855970" onmouseenter="enter('-5214743212244855970');" onmouseout="out('-5214743212244855970');" style=""> 938              e.getEntity().addGlobalValidationError(&quot;constraintViolationError&quot;);                                   </span>
<span class="4509625189679774854" onmouseenter="enter('4509625189679774854');" onmouseout="out('4509625189679774854');" style=""> 939          } else if (!e.getEntity().isValidationFailure()) {                                                        </span>
<span class="-4984910861440118934" onmouseenter="enter('-4984910861440118934');" onmouseout="out('-4984910861440118934');" style=""> 940              e.getEntity().setValidationFailure(true);                                                             </span>
<span class="-6792721057862982153" onmouseenter="enter('-6792721057862982153');" onmouseout="out('-6792721057862982153');" style=""> 941              e.getEntity().addGlobalValidationError(e.getMessage());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 942          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 943      }                                                                                                             </span>
<span  style=""> 944                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 945      @Override                                                                                                     </span>
<span class="5311420287927073238" onmouseenter="enter('5311420287927073238');" onmouseout="out('5311420287927073238');" style=""> 946      public PersistenceResponse fetch(PersistencePackageRequest request)                                           </span>
<span class="1998458335829271558" onmouseenter="enter('1998458335829271558');" onmouseout="out('1998458335829271558');" style=""> 947              throws ServiceException {                                                                             </span>
<span class="-6370936245646502244" onmouseenter="enter('-6370936245646502244');" onmouseout="out('-6370936245646502244');" style=""> 948          PersistencePackage pkg = persistencePackageFactory.create(request);                                       </span>
<span  style=""> 949                                                                                                                    </span>
<span class="-5375974030412648260" onmouseenter="enter('-5375974030412648260');" onmouseout="out('-5375974030412648260');" style=""> 950          CriteriaTransferObject cto = getDefaultCto();                                                             </span>
<span class="-1800505558210996683" onmouseenter="enter('-1800505558210996683');" onmouseout="out('-1800505558210996683');" style=""> 951          if (request.getFilterAndSortCriteria() != null) {                                                         </span>
<span class="629113105269586037" onmouseenter="enter('629113105269586037');" onmouseout="out('629113105269586037');" style=""> 952              cto.addAll(Arrays.asList(request.getFilterAndSortCriteria()));                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 953          }                                                                                                         </span>
<span  style=""> 954                                                                                                                    </span>
<span class="-3823245946626813984" onmouseenter="enter('-3823245946626813984');" onmouseout="out('-3823245946626813984');" style=""> 955          if (request.getMaxResults() != null) {                                                                    </span>
<span class="-8351200142276180335" onmouseenter="enter('-8351200142276180335');" onmouseout="out('-8351200142276180335');" style=""> 956              cto.setMaxResults(request.getMaxResults());                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 957          }                                                                                                         </span>
<span  style=""> 958                                                                                                                    </span>
<span class="-690040157024225203" onmouseenter="enter('-690040157024225203');" onmouseout="out('-690040157024225203');" style=""> 959          if (request.getStartIndex() == null) {                                                                    </span>
<span class="2764779885143665984" onmouseenter="enter('2764779885143665984');" onmouseout="out('2764779885143665984');" style=""> 960              cto.setFirstResult(0);                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 961          } else {                                                                                                  </span>
<span class="-6350611603682358812" onmouseenter="enter('-6350611603682358812');" onmouseout="out('-6350611603682358812');" style=""> 962              cto.setFirstResult(request.getStartIndex());                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 963          }                                                                                                         </span>
<span  style=""> 964                                                                                                                    </span>
<span class="-1342097346218425419" onmouseenter="enter('-1342097346218425419');" onmouseout="out('-1342097346218425419');" style=""> 965          if (request.getMaxIndex() != null) {                                                                      </span>
<span class="-8120529832746798414" onmouseenter="enter('-8120529832746798414');" onmouseout="out('-8120529832746798414');" style=""> 966              Integer startIndex = request.getStartIndex() != null ? request.getStartIndex() : 0;                   </span>
<span class="-6682475132360394674" onmouseenter="enter('-6682475132360394674');" onmouseout="out('-6682475132360394674');" style=""> 967              int requestedMaxResults = request.getMaxIndex() - startIndex + 1;                                     </span>
<span class="-4912375422916056974" onmouseenter="enter('-4912375422916056974');" onmouseout="out('-4912375422916056974');" style=""> 968              if (requestedMaxResults &gt;= 0 &amp;&amp; requestedMaxResults &lt; cto.getMaxResults()) {                          </span>
<span class="-1275291600011289156" onmouseenter="enter('-1275291600011289156');" onmouseout="out('-1275291600011289156');" style=""> 969                  cto.setMaxResults(requestedMaxResults);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 970              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 971          }                                                                                                         </span>
<span  style=""> 972                                                                                                                    </span>
<span class="1589811072437566840" onmouseenter="enter('1589811072437566840');" onmouseout="out('1589811072437566840');" style=""> 973          cto.setLastId(request.getLastId());                                                                       </span>
<span class="4489054305431733195" onmouseenter="enter('4489054305431733195');" onmouseout="out('4489054305431733195');" style=""> 974          cto.setFirstId(request.getFirstId());                                                                     </span>
<span class="7683513281487176699" onmouseenter="enter('7683513281487176699');" onmouseout="out('7683513281487176699');" style=""> 975          cto.setUpperCount(request.getUpperCount());                                                               </span>
<span class="-8031307621948936245" onmouseenter="enter('-8031307621948936245');" onmouseout="out('-8031307621948936245');" style=""> 976          cto.setLowerCount(request.getLowerCount());                                                               </span>
<span class="63997933306934756" onmouseenter="enter('63997933306934756');" onmouseout="out('63997933306934756');" style=""> 977          if (request.getPageSize() != null) {                                                                      </span>
<span class="-7018914636118190968" onmouseenter="enter('-7018914636118190968');" onmouseout="out('-7018914636118190968');" style=""> 978              cto.setMaxResults(request.getPageSize());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 979          }                                                                                                         </span>
<span class="5284762326708873211" onmouseenter="enter('5284762326708873211');" onmouseout="out('5284762326708873211');" style=""> 980          cto.setPresentationFetch(request.getPresentationFetch());                                                 </span>
<span  style=""> 981                                                                                                                    </span>
<span class="8885053060558966919" onmouseenter="enter('8885053060558966919');" onmouseout="out('8885053060558966919');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 982 +        if (request.isFolderedLookup()) {                                                                         </span>
<span class="3703526123616875051" onmouseenter="enter('3703526123616875051');" onmouseout="out('3703526123616875051');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 983 +            cto.setFolderLookup(true);                                                                            </span>
<span class="1820221740933941643" onmouseenter="enter('1820221740933941643');" onmouseout="out('1820221740933941643');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 984 +            cto.setFolderId(request.getFolderId());                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 985 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 986 +                                                                                                                  </span>
<span class="955805546394053652" onmouseenter="enter('955805546394053652');" onmouseout="out('955805546394053652');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 987 +        if (extensionManager != null) {                                                                           </span>
<span class="371414988916191718" onmouseenter="enter('371414988916191718');" onmouseout="out('371414988916191718');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 988 +            extensionManager.getProxy().modifyFetchCriteriaTransferObject(request, cto);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 989 +        }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 990 +                                                                                                                  </span>
<span class="-734873492845948502" onmouseenter="enter('-734873492845948502');" onmouseout="out('-734873492845948502');" style=""> 991          return service.fetch(pkg, cto);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 992      }                                                                                                             </span>
<span  style=""> 993                                                                                                                    </span>
<span class="1747080010822063537" onmouseenter="enter('1747080010822063537');" onmouseout="out('1747080010822063537');" style=""> 994      protected CriteriaTransferObject getDefaultCto() {                                                            </span>
<span class="-7937218466133346867" onmouseenter="enter('-7937218466133346867');" onmouseout="out('-7937218466133346867');" style=""> 995          CriteriaTransferObject cto = new CriteriaTransferObject();                                                </span>
<span class="-792606519014114045" onmouseenter="enter('-792606519014114045');" onmouseout="out('-792606519014114045');" style=""> 996          cto.setMaxResults(getDefaultMaxResults());                                                                </span>
<span class="6058297727948666853" onmouseenter="enter('6058297727948666853');" onmouseout="out('6058297727948666853');" style=""> 997          return cto;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 998      }                                                                                                             </span>
<span  style=""> 999                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">1000      @Override                                                                                                     </span>
<span class="8883083618394394837" onmouseenter="enter('8883083618394394837');" onmouseout="out('8883083618394394837');" style="">1001      public String getForeignEntityName(String owningClass, String id) {                                           </span>
<span class="-872554261283939929" onmouseenter="enter('-872554261283939929');" onmouseout="out('-872554261283939929');" style="">1002          if (owningClass == null || id == null) {                                                                  </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1003              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1004          }                                                                                                         </span>
<span  style="">1005                                                                                                                    </span>
<span class="3468023357463508719" onmouseenter="enter('3468023357463508719');" onmouseout="out('3468023357463508719');" style="">1006          DynamicEntityDao dynamicEntityDao = getDynamicEntityDao(owningClass);                                     </span>
<span class="7635620295149838730" onmouseenter="enter('7635620295149838730');" onmouseout="out('7635620295149838730');" style="">1007          Class&lt;?&gt; clazz = dynamicEntityDao.getImplClass(owningClass);                                              </span>
<span class="6841796057846720752" onmouseenter="enter('6841796057846720752');" onmouseout="out('6841796057846720752');" style="">1008          Object foreignEntity = dynamicEntityDao.find(clazz, toIdFieldType(id, clazz));                            </span>
<span  style="">1009                                                                                                                    </span>
<span class="6094352409442952488" onmouseenter="enter('6094352409442952488');" onmouseout="out('6094352409442952488');" style="">1010          if (foreignEntity instanceof AdminMainEntity) {                                                           </span>
<span class="-5844179197625315876" onmouseenter="enter('-5844179197625315876');" onmouseout="out('-5844179197625315876');" style="">1011              return ((AdminMainEntity) foreignEntity).getMainEntityName();                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1012          }                                                                                                         </span>
<span  style="">1013                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style="">1014          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1015      }                                                                                                             </span>
<span  style="">1016                                                                                                                    </span>
<span class="-1537571071296717959" onmouseenter="enter('-1537571071296717959');" onmouseout="out('-1537571071296717959');" style="">1017      protected DynamicEntityDao getDynamicEntityDao(String owningClass) {                                          </span>
<span class="8951596410601292775" onmouseenter="enter('8951596410601292775');" onmouseout="out('8951596410601292775');" style="">1018          return PersistenceManagerFactory.getPersistenceManager(owningClass).getDynamicEntityDao();                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1019      }                                                                                                             </span>
<span  style="">1020                                                                                                                    </span>
<span class="7239398670151774953" onmouseenter="enter('7239398670151774953');" onmouseout="out('7239398670151774953');" style="">1021      protected int getDefaultMaxResults() {                                                                        </span>
<span class="-1067455107038749142" onmouseenter="enter('-1067455107038749142');" onmouseout="out('-1067455107038749142');" style="">1022          return BLCSystemProperty.resolveIntSystemProperty(&quot;admin.default.max.results&quot;, 50);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1023      }                                                                                                             </span>
<span  style="">1024                                                                                                                    </span>
<span class="8333077553386092776" onmouseenter="enter('8333077553386092776');" onmouseout="out('8333077553386092776');" style="">1025      protected Object toIdFieldType(String id, Class&lt;?&gt; entityClass) {                                             </span>
<span class="3604823920885758204" onmouseenter="enter('3604823920885758204');" onmouseout="out('3604823920885758204');" style="">1026          Class&lt;?&gt; idFieldClass = dynamicDaoHelper.getIdField(entityClass, em).getType();                           </span>

<span class="-2186353433511684671" onmouseenter="enter('-2186353433511684671');" onmouseout="out('-2186353433511684671');" style="">1027          if (Long.class.isAssignableFrom(idFieldClass)) {                                                          </span>
<span class="5572754406141306162" onmouseenter="enter('5572754406141306162');" onmouseout="out('5572754406141306162');" style="">1028              return Long.parseLong(id);                                                                            </span>
<span class="-3847313633493236310" onmouseenter="enter('-3847313633493236310');" onmouseout="out('-3847313633493236310');" style="">1029          } else if (Integer.class.isAssignableFrom(idFieldClass)) {                                                </span>
<span class="3211402984454379456" onmouseenter="enter('3211402984454379456');" onmouseout="out('3211402984454379456');" style="">1030              return Integer.parseInt(id);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1031          }                                                                                                         </span>
<span class="-3074727595953522219" onmouseenter="enter('-3074727595953522219');" onmouseout="out('-3074727595953522219');" style="">1032          return id;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1033      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">1034  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            