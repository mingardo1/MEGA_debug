<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>320</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    320
                    <a href="319.html">prev</a>
                    <a href="321.html">next</a>
                    <a href="320_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CyanogenMod/android_packages_apps_Trebuchet_7118d9dd17f51d998440f257935d6670c927383f_src/com/android/launcher3/IconCache.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;7118d9dd17f51d998440f257935d6670c927383f:src/com/android/launcher3/IconCache.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;7118d9dd17f51d998440f257935d6670c927383f^1:src/com/android/launcher3/IconCache.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;7118d9dd17f51d998440f257935d6670c927383f^2:src/com/android/launcher3/IconCache.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CyanogenMod\android_packages_apps_Trebuchet show &quot;58dcef7b28ec0bbc8e097b2cd45a6c6542a4cdef:src/com/android/launcher3/IconCache.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [b], [b], [b], [b], [b], [b], [b], [b], [b]], subset: [[b], [b], [b], [b], [b], [b], [b], [b], [b], [b], [b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2008 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 
  17 package com.android.launcher3;
  18 
  19 import android.app.ActivityManager;
  20 import android.content.ComponentName;
  21 import android.content.Context;
  22 import android.content.Intent;
  23 import android.content.pm.ActivityInfo;
  24 import android.content.pm.ApplicationInfo;
  25 import android.content.pm.PackageManager;
  26 import android.content.pm.PackageManager.NameNotFoundException;
  27 import android.content.pm.ResolveInfo;
  28 import android.content.res.Resources;
  29 import android.graphics.Bitmap;
  30 import android.graphics.Canvas;
  31 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import android.graphics.drawable.BitmapDrawable;</span>
  33 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import android.graphics.Bitmap;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import android.graphics.BitmapFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import android.graphics.Canvas;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import android.graphics.Paint;</span>
  38 =======
  39 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  40 import android.graphics.drawable.Drawable;
  41 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42 import android.text.TextUtils;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43 import android.util.Log;</span>
  44 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 import android.graphics.BitmapFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46 import android.graphics.Canvas;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 import android.graphics.Paint;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 import android.graphics.drawable.Drawable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 </span>
  51 =======
  52 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  53 
  54 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55 import com.android.launcher3.compat.LauncherActivityInfoCompat;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56 import com.android.launcher3.compat.LauncherAppsCompat;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57 import com.android.launcher3.compat.UserHandleCompat;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58 import com.android.launcher3.compat.UserManagerCompat;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60 import java.io.ByteArrayOutputStream;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61 import java.io.File;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62 import java.io.FileInputStream;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63 import java.io.FileNotFoundException;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64 import java.io.FileOutputStream;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65 import java.io.IOException;</span>
  66 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 import android.graphics.Canvas;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 import android.graphics.Paint;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 import android.graphics.drawable.Drawable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72 import java.io.ByteArrayOutputStream;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 import java.io.File;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74 import java.io.FileInputStream;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 import java.io.FileNotFoundException;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76 import java.io.FileOutputStream;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 import java.io.IOException;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 import java.util.HashSet;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80 import java.util.Iterator;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 import java.util.Map.Entry;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 /**</span>
  84 =======
  85 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  86 import java.util.HashMap;
  87 import java.util.Iterator;
  88 import java.util.Map.Entry;
  89 
  90 /**
  91  * Cache of application icons.  Icons can be made from any thread.
  92  */
  93 public class IconCache {
  94 
  95     private static final String TAG = &quot;Launcher.IconCache&quot;;
  96 
  97     private static final int INITIAL_ICON_CACHE_CAPACITY = 50;
  98 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99     private static final String RESOURCE_FILE_PREFIX = &quot;icon_&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101     // Empty class name is used for storing package default entry.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102     private static final String EMPTY_CLASS_NAME = &quot;.&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104     private static final boolean DEBUG = false;</span>
 105 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106 import java.util.HashSet;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107 import java.util.Iterator;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108 import java.util.Map.Entry;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111  * Cache of application icons.  Icons can be made from any thread.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113 public class IconCache {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114     @SuppressWarnings(&quot;unused&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115     private static final String TAG = &quot;Launcher.IconCache&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117     private static final int INITIAL_ICON_CACHE_CAPACITY = 50;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118     private static final String RESOURCE_FILE_PREFIX = &quot;icon_&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120     private static final boolean DEBUG = true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122     private static class CacheEntry {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123         public Bitmap icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         public String title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127     private final Bitmap mDefaultIcon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     private final Context mContext;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129     private final PackageManager mPackageManager;</span>
 130 =======
 131 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 132 
 133     private static class CacheEntry {
 134         public Bitmap icon;
 135         public CharSequence title;
 136         public CharSequence contentDescription;
 137     }
 138 
 139     private static class CacheKey {
 140         public ComponentName componentName;
 141         public UserHandleCompat user;
 142 
 143         CacheKey(ComponentName componentName, UserHandleCompat user) {
 144             this.componentName = componentName;
 145             this.user = user;
 146         }
 147 
 148         @Override
 149         public int hashCode() {
 150             return componentName.hashCode() + user.hashCode();
 151         }
 152 
 153         @Override
 154         public boolean equals(Object o) {
 155             CacheKey other = (CacheKey) o;
 156             return other.componentName.equals(componentName) &amp;&amp; other.user.equals(user);
 157         }
 158     }
 159 
 160     private final HashMap&lt;UserHandleCompat, Bitmap&gt; mDefaultIcons =
 161             new HashMap&lt;UserHandleCompat, Bitmap&gt;();
 162     private final Context mContext;
 163     private final PackageManager mPackageManager;
 164     private final UserManagerCompat mUserManager;
 165     private final LauncherAppsCompat mLauncherApps;
 166     private final HashMap&lt;CacheKey, CacheEntry&gt; mCache =
 167             new HashMap&lt;CacheKey, CacheEntry&gt;(INITIAL_ICON_CACHE_CAPACITY);
 168     private int mIconDpi;
 169 
 170     public IconCache(Context context) {
 171         ActivityManager activityManager =
 172                 (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
 173 
 174         mContext = context;
 175         mPackageManager = context.getPackageManager();
 176         mUserManager = UserManagerCompat.getInstance(mContext);
 177         mLauncherApps = LauncherAppsCompat.getInstance(mContext);
 178         mIconDpi = activityManager.getLauncherLargeIconDensity();
 179 
 180         // need to set mIconDpi before getting default icon
 181         UserHandleCompat myUser = UserHandleCompat.myUserHandle();
 182         mDefaultIcons.put(myUser, makeDefaultIcon(myUser));
 183     }
 184 
 185     public Drawable getFullResDefaultActivityIcon() {
 186         return getFullResIcon(Resources.getSystem(),
 187                 android.R.mipmap.sym_def_app_icon);
 188     }
 189 
 190     public Drawable getFullResIcon(Resources resources, int iconId) {
 191         Drawable d;
 192         try {
 193             d = resources.getDrawableForDensity(iconId, mIconDpi);
 194         } catch (Resources.NotFoundException e) {
 195             d = null;
 196         }
 197 
 198         return (d != null) ? d : getFullResDefaultActivityIcon();
 199     }
 200 
 201     public Drawable getFullResIcon(String packageName, int iconId) {
 202         Resources resources;
 203         try {
 204             resources = mPackageManager.getResourcesForApplication(packageName);
 205         } catch (PackageManager.NameNotFoundException e) {
 206             resources = null;
 207         }
 208         if (resources != null) {
 209             if (iconId != 0) {
 210                 return getFullResIcon(resources, iconId);
 211             }
 212         }
 213         return getFullResDefaultActivityIcon();
 214     }
 215 
 216     public int getFullResIconDpi() {
 217         return mIconDpi;
 218     }
 219 
 220     public Drawable getFullResIcon(ResolveInfo info) {
 221         return getFullResIcon(info.activityInfo);
 222     }
 223 
 224     public Drawable getFullResIcon(ActivityInfo info) {
 225 
 226         Resources resources;
 227         try {
 228             resources = mPackageManager.getResourcesForApplication(
 229                     info.applicationInfo);
 230         } catch (PackageManager.NameNotFoundException e) {
 231             resources = null;
 232         }
 233         if (resources != null) {
 234             int iconId = info.getIconResource();
 235             if (iconId != 0) {
 236                 return getFullResIcon(resources, iconId);
 237             }
 238         }
 239         return getFullResDefaultActivityIcon();
 240     }
 241 
 242     private Bitmap makeDefaultIcon(UserHandleCompat user) {
 243         Drawable unbadged = getFullResDefaultActivityIcon();
 244         Drawable d = mUserManager.getBadgedDrawableForUser(unbadged, user);
 245         Bitmap b = Bitmap.createBitmap(Math.max(d.getIntrinsicWidth(), 1),
 246                 Math.max(d.getIntrinsicHeight(), 1),
 247                 Bitmap.Config.ARGB_8888);
 248         Canvas c = new Canvas(b);
 249         d.setBounds(0, 0, b.getWidth(), b.getHeight());
 250         d.draw(c);
 251         c.setBitmap(null);
 252         return b;
 253     }
 254 
 255     /**
 256      * Remove any records for the supplied ComponentName.
 257      */
 258     public void remove(ComponentName componentName, UserHandleCompat user) {
 259         synchronized (mCache) {
 260             mCache.remove(new CacheKey(componentName, user));
 261         }
 262     }
 263 
 264     /**
 265 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 266      * Remove any records for the supplied package name.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 267      */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 268     public void remove(String packageName, UserHandleCompat user) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 269         HashSet&lt;CacheKey&gt; forDeletion = new HashSet&lt;CacheKey&gt;();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 270         for (CacheKey key: mCache.keySet()) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271             if (key.componentName.getPackageName().equals(packageName)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 272                     &amp;&amp; key.user.equals(user)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 273                 forDeletion.add(key);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 274             }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 275         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 276         for (CacheKey condemned: forDeletion) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 277             mCache.remove(condemned);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 278         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 281     /**</span>
 282 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         d.setBounds(0, 0, b.getWidth(), b.getHeight());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284         d.draw(c);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285         c.setBitmap(null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286         return b;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290      * Remove any records for the supplied ComponentName.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292     public void remove(ComponentName componentName) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294             mCache.remove(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299      * Remove any records for the supplied package name.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301     public void remove(String packageName) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302         HashSet&lt;ComponentName&gt; forDeletion = new HashSet&lt;ComponentName&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303         for (ComponentName componentName: mCache.keySet()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304             if (componentName.getPackageName().equals(packageName)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305                 forDeletion.add(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308         for (ComponentName condemned: forDeletion) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309             remove(condemned);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314      * Empty out the cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316     public void flush() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318             mCache.clear();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323      * Empty out the cache that aren&#x27;t of the correct grid size</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325     public void flushInvalidIcons(DeviceProfile grid) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327             Iterator&lt;Entry&lt;ComponentName, CacheEntry&gt;&gt; it = mCache.entrySet().iterator();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328             while (it.hasNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329                 final CacheEntry e = it.next().getValue();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330                 if (e.icon.getWidth() &lt; grid.iconSizePx || e.icon.getHeight() &lt; grid.iconSizePx) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331                     it.remove();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338      * Fill in &quot;application&quot; with the icon and label for &quot;info.&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340     public void getTitleAndIcon(AppInfo application, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343             CacheEntry entry = cacheLocked(application.componentName, info, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345             application.title = entry.title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346             application.iconBitmap = entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350     public Bitmap getIcon(Intent intent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351         return getIcon(intent, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354     public Bitmap getIcon(Intent intent, String title) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356             final ResolveInfo resolveInfo = mPackageManager.resolveActivity(intent, 0);</span>
 357 =======
 358 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 359      * Empty out the cache.
 360      */
 361     public void flush() {
 362         synchronized (mCache) {
 363             mCache.clear();
 364         }
 365     }
 366 
 367     /**
 368      * Empty out the cache that aren&#x27;t of the correct grid size
 369      */
 370     public void flushInvalidIcons(DeviceProfile grid) {
 371         synchronized (mCache) {
 372             Iterator&lt;Entry&lt;CacheKey, CacheEntry&gt;&gt; it = mCache.entrySet().iterator();
 373             while (it.hasNext()) {
 374                 final CacheEntry e = it.next().getValue();
 375                 if ((e.icon != null) &amp;&amp; (e.icon.getWidth() &lt; grid.iconSizePx
 376                         || e.icon.getHeight() &lt; grid.iconSizePx)) {
 377                     it.remove();
 378                 }
 379             }
 380         }
 381     }
 382 
 383     /**
 384      * Fill in &quot;application&quot; with the icon and label for &quot;info.&quot;
 385      */
 386     public void getTitleAndIcon(AppInfo application, LauncherActivityInfoCompat info,
 387             HashMap&lt;Object, CharSequence&gt; labelCache) {
 388         synchronized (mCache) {
 389             CacheEntry entry = cacheLocked(application.componentName, info, labelCache,
 390                     info.getUser(), false);
 391 
 392             application.title = entry.title;
 393             application.iconBitmap = entry.icon;
 394             application.contentDescription = entry.contentDescription;
 395         }
 396     }
 397 
 398 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 399     public Bitmap getIcon(Intent intent, UserHandleCompat user) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 400         return getIcon(intent, null, user, true);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 401     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 402 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 403     private Bitmap getIcon(Intent intent, String title, UserHandleCompat user, boolean usePkgIcon) {</span>
 404 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409      * Empty out the cache that aren&#x27;t of the correct grid size</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411     public void flushInvalidIcons(DeviceProfile grid) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413             Iterator&lt;Entry&lt;ComponentName, CacheEntry&gt;&gt; it = mCache.entrySet().iterator();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414             while (it.hasNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415                 final CacheEntry e = it.next().getValue();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416                 if (e.icon.getWidth() &lt; grid.iconSizePx || e.icon.getHeight() &lt; grid.iconSizePx) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417                     it.remove();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424      * Fill in &quot;application&quot; with the icon and label for &quot;info.&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426     public void getTitleAndIcon(AppInfo application, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429             CacheEntry entry = cacheLocked(application.componentName, info, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431             application.title = entry.title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432             application.iconBitmap = entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436     public Bitmap getIcon(Intent intent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437         return getIcon(intent, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440     public Bitmap getIcon(Intent intent, String title) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442             final ResolveInfo resolveInfo = mPackageManager.resolveActivity(intent, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443             ComponentName component = intent.getComponent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445             if (component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446                 return mDefaultIcon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449             CacheEntry entry = cacheLocked(component, resolveInfo, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450             if (title != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451                 entry.title = title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457     public Bitmap getIcon(ComponentName component, ResolveInfo resolveInfo,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460             if (resolveInfo == null || component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461                 return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464             CacheEntry entry = cacheLocked(component, resolveInfo, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469     public boolean isDefaultIcon(Bitmap icon) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470         return mDefaultIcon == icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473     private CacheEntry cacheLocked(ComponentName componentName, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475         CacheEntry entry = mCache.get(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476         if (entry == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477             entry = new CacheEntry();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479             mCache.put(componentName, entry);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481             if (info != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482                 ComponentName key = LauncherModel.getComponentNameFromResolveInfo(info);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483                 if (labelCache != null &amp;&amp; labelCache.containsKey(key)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484                     entry.title = labelCache.get(key).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486                     entry.title = info.loadLabel(mPackageManager).toString();</span>
 487 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488     public Bitmap getIcon(Intent intent) {</span>
 489 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 490         synchronized (mCache) {
 491             ComponentName component = intent.getComponent();
 492 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 493             // null info means not installed, but if we have a component from the intent then</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 494             // we should still look in the cache for restored app icons.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 495             if (component == null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 496                 return getDefaultIcon(user);</span>
 497 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498      * Empty out the cache that aren&#x27;t of the correct grid size</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500     public void flushInvalidIcons(DeviceProfile grid) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502             Iterator&lt;Entry&lt;ComponentName, CacheEntry&gt;&gt; it = mCache.entrySet().iterator();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503             while (it.hasNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504                 final CacheEntry e = it.next().getValue();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505                 if (e.icon.getWidth() &lt; grid.iconSizePx || e.icon.getHeight() &lt; grid.iconSizePx) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506                     it.remove();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513      * Fill in &quot;application&quot; with the icon and label for &quot;info.&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515     public void getTitleAndIcon(AppInfo application, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518             CacheEntry entry = cacheLocked(application.componentName, info, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520             application.title = entry.title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521             application.iconBitmap = entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525     public Bitmap getIcon(Intent intent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526         return getIcon(intent, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529     public Bitmap getIcon(Intent intent, String title) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531             final ResolveInfo resolveInfo = mPackageManager.resolveActivity(intent, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532             ComponentName component = intent.getComponent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534             if (component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535                 return mDefaultIcon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538             CacheEntry entry = cacheLocked(component, resolveInfo, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539             if (title != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540                 entry.title = title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 541             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 542             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 543         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 544     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 545 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 546     public Bitmap getIcon(ComponentName component, ResolveInfo resolveInfo,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 547             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 548         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 549             if (resolveInfo == null || component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 550                 return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 551             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 552 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 553             CacheEntry entry = cacheLocked(component, resolveInfo, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 554             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 555         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 556     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 557 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 558     public boolean isDefaultIcon(Bitmap icon) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 559         return mDefaultIcon == icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 560     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 561 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 562     private CacheEntry cacheLocked(ComponentName componentName, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 563             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 564         CacheEntry entry = mCache.get(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 565         if (entry == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 566             entry = new CacheEntry();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 567 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 568             mCache.put(componentName, entry);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 569 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 570             if (info != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 571                 ComponentName key = LauncherModel.getComponentNameFromResolveInfo(info);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 572                 if (labelCache != null &amp;&amp; labelCache.containsKey(key)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 573                     entry.title = labelCache.get(key).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 574                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 575                     entry.title = info.loadLabel(mPackageManager).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 576                     if (labelCache != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 577                         labelCache.put(key, entry.title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 578                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 579                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 580                 if (entry.title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 581                     entry.title = info.activityInfo.name;</span>
 582 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584             if (resolveInfo == null || component == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585                 return mDefaultIcon;</span>
 586 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 587             }
 588 
 589 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 590             LauncherActivityInfoCompat launcherActInfo = mLauncherApps.resolveActivity(intent, user);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 591             CacheEntry entry = cacheLocked(component, launcherActInfo, null, user, usePkgIcon);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 592             if (title != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 593                 entry.title = title;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 594                 entry.contentDescription = mUserManager.getBadgedLabelForUser(title, user);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 595             }</span>
 596 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 597             while (it.hasNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 598                 final CacheEntry e = it.next().getValue();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 599                 if (e.icon.getWidth() &lt; grid.iconSizePx || e.icon.getHeight() &lt; grid.iconSizePx) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 600                     it.remove();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 601                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 602             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 603         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 604     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 605 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 606     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 607      * Fill in &quot;application&quot; with the icon and label for &quot;info.&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 608      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 609     public void getTitleAndIcon(AppInfo application, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 610             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 611         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 612             CacheEntry entry = cacheLocked(application.componentName, info, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 613 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 614             application.title = entry.title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 615             application.iconBitmap = entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 616         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 617     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 618 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 619     public Bitmap getIcon(Intent intent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 620         return getIcon(intent, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 621     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 622 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 623     public Bitmap getIcon(Intent intent, String title) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 624         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 625             final ResolveInfo resolveInfo = mPackageManager.resolveActivity(intent, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 626             ComponentName component = intent.getComponent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 627 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 628             if (component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 629                 return mDefaultIcon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 630             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632             CacheEntry entry = cacheLocked(component, resolveInfo, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 633             if (title != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 634                 entry.title = title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 635             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 636             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 637         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 638     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 639 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 640     public Bitmap getIcon(ComponentName component, ResolveInfo resolveInfo,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 641             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 642         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 643             if (resolveInfo == null || component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 644                 return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 645             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 646 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 647             CacheEntry entry = cacheLocked(component, resolveInfo, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 648             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 649         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 650     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 651 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 652     public boolean isDefaultIcon(Bitmap icon) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 653         return mDefaultIcon == icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 654     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 655 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 656     private CacheEntry cacheLocked(ComponentName componentName, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 657             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 658         CacheEntry entry = mCache.get(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 659         if (entry == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 660             entry = new CacheEntry();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 661 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 662             mCache.put(componentName, entry);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 663 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 664             if (info != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 665                 ComponentName key = LauncherModel.getComponentNameFromResolveInfo(info);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 666                 if (labelCache != null &amp;&amp; labelCache.containsKey(key)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 667                     entry.title = labelCache.get(key).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 668                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 669                     entry.title = info.loadLabel(mPackageManager).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 670                     if (labelCache != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 671                         labelCache.put(key, entry.title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 672                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 673                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 674                 if (entry.title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 675                     entry.title = info.activityInfo.name;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 676                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 677 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 678                 entry.icon = Utilities.createIconBitmap(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 679                         getFullResIcon(info), mContext);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 680             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 681                 entry.title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 682                 Bitmap preloaded = getPreloadedIcon(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 683                 if (preloaded != null) {</span>
 684 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685             CacheEntry entry = cacheLocked(component, resolveInfo, null);</span>
 686 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 687             return entry.icon;
 688         }
 689     }
 690 
 691     /**
 692      * Fill in &quot;shortcutInfo&quot; with the icon and label for &quot;info.&quot;
 693      */
 694     public void getTitleAndIcon(ShortcutInfo shortcutInfo, Intent intent, UserHandleCompat user,
 695             boolean usePkgIcon) {
 696         synchronized (mCache) {
 697             ComponentName component = intent.getComponent();
 698             // null info means not installed, but if we have a component from the intent then
 699             // we should still look in the cache for restored app icons.
 700             if (component == null) {
 701                 shortcutInfo.setIcon(getDefaultIcon(user));
 702                 shortcutInfo.title = &quot;&quot;;
 703                 shortcutInfo.usingFallbackIcon = true;
 704             } else {
 705                 LauncherActivityInfoCompat launcherActInfo =
 706                         mLauncherApps.resolveActivity(intent, user);
 707                 CacheEntry entry = cacheLocked(component, launcherActInfo, null, user, usePkgIcon);
 708 
 709                 shortcutInfo.setIcon(entry.icon);
 710                 shortcutInfo.title = entry.title;
 711                 shortcutInfo.usingFallbackIcon = isDefaultIcon(entry.icon, user);
 712             }
 713         }
 714     }
 715 
 716 
 717     public Bitmap getDefaultIcon(UserHandleCompat user) {
 718         if (!mDefaultIcons.containsKey(user)) {
 719             mDefaultIcons.put(user, makeDefaultIcon(user));
 720         }
 721         return mDefaultIcons.get(user);
 722     }
 723 
 724     public Bitmap getIcon(ComponentName component, LauncherActivityInfoCompat info,
 725             HashMap&lt;Object, CharSequence&gt; labelCache) {
 726         synchronized (mCache) {
 727             if (info == null || component == null) {
 728                 return null;
 729             }
 730 
 731             CacheEntry entry = cacheLocked(component, info, labelCache, info.getUser(), false);
 732             return entry.icon;
 733         }
 734     }
 735 
 736     public boolean isDefaultIcon(Bitmap icon, UserHandleCompat user) {
 737         return mDefaultIcons.get(user) == icon;
 738     }
 739 
 740     private CacheEntry cacheLocked(ComponentName componentName, LauncherActivityInfoCompat info,
 741             HashMap&lt;Object, CharSequence&gt; labelCache, UserHandleCompat user, boolean usePackageIcon) {
 742         CacheKey cacheKey = new CacheKey(componentName, user);
 743         CacheEntry entry = mCache.get(cacheKey);
 744         if (entry == null) {
 745             entry = new CacheEntry();
 746 
 747             mCache.put(cacheKey, entry);
 748 
 749 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 750             if (info != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 751                 ComponentName labelKey = info.getComponentName();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 752                 if (labelCache != null &amp;&amp; labelCache.containsKey(labelKey)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 753                     entry.title = labelCache.get(labelKey).toString();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 754                 } else {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 755                     entry.title = info.getLabel().toString();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 756                     if (labelCache != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 757                         labelCache.put(labelKey, entry.title);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 758                     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 759                 }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 760 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 761                 entry.contentDescription = mUserManager.getBadgedLabelForUser(entry.title, user);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 762                 entry.icon = Utilities.createIconBitmap(</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 763                         info.getBadgedIcon(mIconDpi), mContext);</span>
 764 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 765             ComponentName component = intent.getComponent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 766 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 767             if (component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 768                 return mDefaultIcon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 769             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 770 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 771             CacheEntry entry = cacheLocked(component, resolveInfo, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 772             if (title != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 773                 entry.title = title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 774             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 775             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 776         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 777     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 778 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 779     public Bitmap getIcon(ComponentName component, ResolveInfo resolveInfo,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 780             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 781         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 782             if (resolveInfo == null || component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 783                 return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 784             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 785 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 786             CacheEntry entry = cacheLocked(component, resolveInfo, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 787             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 788         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 789     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 790 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 791     public boolean isDefaultIcon(Bitmap icon) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 792         return mDefaultIcon == icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 793     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 794 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 795     private CacheEntry cacheLocked(ComponentName componentName, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 796             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 797         CacheEntry entry = mCache.get(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 798         if (entry == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 799             entry = new CacheEntry();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 800 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 801             mCache.put(componentName, entry);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 802 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 803             if (info != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 804                 ComponentName key = LauncherModel.getComponentNameFromResolveInfo(info);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 805                 if (labelCache != null &amp;&amp; labelCache.containsKey(key)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 806                     entry.title = labelCache.get(key).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 807                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 808                     entry.title = info.loadLabel(mPackageManager).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 809                     if (labelCache != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 810                         labelCache.put(key, entry.title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 811                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 812                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 813                 if (entry.title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 814                     entry.title = info.activityInfo.name;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 815                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 816 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 817                 entry.icon = Utilities.createIconBitmap(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 818                         getFullResIcon(info), mContext);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 819             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 820                 entry.title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 821                 Bitmap preloaded = getPreloadedIcon(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 822                 if (preloaded != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 823                     if (DEBUG) Log.d(TAG, &quot;using preloaded icon for &quot; +</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 824                             componentName.toShortString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 825                     entry.icon = preloaded;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 826                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 827                     if (DEBUG) Log.d(TAG, &quot;using default icon for &quot; +</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 828                             componentName.toShortString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 829                     entry.icon = mDefaultIcon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 830                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 831             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 832         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 833         return entry;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 834     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 835 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 836     public HashMap&lt;ComponentName,Bitmap&gt; getAllIcons() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 837         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 838             HashMap&lt;ComponentName,Bitmap&gt; set = new HashMap&lt;ComponentName,Bitmap&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 839             for (ComponentName cn : mCache.keySet()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 840                 final CacheEntry e = mCache.get(cn);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 841                 set.put(cn, e.icon);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 842             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 843             return set;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 844         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 845     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 846 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 847     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 848      * Pre-load an icon into the persistent cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 849      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 850      * &lt;P&gt;Queries for a component that does not exist in the package manager</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 851      * will be answered by the persistent cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 852      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 853      * @param context application context</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 854      * @param componentName the icon should be returned for this component</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 855      * @param icon the icon to be persisted</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 856      * @param dpi the native density of the icon</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 857      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 858     public static void preloadIcon(Context context, ComponentName componentName, Bitmap icon,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 859             int dpi) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 860         // TODO rescale to the correct native DPI</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 861         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 862             PackageManager packageManager = context.getPackageManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 863             packageManager.getActivityIcon(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 864             // component is present on the system already, do nothing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 865             return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 866         } catch (PackageManager.NameNotFoundException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 867             // pass</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 868         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 869 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 870         final String key = componentName.flattenToString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 871         FileOutputStream resourceFile = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 872         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 873             resourceFile = context.openFileOutput(getResourceFilename(componentName),</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 874                     Context.MODE_PRIVATE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 875             ByteArrayOutputStream os = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 876             if (icon.compress(android.graphics.Bitmap.CompressFormat.PNG, 75, os)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 877                 byte[] buffer = os.toByteArray();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 878                 resourceFile.write(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 879             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 880                 Log.w(TAG, &quot;failed to encode cache for &quot; + key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 881                 return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 882             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 883         } catch (FileNotFoundException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 884             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 885         } catch (IOException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 886             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 887         } finally {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 888             if (resourceFile != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 889                 try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 890                     resourceFile.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 891                 } catch (IOException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 892                     Log.d(TAG, &quot;failed to save restored icon for: &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 893                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 894             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 895         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 896     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 897 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 898     /**</span>
 899 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 900             ComponentName key = LauncherModel.getComponentNameFromResolveInfo(info);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 901             if (labelCache != null &amp;&amp; labelCache.containsKey(key)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 902                 entry.title = labelCache.get(key).toString();</span>
 903 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 904             } else {
 905 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 906                 entry.title = &quot;&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 907                 Bitmap preloaded = getPreloadedIcon(componentName, user);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 908                 if (preloaded != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 909                     if (DEBUG) Log.d(TAG, &quot;using preloaded icon for &quot; +</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 910                             componentName.toShortString());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 911                     entry.icon = preloaded;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 912                 } else {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 913                     if (usePackageIcon) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 914                         CacheEntry packageEntry = getEntryForPackage(</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 915                                 componentName.getPackageName(), user);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 916                         if (packageEntry != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 917                             if (DEBUG) Log.d(TAG, &quot;using package default icon for &quot; +</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 918                                     componentName.toShortString());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 919                             entry.icon = packageEntry.icon;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 920                             entry.title = packageEntry.title;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 921                         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 922                     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 923                     if (entry.icon == null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 924                         if (DEBUG) Log.d(TAG, &quot;using default icon for &quot; +</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 925                                 componentName.toShortString());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 926                         entry.icon = getDefaultIcon(user);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 927                     }</span>
 928 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 929             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 930 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 931             CacheEntry entry = cacheLocked(component, resolveInfo, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 932             if (title != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 933                 entry.title = title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 934             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 935             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 936         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 937     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 938 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 939     public Bitmap getIcon(ComponentName component, ResolveInfo resolveInfo,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 940             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 941         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 942             if (resolveInfo == null || component == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 943                 return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 944             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 945 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 946             CacheEntry entry = cacheLocked(component, resolveInfo, labelCache);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 947             return entry.icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 948         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 949     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 950 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 951     public boolean isDefaultIcon(Bitmap icon) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 952         return mDefaultIcon == icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 953     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 954 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 955     private CacheEntry cacheLocked(ComponentName componentName, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 956             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 957         CacheEntry entry = mCache.get(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 958         if (entry == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 959             entry = new CacheEntry();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 960 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 961             mCache.put(componentName, entry);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 962 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 963             if (info != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 964                 ComponentName key = LauncherModel.getComponentNameFromResolveInfo(info);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 965                 if (labelCache != null &amp;&amp; labelCache.containsKey(key)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 966                     entry.title = labelCache.get(key).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 967                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 968                     entry.title = info.loadLabel(mPackageManager).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 969                     if (labelCache != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 970                         labelCache.put(key, entry.title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 971                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 972                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 973                 if (entry.title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 974                     entry.title = info.activityInfo.name;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 975                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 976 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 977                 entry.icon = Utilities.createIconBitmap(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 978                         getFullResIcon(info), mContext);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 979             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 980                 entry.title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 981                 Bitmap preloaded = getPreloadedIcon(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 982                 if (preloaded != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 983                     if (DEBUG) Log.d(TAG, &quot;using preloaded icon for &quot; +</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 984                             componentName.toShortString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 985                     entry.icon = preloaded;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 986                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 987                     if (DEBUG) Log.d(TAG, &quot;using default icon for &quot; +</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 988                             componentName.toShortString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 989                     entry.icon = mDefaultIcon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 990                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 991             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 992         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 993         return entry;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 994     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 995 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 996     public HashMap&lt;ComponentName,Bitmap&gt; getAllIcons() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 997         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 998             HashMap&lt;ComponentName,Bitmap&gt; set = new HashMap&lt;ComponentName,Bitmap&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 999             for (ComponentName cn : mCache.keySet()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1000                 final CacheEntry e = mCache.get(cn);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1001                 set.put(cn, e.icon);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1002             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1003             return set;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1004         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1005     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1006 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1007     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1008      * Pre-load an icon into the persistent cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1009      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1010      * &lt;P&gt;Queries for a component that does not exist in the package manager</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1011      * will be answered by the persistent cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1012      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1013      * @param context application context</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1014      * @param componentName the icon should be returned for this component</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1015      * @param icon the icon to be persisted</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1016      * @param dpi the native density of the icon</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1017      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1018     public static void preloadIcon(Context context, ComponentName componentName, Bitmap icon,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1019             int dpi) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1020         // TODO rescale to the correct native DPI</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1021         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1022             PackageManager packageManager = context.getPackageManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1023             packageManager.getActivityIcon(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1024             // component is present on the system already, do nothing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1025             return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1026         } catch (PackageManager.NameNotFoundException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1027             // pass</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1028         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1029 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1030         final String key = componentName.flattenToString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1031         FileOutputStream resourceFile = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1032         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1033             resourceFile = context.openFileOutput(getResourceFilename(componentName),</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1034                     Context.MODE_PRIVATE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1035             ByteArrayOutputStream os = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1036             if (icon.compress(android.graphics.Bitmap.CompressFormat.PNG, 75, os)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1037                 byte[] buffer = os.toByteArray();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1038                 resourceFile.write(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1039             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1040                 Log.w(TAG, &quot;failed to encode cache for &quot; + key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1041                 return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1042             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1043         } catch (FileNotFoundException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1044             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1045         } catch (IOException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1046             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1047         } finally {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1048             if (resourceFile != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1049                 try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1050                     resourceFile.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1051                 } catch (IOException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1052                     Log.d(TAG, &quot;failed to save restored icon for: &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1053                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1054             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1055         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1056     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1057 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1058     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1059      * Read a pre-loaded icon from the persistent icon cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1060      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1061      * @param componentName the component that should own the icon</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1062      * @returns a bitmap if one is cached, or null.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1063      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1064     private Bitmap getPreloadedIcon(ComponentName componentName) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1065         final String key = componentName.flattenToShortString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1066 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1067         if (DEBUG) Log.v(TAG, &quot;looking for pre-load icon for &quot; + key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1068         Bitmap icon = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1069         FileInputStream resourceFile = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1070         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1071             resourceFile = mContext.openFileInput(getResourceFilename(componentName));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1072             byte[] buffer = new byte[1024];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1073             ByteArrayOutputStream bytes = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1074             int bytesRead = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1075             while(bytesRead &gt;= 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1076                 bytes.write(buffer, 0, bytesRead);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1077                 bytesRead = resourceFile.read(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1078             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1079             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytes.size());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1080             icon = BitmapFactory.decodeByteArray(bytes.toByteArray(), 0, bytes.size());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1081             if (icon == null) {</span>
1082 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1083                 entry.title = info.loadLabel(mPackageManager).toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1084                 if (labelCache != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1085                     labelCache.put(key, entry.title);</span>
1086 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
1087                 }
1088             }
1089             if (entry.title == null) {
1090                 entry.title = info.activityInfo.name;
1091             }
1092 
1093             entry.icon = Utilities.createIconBitmap(
1094                     getFullResIcon(info), mContext);
1095         }
1096         return entry;
1097     }
1098 
1099     /**
1100      * Adds a default package entry in the cache. This entry is not persisted and will be removed
1101      * when the cache is flushed.
1102      */
1103     public void cachePackageInstallInfo(String packageName, UserHandleCompat user,
1104             Bitmap icon, CharSequence title) {
1105         remove(packageName, user);
1106 
1107         CacheEntry entry = getEntryForPackage(packageName, user);
1108         if (!TextUtils.isEmpty(title)) {
1109             entry.title = title;
1110         }
1111         if (icon != null) {
1112             entry.icon = Utilities.createIconBitmap(
1113                     new BitmapDrawable(mContext.getResources(), icon), mContext);
1114         }
1115     }
1116 
1117     /**
1118      * Gets an entry for the package, which can be used as a fallback entry for various components.
1119      */
1120     private CacheEntry getEntryForPackage(String packageName, UserHandleCompat user) {
1121         ComponentName cn = getPackageComponent(packageName);
1122         CacheKey cacheKey = new CacheKey(cn, user);
1123         CacheEntry entry = mCache.get(cacheKey);
1124         if (entry == null) {
1125             entry = new CacheEntry();
1126             entry.title = &quot;&quot;;
1127             mCache.put(cacheKey, entry);
1128 
1129             try {
1130                 ApplicationInfo info = mPackageManager.getApplicationInfo(packageName, 0);
1131                 entry.title = info.loadLabel(mPackageManager);
1132                 entry.icon = Utilities.createIconBitmap(info.loadIcon(mPackageManager), mContext);
1133             } catch (NameNotFoundException e) {
1134                 if (DEBUG) Log.d(TAG, &quot;Application not installed &quot; + packageName);
1135             }
1136 
1137             if (entry.icon == null) {
1138                 entry.icon = getPreloadedIcon(cn, user);
1139             }
1140         }
1141         return entry;
1142     }
1143 
1144     public HashMap&lt;ComponentName,Bitmap&gt; getAllIcons() {
1145         synchronized (mCache) {
1146             HashMap&lt;ComponentName,Bitmap&gt; set = new HashMap&lt;ComponentName,Bitmap&gt;();
1147             for (CacheKey ck : mCache.keySet()) {
1148                 final CacheEntry e = mCache.get(ck);
1149                 set.put(ck.componentName, e.icon);
1150             }
1151             return set;
1152         }
1153     }
1154 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1155 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1156     /**</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1157      * Pre-load an icon into the persistent cache.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1158      *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1159      * &lt;P&gt;Queries for a component that does not exist in the package manager</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1160      * will be answered by the persistent cache.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1161      *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1162      * @param context application context</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1163      * @param componentName the icon should be returned for this component</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1164      * @param icon the icon to be persisted</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1165      * @param dpi the native density of the icon</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1166      */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1167     public static void preloadIcon(Context context, ComponentName componentName, Bitmap icon,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1168             int dpi) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1169         // TODO rescale to the correct native DPI</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1170         try {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1171             PackageManager packageManager = context.getPackageManager();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1172             packageManager.getActivityIcon(componentName);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1173             // component is present on the system already, do nothing</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1174             return;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1175         } catch (PackageManager.NameNotFoundException e) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1176             // pass</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1177         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1178 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1179         final String key = componentName.flattenToString();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1180         FileOutputStream resourceFile = null;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1181         try {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1182             resourceFile = context.openFileOutput(getResourceFilename(componentName),</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1183                     Context.MODE_PRIVATE);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1184             ByteArrayOutputStream os = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1185             if (icon.compress(android.graphics.Bitmap.CompressFormat.PNG, 75, os)) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1186                 byte[] buffer = os.toByteArray();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1187                 resourceFile.write(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1188             } else {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1189                 Log.w(TAG, &quot;failed to encode cache for &quot; + key);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1190                 return;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1191             }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1192         } catch (FileNotFoundException e) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1193             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1194         } catch (IOException e) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1195             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1196         } finally {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1197             if (resourceFile != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1198                 try {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1199                     resourceFile.close();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1200                 } catch (IOException e) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1201                     Log.d(TAG, &quot;failed to save restored icon for: &quot; + key, e);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1202                 }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1203             }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1204         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1205     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1206 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1207     /**</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1208      * Read a pre-loaded icon from the persistent icon cache.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1209      *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1210      * @param componentName the component that should own the icon</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1211      * @returns a bitmap if one is cached, or null.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1212      */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1213     private Bitmap getPreloadedIcon(ComponentName componentName, UserHandleCompat user) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1214         final String key = componentName.flattenToShortString();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1215 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1216         // We don&#x27;t keep icons for other profiles in persistent cache.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1217         if (!user.equals(UserHandleCompat.myUserHandle())) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1218             return null;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1219         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1220 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1221         if (DEBUG) Log.v(TAG, &quot;looking for pre-load icon for &quot; + key);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1222         Bitmap icon = null;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1223         FileInputStream resourceFile = null;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1224         try {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1225             resourceFile = mContext.openFileInput(getResourceFilename(componentName));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1226             byte[] buffer = new byte[1024];</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1227             ByteArrayOutputStream bytes = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1228             int bytesRead = 0;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1229             while(bytesRead &gt;= 0) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1230                 bytes.write(buffer, 0, bytesRead);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1231                 bytesRead = resourceFile.read(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1232             }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1233             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytes.size());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1234             icon = BitmapFactory.decodeByteArray(bytes.toByteArray(), 0, bytes.size());</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1235             if (icon == null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1236                 Log.w(TAG, &quot;failed to decode pre-load icon for &quot; + key);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1237             }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1238         } catch (FileNotFoundException e) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1239             if (DEBUG) Log.d(TAG, &quot;there is no restored icon for: &quot; + key);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1240         } catch (IOException e) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1241             Log.w(TAG, &quot;failed to read pre-load icon for: &quot; + key, e);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1242         } finally {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1243             if(resourceFile != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1244                 try {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1245                     resourceFile.close();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1246                 } catch (IOException e) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1247                     Log.d(TAG, &quot;failed to manage pre-load icon file: &quot; + key, e);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1248                 }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1249             }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1250         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1251 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1252         return icon;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1253     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1254 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1255     /**</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1256      * Remove a pre-loaded icon from the persistent icon cache.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1257      *</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1258      * @param componentName the component that should own the icon</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1259      * @returns true on success</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1260      */</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1261     public boolean deletePreloadedIcon(ComponentName componentName, UserHandleCompat user) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1262         // We don&#x27;t keep icons for other profiles in persistent cache.</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1263         if (!user.equals(UserHandleCompat.myUserHandle())) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1264             return false;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1265         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1266         if (componentName == null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1267             return false;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1268         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1269         if (mCache.remove(componentName) != null) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1270             if (DEBUG) Log.d(TAG, &quot;removed pre-loaded icon from the in-memory cache&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1271         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1272         boolean success = mContext.deleteFile(getResourceFilename(componentName));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1273         if (DEBUG &amp;&amp; success) Log.d(TAG, &quot;removed pre-loaded icon from persistent cache&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1274 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1275         return success;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1276     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1277 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1278     private static String getResourceFilename(ComponentName component) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1279         String resourceName = component.flattenToShortString();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1280         String filename = resourceName.replace(File.separatorChar, &#x27;_&#x27;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1281         return RESOURCE_FILE_PREFIX + filename;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1282     }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1283 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1284     static ComponentName getPackageComponent(String packageName) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1285         return new ComponentName(packageName, EMPTY_CLASS_NAME);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">1286     }</span>
1287 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1288 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1289     private CacheEntry cacheLocked(ComponentName componentName, ResolveInfo info,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1290             HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1291         CacheEntry entry = mCache.get(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1292         if (entry == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1293             entry = new CacheEntry();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1294 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1295             mCache.put(componentName, entry);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1296 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1297             if (info != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1298                 ComponentName key = LauncherModel.getComponentNameFromResolveInfo(info);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1299                 if (labelCache != null &amp;&amp; labelCache.containsKey(key)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1300                     entry.title = labelCache.get(key).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1301                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1302                     entry.title = info.loadLabel(mPackageManager).toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1303                     if (labelCache != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1304                         labelCache.put(key, entry.title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1305                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1306                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1307                 if (entry.title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1308                     entry.title = info.activityInfo.name;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1309                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1310 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1311                 entry.icon = Utilities.createIconBitmap(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1312                         getFullResIcon(info), mContext);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1313             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1314                 entry.title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1315                 Bitmap preloaded = getPreloadedIcon(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1316                 if (preloaded != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1317                     if (DEBUG) Log.d(TAG, &quot;using preloaded icon for &quot; +</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1318                             componentName.toShortString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1319                     entry.icon = preloaded;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1320                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1321                     if (DEBUG) Log.d(TAG, &quot;using default icon for &quot; +</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1322                             componentName.toShortString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1323                     entry.icon = mDefaultIcon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1324                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1325             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1326         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1327         return entry;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1328     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1329 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1330     public HashMap&lt;ComponentName,Bitmap&gt; getAllIcons() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1331         synchronized (mCache) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1332             HashMap&lt;ComponentName,Bitmap&gt; set = new HashMap&lt;ComponentName,Bitmap&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1333             for (ComponentName cn : mCache.keySet()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1334                 final CacheEntry e = mCache.get(cn);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1335                 set.put(cn, e.icon);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1336             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1337             return set;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1338         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1339     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1340 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1341     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1342      * Pre-load an icon into the persistent cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1343      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1344      * &lt;P&gt;Queries for a component that does not exist in the package manager</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1345      * will be answered by the persistent cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1346      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1347      * @param context application context</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1348      * @param componentName the icon should be returned for this component</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1349      * @param icon the icon to be persisted</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1350      * @param dpi the native density of the icon</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1351      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1352     public static void preloadIcon(Context context, ComponentName componentName, Bitmap icon,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1353             int dpi) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1354         // TODO rescale to the correct native DPI</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1355         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1356             PackageManager packageManager = context.getPackageManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1357             packageManager.getActivityIcon(componentName);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1358             // component is present on the system already, do nothing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1359             return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1360         } catch (PackageManager.NameNotFoundException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1361             // pass</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1362         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1363 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1364         final String key = componentName.flattenToString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1365         FileOutputStream resourceFile = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1366         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1367             resourceFile = context.openFileOutput(getResourceFilename(componentName),</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1368                     Context.MODE_PRIVATE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1369             ByteArrayOutputStream os = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1370             if (icon.compress(android.graphics.Bitmap.CompressFormat.PNG, 75, os)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1371                 byte[] buffer = os.toByteArray();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1372                 resourceFile.write(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1373             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1374                 Log.w(TAG, &quot;failed to encode cache for &quot; + key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1375                 return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1376             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1377         } catch (FileNotFoundException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1378             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1379         } catch (IOException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1380             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1381         } finally {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1382             if (resourceFile != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1383                 try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1384                     resourceFile.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1385                 } catch (IOException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1386                     Log.d(TAG, &quot;failed to save restored icon for: &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1387                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1388             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1389         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1390     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1391 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1392     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1393      * Read a pre-loaded icon from the persistent icon cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1394      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1395      * @param componentName the component that should own the icon</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1396      * @returns a bitmap if one is cached, or null.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1397      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1398     private Bitmap getPreloadedIcon(ComponentName componentName) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1399         final String key = componentName.flattenToShortString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1400 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1401         if (DEBUG) Log.v(TAG, &quot;looking for pre-load icon for &quot; + key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1402         Bitmap icon = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1403         FileInputStream resourceFile = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1404         try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1405             resourceFile = mContext.openFileInput(getResourceFilename(componentName));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1406             byte[] buffer = new byte[1024];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1407             ByteArrayOutputStream bytes = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1408             int bytesRead = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1409             while(bytesRead &gt;= 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1410                 bytes.write(buffer, 0, bytesRead);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1411                 bytesRead = resourceFile.read(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1412             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1413             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytes.size());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1414             icon = BitmapFactory.decodeByteArray(bytes.toByteArray(), 0, bytes.size());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1415             if (icon == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1416                 Log.w(TAG, &quot;failed to decode pre-load icon for &quot; + key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1417             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1418         } catch (FileNotFoundException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1419             if (DEBUG) Log.d(TAG, &quot;there is no restored icon for: &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1420         } catch (IOException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1421             Log.w(TAG, &quot;failed to read pre-load icon for: &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1422         } finally {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1423             if(resourceFile != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1424                 try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1425                     resourceFile.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1426                 } catch (IOException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1427                     Log.d(TAG, &quot;failed to manage pre-load icon file: &quot; + key, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1428                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1429             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1430         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1431 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1432         if (icon != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1433             // TODO: handle alpha mask in the view layer</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1434             Bitmap b = Bitmap.createBitmap(Math.max(icon.getWidth(), 1),</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1435                     Math.max(icon.getHeight(), 1),</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1436                     Bitmap.Config.ARGB_8888);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1437             Canvas c = new Canvas(b);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1438             Paint paint = new Paint();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1439             paint.setAlpha(127);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1440             c.drawBitmap(icon, 0, 0, paint);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1441             c.setBitmap(null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1442             icon.recycle();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1443             icon = b;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1444         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1445 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1446         return icon;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1447     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1448 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1449     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1450      * Remove a pre-loaded icon from the persistent icon cache.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1451      *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1452      * @param componentName the component that should own the icon</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1453      * @returns true on success</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1454      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1455     public boolean deletePreloadedIcon(ComponentName componentName) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1456         if (componentName == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1457             return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1458         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1459         if (mCache.remove(componentName) != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1460             if (DEBUG) Log.d(TAG, &quot;removed pre-loaded icon from the in-memory cache&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1461         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1462         boolean success = mContext.deleteFile(getResourceFilename(componentName));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1463         if (DEBUG &amp;&amp; success) Log.d(TAG, &quot;removed pre-loaded icon from persistent cache&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1464 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1465         return success;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1466     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1467 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1468     private static String getResourceFilename(ComponentName component) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1469         String resourceName = component.flattenToShortString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1470         String filename = resourceName.replace(File.separatorChar, &#x27;_&#x27;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1471         return RESOURCE_FILE_PREFIX + filename;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1472     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">1473 }</span>
1474 =======
1475 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
1476 }</pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2008 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 
  17 package com.android.launcher3;
  18 
  19 import android.app.ActivityManager;
  20 import android.content.ComponentName;
  21 import android.content.Context;
  22 import android.content.Intent;
  23 import android.content.pm.ActivityInfo;
  24 import android.content.pm.ApplicationInfo;
  25 import android.content.pm.PackageManager;
  26 import android.content.pm.PackageManager.NameNotFoundException;
  27 import android.content.pm.ResolveInfo;
  28 import android.content.res.Resources;
  29 import android.graphics.Bitmap;
  30 import android.graphics.BitmapFactory;
  31 import android.graphics.Canvas;
  32 import android.graphics.drawable.BitmapDrawable;
  33 import android.graphics.drawable.Drawable;
  34 import android.text.TextUtils;
  35 import android.util.Log;
  36 
  37 import com.android.launcher3.compat.LauncherActivityInfoCompat;
  38 import com.android.launcher3.compat.LauncherAppsCompat;
  39 import com.android.launcher3.compat.UserHandleCompat;
  40 import com.android.launcher3.compat.UserManagerCompat;
  41 
  42 import java.io.ByteArrayOutputStream;
  43 import java.io.File;
  44 import java.io.FileInputStream;
  45 import java.io.FileNotFoundException;
  46 import java.io.FileOutputStream;
  47 import java.io.IOException;
  48 import java.util.HashMap;
  49 import java.util.HashSet;
  50 import java.util.Iterator;
  51 import java.util.Map.Entry;
  52 
  53 /**
  54  * Cache of application icons.  Icons can be made from any thread.
  55  */
  56 public class IconCache {
  57 
  58     private static final String TAG = &quot;Launcher.IconCache&quot;;
  59 
  60     private static final int INITIAL_ICON_CACHE_CAPACITY = 50;
  61     private static final String RESOURCE_FILE_PREFIX = &quot;icon_&quot;;
  62 
  63     // Empty class name is used for storing package default entry.
  64     private static final String EMPTY_CLASS_NAME = &quot;.&quot;;
  65 
  66     private static final boolean DEBUG = false;
  67 
  68     private static class CacheEntry {
  69         public Bitmap icon;
  70         public CharSequence title;
  71         public CharSequence contentDescription;
  72     }
  73 
  74     private static class CacheKey {
  75         public ComponentName componentName;
  76         public UserHandleCompat user;
  77 
  78         CacheKey(ComponentName componentName, UserHandleCompat user) {
  79             this.componentName = componentName;
  80             this.user = user;
  81         }
  82 
  83         @Override
  84         public int hashCode() {
  85             return componentName.hashCode() + user.hashCode();
  86         }
  87 
  88         @Override
  89         public boolean equals(Object o) {
  90             CacheKey other = (CacheKey) o;
  91             return other.componentName.equals(componentName) &amp;&amp; other.user.equals(user);
  92         }
  93     }
  94 
  95     private final HashMap&lt;UserHandleCompat, Bitmap&gt; mDefaultIcons =
  96             new HashMap&lt;UserHandleCompat, Bitmap&gt;();
  97     private final Context mContext;
  98     private final PackageManager mPackageManager;
  99     private final UserManagerCompat mUserManager;
 100     private final LauncherAppsCompat mLauncherApps;
 101     private final HashMap&lt;CacheKey, CacheEntry&gt; mCache =
 102             new HashMap&lt;CacheKey, CacheEntry&gt;(INITIAL_ICON_CACHE_CAPACITY);
 103     private int mIconDpi;
 104 
 105     public IconCache(Context context) {
 106         ActivityManager activityManager =
 107                 (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
 108 
 109         mContext = context;
 110         mPackageManager = context.getPackageManager();
 111         mUserManager = UserManagerCompat.getInstance(mContext);
 112         mLauncherApps = LauncherAppsCompat.getInstance(mContext);
 113         mIconDpi = activityManager.getLauncherLargeIconDensity();
 114 
 115         // need to set mIconDpi before getting default icon
 116         UserHandleCompat myUser = UserHandleCompat.myUserHandle();
 117         mDefaultIcons.put(myUser, makeDefaultIcon(myUser));
 118     }
 119 
 120     public Drawable getFullResDefaultActivityIcon() {
 121         return getFullResIcon(Resources.getSystem(),
 122                 android.R.mipmap.sym_def_app_icon);
 123     }
 124 
 125     public Drawable getFullResIcon(Resources resources, int iconId) {
 126         Drawable d;
 127         try {
 128             d = resources.getDrawableForDensity(iconId, mIconDpi);
 129         } catch (Resources.NotFoundException e) {
 130             d = null;
 131         }
 132 
 133         return (d != null) ? d : getFullResDefaultActivityIcon();
 134     }
 135 
 136     public Drawable getFullResIcon(String packageName, int iconId) {
 137         Resources resources;
 138         try {
 139             resources = mPackageManager.getResourcesForApplication(packageName);
 140         } catch (PackageManager.NameNotFoundException e) {
 141             resources = null;
 142         }
 143         if (resources != null) {
 144             if (iconId != 0) {
 145                 return getFullResIcon(resources, iconId);
 146             }
 147         }
 148         return getFullResDefaultActivityIcon();
 149     }
 150 
 151     public int getFullResIconDpi() {
 152         return mIconDpi;
 153     }
 154 
 155     public Drawable getFullResIcon(ResolveInfo info) {
 156         return getFullResIcon(info.activityInfo);
 157     }
 158 
 159     public Drawable getFullResIcon(ActivityInfo info) {
 160 
 161         Resources resources;
 162         try {
 163             resources = mPackageManager.getResourcesForApplication(
 164                     info.applicationInfo);
 165         } catch (PackageManager.NameNotFoundException e) {
 166             resources = null;
 167         }
 168         if (resources != null) {
 169             int iconId = info.getIconResource();
 170             if (iconId != 0) {
 171                 return getFullResIcon(resources, iconId);
 172             }
 173         }
 174 
 175         return getFullResDefaultActivityIcon();
 176     }
 177 
 178     private Bitmap makeDefaultIcon(UserHandleCompat user) {
 179         Drawable unbadged = getFullResDefaultActivityIcon();
 180         Drawable d = mUserManager.getBadgedDrawableForUser(unbadged, user);
 181         Bitmap b = Bitmap.createBitmap(Math.max(d.getIntrinsicWidth(), 1),
 182                 Math.max(d.getIntrinsicHeight(), 1),
 183                 Bitmap.Config.ARGB_8888);
 184         Canvas c = new Canvas(b);
 185         d.setBounds(0, 0, b.getWidth(), b.getHeight());
 186         d.draw(c);
 187         c.setBitmap(null);
 188         return b;
 189     }
 190 
 191     /**
 192      * Remove any records for the supplied ComponentName.
 193      */
 194     public void remove(ComponentName componentName, UserHandleCompat user) {
 195         synchronized (mCache) {
 196             mCache.remove(new CacheKey(componentName, user));
 197         }
 198     }
 199 
 200     /**
 201      * Remove any records for the supplied package name.
 202      */
 203     public void remove(String packageName, UserHandleCompat user) {
 204         HashSet&lt;CacheKey&gt; forDeletion = new HashSet&lt;CacheKey&gt;();
 205         for (CacheKey key: mCache.keySet()) {
 206             if (key.componentName.getPackageName().equals(packageName)
 207                     &amp;&amp; key.user.equals(user)) {
 208                 forDeletion.add(key);
 209             }
 210         }
 211         for (CacheKey condemned: forDeletion) {
 212             mCache.remove(condemned);
 213         }
 214     }
 215 
 216     /**
 217      * Empty out the cache.
 218      */
 219     public void flush() {
 220         synchronized (mCache) {
 221             mCache.clear();
 222         }
 223     }
 224 
 225     /**
 226      * Empty out the cache that aren&#x27;t of the correct grid size
 227      */
 228     public void flushInvalidIcons(DeviceProfile grid) {
 229         synchronized (mCache) {
 230             Iterator&lt;Entry&lt;CacheKey, CacheEntry&gt;&gt; it = mCache.entrySet().iterator();
 231             while (it.hasNext()) {
 232                 final CacheEntry e = it.next().getValue();
 233                 if ((e.icon != null) &amp;&amp; (e.icon.getWidth() &lt; grid.iconSizePx
 234                         || e.icon.getHeight() &lt; grid.iconSizePx)) {
 235                     it.remove();
 236                 }
 237             }
 238         }
 239     }
 240 
 241     /**
 242      * Fill in &quot;application&quot; with the icon and label for &quot;info.&quot;
 243      */
 244     public void getTitleAndIcon(AppInfo application, LauncherActivityInfoCompat info,
 245             HashMap&lt;Object, CharSequence&gt; labelCache) {
 246         synchronized (mCache) {
 247             CacheEntry entry = cacheLocked(application.componentName, info, labelCache,
 248                     info.getUser(), false);
 249 
 250             application.title = entry.title;
 251             application.iconBitmap = entry.icon;
 252             application.contentDescription = entry.contentDescription;
 253         }
 254     }
 255 
 256     public Bitmap getIcon(Intent intent, UserHandleCompat user) {
 257         return getIcon(intent, null, user, true);
 258     }
 259 
 260     private Bitmap getIcon(Intent intent, String title, UserHandleCompat user, boolean usePkgIcon) {
 261         synchronized (mCache) {
 262             ComponentName component = intent.getComponent();
 263             // null info means not installed, but if we have a component from the intent then
 264             // we should still look in the cache for restored app icons.
 265             if (component == null) {
 266                 return getDefaultIcon(user);
 267             }
 268 
 269             LauncherActivityInfoCompat launcherActInfo = mLauncherApps.resolveActivity(intent, user);
 270             CacheEntry entry = cacheLocked(component, launcherActInfo, null, user, usePkgIcon);
 271             if (title != null) {
 272                 entry.title = title;
 273                 entry.contentDescription = mUserManager.getBadgedLabelForUser(title, user);
 274             }
 275             return entry.icon;
 276         }
 277     }
 278 
 279     /**
 280      * Fill in &quot;shortcutInfo&quot; with the icon and label for &quot;info.&quot;
 281      */
 282     public void getTitleAndIcon(ShortcutInfo shortcutInfo, Intent intent, UserHandleCompat user,
 283             boolean usePkgIcon) {
 284         synchronized (mCache) {
 285             ComponentName component = intent.getComponent();
 286             // null info means not installed, but if we have a component from the intent then
 287             // we should still look in the cache for restored app icons.
 288             if (component == null) {
 289                 shortcutInfo.setIcon(getDefaultIcon(user));
 290                 shortcutInfo.title = &quot;&quot;;
 291                 shortcutInfo.usingFallbackIcon = true;
 292             } else {
 293                 LauncherActivityInfoCompat launcherActInfo =
 294                         mLauncherApps.resolveActivity(intent, user);
 295                 CacheEntry entry = cacheLocked(component, launcherActInfo, null, user, usePkgIcon);
 296 
 297                 shortcutInfo.setIcon(entry.icon);
 298                 shortcutInfo.title = entry.title;
 299                 shortcutInfo.usingFallbackIcon = isDefaultIcon(entry.icon, user);
 300             }
 301         }
 302     }
 303 
 304 
 305     public Bitmap getDefaultIcon(UserHandleCompat user) {
 306         if (!mDefaultIcons.containsKey(user)) {
 307             mDefaultIcons.put(user, makeDefaultIcon(user));
 308         }
 309         return mDefaultIcons.get(user);
 310     }
 311 
 312     public Bitmap getIcon(ComponentName component, LauncherActivityInfoCompat info,
 313             HashMap&lt;Object, CharSequence&gt; labelCache) {
 314         synchronized (mCache) {
 315             if (info == null || component == null) {
 316                 return null;
 317             }
 318 
 319             CacheEntry entry = cacheLocked(component, info, labelCache, info.getUser(), false);
 320             return entry.icon;
 321         }
 322     }
 323 
 324     public boolean isDefaultIcon(Bitmap icon, UserHandleCompat user) {
 325         return mDefaultIcons.get(user) == icon;
 326     }
 327 
 328     private CacheEntry cacheLocked(ComponentName componentName, LauncherActivityInfoCompat info,
 329             HashMap&lt;Object, CharSequence&gt; labelCache, UserHandleCompat user, boolean usePackageIcon) {
 330         CacheKey cacheKey = new CacheKey(componentName, user);
 331         CacheEntry entry = mCache.get(cacheKey);
 332         if (entry == null) {
 333             entry = new CacheEntry();
 334 
 335             mCache.put(cacheKey, entry);
 336 
 337             if (info != null) {
 338                 ComponentName labelKey = info.getComponentName();
 339                 if (labelCache != null &amp;&amp; labelCache.containsKey(labelKey)) {
 340                     entry.title = labelCache.get(labelKey).toString();
 341                 } else {
 342                     entry.title = info.getLabel().toString();
 343                     if (labelCache != null) {
 344                         labelCache.put(labelKey, entry.title);
 345                     }
 346                 }
 347 
 348                 entry.contentDescription = mUserManager.getBadgedLabelForUser(entry.title, user);
 349                 entry.icon = Utilities.createIconBitmap(
 350                         info.getBadgedIcon(mIconDpi), mContext);
 351             } else {
 352                 entry.title = &quot;&quot;;
 353                 Bitmap preloaded = getPreloadedIcon(componentName, user);
 354                 if (preloaded != null) {
 355                     if (DEBUG) Log.d(TAG, &quot;using preloaded icon for &quot; +
 356                             componentName.toShortString());
 357                     entry.icon = preloaded;
 358                 } else {
 359                     if (usePackageIcon) {
 360                         CacheEntry packageEntry = getEntryForPackage(
 361                                 componentName.getPackageName(), user);
 362                         if (packageEntry != null) {
 363                             if (DEBUG) Log.d(TAG, &quot;using package default icon for &quot; +
 364                                     componentName.toShortString());
 365                             entry.icon = packageEntry.icon;
 366                             entry.title = packageEntry.title;
 367                         }
 368                     }
 369                     if (entry.icon == null) {
 370                         if (DEBUG) Log.d(TAG, &quot;using default icon for &quot; +
 371                                 componentName.toShortString());
 372                         entry.icon = getDefaultIcon(user);
 373                     }
 374                 }
 375             }
 376         }
 377         return entry;
 378     }
 379 
 380     /**
 381      * Adds a default package entry in the cache. This entry is not persisted and will be removed
 382      * when the cache is flushed.
 383      */
 384     public void cachePackageInstallInfo(String packageName, UserHandleCompat user,
 385             Bitmap icon, CharSequence title) {
 386         remove(packageName, user);
 387 
 388         CacheEntry entry = getEntryForPackage(packageName, user);
 389         if (!TextUtils.isEmpty(title)) {
 390             entry.title = title;
 391         }
 392         if (icon != null) {
 393             entry.icon = Utilities.createIconBitmap(
 394                     new BitmapDrawable(mContext.getResources(), icon), mContext);
 395         }
 396     }
 397 
 398     /**
 399      * Gets an entry for the package, which can be used as a fallback entry for various components.
 400      */
 401     private CacheEntry getEntryForPackage(String packageName, UserHandleCompat user) {
 402         ComponentName cn = getPackageComponent(packageName);
 403         CacheKey cacheKey = new CacheKey(cn, user);
 404         CacheEntry entry = mCache.get(cacheKey);
 405         if (entry == null) {
 406             entry = new CacheEntry();
 407             entry.title = &quot;&quot;;
 408             mCache.put(cacheKey, entry);
 409 
 410             try {
 411                 ApplicationInfo info = mPackageManager.getApplicationInfo(packageName, 0);
 412                 entry.title = info.loadLabel(mPackageManager);
 413                 entry.icon = Utilities.createIconBitmap(info.loadIcon(mPackageManager), mContext);
 414             } catch (NameNotFoundException e) {
 415                 if (DEBUG) Log.d(TAG, &quot;Application not installed &quot; + packageName);
 416             }
 417 
 418             if (entry.icon == null) {
 419                 entry.icon = getPreloadedIcon(cn, user);
 420             }
 421         }
 422         return entry;
 423     }
 424 
 425     public HashMap&lt;ComponentName,Bitmap&gt; getAllIcons() {
 426         synchronized (mCache) {
 427             HashMap&lt;ComponentName,Bitmap&gt; set = new HashMap&lt;ComponentName,Bitmap&gt;();
 428             for (CacheKey ck : mCache.keySet()) {
 429                 final CacheEntry e = mCache.get(ck);
 430                 set.put(ck.componentName, e.icon);
 431             }
 432             return set;
 433         }
 434     }
 435 
 436     /**
 437      * Pre-load an icon into the persistent cache.
 438      *
 439      * &lt;P&gt;Queries for a component that does not exist in the package manager
 440      * will be answered by the persistent cache.
 441      *
 442      * @param context application context
 443      * @param componentName the icon should be returned for this component
 444      * @param icon the icon to be persisted
 445      * @param dpi the native density of the icon
 446      */
 447     public static void preloadIcon(Context context, ComponentName componentName, Bitmap icon,
 448             int dpi) {
 449         // TODO rescale to the correct native DPI
 450         try {
 451             PackageManager packageManager = context.getPackageManager();
 452             packageManager.getActivityIcon(componentName);
 453             // component is present on the system already, do nothing
 454             return;
 455         } catch (PackageManager.NameNotFoundException e) {
 456             // pass
 457         }
 458 
 459         final String key = componentName.flattenToString();
 460         FileOutputStream resourceFile = null;
 461         try {
 462             resourceFile = context.openFileOutput(getResourceFilename(componentName),
 463                     Context.MODE_PRIVATE);
 464             ByteArrayOutputStream os = new ByteArrayOutputStream();
 465             if (icon.compress(android.graphics.Bitmap.CompressFormat.PNG, 75, os)) {
 466                 byte[] buffer = os.toByteArray();
 467                 resourceFile.write(buffer, 0, buffer.length);
 468             } else {
 469                 Log.w(TAG, &quot;failed to encode cache for &quot; + key);
 470                 return;
 471             }
 472         } catch (FileNotFoundException e) {
 473             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);
 474         } catch (IOException e) {
 475             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);
 476         } finally {
 477             if (resourceFile != null) {
 478                 try {
 479                     resourceFile.close();
 480                 } catch (IOException e) {
 481                     Log.d(TAG, &quot;failed to save restored icon for: &quot; + key, e);
 482                 }
 483             }
 484         }
 485     }
 486 
 487     /**
 488      * Read a pre-loaded icon from the persistent icon cache.
 489      *
 490      * @param componentName the component that should own the icon
 491      * @returns a bitmap if one is cached, or null.
 492      */
 493     private Bitmap getPreloadedIcon(ComponentName componentName, UserHandleCompat user) {
 494         final String key = componentName.flattenToShortString();
 495 
 496         // We don&#x27;t keep icons for other profiles in persistent cache.
 497         if (!user.equals(UserHandleCompat.myUserHandle())) {
 498             return null;
 499         }
 500 
 501         if (DEBUG) Log.v(TAG, &quot;looking for pre-load icon for &quot; + key);
 502         Bitmap icon = null;
 503         FileInputStream resourceFile = null;
 504         try {
 505             resourceFile = mContext.openFileInput(getResourceFilename(componentName));
 506             byte[] buffer = new byte[1024];
 507             ByteArrayOutputStream bytes = new ByteArrayOutputStream();
 508             int bytesRead = 0;
 509             while(bytesRead &gt;= 0) {
 510                 bytes.write(buffer, 0, bytesRead);
 511                 bytesRead = resourceFile.read(buffer, 0, buffer.length);
 512             }
 513             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytes.size());
 514             icon = BitmapFactory.decodeByteArray(bytes.toByteArray(), 0, bytes.size());
 515             if (icon == null) {
 516                 Log.w(TAG, &quot;failed to decode pre-load icon for &quot; + key);
 517             }
 518         } catch (FileNotFoundException e) {
 519             if (DEBUG) Log.d(TAG, &quot;there is no restored icon for: &quot; + key);
 520         } catch (IOException e) {
 521             Log.w(TAG, &quot;failed to read pre-load icon for: &quot; + key, e);
 522         } finally {
 523             if(resourceFile != null) {
 524                 try {
 525                     resourceFile.close();
 526                 } catch (IOException e) {
 527                     Log.d(TAG, &quot;failed to manage pre-load icon file: &quot; + key, e);
 528                 }
 529             }
 530         }
 531 
 532         return icon;
 533     }
 534 
 535     /**
 536      * Remove a pre-loaded icon from the persistent icon cache.
 537      *
 538      * @param componentName the component that should own the icon
 539      * @returns true on success
 540      */
 541     public boolean deletePreloadedIcon(ComponentName componentName, UserHandleCompat user) {
 542         // We don&#x27;t keep icons for other profiles in persistent cache.
 543         if (!user.equals(UserHandleCompat.myUserHandle())) {
 544             return false;
 545         }
 546         if (componentName == null) {
 547             return false;
 548         }
 549         if (mCache.remove(componentName) != null) {
 550             if (DEBUG) Log.d(TAG, &quot;removed pre-loaded icon from the in-memory cache&quot;);
 551         }
 552         boolean success = mContext.deleteFile(getResourceFilename(componentName));
 553         if (DEBUG &amp;&amp; success) Log.d(TAG, &quot;removed pre-loaded icon from persistent cache&quot;);
 554 
 555         return success;
 556     }
 557 
 558     private static String getResourceFilename(ComponentName component) {
 559         String resourceName = component.flattenToShortString();
 560         String filename = resourceName.replace(File.separatorChar, &#x27;_&#x27;);
 561         return RESOURCE_FILE_PREFIX + filename;
 562     }
 563 
 564     static ComponentName getPackageComponent(String packageName) {
 565         return new ComponentName(packageName, EMPTY_CLASS_NAME);
 566     }
 567 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2008 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.android.launcher3;
  17 
  18 import android.app.ActivityManager;
  19 import android.content.ComponentName;
  20 import android.content.Context;
  21 import android.content.Intent;
  22 import android.content.pm.ActivityInfo;
  23 import android.content.pm.ApplicationInfo;
  24 import android.content.pm.PackageManager.NameNotFoundException;
  25 import android.content.pm.PackageManager;
  26 import android.content.pm.ResolveInfo;
  27 import android.content.res.Resources;
  28 import android.graphics.Bitmap;
  29 import android.graphics.BitmapFactory;
  30 import android.graphics.Canvas;
  31 import android.graphics.drawable.BitmapDrawable;
  32 import android.graphics.drawable.Drawable;
  33 import android.text.TextUtils;
  34 import android.util.Log;
  35 import com.android.launcher3.compat.LauncherActivityInfoCompat;
  36 import com.android.launcher3.compat.LauncherAppsCompat;
  37 import com.android.launcher3.compat.UserHandleCompat;
  38 import com.android.launcher3.compat.UserManagerCompat;
  39 import java.io.ByteArrayOutputStream;
  40 import java.io.File;
  41 import java.io.FileInputStream;
  42 import java.io.FileNotFoundException;
  43 import java.io.FileOutputStream;
  44 import java.io.IOException;
  45 import java.util.HashMap;
  46 import java.util.HashSet;
  47 import java.util.Iterator;
  48 import java.util.Map.Entry;
  49 
  50 
  51 /**
  52  * Cache of application icons.  Icons can be made from any thread.
  53  */
  54 public class IconCache {
  55     private static final String TAG = &quot;Launcher.IconCache&quot;;
  56 
  57     private static final int INITIAL_ICON_CACHE_CAPACITY = 50;
  58 
  59     private static final String RESOURCE_FILE_PREFIX = &quot;icon_&quot;;
  60 
  61     // Empty class name is used for storing package default entry.
  62     // Empty class name is used for storing package default entry.
  63     private static final String EMPTY_CLASS_NAME = &quot;.&quot;;
  64 
  65     private static final boolean DEBUG = false;
  66 
  67     private static class CacheEntry {
  68         public Bitmap icon;
  69 
  70         public CharSequence title;
  71 
  72         public CharSequence contentDescription;
  73     }
  74 
  75     private static class CacheKey {
  76         public ComponentName componentName;
  77 
  78         public UserHandleCompat user;
  79 
  80         CacheKey(ComponentName componentName, UserHandleCompat user) {
  81             this.componentName = componentName;
  82             this.user = user;
  83         }
  84 
  85         @Override
  86         public int hashCode() {
  87             return componentName.hashCode() + user.hashCode();
  88         }
  89 
  90         @Override
  91         public boolean equals(Object o) {
  92             CacheKey other = ((CacheKey) (o));
  93             return other.componentName.equals(componentName) &amp;&amp; other.user.equals(user);
  94         }
  95     }
  96 
<abbr title="  97     private final HashMap&lt;UserHandleCompat, Bitmap&gt; mDefaultIcons = new HashMap&lt;UserHandleCompat, Bitmap&gt;();">  97     private final HashMap&lt;UserHandleCompat, Bitmap&gt; mDefaultIcons = new HashMap&lt;UserHandleCompat, Bitmap&gt;</abbr>
  98 
  99     private final Context mContext;
 100 
 101     private final PackageManager mPackageManager;
 102 
 103     private final UserManagerCompat mUserManager;
 104 
 105     private final LauncherAppsCompat mLauncherApps;
 106 
<abbr title=" 107     private final HashMap&lt;CacheKey, CacheEntry&gt; mCache = new HashMap&lt;CacheKey, CacheEntry&gt;(INITIAL_ICON_CACHE_CAPACITY);"> 107     private final HashMap&lt;CacheKey, CacheEntry&gt; mCache = new HashMap&lt;CacheKey, CacheEntry&gt;(INITIAL_ICON_C</abbr>
 108 
 109     private int mIconDpi;
 110 
 111     public IconCache(Context context) {
<abbr title=" 112         ActivityManager activityManager = ((ActivityManager) (context.getSystemService(Context.ACTIVITY_SERVICE)));"> 112         ActivityManager activityManager = ((ActivityManager) (context.getSystemService(Context.ACTIVITY_S</abbr>
 113         mContext = context;
 114         mPackageManager = context.getPackageManager();
 115         mUserManager = UserManagerCompat.getInstance(mContext);
 116         mLauncherApps = LauncherAppsCompat.getInstance(mContext);
 117         mIconDpi = activityManager.getLauncherLargeIconDensity();
 118         // need to set mIconDpi before getting default icon
 119         UserHandleCompat myUser = UserHandleCompat.myUserHandle();
 120         mDefaultIcons.put(myUser, makeDefaultIcon(myUser));
 121     }
 122 
 123     public Drawable getFullResDefaultActivityIcon() {
 124         return getFullResIcon(Resources.getSystem(),
 125                 android.R.mipmap.sym_def_app_icon);
 126     }
 127 
 128     public Drawable getFullResIcon(Resources resources, int iconId) {
 129         Drawable d;
 130         try {
 131             d = resources.getDrawableForDensity(iconId, mIconDpi);
 132         } catch (Resources.NotFoundException e) {
 133             d = null;
 134         }
 135 
 136         return (d != null) ? d : getFullResDefaultActivityIcon();
 137     }
 138 
 139     public Drawable getFullResIcon(String packageName, int iconId) {
 140         Resources resources;
 141         try {
 142             resources = mPackageManager.getResourcesForApplication(packageName);
 143         } catch (PackageManager.NameNotFoundException e) {
 144             resources = null;
 145         }
 146         if (resources != null) {
 147             if (iconId != 0) {
 148                 return getFullResIcon(resources, iconId);
 149             }
 150         }
 151         return getFullResDefaultActivityIcon();
 152     }
 153 
 154     public int getFullResIconDpi() {
 155         return mIconDpi;
 156     }
 157 
 158     public Drawable getFullResIcon(ResolveInfo info) {
 159         return getFullResIcon(info.activityInfo);
 160     }
 161 
 162     public Drawable getFullResIcon(ActivityInfo info) {
 163 
 164         Resources resources;
 165         try {
 166             resources = mPackageManager.getResourcesForApplication(
 167                     info.applicationInfo);
 168         } catch (PackageManager.NameNotFoundException e) {
 169             resources = null;
 170         }
 171         if (resources != null) {
 172             int iconId = info.getIconResource();
 173             if (iconId != 0) {
 174                 return getFullResIcon(resources, iconId);
 175             }
 176         }
 177         return getFullResDefaultActivityIcon();
 178     }
 179 
 180     private Bitmap makeDefaultIcon(UserHandleCompat user) {
 181         Drawable unbadged = getFullResDefaultActivityIcon();
 182         Drawable d = mUserManager.getBadgedDrawableForUser(unbadged, user);
<abbr title=" 183         Bitmap b = Bitmap.createBitmap(Math.max(d.getIntrinsicWidth(), 1), Math.max(d.getIntrinsicHeight(), 1), Bitmap.Config.ARGB_8888);"> 183         Bitmap b = Bitmap.createBitmap(Math.max(d.getIntrinsicWidth(), 1), Math.max(d.getIntrinsicHeight(</abbr>
 184         Canvas c = new Canvas(b);
 185         d.setBounds(0, 0, b.getWidth(), b.getHeight());
 186         d.draw(c);
 187         c.setBitmap(null);
 188         return b;
 189     }
 190 
 191     /**
 192      * Remove any records for the supplied ComponentName.
 193      */
 194     public void remove(ComponentName componentName, UserHandleCompat user) {
 195         synchronized(mCache) {
 196             mCache.remove(new CacheKey(componentName, user));
 197         }
 198     }
 199 
 200     /**
 201      * Remove any records for the supplied package name.
 202      */
 203     public void remove(String packageName, UserHandleCompat user) {
 204         HashSet&lt;CacheKey&gt; forDeletion = new HashSet&lt;CacheKey&gt;();
 205         for (CacheKey key : mCache.keySet()) {
 206             if (key.componentName.getPackageName().equals(packageName) &amp;&amp; key.user.equals(user)) {
 207                 forDeletion.add(key);
 208             }
 209         }
 210         for (CacheKey condemned : forDeletion) {
 211             mCache.remove(condemned);
 212         }
 213     }
 214 
 215     /**
 216      * Empty out the cache.
 217      */
 218     public void flush() {
 219         synchronized(mCache) {
 220             mCache.clear();
 221         }
 222     }
 223 
 224     /**
 225      * Empty out the cache that aren&#x27;t of the correct grid size
 226      */
 227     public void flushInvalidIcons(DeviceProfile grid) {
 228         synchronized(mCache) {
 229             Iterator&lt;Entry&lt;CacheKey, CacheEntry&gt;&gt; it = mCache.entrySet().iterator();
 230             while (it.hasNext()) {
 231                 final CacheEntry e = it.next().getValue();
<abbr title=" 232                 if ((e.icon != null) &amp;&amp; ((e.icon.getWidth() &lt; grid.iconSizePx) || (e.icon.getHeight() &lt; grid.iconSizePx))) {"> 232                 if ((e.icon != null) &amp;&amp; ((e.icon.getWidth() &lt; grid.iconSizePx) || (e.icon.getHeight() &lt; g</abbr>
 233                     it.remove();
 234                 }
 235             }
 236         }
 237     }
 238 
 239     /**
 240      * Fill in &quot;application&quot; with the icon and label for &quot;info.&quot;
 241      */
<abbr title=" 242     public void getTitleAndIcon(AppInfo application, LauncherActivityInfoCompat info, HashMap&lt;Object, CharSequence&gt; labelCache) {"> 242     public void getTitleAndIcon(AppInfo application, LauncherActivityInfoCompat info, HashMap&lt;Object, Cha</abbr>
 243         synchronized(mCache) {
<abbr title=" 244             CacheEntry entry = cacheLocked(application.componentName, info, labelCache, info.getUser(), false);"> 244             CacheEntry entry = cacheLocked(application.componentName, info, labelCache, info.getUser(), f</abbr>
 245             application.title = entry.title;
 246             application.iconBitmap = entry.icon;
 247             application.contentDescription = entry.contentDescription;
 248         }
 249     }
 250 
 251     public Bitmap getIcon(Intent intent, UserHandleCompat user) {
 252         return getIcon(intent, null, user, true);
 253     }
 254 
 255     private Bitmap getIcon(Intent intent, String title, UserHandleCompat user, boolean usePkgIcon) {
 256         synchronized(mCache) {
 257             ComponentName component = intent.getComponent();
 258             // null info means not installed, but if we have a component from the intent then
 259             // we should still look in the cache for restored app icons.
 260             if (component == null) {
 261                 return getDefaultIcon(user);
 262             }
 263             LauncherActivityInfoCompat launcherActInfo = mLauncherApps.resolveActivity(intent, user);
 264             CacheEntry entry = cacheLocked(component, launcherActInfo, null, user, usePkgIcon);
 265             if (title != null) {
 266                 entry.title = title;
 267                 entry.contentDescription = mUserManager.getBadgedLabelForUser(title, user);
 268             }
 269             return entry.icon;
 270         }
 271     }
 272 
 273     /**
 274      * Fill in &quot;shortcutInfo&quot; with the icon and label for &quot;info.&quot;
 275      */
<abbr title=" 276     public void getTitleAndIcon(ShortcutInfo shortcutInfo, Intent intent, UserHandleCompat user, boolean usePkgIcon) {"> 276     public void getTitleAndIcon(ShortcutInfo shortcutInfo, Intent intent, UserHandleCompat user, boolean </abbr>
 277         synchronized(mCache) {
 278             ComponentName component = intent.getComponent();
 279             // null info means not installed, but if we have a component from the intent then
 280             // we should still look in the cache for restored app icons.
 281             if (component == null) {
 282                 shortcutInfo.setIcon(getDefaultIcon(user));
 283                 shortcutInfo.title = &quot;&quot;;
 284                 shortcutInfo.usingFallbackIcon = true;
 285             } else {
 286                 LauncherActivityInfoCompat launcherActInfo = mLauncherApps.resolveActivity(intent, user);
 287                 CacheEntry entry = cacheLocked(component, launcherActInfo, null, user, usePkgIcon);
 288                 shortcutInfo.setIcon(entry.icon);
 289                 shortcutInfo.title = entry.title;
 290                 shortcutInfo.usingFallbackIcon = isDefaultIcon(entry.icon, user);
 291             }
 292         }
 293     }
 294 
 295     public Bitmap getDefaultIcon(UserHandleCompat user) {
 296         if (!mDefaultIcons.containsKey(user)) {
 297             mDefaultIcons.put(user, makeDefaultIcon(user));
 298         }
 299         return mDefaultIcons.get(user);
 300     }
 301 
<abbr title=" 302     public Bitmap getIcon(ComponentName component, LauncherActivityInfoCompat info, HashMap&lt;Object, CharSequence&gt; labelCache) {"> 302     public Bitmap getIcon(ComponentName component, LauncherActivityInfoCompat info, HashMap&lt;Object, CharS</abbr>
 303         synchronized(mCache) {
 304             if ((info == null) || (component == null)) {
 305                 return null;
 306             }
 307             CacheEntry entry = cacheLocked(component, info, labelCache, info.getUser(), false);
 308             return entry.icon;
 309         }
 310     }
 311 
 312     public boolean isDefaultIcon(Bitmap icon, UserHandleCompat user) {
 313         return mDefaultIcons.get(user) == icon;
 314     }
 315 
<abbr title=" 316     private CacheEntry cacheLocked(ComponentName componentName, LauncherActivityInfoCompat info, HashMap&lt;Object, CharSequence&gt; labelCache, UserHandleCompat user, boolean usePackageIcon) {"> 316     private CacheEntry cacheLocked(ComponentName componentName, LauncherActivityInfoCompat info, HashMap&lt;</abbr>
 317         CacheKey cacheKey = new CacheKey(componentName, user);
 318         CacheEntry entry = mCache.get(cacheKey);
 319         if (entry == null) {
 320             entry = new CacheEntry();
 321             mCache.put(cacheKey, entry);
 322             if (info != null) {
 323                 ComponentName labelKey = info.getComponentName();
 324                 if ((labelCache != null) &amp;&amp; labelCache.containsKey(labelKey)) {
 325                     entry.title = labelCache.get(labelKey).toString();
 326                 } else {
 327                     entry.title = info.getLabel().toString();
 328                     if (labelCache != null) {
 329                         labelCache.put(labelKey, entry.title);
 330                     }
 331                 }
 332                 entry.contentDescription = mUserManager.getBadgedLabelForUser(entry.title, user);
 333                 entry.icon = Utilities.createIconBitmap(info.getBadgedIcon(mIconDpi), mContext);
 334             } else {
 335                 entry.title = &quot;&quot;;
 336                 Bitmap preloaded = getPreloadedIcon(componentName, user);
 337                 if (preloaded != null) {
 338                     if (DEBUG) {
 339                         Log.d(TAG, &quot;using preloaded icon for &quot; + componentName.toShortString());
 340                     }
 341                     entry.icon = preloaded;
 342                 } else {
 343                     if (usePackageIcon) {
<abbr title=" 344                         CacheEntry packageEntry = getEntryForPackage(componentName.getPackageName(), user);"> 344                         CacheEntry packageEntry = getEntryForPackage(componentName.getPackageName(), user</abbr>
 345                         if (packageEntry != null) {
 346                             if (DEBUG) {
<abbr title=" 347                                 Log.d(TAG, &quot;using package default icon for &quot; + componentName.toShortString());"> 347                                 Log.d(TAG, &quot;using package default icon for &quot; + componentName.toShortStrin</abbr>
 348                             }
 349                             entry.icon = packageEntry.icon;
 350                             entry.title = packageEntry.title;
 351                         }
 352                     }
 353                     if (entry.icon == null) {
 354                         if (DEBUG) {
 355                             Log.d(TAG, &quot;using default icon for &quot; + componentName.toShortString());
 356                         }
 357                         entry.icon = getDefaultIcon(user);
 358                     }
 359                 }
 360             }
 361         }
 362         return entry;
 363     }
 364 
 365     /**
 366      * Adds a default package entry in the cache. This entry is not persisted and will be removed
 367      * when the cache is flushed.
 368      */
 369     public void cachePackageInstallInfo(String packageName, UserHandleCompat user,
 370             Bitmap icon, CharSequence title) {
 371         remove(packageName, user);
 372 
 373         CacheEntry entry = getEntryForPackage(packageName, user);
 374         if (!TextUtils.isEmpty(title)) {
 375             entry.title = title;
 376         }
 377         if (icon != null) {
 378             entry.icon = Utilities.createIconBitmap(
 379                     new BitmapDrawable(mContext.getResources(), icon), mContext);
 380         }
 381     }
 382 
 383     /**
 384      * Gets an entry for the package, which can be used as a fallback entry for various components.
 385      */
 386     private CacheEntry getEntryForPackage(String packageName, UserHandleCompat user) {
 387         ComponentName cn = getPackageComponent(packageName);
 388         CacheKey cacheKey = new CacheKey(cn, user);
 389         CacheEntry entry = mCache.get(cacheKey);
 390         if (entry == null) {
 391             entry = new CacheEntry();
 392             entry.title = &quot;&quot;;
 393             mCache.put(cacheKey, entry);
 394             try {
 395                 ApplicationInfo info = mPackageManager.getApplicationInfo(packageName, 0);
 396                 entry.title = info.loadLabel(mPackageManager);
 397                 entry.icon = Utilities.createIconBitmap(info.loadIcon(mPackageManager), mContext);
 398             } catch (NameNotFoundException e) {
 399                 if (DEBUG) {
 400                     Log.d(TAG, &quot;Application not installed &quot; + packageName);
 401                 }
 402             }
 403             if (entry.icon == null) {
 404                 entry.icon = getPreloadedIcon(cn, user);
 405             }
 406         }
 407         return entry;
 408     }
 409 
 410     public HashMap&lt;ComponentName, Bitmap&gt; getAllIcons() {
 411         synchronized(mCache) {
 412             HashMap&lt;ComponentName, Bitmap&gt; set = new HashMap&lt;ComponentName, Bitmap&gt;();
 413             for (CacheKey ck : mCache.keySet()) {
 414                 final CacheEntry e = mCache.get(ck);
 415                 set.put(ck.componentName, e.icon);
 416             }
 417             return set;
 418         }
 419     }
 420 
 421     /**
 422      * Pre-load an icon into the persistent cache.
 423      *
 424      * &lt;P&gt;Queries for a component that does not exist in the package manager
 425      * will be answered by the persistent cache.
 426      *
 427      * @param context application context
 428      * @param componentName the icon should be returned for this component
 429      * @param icon the icon to be persisted
 430      * @param dpi the native density of the icon
 431      */
 432     public static void preloadIcon(Context context, ComponentName componentName, Bitmap icon,
 433             int dpi) {
 434         // TODO rescale to the correct native DPI
 435         try {
 436             PackageManager packageManager = context.getPackageManager();
 437             packageManager.getActivityIcon(componentName);
 438             // component is present on the system already, do nothing
 439             return;
 440         } catch (PackageManager.NameNotFoundException e) {
 441             // pass
 442         }
 443 
 444         final String key = componentName.flattenToString();
 445         FileOutputStream resourceFile = null;
 446         try {
 447             resourceFile = context.openFileOutput(getResourceFilename(componentName),
 448                     Context.MODE_PRIVATE);
 449             ByteArrayOutputStream os = new ByteArrayOutputStream();
 450             if (icon.compress(android.graphics.Bitmap.CompressFormat.PNG, 75, os)) {
 451                 byte[] buffer = os.toByteArray();
 452                 resourceFile.write(buffer, 0, buffer.length);
 453             } else {
 454                 Log.w(TAG, &quot;failed to encode cache for &quot; + key);
 455                 return;
 456             }
 457         } catch (FileNotFoundException e) {
 458             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);
 459         } catch (IOException e) {
 460             Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);
 461         } finally {
 462             if (resourceFile != null) {
 463                 try {
 464                     resourceFile.close();
 465                 } catch (IOException e) {
 466                     Log.d(TAG, &quot;failed to save restored icon for: &quot; + key, e);
 467                 }
 468             }
 469         }
 470     }
 471 
 472     /**
 473      * Read a pre-loaded icon from the persistent icon cache.
 474      *
 475      * @param componentName the component that should own the icon
 476      * @returns a bitmap if one is cached, or null.
 477      */
 478     private Bitmap getPreloadedIcon(ComponentName componentName, UserHandleCompat user) {
 479         final String key = componentName.flattenToShortString();
 480 
 481         // We don&#x27;t keep icons for other profiles in persistent cache.
 482         if (!user.equals(UserHandleCompat.myUserHandle())) {
 483             return null;
 484         }
 485 
 486         if (DEBUG) Log.v(TAG, &quot;looking for pre-load icon for &quot; + key);
 487         Bitmap icon = null;
 488         FileInputStream resourceFile = null;
 489         try {
 490             resourceFile = mContext.openFileInput(getResourceFilename(componentName));
 491             byte[] buffer = new byte[1024];
 492             ByteArrayOutputStream bytes = new ByteArrayOutputStream();
 493             int bytesRead = 0;
 494             while(bytesRead &gt;= 0) {
 495                 bytes.write(buffer, 0, bytesRead);
 496                 bytesRead = resourceFile.read(buffer, 0, buffer.length);
 497             }
 498             if (DEBUG) Log.d(TAG, &quot;read &quot; + bytes.size());
 499             icon = BitmapFactory.decodeByteArray(bytes.toByteArray(), 0, bytes.size());
 500             if (icon == null) {
 501                 Log.w(TAG, &quot;failed to decode pre-load icon for &quot; + key);
 502             }
 503         } catch (FileNotFoundException e) {
 504             if (DEBUG) Log.d(TAG, &quot;there is no restored icon for: &quot; + key);
 505         } catch (IOException e) {
 506             Log.w(TAG, &quot;failed to read pre-load icon for: &quot; + key, e);
 507         } finally {
 508             if(resourceFile != null) {
 509                 try {
 510                     resourceFile.close();
 511                 } catch (IOException e) {
 512                     Log.d(TAG, &quot;failed to manage pre-load icon file: &quot; + key, e);
 513                 }
 514             }
 515         }
 516 
 517         return icon;
 518     }
 519 
 520     /**
 521      * Remove a pre-loaded icon from the persistent icon cache.
 522      *
 523      * @param componentName the component that should own the icon
 524      * @returns true on success
 525      */
 526     public boolean deletePreloadedIcon(ComponentName componentName, UserHandleCompat user) {
 527         // We don&#x27;t keep icons for other profiles in persistent cache.
 528         if (!user.equals(UserHandleCompat.myUserHandle())) {
 529             return false;
 530         }
 531         if (componentName == null) {
 532             return false;
 533         }
 534         if (mCache.remove(componentName) != null) {
 535             if (DEBUG) {
 536                 Log.d(TAG, &quot;removed pre-loaded icon from the in-memory cache&quot;);
 537             }
 538         }
 539         boolean success = mContext.deleteFile(getResourceFilename(componentName));
 540         if (DEBUG &amp;&amp; success) {
 541             Log.d(TAG, &quot;removed pre-loaded icon from persistent cache&quot;);
 542         }
 543         return success;
 544     }
 545 
 546     private static String getResourceFilename(ComponentName component) {
 547         String resourceName = component.flattenToShortString();
 548         String filename = resourceName.replace(File.separatorChar, &#x27;_&#x27;);
 549         return RESOURCE_FILE_PREFIX + filename;
 550     }
 551 
 552     static ComponentName getPackageComponent(String packageName) {
 553         return new ComponentName(packageName, EMPTY_CLASS_NAME);
 554     }
 555 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2008 The Android Open Source Project
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  
  17  package com.android.launcher3;
  18  
  19  import android.app.ActivityManager;
  20  import android.content.ComponentName;
  21  import android.content.Context;
  22  import android.content.Intent;
  23  import android.content.pm.ActivityInfo;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import android.content.pm.ApplicationInfo;</span>
  25  import android.content.pm.PackageManager;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import android.content.pm.PackageManager.NameNotFoundException;</span>
  27  import android.content.pm.ResolveInfo;
  28  import android.content.res.Resources;
  29  import android.graphics.Bitmap;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +import android.graphics.BitmapFactory;</span>
  31  import android.graphics.Canvas;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import android.graphics.drawable.BitmapDrawable;</span>
  33  import android.graphics.drawable.Drawable;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +import android.text.TextUtils;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import android.util.Log;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +import com.android.launcher3.compat.LauncherActivityInfoCompat;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +import com.android.launcher3.compat.LauncherAppsCompat;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import com.android.launcher3.compat.UserHandleCompat;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +import com.android.launcher3.compat.UserManagerCompat;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  42 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +import java.io.ByteArrayOutputStream;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +import java.io.File;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +import java.io.FileInputStream;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +import java.io.FileNotFoundException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +import java.io.FileOutputStream;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +import java.io.IOException;</span>
  49  import java.util.HashMap;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +import java.util.HashSet;</span>
  51  import java.util.Iterator;
  52  import java.util.Map.Entry;
  53  
  54  /**
  55   * Cache of application icons.  Icons can be made from any thread.
  56   */
  57  public class IconCache {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -    @SuppressWarnings(&quot;unused&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +</span>
  60      private static final String TAG = &quot;Launcher.IconCache&quot;;
  61  
  62      private static final int INITIAL_ICON_CACHE_CAPACITY = 50;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +    private static final String RESOURCE_FILE_PREFIX = &quot;icon_&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +    // Empty class name is used for storing package default entry.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +    private static final String EMPTY_CLASS_NAME = &quot;.&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +    private static final boolean DEBUG = false;</span>
  69  
  70      private static class CacheEntry {
  71          public Bitmap icon;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -        public String title;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -    private final Bitmap mDefaultIcon;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +        public CharSequence title;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +        public CharSequence contentDescription;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  78 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +    private static class CacheKey {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +        public ComponentName componentName;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +        public UserHandleCompat user;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +        CacheKey(ComponentName componentName, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +            this.componentName = componentName;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +            this.user = user;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +        @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +        public int hashCode() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +            return componentName.hashCode() + user.hashCode();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +        @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +        public boolean equals(Object o) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +            CacheKey other = (CacheKey) o;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +            return other.componentName.equals(componentName) &amp;&amp; other.user.equals(user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +    private final HashMap&lt;UserHandleCompat, Bitmap&gt; mDefaultIcons =</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +            new HashMap&lt;UserHandleCompat, Bitmap&gt;();</span>
 103      private final Context mContext;
 104      private final PackageManager mPackageManager;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -    private final HashMap&lt;ComponentName, CacheEntry&gt; mCache =</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -            new HashMap&lt;ComponentName, CacheEntry&gt;(INITIAL_ICON_CACHE_CAPACITY);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +    private final UserManagerCompat mUserManager;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +    private final LauncherAppsCompat mLauncherApps;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +    private final HashMap&lt;CacheKey, CacheEntry&gt; mCache =</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +            new HashMap&lt;CacheKey, CacheEntry&gt;(INITIAL_ICON_CACHE_CAPACITY);</span>
 111      private int mIconDpi;
 112  
 113      public IconCache(Context context) {
 114          ActivityManager activityManager =
 115                  (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
 116  
 117          mContext = context;
 118          mPackageManager = context.getPackageManager();
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +        mUserManager = UserManagerCompat.getInstance(mContext);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +        mLauncherApps = LauncherAppsCompat.getInstance(mContext);</span>
 121          mIconDpi = activityManager.getLauncherLargeIconDensity();
 122  
 123          // need to set mIconDpi before getting default icon
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -        mDefaultIcon = makeDefaultIcon();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +        UserHandleCompat myUser = UserHandleCompat.myUserHandle();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        mDefaultIcons.put(myUser, makeDefaultIcon(myUser));</span>
 127      }
 128  
 129      public Drawable getFullResDefaultActivityIcon() {
 130          return getFullResIcon(Resources.getSystem(),
 131                  android.R.mipmap.sym_def_app_icon);
 132      }
 133  
 134      public Drawable getFullResIcon(Resources resources, int iconId) {
 135          Drawable d;
 136          try {
 137              d = resources.getDrawableForDensity(iconId, mIconDpi);
 138          } catch (Resources.NotFoundException e) {
 139              d = null;
 140          }
 141  
 142          return (d != null) ? d : getFullResDefaultActivityIcon();
 143      }
 144  
 145      public Drawable getFullResIcon(String packageName, int iconId) {
 146          Resources resources;
 147          try {
 148              resources = mPackageManager.getResourcesForApplication(packageName);
 149          } catch (PackageManager.NameNotFoundException e) {
 150              resources = null;
 151          }
 152          if (resources != null) {
 153              if (iconId != 0) {
 154                  return getFullResIcon(resources, iconId);
 155              }
 156          }
 157          return getFullResDefaultActivityIcon();
 158      }
 159  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +    public int getFullResIconDpi() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +        return mIconDpi;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +</span>
 164      public Drawable getFullResIcon(ResolveInfo info) {
 165          return getFullResIcon(info.activityInfo);
 166      }
 167  
 168      public Drawable getFullResIcon(ActivityInfo info) {
 169  
 170          Resources resources;
 171          try {
 172              resources = mPackageManager.getResourcesForApplication(
 173                      info.applicationInfo);
 174          } catch (PackageManager.NameNotFoundException e) {
 175              resources = null;
 176          }
 177          if (resources != null) {
 178              int iconId = info.getIconResource();
 179              if (iconId != 0) {
 180                  return getFullResIcon(resources, iconId);
 181              }
 182          }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +</span>
 184          return getFullResDefaultActivityIcon();
 185      }
 186  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -    private Bitmap makeDefaultIcon() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -        Drawable d = getFullResDefaultActivityIcon();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +    private Bitmap makeDefaultIcon(UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +        Drawable unbadged = getFullResDefaultActivityIcon();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +        Drawable d = mUserManager.getBadgedDrawableForUser(unbadged, user);</span>
 192          Bitmap b = Bitmap.createBitmap(Math.max(d.getIntrinsicWidth(), 1),
 193                  Math.max(d.getIntrinsicHeight(), 1),
 194                  Bitmap.Config.ARGB_8888);
 195          Canvas c = new Canvas(b);
 196          d.setBounds(0, 0, b.getWidth(), b.getHeight());
 197          d.draw(c);
 198          c.setBitmap(null);
 199          return b;
 200      }
 201  
 202      /**
 203       * Remove any records for the supplied ComponentName.
 204       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -    public void remove(ComponentName componentName) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -        synchronized (mCache) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -            mCache.remove(componentName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +    public void remove(ComponentName componentName, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +        synchronized (mCache) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +            mCache.remove(new CacheKey(componentName, user));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +     * Remove any records for the supplied package name.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +    public void remove(String packageName, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +        HashSet&lt;CacheKey&gt; forDeletion = new HashSet&lt;CacheKey&gt;();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +        for (CacheKey key: mCache.keySet()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +            if (key.componentName.getPackageName().equals(packageName)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +                    &amp;&amp; key.user.equals(user)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +                forDeletion.add(key);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +        for (CacheKey condemned: forDeletion) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +            mCache.remove(condemned);</span>
 227          }
 228      }
 229  
 230      /**
 231       * Empty out the cache.
 232       */
 233      public void flush() {
 234          synchronized (mCache) {
 235              mCache.clear();
 236          }
 237      }
 238  
 239      /**
 240       * Empty out the cache that aren&#x27;t of the correct grid size
 241       */
 242      public void flushInvalidIcons(DeviceProfile grid) {
 243          synchronized (mCache) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -            Iterator&lt;Entry&lt;ComponentName, CacheEntry&gt;&gt; it = mCache.entrySet().iterator();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +            Iterator&lt;Entry&lt;CacheKey, CacheEntry&gt;&gt; it = mCache.entrySet().iterator();</span>
 246              while (it.hasNext()) {
 247                  final CacheEntry e = it.next().getValue();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 248 -                if (e.icon.getWidth() &lt; grid.iconSizePx || e.icon.getHeight() &lt; grid.iconSizePx) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +                if ((e.icon != null) &amp;&amp; (e.icon.getWidth() &lt; grid.iconSizePx</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +                        || e.icon.getHeight() &lt; grid.iconSizePx)) {</span>
 251                      it.remove();
 252                  }
 253              }
 254          }
 255      }
 256  
 257      /**
 258       * Fill in &quot;application&quot; with the icon and label for &quot;info.&quot;
 259       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 260 -    public void getTitleAndIcon(AppInfo application, ResolveInfo info,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +    public void getTitleAndIcon(AppInfo application, LauncherActivityInfoCompat info,</span>
 262              HashMap&lt;Object, CharSequence&gt; labelCache) {
 263          synchronized (mCache) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 264 -            CacheEntry entry = cacheLocked(application.componentName, info, labelCache);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +            CacheEntry entry = cacheLocked(application.componentName, info, labelCache,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +                    info.getUser(), false);</span>
 267  
 268              application.title = entry.title;
 269              application.iconBitmap = entry.icon;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 270 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 271 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 272 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 273 -    public Bitmap getIcon(Intent intent) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 274 -        synchronized (mCache) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 275 -            final ResolveInfo resolveInfo = mPackageManager.resolveActivity(intent, 0);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +            application.contentDescription = entry.contentDescription;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +    public Bitmap getIcon(Intent intent, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +        return getIcon(intent, null, user, true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +    private Bitmap getIcon(Intent intent, String title, UserHandleCompat user, boolean usePkgIcon) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +        synchronized (mCache) {</span>
 286              ComponentName component = intent.getComponent();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 287 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 288 -            if (resolveInfo == null || component == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 289 -                return mDefaultIcon;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 291 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 292 -            CacheEntry entry = cacheLocked(component, resolveInfo, null);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +            // null info means not installed, but if we have a component from the intent then</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +            // we should still look in the cache for restored app icons.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +            if (component == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +                return getDefaultIcon(user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +            LauncherActivityInfoCompat launcherActInfo = mLauncherApps.resolveActivity(intent, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +            CacheEntry entry = cacheLocked(component, launcherActInfo, null, user, usePkgIcon);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +            if (title != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +                entry.title = title;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +                entry.contentDescription = mUserManager.getBadgedLabelForUser(title, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 304 +            }</span>
 305              return entry.icon;
 306          }
 307      }
 308  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 309 -    public Bitmap getIcon(ComponentName component, ResolveInfo resolveInfo,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 310 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +     * Fill in &quot;shortcutInfo&quot; with the icon and label for &quot;info.&quot;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +    public void getTitleAndIcon(ShortcutInfo shortcutInfo, Intent intent, UserHandleCompat user,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +            boolean usePkgIcon) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +        synchronized (mCache) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +            ComponentName component = intent.getComponent();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 317 +            // null info means not installed, but if we have a component from the intent then</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +            // we should still look in the cache for restored app icons.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 319 +            if (component == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +                shortcutInfo.setIcon(getDefaultIcon(user));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 321 +                shortcutInfo.title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 322 +                shortcutInfo.usingFallbackIcon = true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 323 +            } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 324 +                LauncherActivityInfoCompat launcherActInfo =</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 325 +                        mLauncherApps.resolveActivity(intent, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +                CacheEntry entry = cacheLocked(component, launcherActInfo, null, user, usePkgIcon);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +                shortcutInfo.setIcon(entry.icon);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 329 +                shortcutInfo.title = entry.title;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 330 +                shortcutInfo.usingFallbackIcon = isDefaultIcon(entry.icon, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 331 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 332 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 333 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 334 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 335 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 336 +    public Bitmap getDefaultIcon(UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 337 +        if (!mDefaultIcons.containsKey(user)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 338 +            mDefaultIcons.put(user, makeDefaultIcon(user));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +        return mDefaultIcons.get(user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +    public Bitmap getIcon(ComponentName component, LauncherActivityInfoCompat info,</span>
 344              HashMap&lt;Object, CharSequence&gt; labelCache) {
 345          synchronized (mCache) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 346 -            if (resolveInfo == null || component == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +            if (info == null || component == null) {</span>
 348                  return null;
 349              }
 350  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 351 -            CacheEntry entry = cacheLocked(component, resolveInfo, labelCache);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 352 +            CacheEntry entry = cacheLocked(component, info, labelCache, info.getUser(), false);</span>
 353              return entry.icon;
 354          }
 355      }
 356  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -    public boolean isDefaultIcon(Bitmap icon) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 358 -        return mDefaultIcon == icon;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 359 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 360 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 361 -    private CacheEntry cacheLocked(ComponentName componentName, ResolveInfo info,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 362 -            HashMap&lt;Object, CharSequence&gt; labelCache) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 363 -        CacheEntry entry = mCache.get(componentName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 364 +    public boolean isDefaultIcon(Bitmap icon, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 365 +        return mDefaultIcons.get(user) == icon;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 366 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 367 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 368 +    private CacheEntry cacheLocked(ComponentName componentName, LauncherActivityInfoCompat info,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 369 +            HashMap&lt;Object, CharSequence&gt; labelCache, UserHandleCompat user, boolean usePackageIcon) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 370 +        CacheKey cacheKey = new CacheKey(componentName, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 371 +        CacheEntry entry = mCache.get(cacheKey);</span>
 372          if (entry == null) {
 373              entry = new CacheEntry();
 374  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 375 -            mCache.put(componentName, entry);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 376 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 377 -            ComponentName key = LauncherModel.getComponentNameFromResolveInfo(info);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 378 -            if (labelCache != null &amp;&amp; labelCache.containsKey(key)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 379 -                entry.title = labelCache.get(key).toString();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 380 +            mCache.put(cacheKey, entry);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 381 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 382 +            if (info != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 383 +                ComponentName labelKey = info.getComponentName();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 384 +                if (labelCache != null &amp;&amp; labelCache.containsKey(labelKey)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 385 +                    entry.title = labelCache.get(labelKey).toString();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 386 +                } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 387 +                    entry.title = info.getLabel().toString();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 388 +                    if (labelCache != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 389 +                        labelCache.put(labelKey, entry.title);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 390 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 391 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 392 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 393 +                entry.contentDescription = mUserManager.getBadgedLabelForUser(entry.title, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 394 +                entry.icon = Utilities.createIconBitmap(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +                        info.getBadgedIcon(mIconDpi), mContext);</span>
 396              } else {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 397 -                entry.title = info.loadLabel(mPackageManager).toString();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 398 -                if (labelCache != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 399 -                    labelCache.put(key, entry.title);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +                entry.title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 401 +                Bitmap preloaded = getPreloadedIcon(componentName, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +                if (preloaded != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 403 +                    if (DEBUG) Log.d(TAG, &quot;using preloaded icon for &quot; +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 404 +                            componentName.toShortString());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +                    entry.icon = preloaded;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +                } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 407 +                    if (usePackageIcon) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +                        CacheEntry packageEntry = getEntryForPackage(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +                                componentName.getPackageName(), user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +                        if (packageEntry != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +                            if (DEBUG) Log.d(TAG, &quot;using package default icon for &quot; +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +                                    componentName.toShortString());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +                            entry.icon = packageEntry.icon;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +                            entry.title = packageEntry.title;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +                        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +                    if (entry.icon == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +                        if (DEBUG) Log.d(TAG, &quot;using default icon for &quot; +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +                                componentName.toShortString());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +                        entry.icon = getDefaultIcon(user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +                    }</span>
 422                  }
 423              }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 424 -            if (entry.title == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 425 -                entry.title = info.activityInfo.name;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 426 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 427 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 428 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 429 +        return entry;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 430 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 431 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 432 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 433 +     * Adds a default package entry in the cache. This entry is not persisted and will be removed</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 434 +     * when the cache is flushed.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 435 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 436 +    public void cachePackageInstallInfo(String packageName, UserHandleCompat user,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 437 +            Bitmap icon, CharSequence title) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 438 +        remove(packageName, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 439 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 440 +        CacheEntry entry = getEntryForPackage(packageName, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 441 +        if (!TextUtils.isEmpty(title)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 442 +            entry.title = title;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 443 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 444 +        if (icon != null) {</span>
 445              entry.icon = Utilities.createIconBitmap(
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 446 -                    getFullResIcon(info), mContext);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 447 +                    new BitmapDrawable(mContext.getResources(), icon), mContext);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 448 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 449 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 450 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 451 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 452 +     * Gets an entry for the package, which can be used as a fallback entry for various components.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 453 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 454 +    private CacheEntry getEntryForPackage(String packageName, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 455 +        ComponentName cn = getPackageComponent(packageName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 456 +        CacheKey cacheKey = new CacheKey(cn, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 457 +        CacheEntry entry = mCache.get(cacheKey);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 458 +        if (entry == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 459 +            entry = new CacheEntry();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 460 +            entry.title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 461 +            mCache.put(cacheKey, entry);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 462 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 463 +            try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 464 +                ApplicationInfo info = mPackageManager.getApplicationInfo(packageName, 0);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 465 +                entry.title = info.loadLabel(mPackageManager);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 466 +                entry.icon = Utilities.createIconBitmap(info.loadIcon(mPackageManager), mContext);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 467 +            } catch (NameNotFoundException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 468 +                if (DEBUG) Log.d(TAG, &quot;Application not installed &quot; + packageName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 469 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 470 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 471 +            if (entry.icon == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 472 +                entry.icon = getPreloadedIcon(cn, user);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 473 +            }</span>
 474          }
 475          return entry;
 476      }
 477  
 478      public HashMap&lt;ComponentName,Bitmap&gt; getAllIcons() {
 479          synchronized (mCache) {
 480              HashMap&lt;ComponentName,Bitmap&gt; set = new HashMap&lt;ComponentName,Bitmap&gt;();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 481 -            for (ComponentName cn : mCache.keySet()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 482 -                final CacheEntry e = mCache.get(cn);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 483 -                set.put(cn, e.icon);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 484 +            for (CacheKey ck : mCache.keySet()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 485 +                final CacheEntry e = mCache.get(ck);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 486 +                set.put(ck.componentName, e.icon);</span>
 487              }
 488              return set;
 489          }
 490      }
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 491 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 492 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 493 +     * Pre-load an icon into the persistent cache.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 494 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 495 +     * &lt;P&gt;Queries for a component that does not exist in the package manager</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 496 +     * will be answered by the persistent cache.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 497 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 498 +     * @param context application context</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 499 +     * @param componentName the icon should be returned for this component</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 500 +     * @param icon the icon to be persisted</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 501 +     * @param dpi the native density of the icon</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 503 +    public static void preloadIcon(Context context, ComponentName componentName, Bitmap icon,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 504 +            int dpi) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 505 +        // TODO rescale to the correct native DPI</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 506 +        try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 507 +            PackageManager packageManager = context.getPackageManager();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 508 +            packageManager.getActivityIcon(componentName);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 509 +            // component is present on the system already, do nothing</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 510 +            return;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 511 +        } catch (PackageManager.NameNotFoundException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 512 +            // pass</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 513 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 514 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 515 +        final String key = componentName.flattenToString();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 516 +        FileOutputStream resourceFile = null;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 517 +        try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 518 +            resourceFile = context.openFileOutput(getResourceFilename(componentName),</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 519 +                    Context.MODE_PRIVATE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 520 +            ByteArrayOutputStream os = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 521 +            if (icon.compress(android.graphics.Bitmap.CompressFormat.PNG, 75, os)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 522 +                byte[] buffer = os.toByteArray();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 523 +                resourceFile.write(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 524 +            } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 525 +                Log.w(TAG, &quot;failed to encode cache for &quot; + key);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 526 +                return;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 527 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 528 +        } catch (FileNotFoundException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 529 +            Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 530 +        } catch (IOException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 531 +            Log.w(TAG, &quot;failed to pre-load cache for &quot; + key, e);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 532 +        } finally {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 533 +            if (resourceFile != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 534 +                try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 535 +                    resourceFile.close();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 536 +                } catch (IOException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 537 +                    Log.d(TAG, &quot;failed to save restored icon for: &quot; + key, e);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 538 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 539 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 540 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 541 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 542 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 543 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 544 +     * Read a pre-loaded icon from the persistent icon cache.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 545 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 546 +     * @param componentName the component that should own the icon</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 547 +     * @returns a bitmap if one is cached, or null.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 548 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 549 +    private Bitmap getPreloadedIcon(ComponentName componentName, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 550 +        final String key = componentName.flattenToShortString();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 551 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 552 +        // We don&#x27;t keep icons for other profiles in persistent cache.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 553 +        if (!user.equals(UserHandleCompat.myUserHandle())) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 554 +            return null;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 555 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 556 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 557 +        if (DEBUG) Log.v(TAG, &quot;looking for pre-load icon for &quot; + key);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 558 +        Bitmap icon = null;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 559 +        FileInputStream resourceFile = null;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 560 +        try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 561 +            resourceFile = mContext.openFileInput(getResourceFilename(componentName));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 562 +            byte[] buffer = new byte[1024];</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 563 +            ByteArrayOutputStream bytes = new ByteArrayOutputStream();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 564 +            int bytesRead = 0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 565 +            while(bytesRead &gt;= 0) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 566 +                bytes.write(buffer, 0, bytesRead);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 567 +                bytesRead = resourceFile.read(buffer, 0, buffer.length);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 568 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 569 +            if (DEBUG) Log.d(TAG, &quot;read &quot; + bytes.size());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 570 +            icon = BitmapFactory.decodeByteArray(bytes.toByteArray(), 0, bytes.size());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 571 +            if (icon == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 572 +                Log.w(TAG, &quot;failed to decode pre-load icon for &quot; + key);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 573 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 574 +        } catch (FileNotFoundException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 575 +            if (DEBUG) Log.d(TAG, &quot;there is no restored icon for: &quot; + key);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 576 +        } catch (IOException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 577 +            Log.w(TAG, &quot;failed to read pre-load icon for: &quot; + key, e);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 578 +        } finally {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 579 +            if(resourceFile != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 580 +                try {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 581 +                    resourceFile.close();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 582 +                } catch (IOException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 583 +                    Log.d(TAG, &quot;failed to manage pre-load icon file: &quot; + key, e);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 584 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 585 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 586 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 587 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 588 +        return icon;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 589 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 590 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 591 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 592 +     * Remove a pre-loaded icon from the persistent icon cache.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 593 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 594 +     * @param componentName the component that should own the icon</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 595 +     * @returns true on success</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 596 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 597 +    public boolean deletePreloadedIcon(ComponentName componentName, UserHandleCompat user) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 598 +        // We don&#x27;t keep icons for other profiles in persistent cache.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 599 +        if (!user.equals(UserHandleCompat.myUserHandle())) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 600 +            return false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 601 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 602 +        if (componentName == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 603 +            return false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 604 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 605 +        if (mCache.remove(componentName) != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 606 +            if (DEBUG) Log.d(TAG, &quot;removed pre-loaded icon from the in-memory cache&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 607 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 608 +        boolean success = mContext.deleteFile(getResourceFilename(componentName));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 609 +        if (DEBUG &amp;&amp; success) Log.d(TAG, &quot;removed pre-loaded icon from persistent cache&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 610 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 611 +        return success;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 612 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 613 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 614 +    private static String getResourceFilename(ComponentName component) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 615 +        String resourceName = component.flattenToShortString();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 616 +        String filename = resourceName.replace(File.separatorChar, &#x27;_&#x27;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 617 +        return RESOURCE_FILE_PREFIX + filename;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 618 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 619 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 620 +    static ComponentName getPackageComponent(String packageName) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 621 +        return new ComponentName(packageName, EMPTY_CLASS_NAME);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 622 +    }</span>
 623  }</pre></td>
                            <td><pre></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            