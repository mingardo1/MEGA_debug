<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>320</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    320
                    <a href="319.html">prev</a>
                    <a href="321.html">next</a>
                    <a href="320_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Cybereason/Logout4Shell_f5b8576194dd61c99ba013d48ddaf2338d4a0bea_src/main/java/Log4jRCE.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Cybereason\Logout4Shell show &quot;f5b8576194dd61c99ba013d48ddaf2338d4a0bea:src/main/java/Log4jRCE.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Cybereason\Logout4Shell show &quot;f5b8576194dd61c99ba013d48ddaf2338d4a0bea^1:src/main/java/Log4jRCE.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Cybereason\Logout4Shell show &quot;f5b8576194dd61c99ba013d48ddaf2338d4a0bea^2:src/main/java/Log4jRCE.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Cybereason\Logout4Shell show &quot;cff871be4a27c0c5a8acf585ecb20748fc7628e2:src/main/java/Log4jRCE.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bs], [b], [j], [j], [j]], subset: [[bsj], [bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="6691182795354635370" onmouseenter="enter('6691182795354635370');" onmouseout="out('6691182795354635370');" style="">   1 /* Commented out because they are only needed for another commented-out                                  </span>
<span class="-8797436401024994820" onmouseenter="enter('-8797436401024994820');" onmouseout="out('-8797436401024994820');" style="">   2    code block.                                                                                           </span>
<span class="1423952439795191567" onmouseenter="enter('1423952439795191567');" onmouseout="out('1423952439795191567');" style="">   3 --- BEGIN COMMENTED OUT CODE ---                                                                         </span>
<span class="-2049169779958178167" onmouseenter="enter('-2049169779958178167');" onmouseout="out('-2049169779958178167');" style="">   4 import jdk.internal.org.objectweb.asm.ClassReader;                                                       </span>
<span class="7965369241423847631" onmouseenter="enter('7965369241423847631');" onmouseout="out('7965369241423847631');" style="">   5 import jdk.internal.org.objectweb.asm.ClassWriter;                                                       </span>
<span class="-4339491913814058330" onmouseenter="enter('-4339491913814058330');" onmouseout="out('-4339491913814058330');" style="">   6 import jdk.internal.org.objectweb.asm.Opcodes;                                                           </span>
<span class="8249904259647672485" onmouseenter="enter('8249904259647672485');" onmouseout="out('8249904259647672485');" style="">   7 import jdk.internal.org.objectweb.asm.tree.*;                                                            </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">   8 import java.io.ByteArrayOutputStream;                                                                    </span>
<span class="-4914279600566636630" onmouseenter="enter('-4914279600566636630');" onmouseout="out('-4914279600566636630');" style="">   9 import java.util.Optional;                                                                               </span>
<span class="-3247342361776559718" onmouseenter="enter('-3247342361776559718');" onmouseout="out('-3247342361776559718');" style="">  10 --- END COMMENTED OUT CODE ---                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  11  */                                                                                                      </span>
<span class="584651227269278890" onmouseenter="enter('584651227269278890');" onmouseout="out('584651227269278890');" style="">  12 import org.apache.logging.log4j.core.LoggerContext;                                                      </span>
<span class="-2437324594807133199" onmouseenter="enter('-2437324594807133199');" onmouseout="out('-2437324594807133199');" style="">  13 import org.apache.logging.log4j.core.config.Configuration;                                               </span>
<span class="-767245909935616887" onmouseenter="enter('-767245909935616887');" onmouseout="out('-767245909935616887');" style="">  14 import org.apache.logging.log4j.core.lookup.Interpolator;                                                </span>
<span class="-6291433712522694528" onmouseenter="enter('-6291433712522694528');" onmouseout="out('-6291433712522694528');" style="">  15 import org.apache.logging.log4j.core.lookup.StrLookup;                                                   </span>
<span class="-5806274082705791162" onmouseenter="enter('-5806274082705791162');" onmouseout="out('-5806274082705791162');" style="">  16 import org.apache.logging.log4j.core.selector.ContextSelector;                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="6779715416064674619" onmouseenter="enter('6779715416064674619');" onmouseout="out('6779715416064674619');" style="">  18 import java.io.*;                                                                                        </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  19 import java.lang.reflect.Field;                                                                          </span>
<span class="3877996116863688216" onmouseenter="enter('3877996116863688216');" onmouseout="out('3877996116863688216');" style="">  20 import java.lang.reflect.Method;                                                                         </span>
<span class="1546464639948964552" onmouseenter="enter('1546464639948964552');" onmouseout="out('1546464639948964552');" style="">  21 import java.lang.reflect.Modifier;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  22 import java.net.URL;                                                                                     </span>
<span class="-6935710760624141930" onmouseenter="enter('-6935710760624141930');" onmouseout="out('-6935710760624141930');" style="">  23 import java.util.Base64;                                                                                 </span>
<span class="803450442014170948" onmouseenter="enter('803450442014170948');" onmouseout="out('803450442014170948');" style="">  24 import java.util.zip.ZipEntry;                                                                           </span>
<span class="4611873531984630168" onmouseenter="enter('4611873531984630168');" onmouseout="out('4611873531984630168');" style="">  25 import java.util.zip.ZipInputStream;                                                                     </span>
<span class="-7973848186377225832" onmouseenter="enter('-7973848186377225832');" onmouseout="out('-7973848186377225832');" style="">  26 import java.util.zip.ZipOutputStream;                                                                    </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  27 import java.util.Map;                                                                                    </span>
<span  style="">  28                                                                                                          </span>
<span class="-1419637519660801597" onmouseenter="enter('-1419637519660801597');" onmouseout="out('-1419637519660801597');" style="">  29 public class Log4jRCE {                                                                                  </span>
<span class="2640580777198908089" onmouseenter="enter('2640580777198908089');" onmouseout="out('2640580777198908089');" style="">  30     static {                                                                                             </span>
<span class="-6460963334547882165" onmouseenter="enter('-6460963334547882165');" onmouseout="out('-6460963334547882165');" style="">  31         Class&lt;?&gt; c = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  32         try {                                                                                            </span>
<span class="2740482109536166617" onmouseenter="enter('2740482109536166617');" onmouseout="out('2740482109536166617');" style="">  33             try { // Try for versions of Log4j &gt;= 2.10                                                   </span>
<span class="-8598636720620456978" onmouseenter="enter('-8598636720620456978');" onmouseout="out('-8598636720620456978');" style=""><abbr title="  34                 c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.core.util.Constants&quot;);">  34                 c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.coðŸ”µ</abbr></span>
<span class="4331306856400516015" onmouseenter="enter('4331306856400516015');" onmouseout="out('4331306856400516015');" style="">  35                 Field field = c.getField(&quot;FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS&quot;);                     </span>
<span class="-6039644475557245276" onmouseenter="enter('-6039644475557245276');" onmouseout="out('-6039644475557245276');" style="">  36                 System.out.println(&quot;Setting &quot; + field.getName() + &quot; value to True&quot;);                     </span>
<span class="7945815878112567707" onmouseenter="enter('7945815878112567707');" onmouseout="out('7945815878112567707');" style="">  37                 setAccess(field);                                                                        </span>
<span class="4217794172310991600" onmouseenter="enter('4217794172310991600');" onmouseout="out('4217794172310991600');" style="">  38                 field.set(null, Boolean.TRUE);                                                           </span>
<span class="4799298389398123314" onmouseenter="enter('4799298389398123314');" onmouseout="out('4799298389398123314');" style="">  39             } catch (Throwable e) { // Fall back to older versions. Try to make JNDI non instantiable    </span>
<span class="4783372292862450861" onmouseenter="enter('4783372292862450861');" onmouseout="out('4783372292862450861');" style="">  40                 c = null;                                                                                </span>
<span class="-2894496202058774448" onmouseenter="enter('-2894496202058774448');" onmouseout="out('-2894496202058774448');" style=""><abbr title="  41                 System.err.println(&quot;No field FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS - version &lt;= 2.9.0&quot;);">  41                 System.err.println(&quot;No field FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS - version &lt;= 2.9.0&quot;)ðŸ”µ</abbr></span>
<span class="-2014864819161789369" onmouseenter="enter('-2014864819161789369');" onmouseout="out('-2014864819161789369');" style="">  42                 System.err.println(&quot;Will attempt to modify the configuration directly&quot;);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  43             }                                                                                            </span>
<span  style="">  44                                                                                                          </span>
<span class="-968764517086271557" onmouseenter="enter('-968764517086271557');" onmouseout="out('-968764517086271557');" style="">  45             // Reconfigure log4j                                                                         </span>
<span class="-8193543035602096174" onmouseenter="enter('-8193543035602096174');" onmouseout="out('-8193543035602096174');" style="">  46             ClassLoader classLoader = Thread.currentThread().getContextClassLoader();                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  47 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-5344911972097151889" onmouseenter="enter('-5344911972097151889');" onmouseout="out('-5344911972097151889');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48             c = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49             try {                                                                                        </span>
<span class="8827340200273165867" onmouseenter="enter('8827340200273165867');" onmouseout="out('8827340200273165867');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50                 Method reconfigure = c.getMethod(&quot;reconfigure&quot;);                                         </span>
<span class="-1592794414110319594" onmouseenter="enter('-1592794414110319594');" onmouseout="out('-1592794414110319594');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51                 reconfigure.invoke(null);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52             } catch (Exception ex) {                                                                     </span>
<span class="-6344238665933181139" onmouseenter="enter('-6344238665933181139');" onmouseout="out('-6344238665933181139');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53                 // Log4j is probably older.                                                              </span>
<span class="-3857331607984793593" onmouseenter="enter('-3857331607984793593');" onmouseout="out('-3857331607984793593');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54                 Method getFactoryMethod = c.getDeclaredMethod(&quot;getFactory&quot;);                             </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55                 getFactoryMethod.setAccessible(true);                                                    </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56                 Object factory = getFactoryMethod.invoke(null);                                          </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  57                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  57                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.ðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58                 Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                  </span>
<span class="-5294705432399827736" onmouseenter="enter('-5294705432399827736');" onmouseout="out('-5294705432399827736');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59                 Object contextSelector = getSelector.invoke(factory, (Object[]) null);                   </span>
<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60                 ContextSelector ctxSelector = (ContextSelector) contextSelector;                         </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61                 for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                               </span>
<span class="-195599926832777290" onmouseenter="enter('-195599926832777290');" onmouseout="out('-195599926832777290');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62                     ctx.reconfigure();                                                                   </span>
<span class="-8085575071251224001" onmouseenter="enter('-8085575071251224001');" onmouseout="out('-8085575071251224001');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63                     System.err.println(&quot;Reconfiguring context&quot;);                                         </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64                     Configuration config = ctx.getConfiguration();                                       </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65                     StrLookup resolver = config.getStrSubstitutor().getVariableResolver();               </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66                     if (resolver instanceof Interpolator) {                                              </span>
<span class="2051812310513197980" onmouseenter="enter('2051812310513197980');" onmouseout="out('2051812310513197980');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67                         System.err.println(&quot;Lookup is an Interpolator - attempting to remove JNDI&quot;);     </span>
<span class="-227504778537810497" onmouseenter="enter('-227504778537810497');" onmouseout="out('-227504778537810497');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68                         Field lookups;                                                                   </span>
<span class="-3500715653028958316" onmouseenter="enter('-3500715653028958316');" onmouseout="out('-3500715653028958316');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69                         //noinspection RedundantSuppression                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70                         try {                                                                            </span>
<span class="7057696748496001259" onmouseenter="enter('7057696748496001259');" onmouseout="out('7057696748496001259');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71                             //noinspection JavaReflectionMemberAccess                                    </span>
<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72                             lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                    </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73                         } catch (NoSuchFieldException e) {                                               </span>
<span class="7057696748496001259" onmouseenter="enter('7057696748496001259');" onmouseout="out('7057696748496001259');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74                             //noinspection JavaReflectionMemberAccess                                    </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75                             lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76                         }                                                                                </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77                         lookups.setAccessible(true);                                                     </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  78                         Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);">  78                         Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver)ðŸ”µ</abbr></span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79                         lookupMap.remove(&quot;jndi&quot;);                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  80 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-5060650949853928044" onmouseenter="enter('-5060650949853928044');" onmouseout="out('-5060650949853928044');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  81             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);">  81             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.ConfðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82             try {                                                                                        </span>
<span class="2807729132951612984" onmouseenter="enter('2807729132951612984');" onmouseout="out('2807729132951612984');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83                 Method reconfigure = configuratorClass.getMethod(&quot;reconfigure&quot;);                         </span>
<span class="-1592794414110319594" onmouseenter="enter('-1592794414110319594');" onmouseout="out('-1592794414110319594');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84                 reconfigure.invoke(null);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85             } catch (Exception ex) {                                                                     </span>
<span class="-7183520831341214109" onmouseenter="enter('-7183520831341214109');" onmouseout="out('-7183520831341214109');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86                 Method getFactoryMethod = configuratorClass.getDeclaredMethod(&quot;getFactory&quot;);             </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87                 getFactoryMethod.setAccessible(true);                                                    </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88                 Object factory = getFactoryMethod.invoke(null);                                          </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  89                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  89                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.ðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90                 Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                  </span>
<span class="1029865310842325860" onmouseenter="enter('1029865310842325860');" onmouseout="out('1029865310842325860');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91                 Object contextSelector = getSelector.invoke(factory, null);                              </span>
<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92                 ContextSelector ctxSelector = (ContextSelector) contextSelector;                         </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93                 for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                               </span>
<span class="-195599926832777290" onmouseenter="enter('-195599926832777290');" onmouseout="out('-195599926832777290');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94                     ctx.reconfigure();                                                                   </span>
<span class="-8085575071251224001" onmouseenter="enter('-8085575071251224001');" onmouseout="out('-8085575071251224001');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95                     System.err.println(&quot;Reconfiguring context&quot;);                                         </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96                     Configuration config = ctx.getConfiguration();                                       </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97                     StrLookup resolver = config.getStrSubstitutor().getVariableResolver();               </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98                     if (resolver instanceof Interpolator) {                                              </span>
<span class="2051812310513197980" onmouseenter="enter('2051812310513197980');" onmouseout="out('2051812310513197980');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99                         System.err.println(&quot;Lookup is an Interpolator - attempting to remove JNDI&quot;);     </span>
<span class="-3307716615945920777" onmouseenter="enter('-3307716615945920777');" onmouseout="out('-3307716615945920777');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100                         Field lookups = null;                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101                         try {                                                                            </span>
<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102                             lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                    </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                         } catch (NoSuchFieldException e) {                                               </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104                             lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105                         }                                                                                </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106                         lookups.setAccessible(true);                                                     </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 107                         Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);"> 107                         Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver)ðŸ”µ</abbr></span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108                         lookupMap.remove(&quot;jndi&quot;);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112         } catch (Exception e) {                                                                          </span>
<span class="-6673987533178411809" onmouseenter="enter('-6673987533178411809');" onmouseout="out('-6673987533178411809');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113             System.err.println(&quot;Exception &quot; + e);                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117                                                                                                          </span>
<span class="7460090326972894103" onmouseenter="enter('7460090326972894103');" onmouseout="out('7460090326972894103');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118     static void setFinalStatic(Field field, Object newValue) throws Exception {                          </span>
<span class="7945815878112567707" onmouseenter="enter('7945815878112567707');" onmouseout="out('7945815878112567707');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119         setAccess(field);                                                                                </span>
<span class="-2423047719989674028" onmouseenter="enter('-2423047719989674028');" onmouseout="out('-2423047719989674028');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120         field.set(null, newValue);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122                                                                                                          </span>
<span class="-4283724445844521558" onmouseenter="enter('-4283724445844521558');" onmouseout="out('-4283724445844521558');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     private static void setAccess(Field field) throws NoSuchFieldException, IllegalAccessException {     </span>
<span class="-242302875073644057" onmouseenter="enter('-242302875073644057');" onmouseout="out('-242302875073644057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         field.setAccessible(true);                                                                       </span>
<span class="-8869727192744571657" onmouseenter="enter('-8869727192744571657');" onmouseout="out('-8869727192744571657');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125         Field modifiersField = Field.class.getDeclaredField(&quot;modifiers&quot;);                                </span>
<span class="1521535264742225996" onmouseenter="enter('1521535264742225996');" onmouseout="out('1521535264742225996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126         modifiersField.setAccessible(true);                                                              </span>
<span class="-5863712544267326274" onmouseenter="enter('-5863712544267326274');" onmouseout="out('-5863712544267326274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127         modifiersField.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 129 =======                                                                                                  </span>
<span class="-5060650949853928044" onmouseenter="enter('-5060650949853928044');" onmouseout="out('-5060650949853928044');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 130             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);"> 130             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.ConfðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131                                                                                                          </span>
<span class="5708133052288787212" onmouseenter="enter('5708133052288787212');" onmouseout="out('5708133052288787212');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132             // Due to CVE-2021-45046 we&#x27;re no longer using the reconfigure method -                      </span>
<span class="943906060327858176" onmouseenter="enter('943906060327858176');" onmouseout="out('943906060327858176');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133             // Instead we reconfigure the logger but *also* remove the JNDI listener from the plugin map </span>
<span class="-3474683598063362975" onmouseenter="enter('-3474683598063362975');" onmouseout="out('-3474683598063362975');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134             //try {                                                                                      </span>
<span class="4826773022194098059" onmouseenter="enter('4826773022194098059');" onmouseout="out('4826773022194098059');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135             //    Method reconfigure = configuratorClass.getMethod(&quot;reconfigure&quot;);                       </span>
<span class="6840482095641661782" onmouseenter="enter('6840482095641661782');" onmouseout="out('6840482095641661782');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136             //    reconfigure.invoke(null);                                                              </span>
<span class="-5864710875604098479" onmouseenter="enter('-5864710875604098479');" onmouseout="out('-5864710875604098479');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137             //} catch (Exception ex) {                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138                                                                                                          </span>
<span class="-7183520831341214109" onmouseenter="enter('-7183520831341214109');" onmouseout="out('-7183520831341214109');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139             Method getFactoryMethod = configuratorClass.getDeclaredMethod(&quot;getFactory&quot;);                 </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140             getFactoryMethod.setAccessible(true);                                                        </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141             Object factory = getFactoryMethod.invoke(null);                                              </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 142             Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);"> 142             Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.implðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143             Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                      </span>
<span class="1029865310842325860" onmouseenter="enter('1029865310842325860');" onmouseout="out('1029865310842325860');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144             Object contextSelector = getSelector.invoke(factory, null);                                  </span>
<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145             ContextSelector ctxSelector = (ContextSelector) contextSelector;                             </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146             for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                                   </span>
<span class="3144029218802632169" onmouseenter="enter('3144029218802632169');" onmouseout="out('3144029218802632169');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147                 // The following deadlocks in some tests when using ThreadContext attacks                </span>
<span class="-3948224546903505154" onmouseenter="enter('-3948224546903505154');" onmouseout="out('-3948224546903505154');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148                 //ctx.reconfigure();                                                                     </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149                 Configuration config = ctx.getConfiguration();                                           </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150                 StrLookup resolver = config.getStrSubstitutor().getVariableResolver();                   </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151                 if (resolver instanceof Interpolator) {                                                  </span>
<span class="-8072257225722141933" onmouseenter="enter('-8072257225722141933');" onmouseout="out('-8072257225722141933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152                     System.err.println(&quot;Lookup is an Interpolator - removing JNDI&quot;);                     </span>
<span class="-3307716615945920777" onmouseenter="enter('-3307716615945920777');" onmouseout="out('-3307716615945920777');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153                     Field lookups = null;                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154                     try {                                                                                </span>
<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155                         lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                        </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156                     } catch (NoSuchFieldException e) {                                                   </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157                         lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);                   </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 158 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                     }                                                                                    </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style=""> 160                     lookups.setAccessible(true);                                                         </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style=""> 161                     Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);   </span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style=""> 162                     lookupMap.remove(&quot;jndi&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164             }                                                                                            </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 165 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-1156395882344945528" onmouseenter="enter('-1156395882344945528');" onmouseout="out('-1156395882344945528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166         } catch (Throwable e) {                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 167 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170                                                                                                          </span>
<span class="7460090326972894103" onmouseenter="enter('7460090326972894103');" onmouseout="out('7460090326972894103');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171     static void setFinalStatic(Field field, Object newValue) throws Exception {                          </span>
<span class="7945815878112567707" onmouseenter="enter('7945815878112567707');" onmouseout="out('7945815878112567707');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172         setAccess(field);                                                                                </span>
<span class="-2423047719989674028" onmouseenter="enter('-2423047719989674028');" onmouseout="out('-2423047719989674028');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173         field.set(null, newValue);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175                                                                                                          </span>
<span class="-4283724445844521558" onmouseenter="enter('-4283724445844521558');" onmouseout="out('-4283724445844521558');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176     private static void setAccess(Field field) throws NoSuchFieldException, IllegalAccessException {     </span>
<span class="-242302875073644057" onmouseenter="enter('-242302875073644057');" onmouseout="out('-242302875073644057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177         field.setAccessible(true);                                                                       </span>
<span class="-8869727192744571657" onmouseenter="enter('-8869727192744571657');" onmouseout="out('-8869727192744571657');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178         Field modifiersField = Field.class.getDeclaredField(&quot;modifiers&quot;);                                </span>
<span class="1521535264742225996" onmouseenter="enter('1521535264742225996');" onmouseout="out('1521535264742225996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179         modifiersField.setAccessible(true);                                                              </span>
<span class="-5863712544267326274" onmouseenter="enter('-5863712544267326274');" onmouseout="out('-5863712544267326274');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         modifiersField.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 183 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184                                                                                                          </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185             //}                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186         } catch (Exception e) {                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 187 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6673987533178411809" onmouseenter="enter('-6673987533178411809');" onmouseout="out('-6673987533178411809');" style=""> 188             System.err.println(&quot;Exception &quot; + e);                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 189             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190         }                                                                                                </span>
<span  style=""> 191                                                                                                          </span>
<span class="-8820620446306186114" onmouseenter="enter('-8820620446306186114');" onmouseout="out('-8820620446306186114');" style=""> 192         // Modify the log4j jar to fix the vulnerability permanently                                     </span>
<span class="4622163534113836460" onmouseenter="enter('4622163534113836460');" onmouseout="out('4622163534113836460');" style=""> 193         if(c != null)                                                                                    </span>
<span class="-2031086490927858149" onmouseenter="enter('-2031086490927858149');" onmouseout="out('-2031086490927858149');" style=""> 194             fullyVaccinate(c.getProtectionDomain().getCodeSource().getLocation());                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="8154133935933236062" onmouseenter="enter('8154133935933236062');" onmouseout="out('8154133935933236062');" style=""> 197     private static void fullyVaccinate(URL jarfile) {                                                    </span>
<span class="2721804508179316028" onmouseenter="enter('2721804508179316028');" onmouseout="out('2721804508179316028');" style=""> 198         String path = jarfile.getFile();                                                                 </span>
<span class="7072163538887110493" onmouseenter="enter('7072163538887110493');" onmouseout="out('7072163538887110493');" style=""> 199         File jar = new File(path);                                                                       </span>
<span class="-3583999738466172937" onmouseenter="enter('-3583999738466172937');" onmouseout="out('-3583999738466172937');" style=""> 200         if(path.endsWith(&quot;.jar&quot;)) {                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 201             try {                                                                                        </span>
<span class="-5171268849103382741" onmouseenter="enter('-5171268849103382741');" onmouseout="out('-5171268849103382741');" style=""> 202                 File fixedjar = new File(&quot;log4j.jar.tmp&quot;);                                               </span>
<span class="4281812503178124042" onmouseenter="enter('4281812503178124042');" onmouseout="out('4281812503178124042');" style=""> 203                 ZipInputStream in = new ZipInputStream(new FileInputStream(path));                       </span>
<span class="2862934014019817110" onmouseenter="enter('2862934014019817110');" onmouseout="out('2862934014019817110');" style=""> 204                 ZipOutputStream out = new ZipOutputStream(new FileOutputStream(fixedjar));               </span>
<span class="4017647276845946273" onmouseenter="enter('4017647276845946273');" onmouseout="out('4017647276845946273');" style=""> 205                 ZipEntry entry;                                                                          </span>
<span class="8663729047094984174" onmouseenter="enter('8663729047094984174');" onmouseout="out('8663729047094984174');" style=""> 206                 while ((entry = in.getNextEntry()) != null) {                                            </span>
<span class="9046440156409504525" onmouseenter="enter('9046440156409504525');" onmouseout="out('9046440156409504525');" style=""> 207                     out.putNextEntry(new ZipEntry(entry.getName()));                                     </span>
<span class="-8083890262488967167" onmouseenter="enter('-8083890262488967167');" onmouseout="out('-8083890262488967167');" style=""> 208                     switch (entry.getName()) {                                                           </span>
<span class="-5691656988002378082" onmouseenter="enter('-5691656988002378082');" onmouseout="out('-5691656988002378082');" style=""> 209                         case &quot;org/apache/logging/log4j/core/util/Constants.class&quot;:                       </span>
<span class="1660807766465307227" onmouseenter="enter('1660807766465307227');" onmouseout="out('1660807766465307227');" style=""><abbr title=" 210                             // base64 of the patched class (FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS set to default false)"> 210                             // base64 of the patched class (FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS set tðŸ”µ</abbr></span>
<span class="4623810668339343843" onmouseenter="enter('4623810668339343843');" onmouseout="out('4623810668339343843');" style=""> 211                             // base64 is more compact than a byte array in source code.                  </span>
<span class="6084565888398312712" onmouseenter="enter('6084565888398312712');" onmouseout="out('6084565888398312712');" style=""> 212                             byte[] newClass = Base64.getDecoder().decode(&quot;&quot; +                            </span>
<span class="-5561122516707250067" onmouseenter="enter('-5561122516707250067');" onmouseout="out('-5561122516707250067');" style=""><abbr title=" 213                                     &quot;yv66vgAAADQAZAEALG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL3V0aWwvQ29uc3RhbnRz&quot; +"> 213                                     &quot;yv66vgAAADQAZAEALG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL3V0aWwvQ29uðŸ”µ</abbr></span>
<span class="-756816418793786082" onmouseenter="enter('-756816418793786082');" onmouseout="out('-756816418793786082');" style=""><abbr title=" 214                                     &quot;BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEADkNvbnN0YW50cy5qYXZhAQAXTE9HNEpfTE9HX0VW&quot; +"> 214                                     &quot;BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEADkNvbnN0YW50cy5qYXZhAQAXTE9HNEpfðŸ”µ</abbr></span>
<span class="-3984816082022713717" onmouseenter="enter('-3984816082022713717');" onmouseout="out('-3984816082022713717');" style=""><abbr title=" 215                                     &quot;RU5UX0ZBQ1RPUlkBABJMamF2YS9sYW5nL1N0cmluZzsBABRMb2c0akxvZ0V2ZW50RmFjdG9yeQgA&quot; +"> 215                                     &quot;RU5UX0ZBQ1RPUlkBABJMamF2YS9sYW5nL1N0cmluZzsBABRMb2c0akxvZ0V2ZW50RmFjðŸ”µ</abbr></span>
<span class="109114158608130524" onmouseenter="enter('109114158608130524');" onmouseout="out('109114158608130524');" style=""><abbr title=" 216                                     &quot;CAEAFkxPRzRKX0NPTlRFWFRfU0VMRUNUT1IBABRMb2c0akNvbnRleHRTZWxlY3RvcggACwEAGkxP&quot; +"> 216                                     &quot;CAEAFkxPRzRKX0NPTlRFWFRfU0VMRUNUT1IBABRMb2c0akNvbnRleHRTZWxlY3RvcggAðŸ”µ</abbr></span>
<span class="5654115324350911325" onmouseenter="enter('5654115324350911325');" onmouseout="out('5654115324350911325');" style=""><abbr title=" 217                                     &quot;RzRKX0RFRkFVTFRfU1RBVFVTX0xFVkVMAQAXTG9nNGpEZWZhdWx0U3RhdHVzTGV2ZWwIAA4BABFK&quot; +"> 217                                     &quot;RzRKX0RFRkFVTFRfU1RBVFVTX0xFVkVMAQAXTG9nNGpEZWZhdWx0U3RhdHVzTGV2ZWwIðŸ”µ</abbr></span>
<span class="-2454458896399870169" onmouseenter="enter('-2454458896399870169');" onmouseout="out('-2454458896399870169');" style=""><abbr title=" 218                                     &quot;TkRJX0NPTlRFWFRfTkFNRQEAIGphdmE6Y29tcC9lbnYvbG9nNGovY29udGV4dC1uYW1lCAARAQAR&quot; +"> 218                                     &quot;TkRJX0NPTlRFWFRfTkFNRQEAIGphdmE6Y29tcC9lbnYvbG9nNGovY29udGV4dC1uYW1lðŸ”µ</abbr></span>
<span class="-1138789116125002182" onmouseenter="enter('-1138789116125002182');" onmouseout="out('-1138789116125002182');" style=""><abbr title=" 219                                     &quot;TUlMTElTX0lOX1NFQ09ORFMBAAFJAwAAA+gBAB1GT1JNQVRfTUVTU0FHRVNfSU5fQkFDS0dST1VO&quot; +"> 219                                     &quot;TUlMTElTX0lOX1NFQ09ORFMBAAFJAwAAA+gBAB1GT1JNQVRfTUVTU0FHRVNfSU5fQkFDðŸ”µ</abbr></span>
<span class="-7533713598084409785" onmouseenter="enter('-7533713598084409785');" onmouseout="out('-7533713598084409785');" style=""><abbr title=" 220                                     &quot;RAEAAVoBACdGT1JNQVRfTUVTU0FHRVNfUEFUVEVSTl9ESVNBQkxFX0xPT0tVUFMBAApJU19XRUJf&quot; +"> 220                                     &quot;RAEAAVoBACdGT1JNQVRfTUVTU0FHRVNfUEFUVEVSTl9ESVNBQkxFX0xPT0tVUFMBAApJðŸ”µ</abbr></span>
<span class="-7207099870752961264" onmouseenter="enter('-7207099870752961264');" onmouseout="out('-7207099870752961264');" style=""><abbr title=" 221                                     &quot;QVBQAQATRU5BQkxFX1RIUkVBRExPQ0FMUwEAFkVOQUJMRV9ESVJFQ1RfRU5DT0RFUlMBAB1JTklU&quot; +"> 221                                     &quot;QVBQAQATRU5BQkxFX1RIUkVBRExPQ0FMUwEAFkVOQUJMRV9ESVJFQ1RfRU5DT0RFUlMBðŸ”µ</abbr></span>
<span class="4815342611662896598" onmouseenter="enter('4815342611662896598');" onmouseout="out('4815342611662896598');" style=""><abbr title=" 222                                     &quot;SUFMX1JFVVNBQkxFX01FU1NBR0VfU0laRQEAGU1BWF9SRVVTQUJMRV9NRVNTQUdFX1NJWkUBABhF&quot; +"> 222                                     &quot;SUFMX1JFVVNBQkxFX01FU1NBR0VfU0laRQEAGU1BWF9SRVVTQUJMRV9NRVNTQUdFX1NJðŸ”µ</abbr></span>
<span class="-1782873389891306648" onmouseenter="enter('-1782873389891306648');" onmouseout="out('-1782873389891306648');" style=""><abbr title=" 223                                     &quot;TkNPREVSX0NIQVJfQlVGRkVSX1NJWkUBABhFTkNPREVSX0JZVEVfQlVGRkVSX1NJWkUBAARzaXpl&quot; +"> 223                                     &quot;TkNPREVSX0NIQVJfQlVGRkVSX1NJWkUBABhFTkNPREVSX0JZVEVfQlVGRkVSX1NJWkUBðŸ”µ</abbr></span>
<span class="1901774131252985558" onmouseenter="enter('1901774131252985558');" onmouseout="out('1901774131252985558');" style=""><abbr title=" 224                                     &quot;AQAWKExqYXZhL2xhbmcvU3RyaW5nO0kpSQEACHByb3BlcnR5AQAMZGVmYXVsdFZhbHVlAQAsb3Jn&quot; +"> 224                                     &quot;AQAWKExqYXZhL2xhbmcvU3RyaW5nO0kpSQEACHByb3BlcnR5AQAMZGVmYXVsdFZhbHVlðŸ”µ</abbr></span>
<span class="-1053467704281304668" onmouseenter="enter('-1053467704281304668');" onmouseout="out('-1053467704281304668');" style=""><abbr title=" 225                                     &quot;L2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWwHACQBAA1nZXRQcm9wZXJ0&quot; +"> 225                                     &quot;L2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWwHACQBAA1nZXRQðŸ”µ</abbr></span>
<span class="-5160184126636760015" onmouseenter="enter('-5160184126636760015');" onmouseout="out('-5160184126636760015');" style=""><abbr title=" 226                                     &quot;aWVzAQAwKClMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWw7DAAm&quot; +"> 226                                     &quot;aWVzAQAwKClMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0ðŸ”µ</abbr></span>
<span class="-4517541909066786192" onmouseenter="enter('-4517541909066786192');" onmouseout="out('-4517541909066786192');" style=""><abbr title=" 227                                     &quot;ACcKACUAKAEAEmdldEludGVnZXJQcm9wZXJ0eQwAKgAhCgAlACsBAAY8aW5pdD4BAAMoKVYMAC0A&quot; +"> 227                                     &quot;ACcKACUAKAEAEmdldEludGVnZXJQcm9wZXJ0eQwAKgAhCgAlACsBAAY8aW5pdD4BAAMoðŸ”µ</abbr></span>
<span class="1493674449025065653" onmouseenter="enter('1493674449025065653');" onmouseout="out('1493674449025065653');" style=""><abbr title=" 228                                     &quot;LgoABAAvAQAEdGhpcwEALkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS91dGlsL0NvbnN0&quot; +"> 228                                     &quot;LgoABAAvAQAEdGhpcwEALkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS91dGlsðŸ”µ</abbr></span>
<span class="566455589877770702" onmouseenter="enter('566455589877770702');" onmouseout="out('566455589877770702');" style=""><abbr title=" 229                                     &quot;YW50czsBAAg8Y2xpbml0PgEAFmxvZzRqLmZvcm1hdC5tc2cuYXN5bmMIADQBABJnZXRCb29sZWFu&quot; +"> 229                                     &quot;YW50czsBAAg8Y2xpbml0PgEAFmxvZzRqLmZvcm1hdC5tc2cuYXN5bmMIADQBABJnZXRCðŸ”µ</abbr></span>
<span class="6453800866524882267" onmouseenter="enter('6453800866524882267');" onmouseout="out('6453800866524882267');" style=""><abbr title=" 230                                     &quot;UHJvcGVydHkBABYoTGphdmEvbGFuZy9TdHJpbmc7WilaDAA2ADcKACUAOAwAFgAXCQACADoBABls&quot; +"> 230                                     &quot;UHJvcGVydHkBABYoTGphdmEvbGFuZy9TdHJpbmc7WilaDAA2ADcKACUAOAwAFgAXCQACðŸ”µ</abbr></span>
<span class="7332413416388698324" onmouseenter="enter('7332413416388698324');" onmouseout="out('7332413416388698324');" style=""><abbr title=" 231                                     &quot;b2c0ajIuZm9ybWF0TXNnTm9Mb29rdXBzCAA8DAAYABcJAAIAPgEAJ29yZy9hcGFjaGUvbG9nZ2lu&quot; +"> 231                                     &quot;b2c0ajIuZm9ybWF0TXNnTm9Mb29rdXBzCAA8DAAYABcJAAIAPgEAJ29yZy9hcGFjaGUvðŸ”µ</abbr></span>
<span class="-4929360902344800948" onmouseenter="enter('-4929360902344800948');" onmouseout="out('-4929360902344800948');" style=""><abbr title=" 232                                     &quot;Zy9sb2c0ai91dGlsL0NvbnN0YW50cwcAQAwAGQAXCQBBAEIJAAIAQgwAGgAXCQBBAEUJAAIARQEA&quot; +"> 232                                     &quot;Zy9sb2c0ai91dGlsL0NvbnN0YW50cwcAQAwAGQAXCQBBAEIJAAIAQgwAGgAXCQBBAEUJðŸ”µ</abbr></span>
<span class="8686424228131230190" onmouseenter="enter('8686424228131230190');" onmouseout="out('8686424228131230190');" style=""><abbr title=" 233                                     &quot;HWxvZzRqMi5lbmFibGUuZGlyZWN0LmVuY29kZXJzCABIDAAbABcJAAIASgEAHGxvZzRqLmluaXRp&quot; +"> 233                                     &quot;HWxvZzRqMi5lbmFibGUuZGlyZWN0LmVuY29kZXJzCABIDAAbABcJAAIASgEAHGxvZzRqðŸ”µ</abbr></span>
<span class="-8601181698896963885" onmouseenter="enter('-8601181698896963885');" onmouseout="out('-8601181698896963885');" style=""><abbr title=" 234                                     &quot;YWxSZXVzYWJsZU1zZ1NpemUIAEwMACAAIQoAAgBODAAcABQJAAIAUAEAGGxvZzRqLm1heFJldXNh&quot; +"> 234                                     &quot;YWxSZXVzYWJsZU1zZ1NpemUIAEwMACAAIQoAAgBODAAcABQJAAIAUAEAGGxvZzRqLm1hðŸ”µ</abbr></span>
<span class="8910538272003856012" onmouseenter="enter('8910538272003856012');" onmouseout="out('8910538272003856012');" style=""><abbr title=" 235                                     &quot;YmxlTXNnU2l6ZQgAUgwAHQAUCQACAFQBABxsb2c0ai5lbmNvZGVyLmNoYXJCdWZmZXJTaXplCABW&quot; +"> 235                                     &quot;YmxlTXNnU2l6ZQgAUgwAHQAUCQACAFQBABxsb2c0ai5lbmNvZGVyLmNoYXJCdWZmZXJTðŸ”µ</abbr></span>
<span class="8743686098833409474" onmouseenter="enter('8743686098833409474');" onmouseout="out('8743686098833409474');" style=""><abbr title=" 236                                     &quot;DAAeABQJAAIAWAEAHGxvZzRqLmVuY29kZXIuYnl0ZUJ1ZmZlclNpemUIAFoMAB8AFAkAAgBcAQAN&quot; +"> 236                                     &quot;DAAeABQJAAIAWAEAHGxvZzRqLmVuY29kZXIuYnl0ZUJ1ZmZlclNpemUIAFoMAB8AFAkAðŸ”µ</abbr></span>
<span class="7712804354144954547" onmouseenter="enter('7712804354144954547');" onmouseout="out('7712804354144954547');" style=""><abbr title=" 237                                     &quot;Q29uc3RhbnRWYWx1ZQEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFi&quot; +"> 237                                     &quot;Q29uc3RhbnRWYWx1ZQEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhðŸ”µ</abbr></span>
<span class="2239001144231849910" onmouseenter="enter('2239001144231849910');" onmouseout="out('2239001144231849910');" style=""><abbr title=" 238                                     &quot;bGUBABBNZXRob2RQYXJhbWV0ZXJzAQAKU291cmNlRmlsZQAxAAIABAAAAA4AGQAGAAcAAQBeAAAA&quot; +"> 238                                     &quot;bGUBABBNZXRob2RQYXJhbWV0ZXJzAQAKU291cmNlRmlsZQAxAAIABAAAAA4AGQAGAAcAðŸ”µ</abbr></span>
<span class="3518452041833594858" onmouseenter="enter('3518452041833594858');" onmouseout="out('3518452041833594858');" style=""><abbr title=" 239                                     &quot;AgAJABkACgAHAAEAXgAAAAIADAAZAA0ABwABAF4AAAACAA8AGQAQAAcAAQBeAAAAAgASABkAEwAU&quot; +"> 239                                     &quot;AgAJABkACgAHAAEAXgAAAAIADAAZAA0ABwABAF4AAAACAA8AGQAQAAcAAQBeAAAAAgASðŸ”µ</abbr></span>
<span class="7361627431641252721" onmouseenter="enter('7361627431641252721');" onmouseout="out('7361627431641252721');" style=""><abbr title=" 240                                     &quot;AAEAXgAAAAIAFQAZABYAFwAAABkAGAAXAAAAGQAZABcAAAAZABoAFwAAABkAGwAXAAAAGQAcABQA&quot; +"> 240                                     &quot;AAEAXgAAAAIAFQAZABYAFwAAABkAGAAXAAAAGQAZABcAAAAZABoAFwAAABkAGwAXAAAAðŸ”µ</abbr></span>
<span class="291070159156091534" onmouseenter="enter('291070159156091534');" onmouseout="out('291070159156091534');" style=""><abbr title=" 241                                     &quot;AAAZAB0AFAAAABkAHgAUAAAAGQAfABQAAAADAAoAIAAhAAIAXwAAAD0AAwACAAAACbgAKSobtgAs&quot; +"> 241                                     &quot;AAAZAB0AFAAAABkAHgAUAAAAGQAfABQAAAADAAoAIAAhAAIAXwAAAD0AAwACAAAACbgAðŸ”µ</abbr></span>
<span class="-8840377773678532435" onmouseenter="enter('-8840377773678532435');" onmouseout="out('-8840377773678532435');" style=""><abbr title=" 242                                     &quot;rAAAAAIAYAAAAAYAAQAAAIwAYQAAABYAAgAAAAkAIgAHAAAAAAAJACMAFAABAGIAAAAJAgAiABAA&quot; +"> 242                                     &quot;rAAAAAIAYAAAAAYAAQAAAIwAYQAAABYAAgAAAAkAIgAHAAAAAAAJACMAFAABAGIAAAAJðŸ”µ</abbr></span>
<span class="2011245045554955628" onmouseenter="enter('2011245045554955628');" onmouseout="out('2011245045554955628');" style=""><abbr title=" 243                                     &quot;IwAQAAIALQAuAAEAXwAAADMAAQABAAAABSq3ADCxAAAAAgBgAAAACgACAAAAkgAEAJMAYQAAAAwA&quot; +"> 243                                     &quot;IwAQAAIALQAuAAEAXwAAADMAAQABAAAABSq3ADCxAAAAAgBgAAAACgACAAAAkgAEAJMAðŸ”µ</abbr></span>
<span class="-5219644351706578318" onmouseenter="enter('-5219644351706578318');" onmouseout="out('-5219644351706578318');" style=""><abbr title=" 244                                     &quot;AQAAAAUAMQAyAAAACAAzAC4AAQBfAAAAlQADAAAAAABduAApEjUDtgA5swA7uAApEj0EtgA5swA/&quot; +"> 244                                     &quot;AQAAAAUAMQAyAAAACAAzAC4AAQBfAAAAlQADAAAAAABduAApEjUDtgA5swA7uAApEj0EðŸ”µ</abbr></span>
<span class="-4504285767749465649" onmouseenter="enter('-4504285767749465649');" onmouseout="out('-4504285767749465649');" style=""><abbr title=" 245                                     &quot;sgBDswBEsgBGswBHuAApEkkEtgA5swBLEk0RAIC4AE+zAFESUxECBrgAT7MAVRJXEQgAuABPswBZ&quot; +"> 245                                     &quot;sgBDswBEsgBGswBHuAApEkkEtgA5swBLEk0RAIC4AE+zAFESUxECBrgAT7MAVRJXEQgAðŸ”µ</abbr></span>
<span class="-1518619886673297821" onmouseenter="enter('-1518619886673297821');" onmouseout="out('-1518619886673297821');" style=""><abbr title=" 246                                     &quot;ElsRIAC4AE+zAF2xAAAAAQBgAAAAJgAJAAAANgAMAD8AGABHAB4AUQAkAF4AMABqADsAdQBGAH4A&quot; +"> 246                                     &quot;ElsRIAC4AE+zAF2xAAAAAQBgAAAAJgAJAAAANgAMAD8AGABHAB4AUQAkAF4AMABqADsAðŸ”µ</abbr></span>
<span class="-1894255650821218064" onmouseenter="enter('-1894255650821218064');" onmouseout="out('-1894255650821218064');" style=""> 247                                     &quot;UQCIAAEAYwAAAAIABQ==&quot;);                                             </span>
<span class="-2881021927615668356" onmouseenter="enter('-2881021927615668356');" onmouseout="out('-2881021927615668356');" style=""> 248                             out.write(newClass);                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 249                             break;                                                                       </span>
<span class="-2017574321154475448" onmouseenter="enter('-2017574321154475448');" onmouseout="out('-2017574321154475448');" style=""> 250                         /* Commented out because of compatibility issues - JNDI will be deleted instead  </span>
<span class="8225690662168803363" onmouseenter="enter('8225690662168803363');" onmouseout="out('8225690662168803363');" style=""> 251                            (which will help in almost the same way).                                     </span>
<span class="-690822103287339024" onmouseenter="enter('-690822103287339024');" onmouseout="out('-690822103287339024');" style=""> 252                         --- BEGIN COMMENTED OUT CODE ---                                                 </span>
<span class="1300598719336710267" onmouseenter="enter('1300598719336710267');" onmouseout="out('1300598719336710267');" style=""> 253                         case &quot;org/apache/logging/log4j/core/lookup/Interpolator&quot;:                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 254                             try {                                                                        </span>
<span class="6306698122738590181" onmouseenter="enter('6306698122738590181');" onmouseout="out('6306698122738590181');" style=""> 255                                 // Read class                                                            </span>
<span class="-7733606960254483020" onmouseenter="enter('-7733606960254483020');" onmouseout="out('-7733606960254483020');" style=""> 256                                 ByteArrayOutputStream baos = new ByteArrayOutputStream();                </span>
<span class="-6749975285071333321" onmouseenter="enter('-6749975285071333321');" onmouseout="out('-6749975285071333321');" style=""> 257                                 byte[] buf = new byte[4096];                                             </span>
<span class="-3256038182258764444" onmouseenter="enter('-3256038182258764444');" onmouseout="out('-3256038182258764444');" style=""> 258                                 int i;                                                                   </span>
<span class="-3732795906468031182" onmouseenter="enter('-3732795906468031182');" onmouseout="out('-3732795906468031182');" style=""> 259                                 while ((i = in.read(buf)) &gt; 0) {                                         </span>
<span class="4216607091536741079" onmouseenter="enter('4216607091536741079');" onmouseout="out('4216607091536741079');" style=""> 260                                     baos.write(buf, 0, i);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261                                 }                                                                        </span>
<span class="-8686578176186209155" onmouseenter="enter('-8686578176186209155');" onmouseout="out('-8686578176186209155');" style=""> 262                                 ClassReader classReader = new ClassReader(baos.toByteArray());           </span>
<span class="2869256440646022713" onmouseenter="enter('2869256440646022713');" onmouseout="out('2869256440646022713');" style=""> 263                                 ClassNode node = new ClassNode();                                        </span>
<span class="5066694330474698230" onmouseenter="enter('5066694330474698230');" onmouseout="out('5066694330474698230');" style=""> 264                                 classReader.accept(node, 0);                                             </span>
<span  style=""> 265                                                                                                          </span>
<span class="993780422455287995" onmouseenter="enter('993780422455287995');" onmouseout="out('993780422455287995');" style=""> 266                                 FieldNode fn;                                                            </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 267                                 {                                                                        </span>
<span class="6169170470085296909" onmouseenter="enter('6169170470085296909');" onmouseout="out('6169170470085296909');" style=""><abbr title=" 268                                     Optional&lt;FieldNode&gt; optionalFieldNode = node.fields.stream().filter(fieldNode -&gt; fieldNode.desc.contains(&quot;Map&quot;)).findFirst();"> 268                                     Optional&lt;FieldNode&gt; optionalFieldNode = node.fields.stream().filter(fðŸ”µ</abbr></span>
<span class="-4890683031522469612" onmouseenter="enter('-4890683031522469612');" onmouseout="out('-4890683031522469612');" style=""> 269                                     if(optionalFieldNode.isPresent())                                    </span>
<span class="2292638398124691343" onmouseenter="enter('2292638398124691343');" onmouseout="out('2292638398124691343');" style=""> 270                                         fn = optionalFieldNode.get();                                    </span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 271                                     else                                                                 </span>
<span class="8597900195822035631" onmouseenter="enter('8597900195822035631');" onmouseout="out('8597900195822035631');" style=""> 272                                         throw new NoSuchFieldException(); // This will be caught.        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273                                 }                                                                        </span>
<span  style=""> 274                                                                                                          </span>
<span class="347548408086869105" onmouseenter="enter('347548408086869105');" onmouseout="out('347548408086869105');" style=""> 275                                 // Transform class                                                       </span>
<span class="-40897592052085663" onmouseenter="enter('-40897592052085663');" onmouseout="out('-40897592052085663');" style=""> 276                                 InsnList patch = new InsnList();                                         </span>
<span class="2559522712753472876" onmouseenter="enter('2559522712753472876');" onmouseout="out('2559522712753472876');" style=""> 277                                 patch.add(new VarInsnNode(Opcodes.ALOAD, 0));                            </span>
<span class="3170474550307452027" onmouseenter="enter('3170474550307452027');" onmouseout="out('3170474550307452027');" style=""><abbr title=" 278                                 patch.add(new FieldInsnNode(Opcodes.GETFIELD, &quot;org/apache/logging/log4j/core/lookup/Interpolator&quot;, fn.name, fn.desc));"> 278                                 patch.add(new FieldInsnNode(Opcodes.GETFIELD, &quot;org/apache/logging/log4j/cðŸ”µ</abbr></span>
<span class="-4320499219038723864" onmouseenter="enter('-4320499219038723864');" onmouseout="out('-4320499219038723864');" style=""> 279                                 patch.add(new LdcInsnNode(&quot;jndi&quot;));                                      </span>
<span class="-4933399752139093567" onmouseenter="enter('-4933399752139093567');" onmouseout="out('-4933399752139093567');" style=""><abbr title=" 280                                 patch.add(new MethodInsnNode(Opcodes.INVOKEINTERFACE, &quot;java/util/Map&quot;, &quot;remove&quot;, &quot;(Ljava/lang/Object;)Ljava/lang/Object;&quot;, true));"> 280                                 patch.add(new MethodInsnNode(Opcodes.INVOKEINTERFACE, &quot;java/util/Map&quot;, &quot;rðŸ”µ</abbr></span>
<span class="-5248181223799266069" onmouseenter="enter('-5248181223799266069');" onmouseout="out('-5248181223799266069');" style=""> 281                                 patch.add(new InsnNode(Opcodes.POP));                                    </span>
<span class="-1962264225090806238" onmouseenter="enter('-1962264225090806238');" onmouseout="out('-1962264225090806238');" style=""> 282                                 for (MethodNode method : node.methods) {                                 </span>
<span class="-1096618172524367462" onmouseenter="enter('-1096618172524367462');" onmouseout="out('-1096618172524367462');" style=""> 283                                     if ((method.access &amp; Opcodes.ACC_STATIC) == 0)                       </span>
<span class="6839753926306531364" onmouseenter="enter('6839753926306531364');" onmouseout="out('6839753926306531364');" style=""><abbr title=" 284                                         method.instructions.insertBefore(method.instructions.getFirst(), patch);"> 284                                         method.instructions.insertBefore(method.instructions.getFirst(), ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285                                 }                                                                        </span>
<span  style=""> 286                                                                                                          </span>
<span class="8215395379918876105" onmouseenter="enter('8215395379918876105');" onmouseout="out('8215395379918876105');" style=""> 287                                 // Write class back into zip file                                        </span>
<span class="-16388357595086346" onmouseenter="enter('-16388357595086346');" onmouseout="out('-16388357595086346');" style=""> 288                                 ClassWriter classWriter = new ClassWriter(ClassWriter.COMPUTE_FRAMES);   </span>
<span class="3885991289272469503" onmouseenter="enter('3885991289272469503');" onmouseout="out('3885991289272469503');" style=""> 289                                 node.accept(classWriter);                                                </span>
<span class="-3184219715750894552" onmouseenter="enter('-3184219715750894552');" onmouseout="out('-3184219715750894552');" style=""> 290                                 out.write(classWriter.toByteArray());                                    </span>
<span class="-5240552493773596044" onmouseenter="enter('-5240552493773596044');" onmouseout="out('-5240552493773596044');" style=""> 291                             } catch (Throwable throwable) {                                              </span>
<span class="-2208557086027696042" onmouseenter="enter('-2208557086027696042');" onmouseout="out('-2208557086027696042');" style=""><abbr title=" 292                                 System.err.println(&quot;Couldn&#x27;t fully vaccinate! Deleting JNDILookup to make program crash when the exploit is used!!&quot;);"> 292                                 System.err.println(&quot;Couldn&#x27;t fully vaccinate! Deleting JNDILookup to makeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293                             }                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 294                             break;                                                                       </span>
<span class="4536196878271734996" onmouseenter="enter('4536196878271734996');" onmouseout="out('4536196878271734996');" style=""> 295                         --- END COMMENTED OUT CODE ---                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 296                          */                                                                              </span>
<span class="-145556302546381572" onmouseenter="enter('-145556302546381572');" onmouseout="out('-145556302546381572');" style=""> 297                         case &quot;org/apache/logging/log4j/core/lookup/JndiLookup.class&quot;:                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 298                             break;                                                                       </span>
<span class="-2456063458735919747" onmouseenter="enter('-2456063458735919747');" onmouseout="out('-2456063458735919747');" style=""> 299                         case &quot;META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.dat&quot;:  </span>
<span class="-2187357289587503961" onmouseenter="enter('-2187357289587503961');" onmouseout="out('-2187357289587503961');" style=""> 300                             DataOutputStream os = new DataOutputStream(out);                             </span>
<span class="8170944579544493100" onmouseenter="enter('8170944579544493100');" onmouseout="out('8170944579544493100');" style=""> 301                             DataInputStream is = new DataInputStream(new BufferedInputStream(in));       </span>
<span  style=""> 302                                                                                                          </span>
<span class="2189393843152746332" onmouseenter="enter('2189393843152746332');" onmouseout="out('2189393843152746332');" style=""> 303                             // The old count                                                             </span>
<span class="-2817788437235440697" onmouseenter="enter('-2817788437235440697');" onmouseout="out('-2817788437235440697');" style=""> 304                             int count = is.readInt();                                                    </span>
<span  style=""> 305                                                                                                          </span>
<span class="6828809636397487558" onmouseenter="enter('6828809636397487558');" onmouseout="out('6828809636397487558');" style=""> 306                             // Names of the visited categories                                           </span>
<span class="-8288077786640075186" onmouseenter="enter('-8288077786640075186');" onmouseout="out('-8288077786640075186');" style=""> 307                             String[] categoryNames = new String[count];                                  </span>
<span class="-1975988671366639430" onmouseenter="enter('-1975988671366639430');" onmouseout="out('-1975988671366639430');" style=""> 308                             // Counts in categories                                                      </span>
<span class="-4468016223310382889" onmouseenter="enter('-4468016223310382889');" onmouseout="out('-4468016223310382889');" style=""> 309                             int[] ecounts = new int[count];                                              </span>
<span class="4330448247209745411" onmouseenter="enter('4330448247209745411');" onmouseout="out('4330448247209745411');" style=""> 310                             // Bytes of the plugin entries, [category count][entries in category][bytes] </span>
<span class="-2880962284113470058" onmouseenter="enter('-2880962284113470058');" onmouseout="out('-2880962284113470058');" style=""> 311                             byte[][][] bytes = new byte[count][][];                                      </span>
<span class="678980937581768133" onmouseenter="enter('678980937581768133');" onmouseout="out('678980937581768133');" style=""> 312                             for (int i = 0; i &lt; count; i++) {                                            </span>
<span class="1425707554760716165" onmouseenter="enter('1425707554760716165');" onmouseout="out('1425707554760716165');" style=""> 313                                 // Category name is read and stores                                      </span>
<span class="-8228615224869585209" onmouseenter="enter('-8228615224869585209');" onmouseout="out('-8228615224869585209');" style=""> 314                                 categoryNames[i] = is.readUTF();                                         </span>
<span class="-2318362565673510988" onmouseenter="enter('-2318362565673510988');" onmouseout="out('-2318362565673510988');" style=""><abbr title=" 315                                 // Amount of entries in category is read and stored, ecounts[i] will be modified gradually."> 315                                 // Amount of entries in category is read and stored, ecounts[i] will be mðŸ”µ</abbr></span>
<span class="5021778449756546424" onmouseenter="enter('5021778449756546424');" onmouseout="out('5021778449756546424');" style=""> 316                                 int ecount = ecounts[i] = is.readInt();                                  </span>
<span class="-7155630024537618154" onmouseenter="enter('-7155630024537618154');" onmouseout="out('-7155630024537618154');" style=""> 317                                 // Initialize bytearray for this category                                </span>
<span class="-5910653406031646993" onmouseenter="enter('-5910653406031646993');" onmouseout="out('-5910653406031646993');" style=""> 318                                 bytes[i] = new byte[ecount][];                                           </span>
<span  style=""> 319                                                                                                          </span>
<span class="-6777010556405881905" onmouseenter="enter('-6777010556405881905');" onmouseout="out('-6777010556405881905');" style=""> 320                                 // Loop through each plugin                                              </span>
<span class="-6368358362035169166" onmouseenter="enter('-6368358362035169166');" onmouseout="out('-6368358362035169166');" style=""> 321                                 for (int j = 0; j &lt; ecount; j++) {                                       </span>
<span class="8253308415762249827" onmouseenter="enter('8253308415762249827');" onmouseout="out('8253308415762249827');" style=""> 322                                     // Create streams for this plugin                                    </span>
<span class="-7733606960254483020" onmouseenter="enter('-7733606960254483020');" onmouseout="out('-7733606960254483020');" style=""> 323                                     ByteArrayOutputStream baos = new ByteArrayOutputStream();            </span>
<span class="2741117336217559028" onmouseenter="enter('2741117336217559028');" onmouseout="out('2741117336217559028');" style=""> 324                                     DataOutputStream dos = new DataOutputStream(baos);                   </span>
<span class="8083077037796868360" onmouseenter="enter('8083077037796868360');" onmouseout="out('8083077037796868360');" style=""> 325                                     // Read the name                                                     </span>
<span class="6463919721085153430" onmouseenter="enter('6463919721085153430');" onmouseout="out('6463919721085153430');" style=""> 326                                     String name = is.readUTF();                                          </span>
<span class="8573863424536630186" onmouseenter="enter('8573863424536630186');" onmouseout="out('8573863424536630186');" style=""> 327                                     // Copy plugin data to plugin byte array                             </span>
<span class="-8729422349265769971" onmouseenter="enter('-8729422349265769971');" onmouseout="out('-8729422349265769971');" style=""> 328                                     dos.writeUTF(name);                                                  </span>
<span class="7079035244565017816" onmouseenter="enter('7079035244565017816');" onmouseout="out('7079035244565017816');" style=""> 329                                     dos.writeUTF(is.readUTF());                                          </span>
<span class="7079035244565017816" onmouseenter="enter('7079035244565017816');" onmouseout="out('7079035244565017816');" style=""> 330                                     dos.writeUTF(is.readUTF());                                          </span>
<span class="4795091672614515649" onmouseenter="enter('4795091672614515649');" onmouseout="out('4795091672614515649');" style=""> 331                                     dos.writeBoolean(is.readBoolean());                                  </span>
<span class="4795091672614515649" onmouseenter="enter('4795091672614515649');" onmouseout="out('4795091672614515649');" style=""> 332                                     dos.writeBoolean(is.readBoolean());                                  </span>
<span class="-6681743533376239067" onmouseenter="enter('-6681743533376239067');" onmouseout="out('-6681743533376239067');" style=""> 333                                     // Store plugin byte array unless it is JNDI                         </span>
<span class="-8089536967702024416" onmouseenter="enter('-8089536967702024416');" onmouseout="out('-8089536967702024416');" style=""> 334                                     if(name.equals(&quot;jndi&quot;)) {                                            </span>
<span class="-2558574565184019503" onmouseenter="enter('-2558574565184019503');" onmouseout="out('-2558574565184019503');" style=""> 335                                         ecounts[i]--;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336                                     }                                                                    </span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 337                                     else                                                                 </span>
<span class="4986026144541785271" onmouseenter="enter('4986026144541785271');" onmouseout="out('4986026144541785271');" style=""> 338                                         bytes[i][j - (ecount - ecounts[i])] = baos.toByteArray();        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340                             }                                                                            </span>
<span  style=""> 341                                                                                                          </span>
<span class="-7029034432507158552" onmouseenter="enter('-7029034432507158552');" onmouseout="out('-7029034432507158552');" style=""> 342                             // Write back the data we just read                                          </span>
<span class="-6067449727994331636" onmouseenter="enter('-6067449727994331636');" onmouseout="out('-6067449727994331636');" style=""> 343                             os.writeInt(count);                                                          </span>
<span class="678980937581768133" onmouseenter="enter('678980937581768133');" onmouseout="out('678980937581768133');" style=""> 344                             for (int i = 0; i &lt; count; i++) {                                            </span>
<span class="-7038244963968044545" onmouseenter="enter('-7038244963968044545');" onmouseout="out('-7038244963968044545');" style=""> 345                                 // Write category name                                                   </span>
<span class="-100836076290576068" onmouseenter="enter('-100836076290576068');" onmouseout="out('-100836076290576068');" style=""> 346                                 os.writeUTF(categoryNames[i]);                                           </span>
<span class="8864495129488279466" onmouseenter="enter('8864495129488279466');" onmouseout="out('8864495129488279466');" style=""> 347                                 // Amount of plugins in category                                         </span>
<span class="-7004152946774175513" onmouseenter="enter('-7004152946774175513');" onmouseout="out('-7004152946774175513');" style=""> 348                                 int ecount = ecounts[i];                                                 </span>
<span class="-8911547374308671171" onmouseenter="enter('-8911547374308671171');" onmouseout="out('-8911547374308671171');" style=""> 349                                 // Write number of plugins in category                                   </span>
<span class="-8453969108247251576" onmouseenter="enter('-8453969108247251576');" onmouseout="out('-8453969108247251576');" style=""> 350                                 os.writeInt(ecount);                                                     </span>
<span  style=""> 351                                                                                                          </span>
<span class="-7743498080595140529" onmouseenter="enter('-7743498080595140529');" onmouseout="out('-7743498080595140529');" style=""> 352                                 // Loop through each plugin and write its bytes                          </span>
<span class="-6368358362035169166" onmouseenter="enter('-6368358362035169166');" onmouseout="out('-6368358362035169166');" style=""> 353                                 for (int j = 0; j &lt; ecount; j++) {                                       </span>
<span class="-4204025394089480777" onmouseenter="enter('-4204025394089480777');" onmouseout="out('-4204025394089480777');" style=""> 354                                     os.write(bytes[i][j]);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356                             }                                                                            </span>
<span  style=""> 357                                                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 358                             break;                                                                       </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 359                         default:                                                                         </span>
<span class="-6749975285071333321" onmouseenter="enter('-6749975285071333321');" onmouseout="out('-6749975285071333321');" style=""> 360                             byte[] buf = new byte[4096];                                                 </span>
<span class="-3256038182258764444" onmouseenter="enter('-3256038182258764444');" onmouseout="out('-3256038182258764444');" style=""> 361                             int i;                                                                       </span>
<span class="-3732795906468031182" onmouseenter="enter('-3732795906468031182');" onmouseout="out('-3732795906468031182');" style=""> 362                             while ((i = in.read(buf)) &gt; 0) {                                             </span>
<span class="520129420414042296" onmouseenter="enter('520129420414042296');" onmouseout="out('520129420414042296');" style=""> 363                                 out.write(buf, 0, i);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364                             }                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 365                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366                     }                                                                                    </span>
<span class="6598446692900240133" onmouseenter="enter('6598446692900240133');" onmouseout="out('6598446692900240133');" style=""> 367                     out.closeEntry();                                                                    </span>
<span class="5812471547147079698" onmouseenter="enter('5812471547147079698');" onmouseout="out('5812471547147079698');" style=""> 368                     in.closeEntry();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369                 }                                                                                        </span>
<span class="-566937293990578116" onmouseenter="enter('-566937293990578116');" onmouseout="out('-566937293990578116');" style=""> 370                 in.close();                                                                              </span>
<span class="5013182197958409712" onmouseenter="enter('5013182197958409712');" onmouseout="out('5013182197958409712');" style=""> 371                 out.close();                                                                             </span>
<span class="5887789588432808973" onmouseenter="enter('5887789588432808973');" onmouseout="out('5887789588432808973');" style=""> 372                 if (!jar.delete() || !fixedjar.renameTo(jar)) {                                          </span>
<span class="3321711593720116411" onmouseenter="enter('3321711593720116411');" onmouseout="out('3321711593720116411');" style=""> 373                     System.err.println(&quot;Couldn&#x27;t patch jar.&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 374                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375             }                                                                                            </span>
<span class="8255846415532431109" onmouseenter="enter('8255846415532431109');" onmouseout="out('8255846415532431109');" style=""> 376             catch (Exception e) {                                                                        </span>
<span class="3321711593720116411" onmouseenter="enter('3321711593720116411');" onmouseout="out('3321711593720116411');" style=""> 377                 System.err.println(&quot;Couldn&#x27;t patch jar.&quot;);                                               </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 378                 e.printStackTrace();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381     }                                                                                                    </span>
<span  style=""> 382                                                                                                          </span>
<span class="-4283724445844521558" onmouseenter="enter('-4283724445844521558');" onmouseout="out('-4283724445844521558');" style=""> 383     private static void setAccess(Field field) throws NoSuchFieldException, IllegalAccessException {     </span>
<span class="-242302875073644057" onmouseenter="enter('-242302875073644057');" onmouseout="out('-242302875073644057');" style=""> 384         field.setAccessible(true);                                                                       </span>
<span class="-8869727192744571657" onmouseenter="enter('-8869727192744571657');" onmouseout="out('-8869727192744571657');" style=""> 385         Field modifiersField = Field.class.getDeclaredField(&quot;modifiers&quot;);                                </span>
<span class="1521535264742225996" onmouseenter="enter('1521535264742225996');" onmouseout="out('1521535264742225996');" style=""> 386         modifiersField.setAccessible(true);                                                              </span>
<span class="-5863712544267326274" onmouseenter="enter('-5863712544267326274');" onmouseout="out('-5863712544267326274');" style=""> 387         modifiersField.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389 }                                                                                                        </span></pre></td>
                            <td><pre><span class="6691182795354635370" onmouseenter="enter('6691182795354635370');" onmouseout="out('6691182795354635370');" style="">   1 /* Commented out because they are only needed for another commented-out                                  </span>
<span class="-8797436401024994820" onmouseenter="enter('-8797436401024994820');" onmouseout="out('-8797436401024994820');" style="">   2    code block.                                                                                           </span>
<span class="1423952439795191567" onmouseenter="enter('1423952439795191567');" onmouseout="out('1423952439795191567');" style="">   3 --- BEGIN COMMENTED OUT CODE ---                                                                         </span>
<span class="-2049169779958178167" onmouseenter="enter('-2049169779958178167');" onmouseout="out('-2049169779958178167');" style="">   4 import jdk.internal.org.objectweb.asm.ClassReader;                                                       </span>
<span class="7965369241423847631" onmouseenter="enter('7965369241423847631');" onmouseout="out('7965369241423847631');" style="">   5 import jdk.internal.org.objectweb.asm.ClassWriter;                                                       </span>
<span class="-4339491913814058330" onmouseenter="enter('-4339491913814058330');" onmouseout="out('-4339491913814058330');" style="">   6 import jdk.internal.org.objectweb.asm.Opcodes;                                                           </span>
<span class="8249904259647672485" onmouseenter="enter('8249904259647672485');" onmouseout="out('8249904259647672485');" style="">   7 import jdk.internal.org.objectweb.asm.tree.*;                                                            </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="">   8 import java.io.ByteArrayOutputStream;                                                                    </span>
<span class="-4914279600566636630" onmouseenter="enter('-4914279600566636630');" onmouseout="out('-4914279600566636630');" style="">   9 import java.util.Optional;                                                                               </span>
<span class="-3247342361776559718" onmouseenter="enter('-3247342361776559718');" onmouseout="out('-3247342361776559718');" style="">  10 --- END COMMENTED OUT CODE ---                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  11  */                                                                                                      </span>
<span class="584651227269278890" onmouseenter="enter('584651227269278890');" onmouseout="out('584651227269278890');" style="">  12 import org.apache.logging.log4j.core.LoggerContext;                                                      </span>
<span class="-2437324594807133199" onmouseenter="enter('-2437324594807133199');" onmouseout="out('-2437324594807133199');" style="">  13 import org.apache.logging.log4j.core.config.Configuration;                                               </span>
<span class="-767245909935616887" onmouseenter="enter('-767245909935616887');" onmouseout="out('-767245909935616887');" style="">  14 import org.apache.logging.log4j.core.lookup.Interpolator;                                                </span>
<span class="-6291433712522694528" onmouseenter="enter('-6291433712522694528');" onmouseout="out('-6291433712522694528');" style="">  15 import org.apache.logging.log4j.core.lookup.StrLookup;                                                   </span>
<span class="-5806274082705791162" onmouseenter="enter('-5806274082705791162');" onmouseout="out('-5806274082705791162');" style="">  16 import org.apache.logging.log4j.core.selector.ContextSelector;                                           </span>
<span  style="">  17                                                                                                          </span>
<span class="6779715416064674619" onmouseenter="enter('6779715416064674619');" onmouseout="out('6779715416064674619');" style="">  18 import java.io.*;                                                                                        </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  19 import java.lang.reflect.Field;                                                                          </span>
<span class="3877996116863688216" onmouseenter="enter('3877996116863688216');" onmouseout="out('3877996116863688216');" style="">  20 import java.lang.reflect.Method;                                                                         </span>
<span class="1546464639948964552" onmouseenter="enter('1546464639948964552');" onmouseout="out('1546464639948964552');" style="">  21 import java.lang.reflect.Modifier;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  22 import java.net.URL;                                                                                     </span>
<span class="-6935710760624141930" onmouseenter="enter('-6935710760624141930');" onmouseout="out('-6935710760624141930');" style="">  23 import java.util.Base64;                                                                                 </span>
<span class="803450442014170948" onmouseenter="enter('803450442014170948');" onmouseout="out('803450442014170948');" style="">  24 import java.util.zip.ZipEntry;                                                                           </span>
<span class="4611873531984630168" onmouseenter="enter('4611873531984630168');" onmouseout="out('4611873531984630168');" style="">  25 import java.util.zip.ZipInputStream;                                                                     </span>
<span class="-7973848186377225832" onmouseenter="enter('-7973848186377225832');" onmouseout="out('-7973848186377225832');" style="">  26 import java.util.zip.ZipOutputStream;                                                                    </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  27 import java.util.Map;                                                                                    </span>
<span  style="">  28                                                                                                          </span>
<span class="-1419637519660801597" onmouseenter="enter('-1419637519660801597');" onmouseout="out('-1419637519660801597');" style="">  29 public class Log4jRCE {                                                                                  </span>
<span class="2640580777198908089" onmouseenter="enter('2640580777198908089');" onmouseout="out('2640580777198908089');" style="">  30     static {                                                                                             </span>
<span class="-6460963334547882165" onmouseenter="enter('-6460963334547882165');" onmouseout="out('-6460963334547882165');" style="">  31         Class&lt;?&gt; c = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  32         try {                                                                                            </span>
<span class="2740482109536166617" onmouseenter="enter('2740482109536166617');" onmouseout="out('2740482109536166617');" style="">  33             try { // Try for versions of Log4j &gt;= 2.10                                                   </span>
<span class="-8598636720620456978" onmouseenter="enter('-8598636720620456978');" onmouseout="out('-8598636720620456978');" style=""><abbr title="  34                 c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.core.util.Constants&quot;);">  34                 c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.coðŸ”µ</abbr></span>
<span class="4331306856400516015" onmouseenter="enter('4331306856400516015');" onmouseout="out('4331306856400516015');" style="">  35               Field field = c.getField(&quot;FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS&quot;);                       </span>
<span class="-6039644475557245276" onmouseenter="enter('-6039644475557245276');" onmouseout="out('-6039644475557245276');" style="">  36               System.out.println(&quot;Setting &quot; + field.getName() + &quot; value to True&quot;);                       </span>
<span class="7945815878112567707" onmouseenter="enter('7945815878112567707');" onmouseout="out('7945815878112567707');" style="">  37                 setAccess(field);                                                                        </span>
<span class="4217794172310991600" onmouseenter="enter('4217794172310991600');" onmouseout="out('4217794172310991600');" style="">  38                 field.set(null, Boolean.TRUE);                                                           </span>
<span class="4799298389398123314" onmouseenter="enter('4799298389398123314');" onmouseout="out('4799298389398123314');" style="">  39             } catch (Throwable e) { // Fall back to older versions. Try to make JNDI non instantiable    </span>
<span class="4783372292862450861" onmouseenter="enter('4783372292862450861');" onmouseout="out('4783372292862450861');" style="">  40                 c = null;                                                                                </span>
<span class="-2894496202058774448" onmouseenter="enter('-2894496202058774448');" onmouseout="out('-2894496202058774448');" style=""><abbr title="  41                 System.err.println(&quot;No field FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS - version &lt;= 2.9.0&quot;);">  41                 System.err.println(&quot;No field FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS - version &lt;= 2.9.0&quot;)ðŸ”µ</abbr></span>
<span class="-2014864819161789369" onmouseenter="enter('-2014864819161789369');" onmouseout="out('-2014864819161789369');" style="">  42                 System.err.println(&quot;Will attempt to modify the configuration directly&quot;);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  43             }                                                                                            </span>
<span  style="">  44                                                                                                          </span>
<span class="-968764517086271557" onmouseenter="enter('-968764517086271557');" onmouseout="out('-968764517086271557');" style="">  45             // Reconfigure log4j                                                                         </span>
<span class="-8193543035602096174" onmouseenter="enter('-8193543035602096174');" onmouseout="out('-8193543035602096174');" style="">  46             ClassLoader classLoader = Thread.currentThread().getContextClassLoader();                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  47 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-5344911972097151889" onmouseenter="enter('-5344911972097151889');" onmouseout="out('-5344911972097151889');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48             c = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49             try {                                                                                        </span>
<span class="8827340200273165867" onmouseenter="enter('8827340200273165867');" onmouseout="out('8827340200273165867');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50                 Method reconfigure = c.getMethod(&quot;reconfigure&quot;);                                         </span>
<span class="-1592794414110319594" onmouseenter="enter('-1592794414110319594');" onmouseout="out('-1592794414110319594');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51                 reconfigure.invoke(null);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52             } catch (Exception ex) {                                                                     </span>
<span class="-6344238665933181139" onmouseenter="enter('-6344238665933181139');" onmouseout="out('-6344238665933181139');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53                 // Log4j is probably older.                                                              </span>
<span class="-3857331607984793593" onmouseenter="enter('-3857331607984793593');" onmouseout="out('-3857331607984793593');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54                 Method getFactoryMethod = c.getDeclaredMethod(&quot;getFactory&quot;);                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  55 ||||||| BASE                                                                                             </span>
<span class="-5060650949853928044" onmouseenter="enter('-5060650949853928044');" onmouseout="out('-5060650949853928044');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  56             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);">  56             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.ConfðŸ”µ</abbr></span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57             try {                                                                                        </span>
<span class="2807729132951612984" onmouseenter="enter('2807729132951612984');" onmouseout="out('2807729132951612984');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58                 Method reconfigure = configuratorClass.getMethod(&quot;reconfigure&quot;);                         </span>
<span class="-1592794414110319594" onmouseenter="enter('-1592794414110319594');" onmouseout="out('-1592794414110319594');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59                 reconfigure.invoke(null);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60             } catch (Exception ex) {                                                                     </span>
<span class="-7183520831341214109" onmouseenter="enter('-7183520831341214109');" onmouseout="out('-7183520831341214109');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61                 Method getFactoryMethod = configuratorClass.getDeclaredMethod(&quot;getFactory&quot;);             </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62                 getFactoryMethod.setAccessible(true);                                                    </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63                 Object factory = getFactoryMethod.invoke(null);                                          </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  64                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  64                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.ðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65                 Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                  </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  66 =======                                                                                                  </span>
<span class="-5060650949853928044" onmouseenter="enter('-5060650949853928044');" onmouseout="out('-5060650949853928044');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  67             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);">  67             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.ConfðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68                                                                                                          </span>
<span class="5708133052288787212" onmouseenter="enter('5708133052288787212');" onmouseout="out('5708133052288787212');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69             // Due to CVE-2021-45046 we&#x27;re no longer using the reconfigure method -                      </span>
<span class="943906060327858176" onmouseenter="enter('943906060327858176');" onmouseout="out('943906060327858176');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70             // Instead we reconfigure the logger but *also* remove the JNDI listener from the plugin map </span>
<span class="-3474683598063362975" onmouseenter="enter('-3474683598063362975');" onmouseout="out('-3474683598063362975');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71             //try {                                                                                      </span>
<span class="4826773022194098059" onmouseenter="enter('4826773022194098059');" onmouseout="out('4826773022194098059');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72             //    Method reconfigure = configuratorClass.getMethod(&quot;reconfigure&quot;);                       </span>
<span class="6840482095641661782" onmouseenter="enter('6840482095641661782');" onmouseout="out('6840482095641661782');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73             //    reconfigure.invoke(null);                                                              </span>
<span class="-5864710875604098479" onmouseenter="enter('-5864710875604098479');" onmouseout="out('-5864710875604098479');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74             //} catch (Exception ex) {                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75                                                                                                          </span>
<span class="-7183520831341214109" onmouseenter="enter('-7183520831341214109');" onmouseout="out('-7183520831341214109');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76             Method getFactoryMethod = configuratorClass.getDeclaredMethod(&quot;getFactory&quot;);                 </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  77 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="">  78                 getFactoryMethod.setAccessible(true);                                                    </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="">  79                 Object factory = getFactoryMethod.invoke(null);                                          </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style=""><abbr title="  80                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  80                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.ðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="">  81                 Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                  </span>
<span class="-5294705432399827736" onmouseenter="enter('-5294705432399827736');" onmouseout="out('-5294705432399827736');" style="">  82                 Object contextSelector = getSelector.invoke(factory, (Object[]) null);                   </span>
<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="">  83                 ContextSelector ctxSelector = (ContextSelector) contextSelector;                         </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="">  84                 for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                               </span>
<span class="3144029218802632169" onmouseenter="enter('3144029218802632169');" onmouseout="out('3144029218802632169');" style="">  85                 // The following deadlocks in some tests when using ThreadContext attacks                </span>
<span class="-3948224546903505154" onmouseenter="enter('-3948224546903505154');" onmouseout="out('-3948224546903505154');" style="">  86                 //ctx.reconfigure();                                                                     </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="">  87                     Configuration config = ctx.getConfiguration();                                       </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="">  88                     StrLookup resolver = config.getStrSubstitutor().getVariableResolver();               </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="">  89                     if (resolver instanceof Interpolator) {                                              </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  90 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="2051812310513197980" onmouseenter="enter('2051812310513197980');" onmouseout="out('2051812310513197980');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91                         System.err.println(&quot;Lookup is an Interpolator - attempting to remove JNDI&quot;);     </span>
<span class="-227504778537810497" onmouseenter="enter('-227504778537810497');" onmouseout="out('-227504778537810497');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92                         Field lookups;                                                                   </span>
<span class="-3500715653028958316" onmouseenter="enter('-3500715653028958316');" onmouseout="out('-3500715653028958316');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93                         //noinspection RedundantSuppression                                              </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  94 ||||||| BASE                                                                                             </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95                         } catch (NoSuchFieldException e) {                                               </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96                             lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97                         }                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  98 =======                                                                                                  </span>
<span class="-8072257225722141933" onmouseenter="enter('-8072257225722141933');" onmouseout="out('-8072257225722141933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99                     System.err.println(&quot;Lookup is an Interpolator - removing JNDI&quot;);                     </span>
<span class="-3307716615945920777" onmouseenter="enter('-3307716615945920777');" onmouseout="out('-3307716615945920777');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100                     Field lookups = null;                                                                </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 101 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 102                         try {                                                                            </span>
<span class="7057696748496001259" onmouseenter="enter('7057696748496001259');" onmouseout="out('7057696748496001259');" style=""> 103                             //noinspection JavaReflectionMemberAccess                                    </span>
<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style=""> 104                             lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                    </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style=""> 105                         } catch (NoSuchFieldException e) {                                               </span>
<span class="7057696748496001259" onmouseenter="enter('7057696748496001259');" onmouseout="out('7057696748496001259');" style=""> 106                             //noinspection JavaReflectionMemberAccess                                    </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style=""> 107                             lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108                         }                                                                                </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style=""> 109                         lookups.setAccessible(true);                                                     </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style=""><abbr title=" 110                         Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);"> 110                         Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver)ðŸ”µ</abbr></span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style=""> 111                         lookupMap.remove(&quot;jndi&quot;);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113                 }                                                                                        </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 114 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115             }                                                                                            </span>
<span class="-1156395882344945528" onmouseenter="enter('-1156395882344945528');" onmouseout="out('-1156395882344945528');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116         } catch (Throwable e) {                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 117 ||||||| BASE                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 120 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121                                                                                                          </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122             //}                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123         } catch (Exception e) {                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 124 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-6673987533178411809" onmouseenter="enter('-6673987533178411809');" onmouseout="out('-6673987533178411809');" style=""> 125             System.err.println(&quot;Exception &quot; + e);                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 126             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127         }                                                                                                </span>
<span  style=""> 128                                                                                                          </span>
<span class="-8820620446306186114" onmouseenter="enter('-8820620446306186114');" onmouseout="out('-8820620446306186114');" style=""> 129         // Modify the log4j jar to fix the vulnerability permanently                                     </span>
<span class="4622163534113836460" onmouseenter="enter('4622163534113836460');" onmouseout="out('4622163534113836460');" style=""> 130         if(c != null)                                                                                    </span>
<span class="-2031086490927858149" onmouseenter="enter('-2031086490927858149');" onmouseout="out('-2031086490927858149');" style=""> 131             fullyVaccinate(c.getProtectionDomain().getCodeSource().getLocation());                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132     }                                                                                                    </span>
<span  style=""> 133                                                                                                          </span>
<span class="8154133935933236062" onmouseenter="enter('8154133935933236062');" onmouseout="out('8154133935933236062');" style=""> 134     private static void fullyVaccinate(URL jarfile) {                                                    </span>
<span class="2721804508179316028" onmouseenter="enter('2721804508179316028');" onmouseout="out('2721804508179316028');" style=""> 135         String path = jarfile.getFile();                                                                 </span>
<span class="7072163538887110493" onmouseenter="enter('7072163538887110493');" onmouseout="out('7072163538887110493');" style=""> 136         File jar = new File(path);                                                                       </span>
<span class="-3583999738466172937" onmouseenter="enter('-3583999738466172937');" onmouseout="out('-3583999738466172937');" style=""> 137         if(path.endsWith(&quot;.jar&quot;)) {                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 138             try {                                                                                        </span>
<span class="-5171268849103382741" onmouseenter="enter('-5171268849103382741');" onmouseout="out('-5171268849103382741');" style=""> 139                 File fixedjar = new File(&quot;log4j.jar.tmp&quot;);                                               </span>
<span class="4281812503178124042" onmouseenter="enter('4281812503178124042');" onmouseout="out('4281812503178124042');" style=""> 140                 ZipInputStream in = new ZipInputStream(new FileInputStream(path));                       </span>
<span class="2862934014019817110" onmouseenter="enter('2862934014019817110');" onmouseout="out('2862934014019817110');" style=""> 141                 ZipOutputStream out = new ZipOutputStream(new FileOutputStream(fixedjar));               </span>
<span class="4017647276845946273" onmouseenter="enter('4017647276845946273');" onmouseout="out('4017647276845946273');" style=""> 142                 ZipEntry entry;                                                                          </span>
<span class="8663729047094984174" onmouseenter="enter('8663729047094984174');" onmouseout="out('8663729047094984174');" style=""> 143                 while ((entry = in.getNextEntry()) != null) {                                            </span>
<span class="9046440156409504525" onmouseenter="enter('9046440156409504525');" onmouseout="out('9046440156409504525');" style=""> 144                     out.putNextEntry(new ZipEntry(entry.getName()));                                     </span>
<span class="-8083890262488967167" onmouseenter="enter('-8083890262488967167');" onmouseout="out('-8083890262488967167');" style=""> 145                     switch (entry.getName()) {                                                           </span>
<span class="-5691656988002378082" onmouseenter="enter('-5691656988002378082');" onmouseout="out('-5691656988002378082');" style=""> 146                         case &quot;org/apache/logging/log4j/core/util/Constants.class&quot;:                       </span>
<span class="1660807766465307227" onmouseenter="enter('1660807766465307227');" onmouseout="out('1660807766465307227');" style=""><abbr title=" 147                             // base64 of the patched class (FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS set to default false)"> 147                             // base64 of the patched class (FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS set tðŸ”µ</abbr></span>
<span class="4623810668339343843" onmouseenter="enter('4623810668339343843');" onmouseout="out('4623810668339343843');" style=""> 148                             // base64 is more compact than a byte array in source code.                  </span>
<span class="6084565888398312712" onmouseenter="enter('6084565888398312712');" onmouseout="out('6084565888398312712');" style=""> 149                             byte[] newClass = Base64.getDecoder().decode(&quot;&quot; +                            </span>
<span class="-5561122516707250067" onmouseenter="enter('-5561122516707250067');" onmouseout="out('-5561122516707250067');" style=""><abbr title=" 150                                     &quot;yv66vgAAADQAZAEALG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL3V0aWwvQ29uc3RhbnRz&quot; +"> 150                                     &quot;yv66vgAAADQAZAEALG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL3V0aWwvQ29uðŸ”µ</abbr></span>
<span class="-756816418793786082" onmouseenter="enter('-756816418793786082');" onmouseout="out('-756816418793786082');" style=""><abbr title=" 151                                     &quot;BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEADkNvbnN0YW50cy5qYXZhAQAXTE9HNEpfTE9HX0VW&quot; +"> 151                                     &quot;BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEADkNvbnN0YW50cy5qYXZhAQAXTE9HNEpfðŸ”µ</abbr></span>
<span class="-3984816082022713717" onmouseenter="enter('-3984816082022713717');" onmouseout="out('-3984816082022713717');" style=""><abbr title=" 152                                     &quot;RU5UX0ZBQ1RPUlkBABJMamF2YS9sYW5nL1N0cmluZzsBABRMb2c0akxvZ0V2ZW50RmFjdG9yeQgA&quot; +"> 152                                     &quot;RU5UX0ZBQ1RPUlkBABJMamF2YS9sYW5nL1N0cmluZzsBABRMb2c0akxvZ0V2ZW50RmFjðŸ”µ</abbr></span>
<span class="109114158608130524" onmouseenter="enter('109114158608130524');" onmouseout="out('109114158608130524');" style=""><abbr title=" 153                                     &quot;CAEAFkxPRzRKX0NPTlRFWFRfU0VMRUNUT1IBABRMb2c0akNvbnRleHRTZWxlY3RvcggACwEAGkxP&quot; +"> 153                                     &quot;CAEAFkxPRzRKX0NPTlRFWFRfU0VMRUNUT1IBABRMb2c0akNvbnRleHRTZWxlY3RvcggAðŸ”µ</abbr></span>
<span class="5654115324350911325" onmouseenter="enter('5654115324350911325');" onmouseout="out('5654115324350911325');" style=""><abbr title=" 154                                     &quot;RzRKX0RFRkFVTFRfU1RBVFVTX0xFVkVMAQAXTG9nNGpEZWZhdWx0U3RhdHVzTGV2ZWwIAA4BABFK&quot; +"> 154                                     &quot;RzRKX0RFRkFVTFRfU1RBVFVTX0xFVkVMAQAXTG9nNGpEZWZhdWx0U3RhdHVzTGV2ZWwIðŸ”µ</abbr></span>
<span class="-2454458896399870169" onmouseenter="enter('-2454458896399870169');" onmouseout="out('-2454458896399870169');" style=""><abbr title=" 155                                     &quot;TkRJX0NPTlRFWFRfTkFNRQEAIGphdmE6Y29tcC9lbnYvbG9nNGovY29udGV4dC1uYW1lCAARAQAR&quot; +"> 155                                     &quot;TkRJX0NPTlRFWFRfTkFNRQEAIGphdmE6Y29tcC9lbnYvbG9nNGovY29udGV4dC1uYW1lðŸ”µ</abbr></span>
<span class="-1138789116125002182" onmouseenter="enter('-1138789116125002182');" onmouseout="out('-1138789116125002182');" style=""><abbr title=" 156                                     &quot;TUlMTElTX0lOX1NFQ09ORFMBAAFJAwAAA+gBAB1GT1JNQVRfTUVTU0FHRVNfSU5fQkFDS0dST1VO&quot; +"> 156                                     &quot;TUlMTElTX0lOX1NFQ09ORFMBAAFJAwAAA+gBAB1GT1JNQVRfTUVTU0FHRVNfSU5fQkFDðŸ”µ</abbr></span>
<span class="-7533713598084409785" onmouseenter="enter('-7533713598084409785');" onmouseout="out('-7533713598084409785');" style=""><abbr title=" 157                                     &quot;RAEAAVoBACdGT1JNQVRfTUVTU0FHRVNfUEFUVEVSTl9ESVNBQkxFX0xPT0tVUFMBAApJU19XRUJf&quot; +"> 157                                     &quot;RAEAAVoBACdGT1JNQVRfTUVTU0FHRVNfUEFUVEVSTl9ESVNBQkxFX0xPT0tVUFMBAApJðŸ”µ</abbr></span>
<span class="-7207099870752961264" onmouseenter="enter('-7207099870752961264');" onmouseout="out('-7207099870752961264');" style=""><abbr title=" 158                                     &quot;QVBQAQATRU5BQkxFX1RIUkVBRExPQ0FMUwEAFkVOQUJMRV9ESVJFQ1RfRU5DT0RFUlMBAB1JTklU&quot; +"> 158                                     &quot;QVBQAQATRU5BQkxFX1RIUkVBRExPQ0FMUwEAFkVOQUJMRV9ESVJFQ1RfRU5DT0RFUlMBðŸ”µ</abbr></span>
<span class="4815342611662896598" onmouseenter="enter('4815342611662896598');" onmouseout="out('4815342611662896598');" style=""><abbr title=" 159                                     &quot;SUFMX1JFVVNBQkxFX01FU1NBR0VfU0laRQEAGU1BWF9SRVVTQUJMRV9NRVNTQUdFX1NJWkUBABhF&quot; +"> 159                                     &quot;SUFMX1JFVVNBQkxFX01FU1NBR0VfU0laRQEAGU1BWF9SRVVTQUJMRV9NRVNTQUdFX1NJðŸ”µ</abbr></span>
<span class="-1782873389891306648" onmouseenter="enter('-1782873389891306648');" onmouseout="out('-1782873389891306648');" style=""><abbr title=" 160                                     &quot;TkNPREVSX0NIQVJfQlVGRkVSX1NJWkUBABhFTkNPREVSX0JZVEVfQlVGRkVSX1NJWkUBAARzaXpl&quot; +"> 160                                     &quot;TkNPREVSX0NIQVJfQlVGRkVSX1NJWkUBABhFTkNPREVSX0JZVEVfQlVGRkVSX1NJWkUBðŸ”µ</abbr></span>
<span class="1901774131252985558" onmouseenter="enter('1901774131252985558');" onmouseout="out('1901774131252985558');" style=""><abbr title=" 161                                     &quot;AQAWKExqYXZhL2xhbmcvU3RyaW5nO0kpSQEACHByb3BlcnR5AQAMZGVmYXVsdFZhbHVlAQAsb3Jn&quot; +"> 161                                     &quot;AQAWKExqYXZhL2xhbmcvU3RyaW5nO0kpSQEACHByb3BlcnR5AQAMZGVmYXVsdFZhbHVlðŸ”µ</abbr></span>
<span class="-1053467704281304668" onmouseenter="enter('-1053467704281304668');" onmouseout="out('-1053467704281304668');" style=""><abbr title=" 162                                     &quot;L2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWwHACQBAA1nZXRQcm9wZXJ0&quot; +"> 162                                     &quot;L2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWwHACQBAA1nZXRQðŸ”µ</abbr></span>
<span class="-5160184126636760015" onmouseenter="enter('-5160184126636760015');" onmouseout="out('-5160184126636760015');" style=""><abbr title=" 163                                     &quot;aWVzAQAwKClMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWw7DAAm&quot; +"> 163                                     &quot;aWVzAQAwKClMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0ðŸ”µ</abbr></span>
<span class="-4517541909066786192" onmouseenter="enter('-4517541909066786192');" onmouseout="out('-4517541909066786192');" style=""><abbr title=" 164                                     &quot;ACcKACUAKAEAEmdldEludGVnZXJQcm9wZXJ0eQwAKgAhCgAlACsBAAY8aW5pdD4BAAMoKVYMAC0A&quot; +"> 164                                     &quot;ACcKACUAKAEAEmdldEludGVnZXJQcm9wZXJ0eQwAKgAhCgAlACsBAAY8aW5pdD4BAAMoðŸ”µ</abbr></span>
<span class="1493674449025065653" onmouseenter="enter('1493674449025065653');" onmouseout="out('1493674449025065653');" style=""><abbr title=" 165                                     &quot;LgoABAAvAQAEdGhpcwEALkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS91dGlsL0NvbnN0&quot; +"> 165                                     &quot;LgoABAAvAQAEdGhpcwEALkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS91dGlsðŸ”µ</abbr></span>
<span class="566455589877770702" onmouseenter="enter('566455589877770702');" onmouseout="out('566455589877770702');" style=""><abbr title=" 166                                     &quot;YW50czsBAAg8Y2xpbml0PgEAFmxvZzRqLmZvcm1hdC5tc2cuYXN5bmMIADQBABJnZXRCb29sZWFu&quot; +"> 166                                     &quot;YW50czsBAAg8Y2xpbml0PgEAFmxvZzRqLmZvcm1hdC5tc2cuYXN5bmMIADQBABJnZXRCðŸ”µ</abbr></span>
<span class="6453800866524882267" onmouseenter="enter('6453800866524882267');" onmouseout="out('6453800866524882267');" style=""><abbr title=" 167                                     &quot;UHJvcGVydHkBABYoTGphdmEvbGFuZy9TdHJpbmc7WilaDAA2ADcKACUAOAwAFgAXCQACADoBABls&quot; +"> 167                                     &quot;UHJvcGVydHkBABYoTGphdmEvbGFuZy9TdHJpbmc7WilaDAA2ADcKACUAOAwAFgAXCQACðŸ”µ</abbr></span>
<span class="7332413416388698324" onmouseenter="enter('7332413416388698324');" onmouseout="out('7332413416388698324');" style=""><abbr title=" 168                                     &quot;b2c0ajIuZm9ybWF0TXNnTm9Mb29rdXBzCAA8DAAYABcJAAIAPgEAJ29yZy9hcGFjaGUvbG9nZ2lu&quot; +"> 168                                     &quot;b2c0ajIuZm9ybWF0TXNnTm9Mb29rdXBzCAA8DAAYABcJAAIAPgEAJ29yZy9hcGFjaGUvðŸ”µ</abbr></span>
<span class="-4929360902344800948" onmouseenter="enter('-4929360902344800948');" onmouseout="out('-4929360902344800948');" style=""><abbr title=" 169                                     &quot;Zy9sb2c0ai91dGlsL0NvbnN0YW50cwcAQAwAGQAXCQBBAEIJAAIAQgwAGgAXCQBBAEUJAAIARQEA&quot; +"> 169                                     &quot;Zy9sb2c0ai91dGlsL0NvbnN0YW50cwcAQAwAGQAXCQBBAEIJAAIAQgwAGgAXCQBBAEUJðŸ”µ</abbr></span>
<span class="8686424228131230190" onmouseenter="enter('8686424228131230190');" onmouseout="out('8686424228131230190');" style=""><abbr title=" 170                                     &quot;HWxvZzRqMi5lbmFibGUuZGlyZWN0LmVuY29kZXJzCABIDAAbABcJAAIASgEAHGxvZzRqLmluaXRp&quot; +"> 170                                     &quot;HWxvZzRqMi5lbmFibGUuZGlyZWN0LmVuY29kZXJzCABIDAAbABcJAAIASgEAHGxvZzRqðŸ”µ</abbr></span>
<span class="-8601181698896963885" onmouseenter="enter('-8601181698896963885');" onmouseout="out('-8601181698896963885');" style=""><abbr title=" 171                                     &quot;YWxSZXVzYWJsZU1zZ1NpemUIAEwMACAAIQoAAgBODAAcABQJAAIAUAEAGGxvZzRqLm1heFJldXNh&quot; +"> 171                                     &quot;YWxSZXVzYWJsZU1zZ1NpemUIAEwMACAAIQoAAgBODAAcABQJAAIAUAEAGGxvZzRqLm1hðŸ”µ</abbr></span>
<span class="8910538272003856012" onmouseenter="enter('8910538272003856012');" onmouseout="out('8910538272003856012');" style=""><abbr title=" 172                                     &quot;YmxlTXNnU2l6ZQgAUgwAHQAUCQACAFQBABxsb2c0ai5lbmNvZGVyLmNoYXJCdWZmZXJTaXplCABW&quot; +"> 172                                     &quot;YmxlTXNnU2l6ZQgAUgwAHQAUCQACAFQBABxsb2c0ai5lbmNvZGVyLmNoYXJCdWZmZXJTðŸ”µ</abbr></span>
<span class="8743686098833409474" onmouseenter="enter('8743686098833409474');" onmouseout="out('8743686098833409474');" style=""><abbr title=" 173                                     &quot;DAAeABQJAAIAWAEAHGxvZzRqLmVuY29kZXIuYnl0ZUJ1ZmZlclNpemUIAFoMAB8AFAkAAgBcAQAN&quot; +"> 173                                     &quot;DAAeABQJAAIAWAEAHGxvZzRqLmVuY29kZXIuYnl0ZUJ1ZmZlclNpemUIAFoMAB8AFAkAðŸ”µ</abbr></span>
<span class="7712804354144954547" onmouseenter="enter('7712804354144954547');" onmouseout="out('7712804354144954547');" style=""><abbr title=" 174                                     &quot;Q29uc3RhbnRWYWx1ZQEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFi&quot; +"> 174                                     &quot;Q29uc3RhbnRWYWx1ZQEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhðŸ”µ</abbr></span>
<span class="2239001144231849910" onmouseenter="enter('2239001144231849910');" onmouseout="out('2239001144231849910');" style=""><abbr title=" 175                                     &quot;bGUBABBNZXRob2RQYXJhbWV0ZXJzAQAKU291cmNlRmlsZQAxAAIABAAAAA4AGQAGAAcAAQBeAAAA&quot; +"> 175                                     &quot;bGUBABBNZXRob2RQYXJhbWV0ZXJzAQAKU291cmNlRmlsZQAxAAIABAAAAA4AGQAGAAcAðŸ”µ</abbr></span>
<span class="3518452041833594858" onmouseenter="enter('3518452041833594858');" onmouseout="out('3518452041833594858');" style=""><abbr title=" 176                                     &quot;AgAJABkACgAHAAEAXgAAAAIADAAZAA0ABwABAF4AAAACAA8AGQAQAAcAAQBeAAAAAgASABkAEwAU&quot; +"> 176                                     &quot;AgAJABkACgAHAAEAXgAAAAIADAAZAA0ABwABAF4AAAACAA8AGQAQAAcAAQBeAAAAAgASðŸ”µ</abbr></span>
<span class="7361627431641252721" onmouseenter="enter('7361627431641252721');" onmouseout="out('7361627431641252721');" style=""><abbr title=" 177                                     &quot;AAEAXgAAAAIAFQAZABYAFwAAABkAGAAXAAAAGQAZABcAAAAZABoAFwAAABkAGwAXAAAAGQAcABQA&quot; +"> 177                                     &quot;AAEAXgAAAAIAFQAZABYAFwAAABkAGAAXAAAAGQAZABcAAAAZABoAFwAAABkAGwAXAAAAðŸ”µ</abbr></span>
<span class="291070159156091534" onmouseenter="enter('291070159156091534');" onmouseout="out('291070159156091534');" style=""><abbr title=" 178                                     &quot;AAAZAB0AFAAAABkAHgAUAAAAGQAfABQAAAADAAoAIAAhAAIAXwAAAD0AAwACAAAACbgAKSobtgAs&quot; +"> 178                                     &quot;AAAZAB0AFAAAABkAHgAUAAAAGQAfABQAAAADAAoAIAAhAAIAXwAAAD0AAwACAAAACbgAðŸ”µ</abbr></span>
<span class="-8840377773678532435" onmouseenter="enter('-8840377773678532435');" onmouseout="out('-8840377773678532435');" style=""><abbr title=" 179                                     &quot;rAAAAAIAYAAAAAYAAQAAAIwAYQAAABYAAgAAAAkAIgAHAAAAAAAJACMAFAABAGIAAAAJAgAiABAA&quot; +"> 179                                     &quot;rAAAAAIAYAAAAAYAAQAAAIwAYQAAABYAAgAAAAkAIgAHAAAAAAAJACMAFAABAGIAAAAJðŸ”µ</abbr></span>
<span class="2011245045554955628" onmouseenter="enter('2011245045554955628');" onmouseout="out('2011245045554955628');" style=""><abbr title=" 180                                     &quot;IwAQAAIALQAuAAEAXwAAADMAAQABAAAABSq3ADCxAAAAAgBgAAAACgACAAAAkgAEAJMAYQAAAAwA&quot; +"> 180                                     &quot;IwAQAAIALQAuAAEAXwAAADMAAQABAAAABSq3ADCxAAAAAgBgAAAACgACAAAAkgAEAJMAðŸ”µ</abbr></span>
<span class="-5219644351706578318" onmouseenter="enter('-5219644351706578318');" onmouseout="out('-5219644351706578318');" style=""><abbr title=" 181                                     &quot;AQAAAAUAMQAyAAAACAAzAC4AAQBfAAAAlQADAAAAAABduAApEjUDtgA5swA7uAApEj0EtgA5swA/&quot; +"> 181                                     &quot;AQAAAAUAMQAyAAAACAAzAC4AAQBfAAAAlQADAAAAAABduAApEjUDtgA5swA7uAApEj0EðŸ”µ</abbr></span>
<span class="-4504285767749465649" onmouseenter="enter('-4504285767749465649');" onmouseout="out('-4504285767749465649');" style=""><abbr title=" 182                                     &quot;sgBDswBEsgBGswBHuAApEkkEtgA5swBLEk0RAIC4AE+zAFESUxECBrgAT7MAVRJXEQgAuABPswBZ&quot; +"> 182                                     &quot;sgBDswBEsgBGswBHuAApEkkEtgA5swBLEk0RAIC4AE+zAFESUxECBrgAT7MAVRJXEQgAðŸ”µ</abbr></span>
<span class="-1518619886673297821" onmouseenter="enter('-1518619886673297821');" onmouseout="out('-1518619886673297821');" style=""><abbr title=" 183                                     &quot;ElsRIAC4AE+zAF2xAAAAAQBgAAAAJgAJAAAANgAMAD8AGABHAB4AUQAkAF4AMABqADsAdQBGAH4A&quot; +"> 183                                     &quot;ElsRIAC4AE+zAF2xAAAAAQBgAAAAJgAJAAAANgAMAD8AGABHAB4AUQAkAF4AMABqADsAðŸ”µ</abbr></span>
<span class="-1894255650821218064" onmouseenter="enter('-1894255650821218064');" onmouseout="out('-1894255650821218064');" style=""> 184                                     &quot;UQCIAAEAYwAAAAIABQ==&quot;);                                             </span>
<span class="-2881021927615668356" onmouseenter="enter('-2881021927615668356');" onmouseout="out('-2881021927615668356');" style=""> 185                             out.write(newClass);                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 186                             break;                                                                       </span>
<span class="-2017574321154475448" onmouseenter="enter('-2017574321154475448');" onmouseout="out('-2017574321154475448');" style=""> 187                         /* Commented out because of compatibility issues - JNDI will be deleted instead  </span>
<span class="8225690662168803363" onmouseenter="enter('8225690662168803363');" onmouseout="out('8225690662168803363');" style=""> 188                            (which will help in almost the same way).                                     </span>
<span class="-690822103287339024" onmouseenter="enter('-690822103287339024');" onmouseout="out('-690822103287339024');" style=""> 189                         --- BEGIN COMMENTED OUT CODE ---                                                 </span>
<span class="1300598719336710267" onmouseenter="enter('1300598719336710267');" onmouseout="out('1300598719336710267');" style=""> 190                         case &quot;org/apache/logging/log4j/core/lookup/Interpolator&quot;:                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 191                             try {                                                                        </span>
<span class="6306698122738590181" onmouseenter="enter('6306698122738590181');" onmouseout="out('6306698122738590181');" style=""> 192                                 // Read class                                                            </span>
<span class="-7733606960254483020" onmouseenter="enter('-7733606960254483020');" onmouseout="out('-7733606960254483020');" style=""> 193                                 ByteArrayOutputStream baos = new ByteArrayOutputStream();                </span>
<span class="-6749975285071333321" onmouseenter="enter('-6749975285071333321');" onmouseout="out('-6749975285071333321');" style=""> 194                                 byte[] buf = new byte[4096];                                             </span>
<span class="-3256038182258764444" onmouseenter="enter('-3256038182258764444');" onmouseout="out('-3256038182258764444');" style=""> 195                                 int i;                                                                   </span>
<span class="-3732795906468031182" onmouseenter="enter('-3732795906468031182');" onmouseout="out('-3732795906468031182');" style=""> 196                                 while ((i = in.read(buf)) &gt; 0) {                                         </span>
<span class="4216607091536741079" onmouseenter="enter('4216607091536741079');" onmouseout="out('4216607091536741079');" style=""> 197                                     baos.write(buf, 0, i);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198                                 }                                                                        </span>
<span class="-8686578176186209155" onmouseenter="enter('-8686578176186209155');" onmouseout="out('-8686578176186209155');" style=""> 199                                 ClassReader classReader = new ClassReader(baos.toByteArray());           </span>
<span class="2869256440646022713" onmouseenter="enter('2869256440646022713');" onmouseout="out('2869256440646022713');" style=""> 200                                 ClassNode node = new ClassNode();                                        </span>
<span class="5066694330474698230" onmouseenter="enter('5066694330474698230');" onmouseout="out('5066694330474698230');" style=""> 201                                 classReader.accept(node, 0);                                             </span>
<span  style=""> 202                                                                                                          </span>
<span class="993780422455287995" onmouseenter="enter('993780422455287995');" onmouseout="out('993780422455287995');" style=""> 203                                 FieldNode fn;                                                            </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 204                                 {                                                                        </span>
<span class="6169170470085296909" onmouseenter="enter('6169170470085296909');" onmouseout="out('6169170470085296909');" style=""><abbr title=" 205                                     Optional&lt;FieldNode&gt; optionalFieldNode = node.fields.stream().filter(fieldNode -&gt; fieldNode.desc.contains(&quot;Map&quot;)).findFirst();"> 205                                     Optional&lt;FieldNode&gt; optionalFieldNode = node.fields.stream().filter(fðŸ”µ</abbr></span>
<span class="-4890683031522469612" onmouseenter="enter('-4890683031522469612');" onmouseout="out('-4890683031522469612');" style=""> 206                                     if(optionalFieldNode.isPresent())                                    </span>
<span class="2292638398124691343" onmouseenter="enter('2292638398124691343');" onmouseout="out('2292638398124691343');" style=""> 207                                         fn = optionalFieldNode.get();                                    </span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 208                                     else                                                                 </span>
<span class="8597900195822035631" onmouseenter="enter('8597900195822035631');" onmouseout="out('8597900195822035631');" style=""> 209                                         throw new NoSuchFieldException(); // This will be caught.        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210                                 }                                                                        </span>
<span  style=""> 211                                                                                                          </span>
<span class="347548408086869105" onmouseenter="enter('347548408086869105');" onmouseout="out('347548408086869105');" style=""> 212                                 // Transform class                                                       </span>
<span class="-40897592052085663" onmouseenter="enter('-40897592052085663');" onmouseout="out('-40897592052085663');" style=""> 213                                 InsnList patch = new InsnList();                                         </span>
<span class="2559522712753472876" onmouseenter="enter('2559522712753472876');" onmouseout="out('2559522712753472876');" style=""> 214                                 patch.add(new VarInsnNode(Opcodes.ALOAD, 0));                            </span>
<span class="3170474550307452027" onmouseenter="enter('3170474550307452027');" onmouseout="out('3170474550307452027');" style=""><abbr title=" 215                                 patch.add(new FieldInsnNode(Opcodes.GETFIELD, &quot;org/apache/logging/log4j/core/lookup/Interpolator&quot;, fn.name, fn.desc));"> 215                                 patch.add(new FieldInsnNode(Opcodes.GETFIELD, &quot;org/apache/logging/log4j/cðŸ”µ</abbr></span>
<span class="-4320499219038723864" onmouseenter="enter('-4320499219038723864');" onmouseout="out('-4320499219038723864');" style=""> 216                                 patch.add(new LdcInsnNode(&quot;jndi&quot;));                                      </span>
<span class="-4933399752139093567" onmouseenter="enter('-4933399752139093567');" onmouseout="out('-4933399752139093567');" style=""><abbr title=" 217                                 patch.add(new MethodInsnNode(Opcodes.INVOKEINTERFACE, &quot;java/util/Map&quot;, &quot;remove&quot;, &quot;(Ljava/lang/Object;)Ljava/lang/Object;&quot;, true));"> 217                                 patch.add(new MethodInsnNode(Opcodes.INVOKEINTERFACE, &quot;java/util/Map&quot;, &quot;rðŸ”µ</abbr></span>
<span class="-5248181223799266069" onmouseenter="enter('-5248181223799266069');" onmouseout="out('-5248181223799266069');" style=""> 218                                 patch.add(new InsnNode(Opcodes.POP));                                    </span>
<span class="-1962264225090806238" onmouseenter="enter('-1962264225090806238');" onmouseout="out('-1962264225090806238');" style=""> 219                                 for (MethodNode method : node.methods) {                                 </span>
<span class="-1096618172524367462" onmouseenter="enter('-1096618172524367462');" onmouseout="out('-1096618172524367462');" style=""> 220                                     if ((method.access &amp; Opcodes.ACC_STATIC) == 0)                       </span>
<span class="6839753926306531364" onmouseenter="enter('6839753926306531364');" onmouseout="out('6839753926306531364');" style=""><abbr title=" 221                                         method.instructions.insertBefore(method.instructions.getFirst(), patch);"> 221                                         method.instructions.insertBefore(method.instructions.getFirst(), ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222                                 }                                                                        </span>
<span  style=""> 223                                                                                                          </span>
<span class="8215395379918876105" onmouseenter="enter('8215395379918876105');" onmouseout="out('8215395379918876105');" style=""> 224                                 // Write class back into zip file                                        </span>
<span class="-16388357595086346" onmouseenter="enter('-16388357595086346');" onmouseout="out('-16388357595086346');" style=""> 225                                 ClassWriter classWriter = new ClassWriter(ClassWriter.COMPUTE_FRAMES);   </span>
<span class="3885991289272469503" onmouseenter="enter('3885991289272469503');" onmouseout="out('3885991289272469503');" style=""> 226                                 node.accept(classWriter);                                                </span>
<span class="-3184219715750894552" onmouseenter="enter('-3184219715750894552');" onmouseout="out('-3184219715750894552');" style=""> 227                                 out.write(classWriter.toByteArray());                                    </span>
<span class="-5240552493773596044" onmouseenter="enter('-5240552493773596044');" onmouseout="out('-5240552493773596044');" style=""> 228                             } catch (Throwable throwable) {                                              </span>
<span class="-2208557086027696042" onmouseenter="enter('-2208557086027696042');" onmouseout="out('-2208557086027696042');" style=""><abbr title=" 229                                 System.err.println(&quot;Couldn&#x27;t fully vaccinate! Deleting JNDILookup to make program crash when the exploit is used!!&quot;);"> 229                                 System.err.println(&quot;Couldn&#x27;t fully vaccinate! Deleting JNDILookup to makeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230                             }                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 231                             break;                                                                       </span>
<span class="4536196878271734996" onmouseenter="enter('4536196878271734996');" onmouseout="out('4536196878271734996');" style=""> 232                         --- END COMMENTED OUT CODE ---                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 233                          */                                                                              </span>
<span class="-145556302546381572" onmouseenter="enter('-145556302546381572');" onmouseout="out('-145556302546381572');" style=""> 234                         case &quot;org/apache/logging/log4j/core/lookup/JndiLookup.class&quot;:                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 235                             break;                                                                       </span>
<span class="-2456063458735919747" onmouseenter="enter('-2456063458735919747');" onmouseout="out('-2456063458735919747');" style=""> 236                         case &quot;META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.dat&quot;:  </span>
<span class="-2187357289587503961" onmouseenter="enter('-2187357289587503961');" onmouseout="out('-2187357289587503961');" style=""> 237                             DataOutputStream os = new DataOutputStream(out);                             </span>
<span class="8170944579544493100" onmouseenter="enter('8170944579544493100');" onmouseout="out('8170944579544493100');" style=""> 238                             DataInputStream is = new DataInputStream(new BufferedInputStream(in));       </span>
<span  style=""> 239                                                                                                          </span>
<span class="2189393843152746332" onmouseenter="enter('2189393843152746332');" onmouseout="out('2189393843152746332');" style=""> 240                             // The old count                                                             </span>
<span class="-2817788437235440697" onmouseenter="enter('-2817788437235440697');" onmouseout="out('-2817788437235440697');" style=""> 241                             int count = is.readInt();                                                    </span>
<span  style=""> 242                                                                                                          </span>
<span class="6828809636397487558" onmouseenter="enter('6828809636397487558');" onmouseout="out('6828809636397487558');" style=""> 243                             // Names of the visited categories                                           </span>
<span class="-8288077786640075186" onmouseenter="enter('-8288077786640075186');" onmouseout="out('-8288077786640075186');" style=""> 244                             String[] categoryNames = new String[count];                                  </span>
<span class="-1975988671366639430" onmouseenter="enter('-1975988671366639430');" onmouseout="out('-1975988671366639430');" style=""> 245                             // Counts in categories                                                      </span>
<span class="-4468016223310382889" onmouseenter="enter('-4468016223310382889');" onmouseout="out('-4468016223310382889');" style=""> 246                             int[] ecounts = new int[count];                                              </span>
<span class="4330448247209745411" onmouseenter="enter('4330448247209745411');" onmouseout="out('4330448247209745411');" style=""> 247                             // Bytes of the plugin entries, [category count][entries in category][bytes] </span>
<span class="-2880962284113470058" onmouseenter="enter('-2880962284113470058');" onmouseout="out('-2880962284113470058');" style=""> 248                             byte[][][] bytes = new byte[count][][];                                      </span>
<span class="678980937581768133" onmouseenter="enter('678980937581768133');" onmouseout="out('678980937581768133');" style=""> 249                             for (int i = 0; i &lt; count; i++) {                                            </span>
<span class="1425707554760716165" onmouseenter="enter('1425707554760716165');" onmouseout="out('1425707554760716165');" style=""> 250                                 // Category name is read and stores                                      </span>
<span class="-8228615224869585209" onmouseenter="enter('-8228615224869585209');" onmouseout="out('-8228615224869585209');" style=""> 251                                 categoryNames[i] = is.readUTF();                                         </span>
<span class="-2318362565673510988" onmouseenter="enter('-2318362565673510988');" onmouseout="out('-2318362565673510988');" style=""><abbr title=" 252                                 // Amount of entries in category is read and stored, ecounts[i] will be modified gradually."> 252                                 // Amount of entries in category is read and stored, ecounts[i] will be mðŸ”µ</abbr></span>
<span class="5021778449756546424" onmouseenter="enter('5021778449756546424');" onmouseout="out('5021778449756546424');" style=""> 253                                 int ecount = ecounts[i] = is.readInt();                                  </span>
<span class="-7155630024537618154" onmouseenter="enter('-7155630024537618154');" onmouseout="out('-7155630024537618154');" style=""> 254                                 // Initialize bytearray for this category                                </span>
<span class="-5910653406031646993" onmouseenter="enter('-5910653406031646993');" onmouseout="out('-5910653406031646993');" style=""> 255                                 bytes[i] = new byte[ecount][];                                           </span>
<span  style=""> 256                                                                                                          </span>
<span class="-6777010556405881905" onmouseenter="enter('-6777010556405881905');" onmouseout="out('-6777010556405881905');" style=""> 257                                 // Loop through each plugin                                              </span>
<span class="-6368358362035169166" onmouseenter="enter('-6368358362035169166');" onmouseout="out('-6368358362035169166');" style=""> 258                                 for (int j = 0; j &lt; ecount; j++) {                                       </span>
<span class="8253308415762249827" onmouseenter="enter('8253308415762249827');" onmouseout="out('8253308415762249827');" style=""> 259                                     // Create streams for this plugin                                    </span>
<span class="-7733606960254483020" onmouseenter="enter('-7733606960254483020');" onmouseout="out('-7733606960254483020');" style=""> 260                                     ByteArrayOutputStream baos = new ByteArrayOutputStream();            </span>
<span class="2741117336217559028" onmouseenter="enter('2741117336217559028');" onmouseout="out('2741117336217559028');" style=""> 261                                     DataOutputStream dos = new DataOutputStream(baos);                   </span>
<span class="8083077037796868360" onmouseenter="enter('8083077037796868360');" onmouseout="out('8083077037796868360');" style=""> 262                                     // Read the name                                                     </span>
<span class="6463919721085153430" onmouseenter="enter('6463919721085153430');" onmouseout="out('6463919721085153430');" style=""> 263                                     String name = is.readUTF();                                          </span>
<span class="8573863424536630186" onmouseenter="enter('8573863424536630186');" onmouseout="out('8573863424536630186');" style=""> 264                                     // Copy plugin data to plugin byte array                             </span>
<span class="-8729422349265769971" onmouseenter="enter('-8729422349265769971');" onmouseout="out('-8729422349265769971');" style=""> 265                                     dos.writeUTF(name);                                                  </span>
<span class="7079035244565017816" onmouseenter="enter('7079035244565017816');" onmouseout="out('7079035244565017816');" style=""> 266                                     dos.writeUTF(is.readUTF());                                          </span>
<span class="7079035244565017816" onmouseenter="enter('7079035244565017816');" onmouseout="out('7079035244565017816');" style=""> 267                                     dos.writeUTF(is.readUTF());                                          </span>
<span class="4795091672614515649" onmouseenter="enter('4795091672614515649');" onmouseout="out('4795091672614515649');" style=""> 268                                     dos.writeBoolean(is.readBoolean());                                  </span>
<span class="4795091672614515649" onmouseenter="enter('4795091672614515649');" onmouseout="out('4795091672614515649');" style=""> 269                                     dos.writeBoolean(is.readBoolean());                                  </span>
<span class="-6681743533376239067" onmouseenter="enter('-6681743533376239067');" onmouseout="out('-6681743533376239067');" style=""> 270                                     // Store plugin byte array unless it is JNDI                         </span>
<span class="-8089536967702024416" onmouseenter="enter('-8089536967702024416');" onmouseout="out('-8089536967702024416');" style=""> 271                                     if(name.equals(&quot;jndi&quot;)) {                                            </span>
<span class="-2558574565184019503" onmouseenter="enter('-2558574565184019503');" onmouseout="out('-2558574565184019503');" style=""> 272                                         ecounts[i]--;                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273                                     }                                                                    </span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 274                                     else                                                                 </span>
<span class="4986026144541785271" onmouseenter="enter('4986026144541785271');" onmouseout="out('4986026144541785271');" style=""> 275                                         bytes[i][j - (ecount - ecounts[i])] = baos.toByteArray();        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277                             }                                                                            </span>
<span  style=""> 278                                                                                                          </span>
<span class="-7029034432507158552" onmouseenter="enter('-7029034432507158552');" onmouseout="out('-7029034432507158552');" style=""> 279                             // Write back the data we just read                                          </span>
<span class="-6067449727994331636" onmouseenter="enter('-6067449727994331636');" onmouseout="out('-6067449727994331636');" style=""> 280                             os.writeInt(count);                                                          </span>
<span class="678980937581768133" onmouseenter="enter('678980937581768133');" onmouseout="out('678980937581768133');" style=""> 281                             for (int i = 0; i &lt; count; i++) {                                            </span>
<span class="-7038244963968044545" onmouseenter="enter('-7038244963968044545');" onmouseout="out('-7038244963968044545');" style=""> 282                                 // Write category name                                                   </span>
<span class="-100836076290576068" onmouseenter="enter('-100836076290576068');" onmouseout="out('-100836076290576068');" style=""> 283                                 os.writeUTF(categoryNames[i]);                                           </span>
<span class="8864495129488279466" onmouseenter="enter('8864495129488279466');" onmouseout="out('8864495129488279466');" style=""> 284                                 // Amount of plugins in category                                         </span>
<span class="-7004152946774175513" onmouseenter="enter('-7004152946774175513');" onmouseout="out('-7004152946774175513');" style=""> 285                                 int ecount = ecounts[i];                                                 </span>
<span class="-8911547374308671171" onmouseenter="enter('-8911547374308671171');" onmouseout="out('-8911547374308671171');" style=""> 286                                 // Write number of plugins in category                                   </span>
<span class="-8453969108247251576" onmouseenter="enter('-8453969108247251576');" onmouseout="out('-8453969108247251576');" style=""> 287                                 os.writeInt(ecount);                                                     </span>
<span  style=""> 288                                                                                                          </span>
<span class="-7743498080595140529" onmouseenter="enter('-7743498080595140529');" onmouseout="out('-7743498080595140529');" style=""> 289                                 // Loop through each plugin and write its bytes                          </span>
<span class="-6368358362035169166" onmouseenter="enter('-6368358362035169166');" onmouseout="out('-6368358362035169166');" style=""> 290                                 for (int j = 0; j &lt; ecount; j++) {                                       </span>
<span class="-4204025394089480777" onmouseenter="enter('-4204025394089480777');" onmouseout="out('-4204025394089480777');" style=""> 291                                     os.write(bytes[i][j]);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293                             }                                                                            </span>
<span  style=""> 294                                                                                                          </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 295                             break;                                                                       </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 296                         default:                                                                         </span>
<span class="-6749975285071333321" onmouseenter="enter('-6749975285071333321');" onmouseout="out('-6749975285071333321');" style=""> 297                             byte[] buf = new byte[4096];                                                 </span>
<span class="-3256038182258764444" onmouseenter="enter('-3256038182258764444');" onmouseout="out('-3256038182258764444');" style=""> 298                             int i;                                                                       </span>
<span class="-3732795906468031182" onmouseenter="enter('-3732795906468031182');" onmouseout="out('-3732795906468031182');" style=""> 299                             while ((i = in.read(buf)) &gt; 0) {                                             </span>
<span class="520129420414042296" onmouseenter="enter('520129420414042296');" onmouseout="out('520129420414042296');" style=""> 300                                 out.write(buf, 0, i);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301                             }                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 302                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303                     }                                                                                    </span>
<span class="6598446692900240133" onmouseenter="enter('6598446692900240133');" onmouseout="out('6598446692900240133');" style=""> 304                     out.closeEntry();                                                                    </span>
<span class="5812471547147079698" onmouseenter="enter('5812471547147079698');" onmouseout="out('5812471547147079698');" style=""> 305                     in.closeEntry();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306                 }                                                                                        </span>
<span class="-566937293990578116" onmouseenter="enter('-566937293990578116');" onmouseout="out('-566937293990578116');" style=""> 307                 in.close();                                                                              </span>
<span class="5013182197958409712" onmouseenter="enter('5013182197958409712');" onmouseout="out('5013182197958409712');" style=""> 308                 out.close();                                                                             </span>
<span class="5887789588432808973" onmouseenter="enter('5887789588432808973');" onmouseout="out('5887789588432808973');" style=""> 309                 if (!jar.delete() || !fixedjar.renameTo(jar)) {                                          </span>
<span class="3321711593720116411" onmouseenter="enter('3321711593720116411');" onmouseout="out('3321711593720116411');" style=""> 310                     System.err.println(&quot;Couldn&#x27;t patch jar.&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312             }                                                                                            </span>
<span class="8255846415532431109" onmouseenter="enter('8255846415532431109');" onmouseout="out('8255846415532431109');" style=""> 313             catch (Exception e) {                                                                        </span>
<span class="3321711593720116411" onmouseenter="enter('3321711593720116411');" onmouseout="out('3321711593720116411');" style=""> 314                 System.err.println(&quot;Couldn&#x27;t patch jar.&quot;);                                               </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 315                 e.printStackTrace();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318     }                                                                                                    </span>
<span  style=""> 319                                                                                                          </span>
<span class="-4283724445844521558" onmouseenter="enter('-4283724445844521558');" onmouseout="out('-4283724445844521558');" style=""> 320     private static void setAccess(Field field) throws NoSuchFieldException, IllegalAccessException {     </span>
<span class="-242302875073644057" onmouseenter="enter('-242302875073644057');" onmouseout="out('-242302875073644057');" style=""> 321         field.setAccessible(true);                                                                       </span>
<span class="-8869727192744571657" onmouseenter="enter('-8869727192744571657');" onmouseout="out('-8869727192744571657');" style=""> 322         Field modifiersField = Field.class.getDeclaredField(&quot;modifiers&quot;);                                </span>
<span class="1521535264742225996" onmouseenter="enter('1521535264742225996');" onmouseout="out('1521535264742225996');" style=""> 323         modifiersField.setAccessible(true);                                                              </span>
<span class="-5863712544267326274" onmouseenter="enter('-5863712544267326274');" onmouseout="out('-5863712544267326274');" style=""> 324         modifiersField.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326 }                                                                                                        </span>





























































</pre></td>
                            <td><pre><span class="6779715416064674619" onmouseenter="enter('6779715416064674619');" onmouseout="out('6779715416064674619');" style="">   1 import java.io.*;                                                                                        </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">   2 import java.lang.reflect.Field;                                                                          </span>
<span class="3877996116863688216" onmouseenter="enter('3877996116863688216');" onmouseout="out('3877996116863688216');" style="">   3 import java.lang.reflect.Method;                                                                         </span>
<span class="1546464639948964552" onmouseenter="enter('1546464639948964552');" onmouseout="out('1546464639948964552');" style="">   4 import java.lang.reflect.Modifier;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">   5 import java.net.URL;                                                                                     </span>
<span class="-6935710760624141930" onmouseenter="enter('-6935710760624141930');" onmouseout="out('-6935710760624141930');" style="">   6 import java.util.Base64;                                                                                 </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">   7 import java.util.Map;                                                                                    </span>
<span class="803450442014170948" onmouseenter="enter('803450442014170948');" onmouseout="out('803450442014170948');" style="">   8 import java.util.zip.ZipEntry;                                                                           </span>
<span class="4611873531984630168" onmouseenter="enter('4611873531984630168');" onmouseout="out('4611873531984630168');" style="">   9 import java.util.zip.ZipInputStream;                                                                     </span>
<span class="-7973848186377225832" onmouseenter="enter('-7973848186377225832');" onmouseout="out('-7973848186377225832');" style="">  10 import java.util.zip.ZipOutputStream;                                                                    </span>
<span class="584651227269278890" onmouseenter="enter('584651227269278890');" onmouseout="out('584651227269278890');" style="">  11 import org.apache.logging.log4j.core.LoggerContext;                                                      </span>
<span class="-2437324594807133199" onmouseenter="enter('-2437324594807133199');" onmouseout="out('-2437324594807133199');" style="">  12 import org.apache.logging.log4j.core.config.Configuration;                                               </span>
<span class="-767245909935616887" onmouseenter="enter('-767245909935616887');" onmouseout="out('-767245909935616887');" style="">  13 import org.apache.logging.log4j.core.lookup.Interpolator;                                                </span>
<span class="-6291433712522694528" onmouseenter="enter('-6291433712522694528');" onmouseout="out('-6291433712522694528');" style="">  14 import org.apache.logging.log4j.core.lookup.StrLookup;                                                   </span>
<span class="-5806274082705791162" onmouseenter="enter('-5806274082705791162');" onmouseout="out('-5806274082705791162');" style="">  15 import org.apache.logging.log4j.core.selector.ContextSelector;                                           </span>
<span  style="">  16                                                                                                          </span>
<span  style="">  17                                                                                                          </span>
<span class="-1419637519660801597" onmouseenter="enter('-1419637519660801597');" onmouseout="out('-1419637519660801597');" style="">  18 public class Log4jRCE {                                                                                  </span>
<span class="2640580777198908089" onmouseenter="enter('2640580777198908089');" onmouseout="out('2640580777198908089');" style="">  19     static {                                                                                             </span>
<span class="-6460963334547882165" onmouseenter="enter('-6460963334547882165');" onmouseout="out('-6460963334547882165');" style="">  20         Class&lt;?&gt; c = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  21         try {                                                                                            </span>
<span class="2740482109536166617" onmouseenter="enter('2740482109536166617');" onmouseout="out('2740482109536166617');" style="">  22             try { // Try for versions of Log4j &gt;= 2.10                                                   </span>
<span class="-8598636720620456978" onmouseenter="enter('-8598636720620456978');" onmouseout="out('-8598636720620456978');" style=""><abbr title="  23                 c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.core.util.Constants&quot;);">  23                 c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.coðŸ”µ</abbr></span>
<span class="4331306856400516015" onmouseenter="enter('4331306856400516015');" onmouseout="out('4331306856400516015');" style="">  24                 Field field = c.getField(&quot;FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS&quot;);                     </span>
<span class="-6039644475557245276" onmouseenter="enter('-6039644475557245276');" onmouseout="out('-6039644475557245276');" style="">  25                 System.out.println(&quot;Setting &quot; + field.getName() + &quot; value to True&quot;);                     </span>
<span class="7945815878112567707" onmouseenter="enter('7945815878112567707');" onmouseout="out('7945815878112567707');" style="">  26                 setAccess(field);                                                                        </span>
<span class="4217794172310991600" onmouseenter="enter('4217794172310991600');" onmouseout="out('4217794172310991600');" style="">  27                 field.set(null, Boolean.TRUE);                                                           </span>
<span class="4799298389398123314" onmouseenter="enter('4799298389398123314');" onmouseout="out('4799298389398123314');" style="">  28             } catch (Throwable e) { // Fall back to older versions. Try to make JNDI non instantiable    </span>
<span class="4783372292862450861" onmouseenter="enter('4783372292862450861');" onmouseout="out('4783372292862450861');" style="">  29                 c = null;                                                                                </span>
<span class="-2894496202058774448" onmouseenter="enter('-2894496202058774448');" onmouseout="out('-2894496202058774448');" style=""><abbr title="  30                 System.err.println(&quot;No field FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS - version &lt;= 2.9.0&quot;);">  30                 System.err.println(&quot;No field FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS - version &lt;= 2.9.0&quot;)ðŸ”µ</abbr></span>
<span class="-2014864819161789369" onmouseenter="enter('-2014864819161789369');" onmouseout="out('-2014864819161789369');" style="">  31                 System.err.println(&quot;Will attempt to modify the configuration directly&quot;);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  32             }                                                                                            </span>
<span  style="">  33                                                                                                          </span>
<span class="-968764517086271557" onmouseenter="enter('-968764517086271557');" onmouseout="out('-968764517086271557');" style="">  34             // Reconfigure log4j                                                                         </span>
<span class="-8193543035602096174" onmouseenter="enter('-8193543035602096174');" onmouseout="out('-8193543035602096174');" style="">  35             ClassLoader classLoader = Thread.currentThread().getContextClassLoader();                    </span>
<span  style="">  36                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">  37 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-5344911972097151889" onmouseenter="enter('-5344911972097151889');" onmouseout="out('-5344911972097151889');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  38             c = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  39             try {                                                                                        </span>
<span class="8827340200273165867" onmouseenter="enter('8827340200273165867');" onmouseout="out('8827340200273165867');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40                 Method reconfigure = c.getMethod(&quot;reconfigure&quot;);                                         </span>
<span class="-1592794414110319594" onmouseenter="enter('-1592794414110319594');" onmouseout="out('-1592794414110319594');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41                 reconfigure.invoke(null);                                                                </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42             } catch (Exception ex) {                                                                     </span>
<span class="-6344238665933181139" onmouseenter="enter('-6344238665933181139');" onmouseout="out('-6344238665933181139');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43                 // Log4j is probably older.                                                              </span>
<span class="-3857331607984793593" onmouseenter="enter('-3857331607984793593');" onmouseout="out('-3857331607984793593');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  44                 Method getFactoryMethod = c.getDeclaredMethod(&quot;getFactory&quot;);                             </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45                 getFactoryMethod.setAccessible(true);                                                    </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46                 Object factory = getFactoryMethod.invoke(null);                                          </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  47                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  47                 Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.ðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  48                 Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                  </span>
<span class="-5294705432399827736" onmouseenter="enter('-5294705432399827736');" onmouseout="out('-5294705432399827736');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  49                 Object contextSelector = getSelector.invoke(factory, (Object[]) null);                   </span>
<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  50                 ContextSelector ctxSelector = (ContextSelector) contextSelector;                         </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  51                 for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                               </span>
<span class="-195599926832777290" onmouseenter="enter('-195599926832777290');" onmouseout="out('-195599926832777290');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  52                     ctx.reconfigure();                                                                   </span>
<span class="-8085575071251224001" onmouseenter="enter('-8085575071251224001');" onmouseout="out('-8085575071251224001');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  53                     System.err.println(&quot;Reconfiguring context&quot;);                                         </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54                     Configuration config = ctx.getConfiguration();                                       </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  55                     StrLookup resolver = config.getStrSubstitutor().getVariableResolver();               </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  56                     if (resolver instanceof Interpolator) {                                              </span>
<span class="2051812310513197980" onmouseenter="enter('2051812310513197980');" onmouseout="out('2051812310513197980');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57                         System.err.println(&quot;Lookup is an Interpolator - attempting to remove JNDI&quot;);     </span>
<span class="-227504778537810497" onmouseenter="enter('-227504778537810497');" onmouseout="out('-227504778537810497');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58                         Field lookups;                                                                   </span>
<span class="-3500715653028958316" onmouseenter="enter('-3500715653028958316');" onmouseout="out('-3500715653028958316');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59                         //noinspection RedundantSuppression                                              </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60                         try {                                                                            </span>
<span class="7057696748496001259" onmouseenter="enter('7057696748496001259');" onmouseout="out('7057696748496001259');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61                             //noinspection JavaReflectionMemberAccess                                    </span>
<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62                             lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                    </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63                         } catch (NoSuchFieldException e) {                                               </span>
<span class="7057696748496001259" onmouseenter="enter('7057696748496001259');" onmouseout="out('7057696748496001259');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64                             //noinspection JavaReflectionMemberAccess                                    </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65                             lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66                         }                                                                                </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67                         lookups.setAccessible(true);                                                     </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  68                         Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);">  68                         Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver)ðŸ”µ</abbr></span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69                         lookupMap.remove(&quot;jndi&quot;);                                                        </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  71 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  72 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  72 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  73 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74                                                                                                          </span>
<span class="-5060650949853928044" onmouseenter="enter('-5060650949853928044');" onmouseout="out('-5060650949853928044');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  75             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);">  75             Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.ConfðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76                                                                                                          </span>
<span class="5708133052288787212" onmouseenter="enter('5708133052288787212');" onmouseout="out('5708133052288787212');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77             // Due to CVE-2021-45046 we&#x27;re no longer using the reconfigure method -                      </span>
<span class="943906060327858176" onmouseenter="enter('943906060327858176');" onmouseout="out('943906060327858176');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78             // Instead we reconfigure the logger but *also* remove the JNDI listener from the plugin map </span>
<span class="-3474683598063362975" onmouseenter="enter('-3474683598063362975');" onmouseout="out('-3474683598063362975');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79             //try {                                                                                      </span>
<span class="4826773022194098059" onmouseenter="enter('4826773022194098059');" onmouseout="out('4826773022194098059');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80             //    Method reconfigure = configuratorClass.getMethod(&quot;reconfigure&quot;);                       </span>
<span class="6840482095641661782" onmouseenter="enter('6840482095641661782');" onmouseout="out('6840482095641661782');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81             //    reconfigure.invoke(null);                                                              </span>
<span class="-5864710875604098479" onmouseenter="enter('-5864710875604098479');" onmouseout="out('-5864710875604098479');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82             //} catch (Exception ex) {                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83                                                                                                          </span>
<span class="-7183520831341214109" onmouseenter="enter('-7183520831341214109');" onmouseout="out('-7183520831341214109');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84             Method getFactoryMethod = configuratorClass.getDeclaredMethod(&quot;getFactory&quot;);                 </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85             getFactoryMethod.setAccessible(true);                                                        </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86             Object factory = getFactoryMethod.invoke(null);                                              </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  87             Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  87             Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.implðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88             Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                      </span>
<span class="1029865310842325860" onmouseenter="enter('1029865310842325860');" onmouseout="out('1029865310842325860');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89             Object contextSelector = getSelector.invoke(factory, null);                                  </span>
<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90             ContextSelector ctxSelector = (ContextSelector) contextSelector;                             </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91             for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                                   </span>
<span class="3144029218802632169" onmouseenter="enter('3144029218802632169');" onmouseout="out('3144029218802632169');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92                 // The following deadlocks in some tests when using ThreadContext attacks                </span>
<span class="-3948224546903505154" onmouseenter="enter('-3948224546903505154');" onmouseout="out('-3948224546903505154');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93                 //ctx.reconfigure();                                                                     </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94                 Configuration config = ctx.getConfiguration();                                           </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95                 StrLookup resolver = config.getStrSubstitutor().getVariableResolver();                   </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96                 if (resolver instanceof Interpolator) {                                                  </span>
<span class="-8072257225722141933" onmouseenter="enter('-8072257225722141933');" onmouseout="out('-8072257225722141933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97                     System.err.println(&quot;Lookup is an Interpolator - removing JNDI&quot;);                     </span>
<span class="-3307716615945920777" onmouseenter="enter('-3307716615945920777');" onmouseout="out('-3307716615945920777');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98                     Field lookups = null;                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99                     try {                                                                                </span>
<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100                         lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                        </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101                     } catch (NoSuchFieldException e) {                                                   </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102                         lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 104 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105                     }                                                                                    </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style=""> 106                     lookups.setAccessible(true);                                                         </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style=""> 107                     Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);   </span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style=""> 108                     lookupMap.remove(&quot;jndi&quot;);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110             }                                                                                            </span>
<span  style=""> 111                                                                                                          </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 112             //}                                                                                          </span>
<span class="7698420162202467514" onmouseenter="enter('7698420162202467514');" onmouseout="out('7698420162202467514');" style=""> 113         } catch (java.lang.Throwable e) {                                                                </span>
<span class="-6673987533178411809" onmouseenter="enter('-6673987533178411809');" onmouseout="out('-6673987533178411809');" style=""> 114             System.err.println(&quot;Exception &quot; + e);                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 115             e.printStackTrace();                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116         }                                                                                                </span>
<span class="-8820620446306186114" onmouseenter="enter('-8820620446306186114');" onmouseout="out('-8820620446306186114');" style=""> 117         // Modify the log4j jar to fix the vulnerability permanently                                     </span>
<span class="-6948023604691785621" onmouseenter="enter('-6948023604691785621');" onmouseout="out('-6948023604691785621');" style=""> 118         if (c != null) {                                                                                 </span>
<span class="-2031086490927858149" onmouseenter="enter('-2031086490927858149');" onmouseout="out('-2031086490927858149');" style=""> 119             fullyVaccinate(c.getProtectionDomain().getCodeSource().getLocation());                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span  style=""> 122                                                                                                          </span>
<span class="8154133935933236062" onmouseenter="enter('8154133935933236062');" onmouseout="out('8154133935933236062');" style=""> 123     private static void fullyVaccinate(URL jarfile) {                                                    </span>
<span class="2721804508179316028" onmouseenter="enter('2721804508179316028');" onmouseout="out('2721804508179316028');" style=""> 124         String path = jarfile.getFile();                                                                 </span>
<span class="7072163538887110493" onmouseenter="enter('7072163538887110493');" onmouseout="out('7072163538887110493');" style=""> 125         File jar = new File(path);                                                                       </span>
<span class="-5934353960868960769" onmouseenter="enter('-5934353960868960769');" onmouseout="out('-5934353960868960769');" style=""> 126         if (path.endsWith(&quot;.jar&quot;)) {                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 127             try {                                                                                        </span>
<span class="-5171268849103382741" onmouseenter="enter('-5171268849103382741');" onmouseout="out('-5171268849103382741');" style=""> 128                 File fixedjar = new File(&quot;log4j.jar.tmp&quot;);                                               </span>
<span class="4281812503178124042" onmouseenter="enter('4281812503178124042');" onmouseout="out('4281812503178124042');" style=""> 129                 ZipInputStream in = new ZipInputStream(new FileInputStream(path));                       </span>
<span class="2862934014019817110" onmouseenter="enter('2862934014019817110');" onmouseout="out('2862934014019817110');" style=""> 130                 ZipOutputStream out = new ZipOutputStream(new FileOutputStream(fixedjar));               </span>
<span class="4017647276845946273" onmouseenter="enter('4017647276845946273');" onmouseout="out('4017647276845946273');" style=""> 131                 ZipEntry entry;                                                                          </span>
<span class="8663729047094984174" onmouseenter="enter('8663729047094984174');" onmouseout="out('8663729047094984174');" style=""> 132                 while ((entry = in.getNextEntry()) != null) {                                            </span>
<span class="9046440156409504525" onmouseenter="enter('9046440156409504525');" onmouseout="out('9046440156409504525');" style=""> 133                     out.putNextEntry(new ZipEntry(entry.getName()));                                     </span>
<span class="-8083890262488967167" onmouseenter="enter('-8083890262488967167');" onmouseout="out('-8083890262488967167');" style=""> 134                     switch (entry.getName()) {                                                           </span>
<span class="7960299430348559445" onmouseenter="enter('7960299430348559445');" onmouseout="out('7960299430348559445');" style=""> 135                         case &quot;org/apache/logging/log4j/core/util/Constants.class&quot; :                      </span>
<span class="1660807766465307227" onmouseenter="enter('1660807766465307227');" onmouseout="out('1660807766465307227');" style=""><abbr title=" 136                             // base64 of the patched class (FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS set to default false)"> 136                             // base64 of the patched class (FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS set tðŸ”µ</abbr></span>
<span class="4623810668339343843" onmouseenter="enter('4623810668339343843');" onmouseout="out('4623810668339343843');" style=""> 137                             // base64 is more compact than a byte array in source code.                  </span>
<span class="-3980702403993506247" onmouseenter="enter('-3980702403993506247');" onmouseout="out('-3980702403993506247');" style=""><abbr title=" 138                             byte[] newClass = Base64.getDecoder().decode(&quot;&quot; + ((((((((((((((((((((((((((((((((((&quot;yv66vgAAADQAZAEALG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL3V0aWwvQ29uc3RhbnRz&quot; + &quot;BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEADkNvbnN0YW50cy5qYXZhAQAXTE9HNEpfTE9HX0VW&quot;) + &quot;RU5UX0ZBQ1RPUlkBABJMamF2YS9sYW5nL1N0cmluZzsBABRMb2c0akxvZ0V2ZW50RmFjdG9yeQgA&quot;) + &quot;CAEAFkxPRzRKX0NPTlRFWFRfU0VMRUNUT1IBABRMb2c0akNvbnRleHRTZWxlY3RvcggACwEAGkxP&quot;) + &quot;RzRKX0RFRkFVTFRfU1RBVFVTX0xFVkVMAQAXTG9nNGpEZWZhdWx0U3RhdHVzTGV2ZWwIAA4BABFK&quot;) + &quot;TkRJX0NPTlRFWFRfTkFNRQEAIGphdmE6Y29tcC9lbnYvbG9nNGovY29udGV4dC1uYW1lCAARAQAR&quot;) + &quot;TUlMTElTX0lOX1NFQ09ORFMBAAFJAwAAA+gBAB1GT1JNQVRfTUVTU0FHRVNfSU5fQkFDS0dST1VO&quot;) + &quot;RAEAAVoBACdGT1JNQVRfTUVTU0FHRVNfUEFUVEVSTl9ESVNBQkxFX0xPT0tVUFMBAApJU19XRUJf&quot;) + &quot;QVBQAQATRU5BQkxFX1RIUkVBRExPQ0FMUwEAFkVOQUJMRV9ESVJFQ1RfRU5DT0RFUlMBAB1JTklU&quot;) + &quot;SUFMX1JFVVNBQkxFX01FU1NBR0VfU0laRQEAGU1BWF9SRVVTQUJMRV9NRVNTQUdFX1NJWkUBABhF&quot;) + &quot;TkNPREVSX0NIQVJfQlVGRkVSX1NJWkUBABhFTkNPREVSX0JZVEVfQlVGRkVSX1NJWkUBAARzaXpl&quot;) + &quot;AQAWKExqYXZhL2xhbmcvU3RyaW5nO0kpSQEACHByb3BlcnR5AQAMZGVmYXVsdFZhbHVlAQAsb3Jn&quot;) + &quot;L2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWwHACQBAA1nZXRQcm9wZXJ0&quot;) + &quot;aWVzAQAwKClMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWw7DAAm&quot;) + &quot;ACcKACUAKAEAEmdldEludGVnZXJQcm9wZXJ0eQwAKgAhCgAlACsBAAY8aW5pdD4BAAMoKVYMAC0A&quot;) + &quot;LgoABAAvAQAEdGhpcwEALkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS91dGlsL0NvbnN0&quot;) + &quot;YW50czsBAAg8Y2xpbml0PgEAFmxvZzRqLmZvcm1hdC5tc2cuYXN5bmMIADQBABJnZXRCb29sZWFu&quot;) + &quot;UHJvcGVydHkBABYoTGphdmEvbGFuZy9TdHJpbmc7WilaDAA2ADcKACUAOAwAFgAXCQACADoBABls&quot;) + &quot;b2c0ajIuZm9ybWF0TXNnTm9Mb29rdXBzCAA8DAAYABcJAAIAPgEAJ29yZy9hcGFjaGUvbG9nZ2lu&quot;) + &quot;Zy9sb2c0ai91dGlsL0NvbnN0YW50cwcAQAwAGQAXCQBBAEIJAAIAQgwAGgAXCQBBAEUJAAIARQEA&quot;) + &quot;HWxvZzRqMi5lbmFibGUuZGlyZWN0LmVuY29kZXJzCABIDAAbABcJAAIASgEAHGxvZzRqLmluaXRp&quot;) + &quot;YWxSZXVzYWJsZU1zZ1NpemUIAEwMACAAIQoAAgBODAAcABQJAAIAUAEAGGxvZzRqLm1heFJldXNh&quot;) + &quot;YmxlTXNnU2l6ZQgAUgwAHQAUCQACAFQBABxsb2c0ai5lbmNvZGVyLmNoYXJCdWZmZXJTaXplCABW&quot;) + &quot;DAAeABQJAAIAWAEAHGxvZzRqLmVuY29kZXIuYnl0ZUJ1ZmZlclNpemUIAFoMAB8AFAkAAgBcAQAN&quot;) + &quot;Q29uc3RhbnRWYWx1ZQEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFi&quot;) + &quot;bGUBABBNZXRob2RQYXJhbWV0ZXJzAQAKU291cmNlRmlsZQAxAAIABAAAAA4AGQAGAAcAAQBeAAAA&quot;) + &quot;AgAJABkACgAHAAEAXgAAAAIADAAZAA0ABwABAF4AAAACAA8AGQAQAAcAAQBeAAAAAgASABkAEwAU&quot;) + &quot;AAEAXgAAAAIAFQAZABYAFwAAABkAGAAXAAAAGQAZABcAAAAZABoAFwAAABkAGwAXAAAAGQAcABQA&quot;) + &quot;AAAZAB0AFAAAABkAHgAUAAAAGQAfABQAAAADAAoAIAAhAAIAXwAAAD0AAwACAAAACbgAKSobtgAs&quot;) + &quot;rAAAAAIAYAAAAAYAAQAAAIwAYQAAABYAAgAAAAkAIgAHAAAAAAAJACMAFAABAGIAAAAJAgAiABAA&quot;) + &quot;IwAQAAIALQAuAAEAXwAAADMAAQABAAAABSq3ADCxAAAAAgBgAAAACgACAAAAkgAEAJMAYQAAAAwA&quot;) + &quot;AQAAAAUAMQAyAAAACAAzAC4AAQBfAAAAlQADAAAAAABduAApEjUDtgA5swA7uAApEj0EtgA5swA/&quot;) + &quot;sgBDswBEsgBGswBHuAApEkkEtgA5swBLEk0RAIC4AE+zAFESUxECBrgAT7MAVRJXEQgAuABPswBZ&quot;) + &quot;ElsRIAC4AE+zAF2xAAAAAQBgAAAAJgAJAAAANgAMAD8AGABHAB4AUQAkAF4AMABqADsAdQBGAH4A&quot;) + &quot;UQCIAAEAYwAAAAIABQ==&quot;));"> 138                             byte[] newClass = Base64.getDecoder().decode(&quot;&quot; + (((((((((((((((((((((((((((ðŸ”µ</abbr></span>
<span class="-2881021927615668356" onmouseenter="enter('-2881021927615668356');" onmouseout="out('-2881021927615668356');" style=""> 139                             out.write(newClass);                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 140                             break;                                                                       </span>
<span class="-2017574321154475448" onmouseenter="enter('-2017574321154475448');" onmouseout="out('-2017574321154475448');" style=""> 141                         /* Commented out because of compatibility issues - JNDI will be deleted instead  </span>
<span class="8225690662168803363" onmouseenter="enter('8225690662168803363');" onmouseout="out('8225690662168803363');" style=""> 142                            (which will help in almost the same way).                                     </span>
<span class="-690822103287339024" onmouseenter="enter('-690822103287339024');" onmouseout="out('-690822103287339024');" style=""> 143                         --- BEGIN COMMENTED OUT CODE ---                                                 </span>
<span class="1300598719336710267" onmouseenter="enter('1300598719336710267');" onmouseout="out('1300598719336710267');" style=""> 144                         case &quot;org/apache/logging/log4j/core/lookup/Interpolator&quot;:                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 145                             try {                                                                        </span>
<span class="6306698122738590181" onmouseenter="enter('6306698122738590181');" onmouseout="out('6306698122738590181');" style=""> 146                                 // Read class                                                            </span>
<span class="-7733606960254483020" onmouseenter="enter('-7733606960254483020');" onmouseout="out('-7733606960254483020');" style=""> 147                                 ByteArrayOutputStream baos = new ByteArrayOutputStream();                </span>
<span class="-6749975285071333321" onmouseenter="enter('-6749975285071333321');" onmouseout="out('-6749975285071333321');" style=""> 148                                 byte[] buf = new byte[4096];                                             </span>
<span class="-3256038182258764444" onmouseenter="enter('-3256038182258764444');" onmouseout="out('-3256038182258764444');" style=""> 149                                 int i;                                                                   </span>
<span class="-3732795906468031182" onmouseenter="enter('-3732795906468031182');" onmouseout="out('-3732795906468031182');" style=""> 150                                 while ((i = in.read(buf)) &gt; 0) {                                         </span>
<span class="4216607091536741079" onmouseenter="enter('4216607091536741079');" onmouseout="out('4216607091536741079');" style=""> 151                                     baos.write(buf, 0, i);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                                 }                                                                        </span>
<span class="-8686578176186209155" onmouseenter="enter('-8686578176186209155');" onmouseout="out('-8686578176186209155');" style=""> 153                                 ClassReader classReader = new ClassReader(baos.toByteArray());           </span>
<span class="2869256440646022713" onmouseenter="enter('2869256440646022713');" onmouseout="out('2869256440646022713');" style=""> 154                                 ClassNode node = new ClassNode();                                        </span>
<span class="5066694330474698230" onmouseenter="enter('5066694330474698230');" onmouseout="out('5066694330474698230');" style=""> 155                                 classReader.accept(node, 0);                                             </span>
<span  style=""> 156                                                                                                          </span>
<span class="993780422455287995" onmouseenter="enter('993780422455287995');" onmouseout="out('993780422455287995');" style=""> 157                                 FieldNode fn;                                                            </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 158                                 {                                                                        </span>
<span class="6169170470085296909" onmouseenter="enter('6169170470085296909');" onmouseout="out('6169170470085296909');" style=""><abbr title=" 159                                     Optional&lt;FieldNode&gt; optionalFieldNode = node.fields.stream().filter(fieldNode -&gt; fieldNode.desc.contains(&quot;Map&quot;)).findFirst();"> 159                                     Optional&lt;FieldNode&gt; optionalFieldNode = node.fields.stream().filter(fðŸ”µ</abbr></span>
<span class="-4890683031522469612" onmouseenter="enter('-4890683031522469612');" onmouseout="out('-4890683031522469612');" style=""> 160                                     if(optionalFieldNode.isPresent())                                    </span>
<span class="2292638398124691343" onmouseenter="enter('2292638398124691343');" onmouseout="out('2292638398124691343');" style=""> 161                                         fn = optionalFieldNode.get();                                    </span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style=""> 162                                     else                                                                 </span>
<span class="8597900195822035631" onmouseenter="enter('8597900195822035631');" onmouseout="out('8597900195822035631');" style=""> 163                                         throw new NoSuchFieldException(); // This will be caught.        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164                                 }                                                                        </span>
<span  style=""> 165                                                                                                          </span>
<span class="347548408086869105" onmouseenter="enter('347548408086869105');" onmouseout="out('347548408086869105');" style=""> 166                                 // Transform class                                                       </span>
<span class="-40897592052085663" onmouseenter="enter('-40897592052085663');" onmouseout="out('-40897592052085663');" style=""> 167                                 InsnList patch = new InsnList();                                         </span>
<span class="2559522712753472876" onmouseenter="enter('2559522712753472876');" onmouseout="out('2559522712753472876');" style=""> 168                                 patch.add(new VarInsnNode(Opcodes.ALOAD, 0));                            </span>
<span class="3170474550307452027" onmouseenter="enter('3170474550307452027');" onmouseout="out('3170474550307452027');" style=""><abbr title=" 169                                 patch.add(new FieldInsnNode(Opcodes.GETFIELD, &quot;org/apache/logging/log4j/core/lookup/Interpolator&quot;, fn.name, fn.desc));"> 169                                 patch.add(new FieldInsnNode(Opcodes.GETFIELD, &quot;org/apache/logging/log4j/cðŸ”µ</abbr></span>
<span class="-4320499219038723864" onmouseenter="enter('-4320499219038723864');" onmouseout="out('-4320499219038723864');" style=""> 170                                 patch.add(new LdcInsnNode(&quot;jndi&quot;));                                      </span>
<span class="-4933399752139093567" onmouseenter="enter('-4933399752139093567');" onmouseout="out('-4933399752139093567');" style=""><abbr title=" 171                                 patch.add(new MethodInsnNode(Opcodes.INVOKEINTERFACE, &quot;java/util/Map&quot;, &quot;remove&quot;, &quot;(Ljava/lang/Object;)Ljava/lang/Object;&quot;, true));"> 171                                 patch.add(new MethodInsnNode(Opcodes.INVOKEINTERFACE, &quot;java/util/Map&quot;, &quot;rðŸ”µ</abbr></span>
<span class="-5248181223799266069" onmouseenter="enter('-5248181223799266069');" onmouseout="out('-5248181223799266069');" style=""> 172                                 patch.add(new InsnNode(Opcodes.POP));                                    </span>
<span class="-1962264225090806238" onmouseenter="enter('-1962264225090806238');" onmouseout="out('-1962264225090806238');" style=""> 173                                 for (MethodNode method : node.methods) {                                 </span>
<span class="-1096618172524367462" onmouseenter="enter('-1096618172524367462');" onmouseout="out('-1096618172524367462');" style=""> 174                                     if ((method.access &amp; Opcodes.ACC_STATIC) == 0)                       </span>
<span class="6839753926306531364" onmouseenter="enter('6839753926306531364');" onmouseout="out('6839753926306531364');" style=""><abbr title=" 175                                         method.instructions.insertBefore(method.instructions.getFirst(), patch);"> 175                                         method.instructions.insertBefore(method.instructions.getFirst(), ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176                                 }                                                                        </span>
<span  style=""> 177                                                                                                          </span>
<span class="8215395379918876105" onmouseenter="enter('8215395379918876105');" onmouseout="out('8215395379918876105');" style=""> 178                                 // Write class back into zip file                                        </span>
<span class="-16388357595086346" onmouseenter="enter('-16388357595086346');" onmouseout="out('-16388357595086346');" style=""> 179                                 ClassWriter classWriter = new ClassWriter(ClassWriter.COMPUTE_FRAMES);   </span>
<span class="3885991289272469503" onmouseenter="enter('3885991289272469503');" onmouseout="out('3885991289272469503');" style=""> 180                                 node.accept(classWriter);                                                </span>
<span class="-3184219715750894552" onmouseenter="enter('-3184219715750894552');" onmouseout="out('-3184219715750894552');" style=""> 181                                 out.write(classWriter.toByteArray());                                    </span>
<span class="-5240552493773596044" onmouseenter="enter('-5240552493773596044');" onmouseout="out('-5240552493773596044');" style=""> 182                             } catch (Throwable throwable) {                                              </span>
<span class="-2208557086027696042" onmouseenter="enter('-2208557086027696042');" onmouseout="out('-2208557086027696042');" style=""><abbr title=" 183                                 System.err.println(&quot;Couldn&#x27;t fully vaccinate! Deleting JNDILookup to make program crash when the exploit is used!!&quot;);"> 183                                 System.err.println(&quot;Couldn&#x27;t fully vaccinate! Deleting JNDILookup to makeðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184                             }                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 185                             break;                                                                       </span>
<span class="4536196878271734996" onmouseenter="enter('4536196878271734996');" onmouseout="out('4536196878271734996');" style=""> 186                         --- END COMMENTED OUT CODE ---                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 187                          */                                                                              </span>
<span class="4848270223908924347" onmouseenter="enter('4848270223908924347');" onmouseout="out('4848270223908924347');" style=""> 188                         case &quot;org/apache/logging/log4j/core/lookup/JndiLookup.class&quot; :                   </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 189                             break;                                                                       </span>
<span class="4594956059763972444" onmouseenter="enter('4594956059763972444');" onmouseout="out('4594956059763972444');" style=""> 190                         case &quot;META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.dat&quot; : </span>
<span class="-2187357289587503961" onmouseenter="enter('-2187357289587503961');" onmouseout="out('-2187357289587503961');" style=""> 191                             DataOutputStream os = new DataOutputStream(out);                             </span>
<span class="8170944579544493100" onmouseenter="enter('8170944579544493100');" onmouseout="out('8170944579544493100');" style=""> 192                             DataInputStream is = new DataInputStream(new BufferedInputStream(in));       </span>
<span class="2189393843152746332" onmouseenter="enter('2189393843152746332');" onmouseout="out('2189393843152746332');" style=""> 193                             // The old count                                                             </span>
<span class="-2817788437235440697" onmouseenter="enter('-2817788437235440697');" onmouseout="out('-2817788437235440697');" style=""> 194                             int count = is.readInt();                                                    </span>
<span class="6828809636397487558" onmouseenter="enter('6828809636397487558');" onmouseout="out('6828809636397487558');" style=""> 195                             // Names of the visited categories                                           </span>
<span class="-8288077786640075186" onmouseenter="enter('-8288077786640075186');" onmouseout="out('-8288077786640075186');" style=""> 196                             String[] categoryNames = new String[count];                                  </span>
<span class="-1975988671366639430" onmouseenter="enter('-1975988671366639430');" onmouseout="out('-1975988671366639430');" style=""> 197                             // Counts in categories                                                      </span>
<span class="-4468016223310382889" onmouseenter="enter('-4468016223310382889');" onmouseout="out('-4468016223310382889');" style=""> 198                             int[] ecounts = new int[count];                                              </span>
<span class="4330448247209745411" onmouseenter="enter('4330448247209745411');" onmouseout="out('4330448247209745411');" style=""> 199                             // Bytes of the plugin entries, [category count][entries in category][bytes] </span>
<span class="-2880962284113470058" onmouseenter="enter('-2880962284113470058');" onmouseout="out('-2880962284113470058');" style=""> 200                             byte[][][] bytes = new byte[count][][];                                      </span>
<span class="678980937581768133" onmouseenter="enter('678980937581768133');" onmouseout="out('678980937581768133');" style=""> 201                             for (int i = 0; i &lt; count; i++) {                                            </span>
<span class="1425707554760716165" onmouseenter="enter('1425707554760716165');" onmouseout="out('1425707554760716165');" style=""> 202                                 // Category name is read and stores                                      </span>
<span class="-8228615224869585209" onmouseenter="enter('-8228615224869585209');" onmouseout="out('-8228615224869585209');" style=""> 203                                 categoryNames[i] = is.readUTF();                                         </span>
<span class="-2318362565673510988" onmouseenter="enter('-2318362565673510988');" onmouseout="out('-2318362565673510988');" style=""><abbr title=" 204                                 // Amount of entries in category is read and stored, ecounts[i] will be modified gradually."> 204                                 // Amount of entries in category is read and stored, ecounts[i] will be mðŸ”µ</abbr></span>
<span class="5021778449756546424" onmouseenter="enter('5021778449756546424');" onmouseout="out('5021778449756546424');" style=""> 205                                 int ecount = ecounts[i] = is.readInt();                                  </span>
<span class="-7155630024537618154" onmouseenter="enter('-7155630024537618154');" onmouseout="out('-7155630024537618154');" style=""> 206                                 // Initialize bytearray for this category                                </span>
<span class="-5910653406031646993" onmouseenter="enter('-5910653406031646993');" onmouseout="out('-5910653406031646993');" style=""> 207                                 bytes[i] = new byte[ecount][];                                           </span>
<span class="-6777010556405881905" onmouseenter="enter('-6777010556405881905');" onmouseout="out('-6777010556405881905');" style=""> 208                                 // Loop through each plugin                                              </span>
<span class="-6368358362035169166" onmouseenter="enter('-6368358362035169166');" onmouseout="out('-6368358362035169166');" style=""> 209                                 for (int j = 0; j &lt; ecount; j++) {                                       </span>
<span class="8253308415762249827" onmouseenter="enter('8253308415762249827');" onmouseout="out('8253308415762249827');" style=""> 210                                     // Create streams for this plugin                                    </span>
<span class="-7733606960254483020" onmouseenter="enter('-7733606960254483020');" onmouseout="out('-7733606960254483020');" style=""> 211                                     ByteArrayOutputStream baos = new ByteArrayOutputStream();            </span>
<span class="2741117336217559028" onmouseenter="enter('2741117336217559028');" onmouseout="out('2741117336217559028');" style=""> 212                                     DataOutputStream dos = new DataOutputStream(baos);                   </span>
<span class="8083077037796868360" onmouseenter="enter('8083077037796868360');" onmouseout="out('8083077037796868360');" style=""> 213                                     // Read the name                                                     </span>
<span class="6463919721085153430" onmouseenter="enter('6463919721085153430');" onmouseout="out('6463919721085153430');" style=""> 214                                     String name = is.readUTF();                                          </span>
<span class="8573863424536630186" onmouseenter="enter('8573863424536630186');" onmouseout="out('8573863424536630186');" style=""> 215                                     // Copy plugin data to plugin byte array                             </span>
<span class="-8729422349265769971" onmouseenter="enter('-8729422349265769971');" onmouseout="out('-8729422349265769971');" style=""> 216                                     dos.writeUTF(name);                                                  </span>
<span class="7079035244565017816" onmouseenter="enter('7079035244565017816');" onmouseout="out('7079035244565017816');" style=""> 217                                     dos.writeUTF(is.readUTF());                                          </span>
<span class="7079035244565017816" onmouseenter="enter('7079035244565017816');" onmouseout="out('7079035244565017816');" style=""> 218                                     dos.writeUTF(is.readUTF());                                          </span>
<span class="4795091672614515649" onmouseenter="enter('4795091672614515649');" onmouseout="out('4795091672614515649');" style=""> 219                                     dos.writeBoolean(is.readBoolean());                                  </span>
<span class="4795091672614515649" onmouseenter="enter('4795091672614515649');" onmouseout="out('4795091672614515649');" style=""> 220                                     dos.writeBoolean(is.readBoolean());                                  </span>
<span class="-6681743533376239067" onmouseenter="enter('-6681743533376239067');" onmouseout="out('-6681743533376239067');" style=""> 221                                     // Store plugin byte array unless it is JNDI                         </span>
<span class="5445462284885500518" onmouseenter="enter('5445462284885500518');" onmouseout="out('5445462284885500518');" style=""> 222                                     if (name.equals(&quot;jndi&quot;)) {                                           </span>
<span class="-2558574565184019503" onmouseenter="enter('-2558574565184019503');" onmouseout="out('-2558574565184019503');" style=""> 223                                         ecounts[i]--;                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 224                                     } else {                                                             </span>
<span class="4986026144541785271" onmouseenter="enter('4986026144541785271');" onmouseout="out('4986026144541785271');" style=""> 225                                         bytes[i][j - (ecount - ecounts[i])] = baos.toByteArray();        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226                                     }                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228                             }                                                                            </span>
<span class="-7029034432507158552" onmouseenter="enter('-7029034432507158552');" onmouseout="out('-7029034432507158552');" style=""> 229                             // Write back the data we just read                                          </span>
<span class="-6067449727994331636" onmouseenter="enter('-6067449727994331636');" onmouseout="out('-6067449727994331636');" style=""> 230                             os.writeInt(count);                                                          </span>
<span class="678980937581768133" onmouseenter="enter('678980937581768133');" onmouseout="out('678980937581768133');" style=""> 231                             for (int i = 0; i &lt; count; i++) {                                            </span>
<span class="-7038244963968044545" onmouseenter="enter('-7038244963968044545');" onmouseout="out('-7038244963968044545');" style=""> 232                                 // Write category name                                                   </span>
<span class="-100836076290576068" onmouseenter="enter('-100836076290576068');" onmouseout="out('-100836076290576068');" style=""> 233                                 os.writeUTF(categoryNames[i]);                                           </span>
<span class="8864495129488279466" onmouseenter="enter('8864495129488279466');" onmouseout="out('8864495129488279466');" style=""> 234                                 // Amount of plugins in category                                         </span>
<span class="-7004152946774175513" onmouseenter="enter('-7004152946774175513');" onmouseout="out('-7004152946774175513');" style=""> 235                                 int ecount = ecounts[i];                                                 </span>
<span class="-8911547374308671171" onmouseenter="enter('-8911547374308671171');" onmouseout="out('-8911547374308671171');" style=""> 236                                 // Write number of plugins in category                                   </span>
<span class="-8453969108247251576" onmouseenter="enter('-8453969108247251576');" onmouseout="out('-8453969108247251576');" style=""> 237                                 os.writeInt(ecount);                                                     </span>
<span class="-7743498080595140529" onmouseenter="enter('-7743498080595140529');" onmouseout="out('-7743498080595140529');" style=""> 238                                 // Loop through each plugin and write its bytes                          </span>
<span class="-6368358362035169166" onmouseenter="enter('-6368358362035169166');" onmouseout="out('-6368358362035169166');" style=""> 239                                 for (int j = 0; j &lt; ecount; j++) {                                       </span>
<span class="-4204025394089480777" onmouseenter="enter('-4204025394089480777');" onmouseout="out('-4204025394089480777');" style=""> 240                                     os.write(bytes[i][j]);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241                                 }                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242                             }                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 243                             break;                                                                       </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 244                         default :                                                                        </span>
<span class="-6749975285071333321" onmouseenter="enter('-6749975285071333321');" onmouseout="out('-6749975285071333321');" style=""> 245                             byte[] buf = new byte[4096];                                                 </span>
<span class="-3256038182258764444" onmouseenter="enter('-3256038182258764444');" onmouseout="out('-3256038182258764444');" style=""> 246                             int i;                                                                       </span>
<span class="-3732795906468031182" onmouseenter="enter('-3732795906468031182');" onmouseout="out('-3732795906468031182');" style=""> 247                             while ((i = in.read(buf)) &gt; 0) {                                             </span>
<span class="520129420414042296" onmouseenter="enter('520129420414042296');" onmouseout="out('520129420414042296');" style=""> 248                                 out.write(buf, 0, i);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249                             }                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 250                             break;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251                     }                                                                                    </span>
<span class="6598446692900240133" onmouseenter="enter('6598446692900240133');" onmouseout="out('6598446692900240133');" style=""> 252                     out.closeEntry();                                                                    </span>
<span class="5812471547147079698" onmouseenter="enter('5812471547147079698');" onmouseout="out('5812471547147079698');" style=""> 253                     in.closeEntry();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254                 }                                                                                        </span>
<span class="-566937293990578116" onmouseenter="enter('-566937293990578116');" onmouseout="out('-566937293990578116');" style=""> 255                 in.close();                                                                              </span>
<span class="5013182197958409712" onmouseenter="enter('5013182197958409712');" onmouseout="out('5013182197958409712');" style=""> 256                 out.close();                                                                             </span>
<span class="9197923713511817553" onmouseenter="enter('9197923713511817553');" onmouseout="out('9197923713511817553');" style=""> 257                 if ((!jar.delete()) || (!fixedjar.renameTo(jar))) {                                      </span>
<span class="3321711593720116411" onmouseenter="enter('3321711593720116411');" onmouseout="out('3321711593720116411');" style=""> 258                     System.err.println(&quot;Couldn&#x27;t patch jar.&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259                 }                                                                                        </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 260             } catch (java.lang.Exception e) {                                                            </span>
<span class="3321711593720116411" onmouseenter="enter('3321711593720116411');" onmouseout="out('3321711593720116411');" style=""> 261                 System.err.println(&quot;Couldn&#x27;t patch jar.&quot;);                                               </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 262                 e.printStackTrace();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265     }                                                                                                    </span>
<span  style=""> 266                                                                                                          </span>
<span class="-4283724445844521558" onmouseenter="enter('-4283724445844521558');" onmouseout="out('-4283724445844521558');" style=""> 267     private static void setAccess(Field field) throws NoSuchFieldException, IllegalAccessException {     </span>
<span class="-242302875073644057" onmouseenter="enter('-242302875073644057');" onmouseout="out('-242302875073644057');" style=""> 268         field.setAccessible(true);                                                                       </span>
<span class="-8869727192744571657" onmouseenter="enter('-8869727192744571657');" onmouseout="out('-8869727192744571657');" style=""> 269         Field modifiersField = Field.class.getDeclaredField(&quot;modifiers&quot;);                                </span>
<span class="1521535264742225996" onmouseenter="enter('1521535264742225996');" onmouseout="out('1521535264742225996');" style=""> 270         modifiersField.setAccessible(true);                                                              </span>
<span class="-5863712544267326274" onmouseenter="enter('-5863712544267326274');" onmouseout="out('-5863712544267326274');" style=""> 271         modifiersField.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273 }                                                                                                        </span>


















































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-538473715904851717" onmouseenter="enter('-538473715904851717');" onmouseout="out('-538473715904851717');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   1 -import org.apache.logging.log4j.LogManager;                                                                       </span>
<span class="6691182795354635370" onmouseenter="enter('6691182795354635370');" onmouseout="out('6691182795354635370');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   2 +/* Commented out because they are only needed for another commented-out                                           </span>
<span class="-8797436401024994820" onmouseenter="enter('-8797436401024994820');" onmouseout="out('-8797436401024994820');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   3 +   code block.                                                                                                    </span>
<span class="-690822103287339024" onmouseenter="enter('-690822103287339024');" onmouseout="out('-690822103287339024');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   4 +--- BEGIN COMMENTED OUT CODE ---                                                                                  </span>
<span class="-2049169779958178167" onmouseenter="enter('-2049169779958178167');" onmouseout="out('-2049169779958178167');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   5 +import jdk.internal.org.objectweb.asm.ClassReader;                                                                </span>
<span class="7965369241423847631" onmouseenter="enter('7965369241423847631');" onmouseout="out('7965369241423847631');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   6 +import jdk.internal.org.objectweb.asm.ClassWriter;                                                                </span>
<span class="-4339491913814058330" onmouseenter="enter('-4339491913814058330');" onmouseout="out('-4339491913814058330');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   7 +import jdk.internal.org.objectweb.asm.Opcodes;                                                                    </span>
<span class="8249904259647672485" onmouseenter="enter('8249904259647672485');" onmouseout="out('8249904259647672485');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   8 +import jdk.internal.org.objectweb.asm.tree.*;                                                                     </span>
<span class="9184227348967602043" onmouseenter="enter('9184227348967602043');" onmouseout="out('9184227348967602043');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">   9 +import java.io.ByteArrayOutputStream;                                                                             </span>
<span class="-4914279600566636630" onmouseenter="enter('-4914279600566636630');" onmouseout="out('-4914279600566636630');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  10 +import java.util.Optional;                                                                                        </span>
<span class="4536196878271734996" onmouseenter="enter('4536196878271734996');" onmouseout="out('4536196878271734996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  11 +--- END COMMENTED OUT CODE ---                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  12 + */                                                                                                               </span>
<span class="584651227269278890" onmouseenter="enter('584651227269278890');" onmouseout="out('584651227269278890');" style="">  13  import org.apache.logging.log4j.core.LoggerContext;                                                               </span>
<span class="-2437324594807133199" onmouseenter="enter('-2437324594807133199');" onmouseout="out('-2437324594807133199');" style="">  14  import org.apache.logging.log4j.core.config.Configuration;                                                        </span>
<span class="6632971262397233417" onmouseenter="enter('6632971262397233417');" onmouseout="out('6632971262397233417');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  15 -import org.apache.logging.log4j.core.config.Configurator;                                                         </span>
<span class="-767245909935616887" onmouseenter="enter('-767245909935616887');" onmouseout="out('-767245909935616887');" style="">  16  import org.apache.logging.log4j.core.lookup.Interpolator;                                                         </span>
<span class="-6291433712522694528" onmouseenter="enter('-6291433712522694528');" onmouseout="out('-6291433712522694528');" style="">  17  import org.apache.logging.log4j.core.lookup.StrLookup;                                                            </span>
<span class="-5806274082705791162" onmouseenter="enter('-5806274082705791162');" onmouseout="out('-5806274082705791162');" style="">  18  import org.apache.logging.log4j.core.selector.ContextSelector;                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span class="6779715416064674619" onmouseenter="enter('6779715416064674619');" onmouseout="out('6779715416064674619');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import java.io.*;                                                                                                 </span>
<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">  21  import java.lang.reflect.Field;                                                                                   </span>
<span class="2674806488057045420" onmouseenter="enter('2674806488057045420');" onmouseout="out('2674806488057045420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import java.lang.reflect.Constructor;                                                                             </span>
<span class="3877996116863688216" onmouseenter="enter('3877996116863688216');" onmouseout="out('3877996116863688216');" style="">  23  import java.lang.reflect.Method;                                                                                  </span>
<span class="1546464639948964552" onmouseenter="enter('1546464639948964552');" onmouseout="out('1546464639948964552');" style="">  24  import java.lang.reflect.Modifier;                                                                                </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import java.util.HashMap;                                                                                         </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import java.net.URL;                                                                                              </span>
<span class="-6935710760624141930" onmouseenter="enter('-6935710760624141930');" onmouseout="out('-6935710760624141930');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import java.util.Base64;                                                                                          </span>
<span class="803450442014170948" onmouseenter="enter('803450442014170948');" onmouseout="out('803450442014170948');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +import java.util.zip.ZipEntry;                                                                                    </span>
<span class="4611873531984630168" onmouseenter="enter('4611873531984630168');" onmouseout="out('4611873531984630168');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import java.util.zip.ZipInputStream;                                                                              </span>
<span class="-7973848186377225832" onmouseenter="enter('-7973848186377225832');" onmouseout="out('-7973848186377225832');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +import java.util.zip.ZipOutputStream;                                                                             </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  31  import java.util.Map;                                                                                             </span>
<span  style="">  32                                                                                                                    </span>
<span class="-1419637519660801597" onmouseenter="enter('-1419637519660801597');" onmouseout="out('-1419637519660801597');" style="">  33  public class Log4jRCE {                                                                                           </span>
<span class="2640580777198908089" onmouseenter="enter('2640580777198908089');" onmouseout="out('2640580777198908089');" style="">  34      static {                                                                                                      </span>
<span class="-6460963334547882165" onmouseenter="enter('-6460963334547882165');" onmouseout="out('-6460963334547882165');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +        Class&lt;?&gt; c = null;                                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  36          try {                                                                                                     </span>
<span class="2740482109536166617" onmouseenter="enter('2740482109536166617');" onmouseout="out('2740482109536166617');" style="">  37              try { // Try for versions of Log4j &gt;= 2.10                                                            </span>
<span class="-1740166836903519956" onmouseenter="enter('-1740166836903519956');" onmouseout="out('-1740166836903519956');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  38 -              Class&lt;?&gt; c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.core.util.Constants&quot;);">  38 -              Class&lt;?&gt; c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.coreðŸ”µ</abbr></span>
<span class="4331306856400516015" onmouseenter="enter('4331306856400516015');" onmouseout="out('4331306856400516015');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -              Field field = c.getField(&quot;FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS&quot;);                                </span>
<span class="-6039644475557245276" onmouseenter="enter('-6039644475557245276');" onmouseout="out('-6039644475557245276');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -              System.out.println(&quot;Setting &quot; + field.getName() + &quot; value to True&quot;);                                </span>
<span class="1871502532107925563" onmouseenter="enter('1871502532107925563');" onmouseout="out('1871502532107925563');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -              setFinalStatic(field, Boolean.TRUE);                                                                </span>
<span class="3171147576542081904" onmouseenter="enter('3171147576542081904');" onmouseout="out('3171147576542081904');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -            } catch (NoSuchFieldException e) { // Fall back to older versions. Try to make JNDI non instantiable  </span>
<span class="-8598636720620456978" onmouseenter="enter('-8598636720620456978');" onmouseout="out('-8598636720620456978');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  43 +                c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.core.util.Constants&quot;);">  43 +                c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.core.util.CðŸ”µ</abbr></span>
<span class="4331306856400516015" onmouseenter="enter('4331306856400516015');" onmouseout="out('4331306856400516015');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +                Field field = c.getField(&quot;FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS&quot;);                              </span>
<span class="-6039644475557245276" onmouseenter="enter('-6039644475557245276');" onmouseout="out('-6039644475557245276');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +                System.out.println(&quot;Setting &quot; + field.getName() + &quot; value to True&quot;);                              </span>
<span class="7945815878112567707" onmouseenter="enter('7945815878112567707');" onmouseout="out('7945815878112567707');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +                setAccess(field);                                                                                 </span>
<span class="4217794172310991600" onmouseenter="enter('4217794172310991600');" onmouseout="out('4217794172310991600');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +                field.set(null, Boolean.TRUE);                                                                    </span>
<span class="4799298389398123314" onmouseenter="enter('4799298389398123314');" onmouseout="out('4799298389398123314');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +            } catch (Throwable e) { // Fall back to older versions. Try to make JNDI non instantiable             </span>
<span class="4783372292862450861" onmouseenter="enter('4783372292862450861');" onmouseout="out('4783372292862450861');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +                c = null;                                                                                         </span>
<span class="-2894496202058774448" onmouseenter="enter('-2894496202058774448');" onmouseout="out('-2894496202058774448');" style="">  50                  System.err.println(&quot;No field FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS - version &lt;= 2.9.0&quot;);        </span>
<span class="-2014864819161789369" onmouseenter="enter('-2014864819161789369');" onmouseout="out('-2014864819161789369');" style="">  51                  System.err.println(&quot;Will attempt to modify the configuration directly&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  52              }                                                                                                     </span>
<span  style="">  53                                                                                                                    </span>
<span class="2318669164687223218" onmouseenter="enter('2318669164687223218');" onmouseout="out('2318669164687223218');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -            //reconfiguring log4j                                                                                 </span>
<span class="-968764517086271557" onmouseenter="enter('-968764517086271557');" onmouseout="out('-968764517086271557');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +            // Reconfigure log4j                                                                                  </span>
<span class="-8193543035602096174" onmouseenter="enter('-8193543035602096174');" onmouseout="out('-8193543035602096174');" style="">  56              ClassLoader classLoader = Thread.currentThread().getContextClassLoader();                             </span>
<span class="-5060650949853928044" onmouseenter="enter('-5060650949853928044');" onmouseout="out('-5060650949853928044');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  57 -            Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);">  57 -            Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;ðŸ”µ</abbr></span>
<span class="-5344911972097151889" onmouseenter="enter('-5344911972097151889');" onmouseout="out('-5344911972097151889');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +            c = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  59              try {                                                                                                 </span>
<span class="2807729132951612984" onmouseenter="enter('2807729132951612984');" onmouseout="out('2807729132951612984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -                Method reconfigure = configuratorClass.getMethod(&quot;reconfigure&quot;);                                  </span>
<span class="8827340200273165867" onmouseenter="enter('8827340200273165867');" onmouseout="out('8827340200273165867');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +                Method reconfigure = c.getMethod(&quot;reconfigure&quot;);                                                  </span>
<span class="-1592794414110319594" onmouseenter="enter('-1592794414110319594');" onmouseout="out('-1592794414110319594');" style="">  62                  reconfigure.invoke(null);                                                                         </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style="">  63              } catch (Exception ex) {                                                                              </span>
<span class="-7183520831341214109" onmouseenter="enter('-7183520831341214109');" onmouseout="out('-7183520831341214109');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  64 -                Method getFactoryMethod = configuratorClass.getDeclaredMethod(&quot;getFactory&quot;);                      </span>
<span class="-6344238665933181139" onmouseenter="enter('-6344238665933181139');" onmouseout="out('-6344238665933181139');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +                // Log4j is probably older.                                                                       </span>
<span class="-3857331607984793593" onmouseenter="enter('-3857331607984793593');" onmouseout="out('-3857331607984793593');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +                Method getFactoryMethod = c.getDeclaredMethod(&quot;getFactory&quot;);                                      </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="">  67                  getFactoryMethod.setAccessible(true);                                                             </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="">  68                  Object factory = getFactoryMethod.invoke(null);                                                   </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style=""><abbr title="  69                  Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  69                  Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4ðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="">  70                  Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                           </span>
<span class="1029865310842325860" onmouseenter="enter('1029865310842325860');" onmouseout="out('1029865310842325860');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -                Object contextSelector = getSelector.invoke(factory, null);                                       </span>
<span class="-5294705432399827736" onmouseenter="enter('-5294705432399827736');" onmouseout="out('-5294705432399827736');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +                Object contextSelector = getSelector.invoke(factory, (Object[]) null);                            </span>
<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="">  73                  ContextSelector ctxSelector = (ContextSelector) contextSelector;                                  </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="">  74                  for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                                        </span>
<span class="-195599926832777290" onmouseenter="enter('-195599926832777290');" onmouseout="out('-195599926832777290');" style="">  75                      ctx.reconfigure();                                                                            </span>
<span class="-8085575071251224001" onmouseenter="enter('-8085575071251224001');" onmouseout="out('-8085575071251224001');" style="">  76                      System.err.println(&quot;Reconfiguring context&quot;);                                                  </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="">  77                      Configuration config = ctx.getConfiguration();                                                </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="">  78                      StrLookup resolver = config.getStrSubstitutor().getVariableResolver();                        </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="">  79                      if (resolver instanceof Interpolator) {                                                       </span>
<span class="2051812310513197980" onmouseenter="enter('2051812310513197980');" onmouseout="out('2051812310513197980');" style="">  80                          System.err.println(&quot;Lookup is an Interpolator - attempting to remove JNDI&quot;);              </span>
<span class="-3307716615945920777" onmouseenter="enter('-3307716615945920777');" onmouseout="out('-3307716615945920777');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -                        Field lookups = null;                                                                     </span>
<span class="-227504778537810497" onmouseenter="enter('-227504778537810497');" onmouseout="out('-227504778537810497');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +                        Field lookups;                                                                            </span>
<span class="-3500715653028958316" onmouseenter="enter('-3500715653028958316');" onmouseout="out('-3500715653028958316');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +                        //noinspection RedundantSuppression                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  84                          try {                                                                                     </span>
<span class="7057696748496001259" onmouseenter="enter('7057696748496001259');" onmouseout="out('7057696748496001259');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +                            //noinspection JavaReflectionMemberAccess                                             </span>
<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style="">  86                              lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                             </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="">  87                          } catch (NoSuchFieldException e) {                                                        </span>
<span class="7057696748496001259" onmouseenter="enter('7057696748496001259');" onmouseout="out('7057696748496001259');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +                            //noinspection JavaReflectionMemberAccess                                             </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="">  89                              lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90                          }                                                                                         </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style="">  91                          lookups.setAccessible(true);                                                              </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style="">  92                          Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);        </span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style="">  93                          lookupMap.remove(&quot;jndi&quot;);                                                                 </span>



























<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94                      }                                                                                             </span>



<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96              }                                                                                                     </span>


<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -        } catch (Exception e) {                                                                                   </span>
<span class="-1156395882344945528" onmouseenter="enter('-1156395882344945528');" onmouseout="out('-1156395882344945528');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +        } catch (Throwable e) {                                                                                   </span>
<span class="-6673987533178411809" onmouseenter="enter('-6673987533178411809');" onmouseout="out('-6673987533178411809');" style="">  99              System.err.println(&quot;Exception &quot; + e);                                                                 </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style=""> 100              e.printStackTrace();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101          }                                                                                                         </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +                                                                                                                  </span>
<span class="-8820620446306186114" onmouseenter="enter('-8820620446306186114');" onmouseout="out('-8820620446306186114');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +        // Modify the log4j jar to fix the vulnerability permanently                                              </span>
<span class="4622163534113836460" onmouseenter="enter('4622163534113836460');" onmouseout="out('4622163534113836460');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +        if(c != null)                                                                                             </span>
<span class="-2031086490927858149" onmouseenter="enter('-2031086490927858149');" onmouseout="out('-2031086490927858149');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +            fullyVaccinate(c.getProtectionDomain().getCodeSource().getLocation());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106      }                                                                                                             </span>
<span  style=""> 107                                                                                                                    </span>
<span class="7460090326972894103" onmouseenter="enter('7460090326972894103');" onmouseout="out('7460090326972894103');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -    static void setFinalStatic(Field field, Object newValue) throws Exception {                                   </span>
<span class="7945815878112567707" onmouseenter="enter('7945815878112567707');" onmouseout="out('7945815878112567707');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -        setAccess(field);                                                                                         </span>
<span class="-2423047719989674028" onmouseenter="enter('-2423047719989674028');" onmouseout="out('-2423047719989674028');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -        field.set(null, newValue);                                                                                </span>
<span class="8154133935933236062" onmouseenter="enter('8154133935933236062');" onmouseout="out('8154133935933236062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +    private static void fullyVaccinate(URL jarfile) {                                                             </span>
<span class="2721804508179316028" onmouseenter="enter('2721804508179316028');" onmouseout="out('2721804508179316028');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +        String path = jarfile.getFile();                                                                          </span>
<span class="7072163538887110493" onmouseenter="enter('7072163538887110493');" onmouseout="out('7072163538887110493');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +        File jar = new File(path);                                                                                </span>
<span class="-3583999738466172937" onmouseenter="enter('-3583999738466172937');" onmouseout="out('-3583999738466172937');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +        if(path.endsWith(&quot;.jar&quot;)) {                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +            try {                                                                                                 </span>
<span class="-5171268849103382741" onmouseenter="enter('-5171268849103382741');" onmouseout="out('-5171268849103382741');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +                File fixedjar = new File(&quot;log4j.jar.tmp&quot;);                                                        </span>
<span class="4281812503178124042" onmouseenter="enter('4281812503178124042');" onmouseout="out('4281812503178124042');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +                ZipInputStream in = new ZipInputStream(new FileInputStream(path));                                </span>
<span class="2862934014019817110" onmouseenter="enter('2862934014019817110');" onmouseout="out('2862934014019817110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +                ZipOutputStream out = new ZipOutputStream(new FileOutputStream(fixedjar));                        </span>
<span class="4017647276845946273" onmouseenter="enter('4017647276845946273');" onmouseout="out('4017647276845946273');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +                ZipEntry entry;                                                                                   </span>
<span class="8663729047094984174" onmouseenter="enter('8663729047094984174');" onmouseout="out('8663729047094984174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +                while ((entry = in.getNextEntry()) != null) {                                                     </span>
<span class="9046440156409504525" onmouseenter="enter('9046440156409504525');" onmouseout="out('9046440156409504525');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +                    out.putNextEntry(new ZipEntry(entry.getName()));                                              </span>
<span class="-8083890262488967167" onmouseenter="enter('-8083890262488967167');" onmouseout="out('-8083890262488967167');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +                    switch (entry.getName()) {                                                                    </span>
<span class="-5691656988002378082" onmouseenter="enter('-5691656988002378082');" onmouseout="out('-5691656988002378082');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +                        case &quot;org/apache/logging/log4j/core/util/Constants.class&quot;:                                </span>
<span class="1660807766465307227" onmouseenter="enter('1660807766465307227');" onmouseout="out('1660807766465307227');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 124 +                            // base64 of the patched class (FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS set to default false)"> 124 +                            // base64 of the patched class (FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS set to defaultðŸ”µ</abbr></span>
<span class="4623810668339343843" onmouseenter="enter('4623810668339343843');" onmouseout="out('4623810668339343843');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +                            // base64 is more compact than a byte array in source code.                           </span>
<span class="6084565888398312712" onmouseenter="enter('6084565888398312712');" onmouseout="out('6084565888398312712');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +                            byte[] newClass = Base64.getDecoder().decode(&quot;&quot; +                                     </span>
<span class="-5561122516707250067" onmouseenter="enter('-5561122516707250067');" onmouseout="out('-5561122516707250067');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 127 +                                    &quot;yv66vgAAADQAZAEALG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL3V0aWwvQ29uc3RhbnRz&quot; +"> 127 +                                    &quot;yv66vgAAADQAZAEALG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL3V0aWwvQ29uc3RhbnRz&quot;ðŸ”µ</abbr></span>
<span class="-756816418793786082" onmouseenter="enter('-756816418793786082');" onmouseout="out('-756816418793786082');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 128 +                                    &quot;BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEADkNvbnN0YW50cy5qYXZhAQAXTE9HNEpfTE9HX0VW&quot; +"> 128 +                                    &quot;BwABAQAQamF2YS9sYW5nL09iamVjdAcAAwEADkNvbnN0YW50cy5qYXZhAQAXTE9HNEpfTE9HX0VW&quot;ðŸ”µ</abbr></span>
<span class="-3984816082022713717" onmouseenter="enter('-3984816082022713717');" onmouseout="out('-3984816082022713717');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 129 +                                    &quot;RU5UX0ZBQ1RPUlkBABJMamF2YS9sYW5nL1N0cmluZzsBABRMb2c0akxvZ0V2ZW50RmFjdG9yeQgA&quot; +"> 129 +                                    &quot;RU5UX0ZBQ1RPUlkBABJMamF2YS9sYW5nL1N0cmluZzsBABRMb2c0akxvZ0V2ZW50RmFjdG9yeQgA&quot;ðŸ”µ</abbr></span>
<span class="109114158608130524" onmouseenter="enter('109114158608130524');" onmouseout="out('109114158608130524');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 130 +                                    &quot;CAEAFkxPRzRKX0NPTlRFWFRfU0VMRUNUT1IBABRMb2c0akNvbnRleHRTZWxlY3RvcggACwEAGkxP&quot; +"> 130 +                                    &quot;CAEAFkxPRzRKX0NPTlRFWFRfU0VMRUNUT1IBABRMb2c0akNvbnRleHRTZWxlY3RvcggACwEAGkxP&quot;ðŸ”µ</abbr></span>
<span class="5654115324350911325" onmouseenter="enter('5654115324350911325');" onmouseout="out('5654115324350911325');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 131 +                                    &quot;RzRKX0RFRkFVTFRfU1RBVFVTX0xFVkVMAQAXTG9nNGpEZWZhdWx0U3RhdHVzTGV2ZWwIAA4BABFK&quot; +"> 131 +                                    &quot;RzRKX0RFRkFVTFRfU1RBVFVTX0xFVkVMAQAXTG9nNGpEZWZhdWx0U3RhdHVzTGV2ZWwIAA4BABFK&quot;ðŸ”µ</abbr></span>
<span class="-2454458896399870169" onmouseenter="enter('-2454458896399870169');" onmouseout="out('-2454458896399870169');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 132 +                                    &quot;TkRJX0NPTlRFWFRfTkFNRQEAIGphdmE6Y29tcC9lbnYvbG9nNGovY29udGV4dC1uYW1lCAARAQAR&quot; +"> 132 +                                    &quot;TkRJX0NPTlRFWFRfTkFNRQEAIGphdmE6Y29tcC9lbnYvbG9nNGovY29udGV4dC1uYW1lCAARAQAR&quot;ðŸ”µ</abbr></span>
<span class="-1138789116125002182" onmouseenter="enter('-1138789116125002182');" onmouseout="out('-1138789116125002182');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 133 +                                    &quot;TUlMTElTX0lOX1NFQ09ORFMBAAFJAwAAA+gBAB1GT1JNQVRfTUVTU0FHRVNfSU5fQkFDS0dST1VO&quot; +"> 133 +                                    &quot;TUlMTElTX0lOX1NFQ09ORFMBAAFJAwAAA+gBAB1GT1JNQVRfTUVTU0FHRVNfSU5fQkFDS0dST1VO&quot;ðŸ”µ</abbr></span>
<span class="-7533713598084409785" onmouseenter="enter('-7533713598084409785');" onmouseout="out('-7533713598084409785');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 134 +                                    &quot;RAEAAVoBACdGT1JNQVRfTUVTU0FHRVNfUEFUVEVSTl9ESVNBQkxFX0xPT0tVUFMBAApJU19XRUJf&quot; +"> 134 +                                    &quot;RAEAAVoBACdGT1JNQVRfTUVTU0FHRVNfUEFUVEVSTl9ESVNBQkxFX0xPT0tVUFMBAApJU19XRUJf&quot;ðŸ”µ</abbr></span>
<span class="-7207099870752961264" onmouseenter="enter('-7207099870752961264');" onmouseout="out('-7207099870752961264');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 135 +                                    &quot;QVBQAQATRU5BQkxFX1RIUkVBRExPQ0FMUwEAFkVOQUJMRV9ESVJFQ1RfRU5DT0RFUlMBAB1JTklU&quot; +"> 135 +                                    &quot;QVBQAQATRU5BQkxFX1RIUkVBRExPQ0FMUwEAFkVOQUJMRV9ESVJFQ1RfRU5DT0RFUlMBAB1JTklU&quot;ðŸ”µ</abbr></span>
<span class="4815342611662896598" onmouseenter="enter('4815342611662896598');" onmouseout="out('4815342611662896598');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 136 +                                    &quot;SUFMX1JFVVNBQkxFX01FU1NBR0VfU0laRQEAGU1BWF9SRVVTQUJMRV9NRVNTQUdFX1NJWkUBABhF&quot; +"> 136 +                                    &quot;SUFMX1JFVVNBQkxFX01FU1NBR0VfU0laRQEAGU1BWF9SRVVTQUJMRV9NRVNTQUdFX1NJWkUBABhF&quot;ðŸ”µ</abbr></span>
<span class="-1782873389891306648" onmouseenter="enter('-1782873389891306648');" onmouseout="out('-1782873389891306648');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 137 +                                    &quot;TkNPREVSX0NIQVJfQlVGRkVSX1NJWkUBABhFTkNPREVSX0JZVEVfQlVGRkVSX1NJWkUBAARzaXpl&quot; +"> 137 +                                    &quot;TkNPREVSX0NIQVJfQlVGRkVSX1NJWkUBABhFTkNPREVSX0JZVEVfQlVGRkVSX1NJWkUBAARzaXpl&quot;ðŸ”µ</abbr></span>
<span class="1901774131252985558" onmouseenter="enter('1901774131252985558');" onmouseout="out('1901774131252985558');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 138 +                                    &quot;AQAWKExqYXZhL2xhbmcvU3RyaW5nO0kpSQEACHByb3BlcnR5AQAMZGVmYXVsdFZhbHVlAQAsb3Jn&quot; +"> 138 +                                    &quot;AQAWKExqYXZhL2xhbmcvU3RyaW5nO0kpSQEACHByb3BlcnR5AQAMZGVmYXVsdFZhbHVlAQAsb3Jn&quot;ðŸ”µ</abbr></span>
<span class="-1053467704281304668" onmouseenter="enter('-1053467704281304668');" onmouseout="out('-1053467704281304668');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 139 +                                    &quot;L2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWwHACQBAA1nZXRQcm9wZXJ0&quot; +"> 139 +                                    &quot;L2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWwHACQBAA1nZXRQcm9wZXJ0&quot;ðŸ”µ</abbr></span>
<span class="-5160184126636760015" onmouseenter="enter('-5160184126636760015');" onmouseout="out('-5160184126636760015');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 140 +                                    &quot;aWVzAQAwKClMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWw7DAAm&quot; +"> 140 +                                    &quot;aWVzAQAwKClMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL3V0aWwvUHJvcGVydGllc1V0aWw7DAAm&quot;ðŸ”µ</abbr></span>
<span class="-4517541909066786192" onmouseenter="enter('-4517541909066786192');" onmouseout="out('-4517541909066786192');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 141 +                                    &quot;ACcKACUAKAEAEmdldEludGVnZXJQcm9wZXJ0eQwAKgAhCgAlACsBAAY8aW5pdD4BAAMoKVYMAC0A&quot; +"> 141 +                                    &quot;ACcKACUAKAEAEmdldEludGVnZXJQcm9wZXJ0eQwAKgAhCgAlACsBAAY8aW5pdD4BAAMoKVYMAC0A&quot;ðŸ”µ</abbr></span>
<span class="1493674449025065653" onmouseenter="enter('1493674449025065653');" onmouseout="out('1493674449025065653');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 142 +                                    &quot;LgoABAAvAQAEdGhpcwEALkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS91dGlsL0NvbnN0&quot; +"> 142 +                                    &quot;LgoABAAvAQAEdGhpcwEALkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS91dGlsL0NvbnN0&quot;ðŸ”µ</abbr></span>
<span class="566455589877770702" onmouseenter="enter('566455589877770702');" onmouseout="out('566455589877770702');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 143 +                                    &quot;YW50czsBAAg8Y2xpbml0PgEAFmxvZzRqLmZvcm1hdC5tc2cuYXN5bmMIADQBABJnZXRCb29sZWFu&quot; +"> 143 +                                    &quot;YW50czsBAAg8Y2xpbml0PgEAFmxvZzRqLmZvcm1hdC5tc2cuYXN5bmMIADQBABJnZXRCb29sZWFu&quot;ðŸ”µ</abbr></span>
<span class="6453800866524882267" onmouseenter="enter('6453800866524882267');" onmouseout="out('6453800866524882267');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 144 +                                    &quot;UHJvcGVydHkBABYoTGphdmEvbGFuZy9TdHJpbmc7WilaDAA2ADcKACUAOAwAFgAXCQACADoBABls&quot; +"> 144 +                                    &quot;UHJvcGVydHkBABYoTGphdmEvbGFuZy9TdHJpbmc7WilaDAA2ADcKACUAOAwAFgAXCQACADoBABls&quot;ðŸ”µ</abbr></span>
<span class="7332413416388698324" onmouseenter="enter('7332413416388698324');" onmouseout="out('7332413416388698324');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 145 +                                    &quot;b2c0ajIuZm9ybWF0TXNnTm9Mb29rdXBzCAA8DAAYABcJAAIAPgEAJ29yZy9hcGFjaGUvbG9nZ2lu&quot; +"> 145 +                                    &quot;b2c0ajIuZm9ybWF0TXNnTm9Mb29rdXBzCAA8DAAYABcJAAIAPgEAJ29yZy9hcGFjaGUvbG9nZ2lu&quot;ðŸ”µ</abbr></span>
<span class="-4929360902344800948" onmouseenter="enter('-4929360902344800948');" onmouseout="out('-4929360902344800948');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 146 +                                    &quot;Zy9sb2c0ai91dGlsL0NvbnN0YW50cwcAQAwAGQAXCQBBAEIJAAIAQgwAGgAXCQBBAEUJAAIARQEA&quot; +"> 146 +                                    &quot;Zy9sb2c0ai91dGlsL0NvbnN0YW50cwcAQAwAGQAXCQBBAEIJAAIAQgwAGgAXCQBBAEUJAAIARQEA&quot;ðŸ”µ</abbr></span>
<span class="8686424228131230190" onmouseenter="enter('8686424228131230190');" onmouseout="out('8686424228131230190');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 147 +                                    &quot;HWxvZzRqMi5lbmFibGUuZGlyZWN0LmVuY29kZXJzCABIDAAbABcJAAIASgEAHGxvZzRqLmluaXRp&quot; +"> 147 +                                    &quot;HWxvZzRqMi5lbmFibGUuZGlyZWN0LmVuY29kZXJzCABIDAAbABcJAAIASgEAHGxvZzRqLmluaXRp&quot;ðŸ”µ</abbr></span>
<span class="-8601181698896963885" onmouseenter="enter('-8601181698896963885');" onmouseout="out('-8601181698896963885');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 148 +                                    &quot;YWxSZXVzYWJsZU1zZ1NpemUIAEwMACAAIQoAAgBODAAcABQJAAIAUAEAGGxvZzRqLm1heFJldXNh&quot; +"> 148 +                                    &quot;YWxSZXVzYWJsZU1zZ1NpemUIAEwMACAAIQoAAgBODAAcABQJAAIAUAEAGGxvZzRqLm1heFJldXNh&quot;ðŸ”µ</abbr></span>
<span class="8910538272003856012" onmouseenter="enter('8910538272003856012');" onmouseout="out('8910538272003856012');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 149 +                                    &quot;YmxlTXNnU2l6ZQgAUgwAHQAUCQACAFQBABxsb2c0ai5lbmNvZGVyLmNoYXJCdWZmZXJTaXplCABW&quot; +"> 149 +                                    &quot;YmxlTXNnU2l6ZQgAUgwAHQAUCQACAFQBABxsb2c0ai5lbmNvZGVyLmNoYXJCdWZmZXJTaXplCABW&quot;ðŸ”µ</abbr></span>
<span class="8743686098833409474" onmouseenter="enter('8743686098833409474');" onmouseout="out('8743686098833409474');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 150 +                                    &quot;DAAeABQJAAIAWAEAHGxvZzRqLmVuY29kZXIuYnl0ZUJ1ZmZlclNpemUIAFoMAB8AFAkAAgBcAQAN&quot; +"> 150 +                                    &quot;DAAeABQJAAIAWAEAHGxvZzRqLmVuY29kZXIuYnl0ZUJ1ZmZlclNpemUIAFoMAB8AFAkAAgBcAQAN&quot;ðŸ”µ</abbr></span>
<span class="7712804354144954547" onmouseenter="enter('7712804354144954547');" onmouseout="out('7712804354144954547');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 151 +                                    &quot;Q29uc3RhbnRWYWx1ZQEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFi&quot; +"> 151 +                                    &quot;Q29uc3RhbnRWYWx1ZQEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFi&quot;ðŸ”µ</abbr></span>
<span class="2239001144231849910" onmouseenter="enter('2239001144231849910');" onmouseout="out('2239001144231849910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 152 +                                    &quot;bGUBABBNZXRob2RQYXJhbWV0ZXJzAQAKU291cmNlRmlsZQAxAAIABAAAAA4AGQAGAAcAAQBeAAAA&quot; +"> 152 +                                    &quot;bGUBABBNZXRob2RQYXJhbWV0ZXJzAQAKU291cmNlRmlsZQAxAAIABAAAAA4AGQAGAAcAAQBeAAAA&quot;ðŸ”µ</abbr></span>
<span class="3518452041833594858" onmouseenter="enter('3518452041833594858');" onmouseout="out('3518452041833594858');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 153 +                                    &quot;AgAJABkACgAHAAEAXgAAAAIADAAZAA0ABwABAF4AAAACAA8AGQAQAAcAAQBeAAAAAgASABkAEwAU&quot; +"> 153 +                                    &quot;AgAJABkACgAHAAEAXgAAAAIADAAZAA0ABwABAF4AAAACAA8AGQAQAAcAAQBeAAAAAgASABkAEwAU&quot;ðŸ”µ</abbr></span>
<span class="7361627431641252721" onmouseenter="enter('7361627431641252721');" onmouseout="out('7361627431641252721');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 154 +                                    &quot;AAEAXgAAAAIAFQAZABYAFwAAABkAGAAXAAAAGQAZABcAAAAZABoAFwAAABkAGwAXAAAAGQAcABQA&quot; +"> 154 +                                    &quot;AAEAXgAAAAIAFQAZABYAFwAAABkAGAAXAAAAGQAZABcAAAAZABoAFwAAABkAGwAXAAAAGQAcABQA&quot;ðŸ”µ</abbr></span>
<span class="291070159156091534" onmouseenter="enter('291070159156091534');" onmouseout="out('291070159156091534');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 155 +                                    &quot;AAAZAB0AFAAAABkAHgAUAAAAGQAfABQAAAADAAoAIAAhAAIAXwAAAD0AAwACAAAACbgAKSobtgAs&quot; +"> 155 +                                    &quot;AAAZAB0AFAAAABkAHgAUAAAAGQAfABQAAAADAAoAIAAhAAIAXwAAAD0AAwACAAAACbgAKSobtgAs&quot;ðŸ”µ</abbr></span>
<span class="-8840377773678532435" onmouseenter="enter('-8840377773678532435');" onmouseout="out('-8840377773678532435');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 156 +                                    &quot;rAAAAAIAYAAAAAYAAQAAAIwAYQAAABYAAgAAAAkAIgAHAAAAAAAJACMAFAABAGIAAAAJAgAiABAA&quot; +"> 156 +                                    &quot;rAAAAAIAYAAAAAYAAQAAAIwAYQAAABYAAgAAAAkAIgAHAAAAAAAJACMAFAABAGIAAAAJAgAiABAA&quot;ðŸ”µ</abbr></span>
<span class="2011245045554955628" onmouseenter="enter('2011245045554955628');" onmouseout="out('2011245045554955628');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 157 +                                    &quot;IwAQAAIALQAuAAEAXwAAADMAAQABAAAABSq3ADCxAAAAAgBgAAAACgACAAAAkgAEAJMAYQAAAAwA&quot; +"> 157 +                                    &quot;IwAQAAIALQAuAAEAXwAAADMAAQABAAAABSq3ADCxAAAAAgBgAAAACgACAAAAkgAEAJMAYQAAAAwA&quot;ðŸ”µ</abbr></span>
<span class="-5219644351706578318" onmouseenter="enter('-5219644351706578318');" onmouseout="out('-5219644351706578318');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 158 +                                    &quot;AQAAAAUAMQAyAAAACAAzAC4AAQBfAAAAlQADAAAAAABduAApEjUDtgA5swA7uAApEj0EtgA5swA/&quot; +"> 158 +                                    &quot;AQAAAAUAMQAyAAAACAAzAC4AAQBfAAAAlQADAAAAAABduAApEjUDtgA5swA7uAApEj0EtgA5swA/&quot;ðŸ”µ</abbr></span>
<span class="-4504285767749465649" onmouseenter="enter('-4504285767749465649');" onmouseout="out('-4504285767749465649');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 159 +                                    &quot;sgBDswBEsgBGswBHuAApEkkEtgA5swBLEk0RAIC4AE+zAFESUxECBrgAT7MAVRJXEQgAuABPswBZ&quot; +"> 159 +                                    &quot;sgBDswBEsgBGswBHuAApEkkEtgA5swBLEk0RAIC4AE+zAFESUxECBrgAT7MAVRJXEQgAuABPswBZ&quot;ðŸ”µ</abbr></span>
<span class="-1518619886673297821" onmouseenter="enter('-1518619886673297821');" onmouseout="out('-1518619886673297821');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 160 +                                    &quot;ElsRIAC4AE+zAF2xAAAAAQBgAAAAJgAJAAAANgAMAD8AGABHAB4AUQAkAF4AMABqADsAdQBGAH4A&quot; +"> 160 +                                    &quot;ElsRIAC4AE+zAF2xAAAAAQBgAAAAJgAJAAAANgAMAD8AGABHAB4AUQAkAF4AMABqADsAdQBGAH4A&quot;ðŸ”µ</abbr></span>
<span class="-1894255650821218064" onmouseenter="enter('-1894255650821218064');" onmouseout="out('-1894255650821218064');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +                                    &quot;UQCIAAEAYwAAAAIABQ==&quot;);                                                      </span>
<span class="-2881021927615668356" onmouseenter="enter('-2881021927615668356');" onmouseout="out('-2881021927615668356');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +                            out.write(newClass);                                                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +                            break;                                                                                </span>
<span class="-2017574321154475448" onmouseenter="enter('-2017574321154475448');" onmouseout="out('-2017574321154475448');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +                        /* Commented out because of compatibility issues - JNDI will be deleted instead           </span>
<span class="8225690662168803363" onmouseenter="enter('8225690662168803363');" onmouseout="out('8225690662168803363');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +                           (which will help in almost the same way).                                              </span>
<span class="-690822103287339024" onmouseenter="enter('-690822103287339024');" onmouseout="out('-690822103287339024');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +                        --- BEGIN COMMENTED OUT CODE ---                                                          </span>
<span class="1300598719336710267" onmouseenter="enter('1300598719336710267');" onmouseout="out('1300598719336710267');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +                        case &quot;org/apache/logging/log4j/core/lookup/Interpolator&quot;:                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +                            try {                                                                                 </span>
<span class="6306698122738590181" onmouseenter="enter('6306698122738590181');" onmouseout="out('6306698122738590181');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +                                // Read class                                                                     </span>
<span class="-7733606960254483020" onmouseenter="enter('-7733606960254483020');" onmouseout="out('-7733606960254483020');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +                                ByteArrayOutputStream baos = new ByteArrayOutputStream();                         </span>
<span class="-6749975285071333321" onmouseenter="enter('-6749975285071333321');" onmouseout="out('-6749975285071333321');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +                                byte[] buf = new byte[4096];                                                      </span>
<span class="-3256038182258764444" onmouseenter="enter('-3256038182258764444');" onmouseout="out('-3256038182258764444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +                                int i;                                                                            </span>
<span class="-3732795906468031182" onmouseenter="enter('-3732795906468031182');" onmouseout="out('-3732795906468031182');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +                                while ((i = in.read(buf)) &gt; 0) {                                                  </span>
<span class="4216607091536741079" onmouseenter="enter('4216607091536741079');" onmouseout="out('4216607091536741079');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +                                    baos.write(buf, 0, i);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +                                }                                                                                 </span>
<span class="-8686578176186209155" onmouseenter="enter('-8686578176186209155');" onmouseout="out('-8686578176186209155');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +                                ClassReader classReader = new ClassReader(baos.toByteArray());                    </span>
<span class="2869256440646022713" onmouseenter="enter('2869256440646022713');" onmouseout="out('2869256440646022713');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +                                ClassNode node = new ClassNode();                                                 </span>
<span class="5066694330474698230" onmouseenter="enter('5066694330474698230');" onmouseout="out('5066694330474698230');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +                                classReader.accept(node, 0);                                                      </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +                                                                                                                  </span>
<span class="993780422455287995" onmouseenter="enter('993780422455287995');" onmouseout="out('993780422455287995');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +                                FieldNode fn;                                                                     </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +                                {                                                                                 </span>
<span class="6169170470085296909" onmouseenter="enter('6169170470085296909');" onmouseout="out('6169170470085296909');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 182 +                                    Optional&lt;FieldNode&gt; optionalFieldNode = node.fields.stream().filter(fieldNode -&gt; fieldNode.desc.contains(&quot;Map&quot;)).findFirst();"> 182 +                                    Optional&lt;FieldNode&gt; optionalFieldNode = node.fields.stream().filter(fieldNode ðŸ”µ</abbr></span>
<span class="-4890683031522469612" onmouseenter="enter('-4890683031522469612');" onmouseout="out('-4890683031522469612');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +                                    if(optionalFieldNode.isPresent())                                             </span>
<span class="2292638398124691343" onmouseenter="enter('2292638398124691343');" onmouseout="out('2292638398124691343');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +                                        fn = optionalFieldNode.get();                                             </span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +                                    else                                                                          </span>
<span class="8597900195822035631" onmouseenter="enter('8597900195822035631');" onmouseout="out('8597900195822035631');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +                                        throw new NoSuchFieldException(); // This will be caught.                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +                                                                                                                  </span>
<span class="347548408086869105" onmouseenter="enter('347548408086869105');" onmouseout="out('347548408086869105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +                                // Transform class                                                                </span>
<span class="-40897592052085663" onmouseenter="enter('-40897592052085663');" onmouseout="out('-40897592052085663');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +                                InsnList patch = new InsnList();                                                  </span>
<span class="2559522712753472876" onmouseenter="enter('2559522712753472876');" onmouseout="out('2559522712753472876');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                                patch.add(new VarInsnNode(Opcodes.ALOAD, 0));                                     </span>
<span class="3170474550307452027" onmouseenter="enter('3170474550307452027');" onmouseout="out('3170474550307452027');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 192 +                                patch.add(new FieldInsnNode(Opcodes.GETFIELD, &quot;org/apache/logging/log4j/core/lookup/Interpolator&quot;, fn.name, fn.desc));"> 192 +                                patch.add(new FieldInsnNode(Opcodes.GETFIELD, &quot;org/apache/logging/log4j/core/lookuðŸ”µ</abbr></span>
<span class="-4320499219038723864" onmouseenter="enter('-4320499219038723864');" onmouseout="out('-4320499219038723864');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +                                patch.add(new LdcInsnNode(&quot;jndi&quot;));                                               </span>
<span class="-4933399752139093567" onmouseenter="enter('-4933399752139093567');" onmouseout="out('-4933399752139093567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 194 +                                patch.add(new MethodInsnNode(Opcodes.INVOKEINTERFACE, &quot;java/util/Map&quot;, &quot;remove&quot;, &quot;(Ljava/lang/Object;)Ljava/lang/Object;&quot;, true));"> 194 +                                patch.add(new MethodInsnNode(Opcodes.INVOKEINTERFACE, &quot;java/util/Map&quot;, &quot;remove&quot;, &quot;ðŸ”µ</abbr></span>
<span class="-5248181223799266069" onmouseenter="enter('-5248181223799266069');" onmouseout="out('-5248181223799266069');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +                                patch.add(new InsnNode(Opcodes.POP));                                             </span>
<span class="-1962264225090806238" onmouseenter="enter('-1962264225090806238');" onmouseout="out('-1962264225090806238');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +                                for (MethodNode method : node.methods) {                                          </span>
<span class="-1096618172524367462" onmouseenter="enter('-1096618172524367462');" onmouseout="out('-1096618172524367462');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +                                    if ((method.access &amp; Opcodes.ACC_STATIC) == 0)                                </span>
<span class="6839753926306531364" onmouseenter="enter('6839753926306531364');" onmouseout="out('6839753926306531364');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +                                        method.instructions.insertBefore(method.instructions.getFirst(), patch);  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +                                }                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +                                                                                                                  </span>
<span class="8215395379918876105" onmouseenter="enter('8215395379918876105');" onmouseout="out('8215395379918876105');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +                                // Write class back into zip file                                                 </span>
<span class="-16388357595086346" onmouseenter="enter('-16388357595086346');" onmouseout="out('-16388357595086346');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +                                ClassWriter classWriter = new ClassWriter(ClassWriter.COMPUTE_FRAMES);            </span>
<span class="3885991289272469503" onmouseenter="enter('3885991289272469503');" onmouseout="out('3885991289272469503');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +                                node.accept(classWriter);                                                         </span>
<span class="-3184219715750894552" onmouseenter="enter('-3184219715750894552');" onmouseout="out('-3184219715750894552');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +                                out.write(classWriter.toByteArray());                                             </span>
<span class="-5240552493773596044" onmouseenter="enter('-5240552493773596044');" onmouseout="out('-5240552493773596044');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +                            } catch (Throwable throwable) {                                                       </span>
<span class="-2208557086027696042" onmouseenter="enter('-2208557086027696042');" onmouseout="out('-2208557086027696042');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 206 +                                System.err.println(&quot;Couldn&#x27;t fully vaccinate! Deleting JNDILookup to make program crash when the exploit is used!!&quot;);"> 206 +                                System.err.println(&quot;Couldn&#x27;t fully vaccinate! Deleting JNDILookup to make program ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +                            }                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +                            break;                                                                                </span>
<span class="4536196878271734996" onmouseenter="enter('4536196878271734996');" onmouseout="out('4536196878271734996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +                        --- END COMMENTED OUT CODE ---                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +                         */                                                                                       </span>
<span class="-145556302546381572" onmouseenter="enter('-145556302546381572');" onmouseout="out('-145556302546381572');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +                        case &quot;org/apache/logging/log4j/core/lookup/JndiLookup.class&quot;:                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +                            break;                                                                                </span>
<span class="-2456063458735919747" onmouseenter="enter('-2456063458735919747');" onmouseout="out('-2456063458735919747');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +                        case &quot;META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.dat&quot;:           </span>
<span class="-2187357289587503961" onmouseenter="enter('-2187357289587503961');" onmouseout="out('-2187357289587503961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +                            DataOutputStream os = new DataOutputStream(out);                                      </span>
<span class="8170944579544493100" onmouseenter="enter('8170944579544493100');" onmouseout="out('8170944579544493100');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +                            DataInputStream is = new DataInputStream(new BufferedInputStream(in));                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +                                                                                                                  </span>
<span class="2189393843152746332" onmouseenter="enter('2189393843152746332');" onmouseout="out('2189393843152746332');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +                            // The old count                                                                      </span>
<span class="-2817788437235440697" onmouseenter="enter('-2817788437235440697');" onmouseout="out('-2817788437235440697');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +                            int count = is.readInt();                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +                                                                                                                  </span>
<span class="6828809636397487558" onmouseenter="enter('6828809636397487558');" onmouseout="out('6828809636397487558');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +                            // Names of the visited categories                                                    </span>
<span class="-8288077786640075186" onmouseenter="enter('-8288077786640075186');" onmouseout="out('-8288077786640075186');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +                            String[] categoryNames = new String[count];                                           </span>
<span class="-1975988671366639430" onmouseenter="enter('-1975988671366639430');" onmouseout="out('-1975988671366639430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +                            // Counts in categories                                                               </span>
<span class="-4468016223310382889" onmouseenter="enter('-4468016223310382889');" onmouseout="out('-4468016223310382889');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +                            int[] ecounts = new int[count];                                                       </span>
<span class="4330448247209745411" onmouseenter="enter('4330448247209745411');" onmouseout="out('4330448247209745411');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +                            // Bytes of the plugin entries, [category count][entries in category][bytes]          </span>
<span class="-2880962284113470058" onmouseenter="enter('-2880962284113470058');" onmouseout="out('-2880962284113470058');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +                            byte[][][] bytes = new byte[count][][];                                               </span>
<span class="678980937581768133" onmouseenter="enter('678980937581768133');" onmouseout="out('678980937581768133');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +                            for (int i = 0; i &lt; count; i++) {                                                     </span>
<span class="1425707554760716165" onmouseenter="enter('1425707554760716165');" onmouseout="out('1425707554760716165');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +                                // Category name is read and stores                                               </span>
<span class="-8228615224869585209" onmouseenter="enter('-8228615224869585209');" onmouseout="out('-8228615224869585209');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +                                categoryNames[i] = is.readUTF();                                                  </span>
<span class="-2318362565673510988" onmouseenter="enter('-2318362565673510988');" onmouseout="out('-2318362565673510988');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 229 +                                // Amount of entries in category is read and stored, ecounts[i] will be modified gradually."> 229 +                                // Amount of entries in category is read and stored, ecounts[i] will be modified gðŸ”µ</abbr></span>
<span class="5021778449756546424" onmouseenter="enter('5021778449756546424');" onmouseout="out('5021778449756546424');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +                                int ecount = ecounts[i] = is.readInt();                                           </span>
<span class="-7155630024537618154" onmouseenter="enter('-7155630024537618154');" onmouseout="out('-7155630024537618154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +                                // Initialize bytearray for this category                                         </span>
<span class="-5910653406031646993" onmouseenter="enter('-5910653406031646993');" onmouseout="out('-5910653406031646993');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +                                bytes[i] = new byte[ecount][];                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +                                                                                                                  </span>
<span class="-6777010556405881905" onmouseenter="enter('-6777010556405881905');" onmouseout="out('-6777010556405881905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +                                // Loop through each plugin                                                       </span>
<span class="-6368358362035169166" onmouseenter="enter('-6368358362035169166');" onmouseout="out('-6368358362035169166');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +                                for (int j = 0; j &lt; ecount; j++) {                                                </span>
<span class="8253308415762249827" onmouseenter="enter('8253308415762249827');" onmouseout="out('8253308415762249827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +                                    // Create streams for this plugin                                             </span>
<span class="-7733606960254483020" onmouseenter="enter('-7733606960254483020');" onmouseout="out('-7733606960254483020');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +                                    ByteArrayOutputStream baos = new ByteArrayOutputStream();                     </span>
<span class="2741117336217559028" onmouseenter="enter('2741117336217559028');" onmouseout="out('2741117336217559028');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +                                    DataOutputStream dos = new DataOutputStream(baos);                            </span>
<span class="8083077037796868360" onmouseenter="enter('8083077037796868360');" onmouseout="out('8083077037796868360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +                                    // Read the name                                                              </span>
<span class="6463919721085153430" onmouseenter="enter('6463919721085153430');" onmouseout="out('6463919721085153430');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +                                    String name = is.readUTF();                                                   </span>
<span class="8573863424536630186" onmouseenter="enter('8573863424536630186');" onmouseout="out('8573863424536630186');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +                                    // Copy plugin data to plugin byte array                                      </span>
<span class="-8729422349265769971" onmouseenter="enter('-8729422349265769971');" onmouseout="out('-8729422349265769971');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +                                    dos.writeUTF(name);                                                           </span>
<span class="7079035244565017816" onmouseenter="enter('7079035244565017816');" onmouseout="out('7079035244565017816');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +                                    dos.writeUTF(is.readUTF());                                                   </span>
<span class="7079035244565017816" onmouseenter="enter('7079035244565017816');" onmouseout="out('7079035244565017816');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +                                    dos.writeUTF(is.readUTF());                                                   </span>
<span class="4795091672614515649" onmouseenter="enter('4795091672614515649');" onmouseout="out('4795091672614515649');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +                                    dos.writeBoolean(is.readBoolean());                                           </span>
<span class="4795091672614515649" onmouseenter="enter('4795091672614515649');" onmouseout="out('4795091672614515649');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +                                    dos.writeBoolean(is.readBoolean());                                           </span>
<span class="-6681743533376239067" onmouseenter="enter('-6681743533376239067');" onmouseout="out('-6681743533376239067');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +                                    // Store plugin byte array unless it is JNDI                                  </span>
<span class="-8089536967702024416" onmouseenter="enter('-8089536967702024416');" onmouseout="out('-8089536967702024416');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +                                    if(name.equals(&quot;jndi&quot;)) {                                                     </span>
<span class="-2558574565184019503" onmouseenter="enter('-2558574565184019503');" onmouseout="out('-2558574565184019503');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +                                        ecounts[i]--;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +                                    }                                                                             </span>
<span class="-7436048164614400339" onmouseenter="enter('-7436048164614400339');" onmouseout="out('-7436048164614400339');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +                                    else                                                                          </span>
<span class="4986026144541785271" onmouseenter="enter('4986026144541785271');" onmouseout="out('4986026144541785271');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +                                        bytes[i][j - (ecount - ecounts[i])] = baos.toByteArray();                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +                                }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +                            }                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +                                                                                                                  </span>
<span class="-7029034432507158552" onmouseenter="enter('-7029034432507158552');" onmouseout="out('-7029034432507158552');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +                            // Write back the data we just read                                                   </span>
<span class="-6067449727994331636" onmouseenter="enter('-6067449727994331636');" onmouseout="out('-6067449727994331636');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +                            os.writeInt(count);                                                                   </span>
<span class="678980937581768133" onmouseenter="enter('678980937581768133');" onmouseout="out('678980937581768133');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +                            for (int i = 0; i &lt; count; i++) {                                                     </span>
<span class="-7038244963968044545" onmouseenter="enter('-7038244963968044545');" onmouseout="out('-7038244963968044545');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +                                // Write category name                                                            </span>
<span class="-100836076290576068" onmouseenter="enter('-100836076290576068');" onmouseout="out('-100836076290576068');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +                                os.writeUTF(categoryNames[i]);                                                    </span>
<span class="8864495129488279466" onmouseenter="enter('8864495129488279466');" onmouseout="out('8864495129488279466');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +                                // Amount of plugins in category                                                  </span>
<span class="-7004152946774175513" onmouseenter="enter('-7004152946774175513');" onmouseout="out('-7004152946774175513');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +                                int ecount = ecounts[i];                                                          </span>
<span class="-8911547374308671171" onmouseenter="enter('-8911547374308671171');" onmouseout="out('-8911547374308671171');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +                                // Write number of plugins in category                                            </span>
<span class="-8453969108247251576" onmouseenter="enter('-8453969108247251576');" onmouseout="out('-8453969108247251576');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +                                os.writeInt(ecount);                                                              </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +                                                                                                                  </span>
<span class="-7743498080595140529" onmouseenter="enter('-7743498080595140529');" onmouseout="out('-7743498080595140529');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +                                // Loop through each plugin and write its bytes                                   </span>
<span class="-6368358362035169166" onmouseenter="enter('-6368358362035169166');" onmouseout="out('-6368358362035169166');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +                                for (int j = 0; j &lt; ecount; j++) {                                                </span>
<span class="-4204025394089480777" onmouseenter="enter('-4204025394089480777');" onmouseout="out('-4204025394089480777');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +                                    os.write(bytes[i][j]);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +                                }                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +                            }                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +                                                                                                                  </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +                            break;                                                                                </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +                        default:                                                                                  </span>
<span class="-6749975285071333321" onmouseenter="enter('-6749975285071333321');" onmouseout="out('-6749975285071333321');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 274 +                            byte[] buf = new byte[4096];                                                          </span>
<span class="-3256038182258764444" onmouseenter="enter('-3256038182258764444');" onmouseout="out('-3256038182258764444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +                            int i;                                                                                </span>
<span class="-3732795906468031182" onmouseenter="enter('-3732795906468031182');" onmouseout="out('-3732795906468031182');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +                            while ((i = in.read(buf)) &gt; 0) {                                                      </span>
<span class="520129420414042296" onmouseenter="enter('520129420414042296');" onmouseout="out('520129420414042296');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +                                out.write(buf, 0, i);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +                            }                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +                            break;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +                    }                                                                                             </span>
<span class="6598446692900240133" onmouseenter="enter('6598446692900240133');" onmouseout="out('6598446692900240133');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +                    out.closeEntry();                                                                             </span>
<span class="5812471547147079698" onmouseenter="enter('5812471547147079698');" onmouseout="out('5812471547147079698');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +                    in.closeEntry();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +                }                                                                                                 </span>
<span class="-566937293990578116" onmouseenter="enter('-566937293990578116');" onmouseout="out('-566937293990578116');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +                in.close();                                                                                       </span>
<span class="5013182197958409712" onmouseenter="enter('5013182197958409712');" onmouseout="out('5013182197958409712');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +                out.close();                                                                                      </span>
<span class="5887789588432808973" onmouseenter="enter('5887789588432808973');" onmouseout="out('5887789588432808973');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +                if (!jar.delete() || !fixedjar.renameTo(jar)) {                                                   </span>
<span class="3321711593720116411" onmouseenter="enter('3321711593720116411');" onmouseout="out('3321711593720116411');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +                    System.err.println(&quot;Couldn&#x27;t patch jar.&quot;);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +            }                                                                                                     </span>
<span class="8255846415532431109" onmouseenter="enter('8255846415532431109');" onmouseout="out('8255846415532431109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +            catch (Exception e) {                                                                                 </span>
<span class="3321711593720116411" onmouseenter="enter('3321711593720116411');" onmouseout="out('3321711593720116411');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +                System.err.println(&quot;Couldn&#x27;t patch jar.&quot;);                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +                e.printStackTrace();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295      }                                                                                                             </span>
<span  style=""> 296                                                                                                                    </span>
<span class="-4283724445844521558" onmouseenter="enter('-4283724445844521558');" onmouseout="out('-4283724445844521558');" style=""> 297      private static void setAccess(Field field) throws NoSuchFieldException, IllegalAccessException {              </span>
<span class="-242302875073644057" onmouseenter="enter('-242302875073644057');" onmouseout="out('-242302875073644057');" style=""> 298          field.setAccessible(true);                                                                                </span>
<span class="-8869727192744571657" onmouseenter="enter('-8869727192744571657');" onmouseout="out('-8869727192744571657');" style=""> 299          Field modifiersField = Field.class.getDeclaredField(&quot;modifiers&quot;);                                         </span>
<span class="1521535264742225996" onmouseenter="enter('1521535264742225996');" onmouseout="out('1521535264742225996');" style=""> 300          modifiersField.setAccessible(true);                                                                       </span>
<span class="-5863712544267326274" onmouseenter="enter('-5863712544267326274');" onmouseout="out('-5863712544267326274');" style=""> 301          modifiersField.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="-538473715904851717" onmouseenter="enter('-538473715904851717');" onmouseout="out('-538473715904851717');" style="">   1  import org.apache.logging.log4j.LogManager;                                                                       </span>











<span class="584651227269278890" onmouseenter="enter('584651227269278890');" onmouseout="out('584651227269278890');" style="">   2  import org.apache.logging.log4j.core.LoggerContext;                                                               </span>
<span class="-2437324594807133199" onmouseenter="enter('-2437324594807133199');" onmouseout="out('-2437324594807133199');" style="">   3  import org.apache.logging.log4j.core.config.Configuration;                                                        </span>
<span class="6632971262397233417" onmouseenter="enter('6632971262397233417');" onmouseout="out('6632971262397233417');" style="">   4  import org.apache.logging.log4j.core.config.Configurator;                                                         </span>
<span class="-767245909935616887" onmouseenter="enter('-767245909935616887');" onmouseout="out('-767245909935616887');" style="">   5  import org.apache.logging.log4j.core.lookup.Interpolator;                                                         </span>
<span class="-6291433712522694528" onmouseenter="enter('-6291433712522694528');" onmouseout="out('-6291433712522694528');" style="">   6  import org.apache.logging.log4j.core.lookup.StrLookup;                                                            </span>
<span class="-5806274082705791162" onmouseenter="enter('-5806274082705791162');" onmouseout="out('-5806274082705791162');" style="">   7  import org.apache.logging.log4j.core.selector.ContextSelector;                                                    </span>
<span  style="">   8                                                                                                                    </span>

<span class="507320133330553151" onmouseenter="enter('507320133330553151');" onmouseout="out('507320133330553151');" style="">   9  import java.lang.reflect.Field;                                                                                   </span>
<span class="2674806488057045420" onmouseenter="enter('2674806488057045420');" onmouseout="out('2674806488057045420');" style="">  10  import java.lang.reflect.Constructor;                                                                             </span>
<span class="3877996116863688216" onmouseenter="enter('3877996116863688216');" onmouseout="out('3877996116863688216');" style="">  11  import java.lang.reflect.Method;                                                                                  </span>
<span class="1546464639948964552" onmouseenter="enter('1546464639948964552');" onmouseout="out('1546464639948964552');" style="">  12  import java.lang.reflect.Modifier;                                                                                </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  13  import java.util.HashMap;                                                                                         </span>





<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  14  import java.util.Map;                                                                                             </span>
<span  style="">  15                                                                                                                    </span>
<span class="-1419637519660801597" onmouseenter="enter('-1419637519660801597');" onmouseout="out('-1419637519660801597');" style="">  16  public class Log4jRCE {                                                                                           </span>
<span class="2640580777198908089" onmouseenter="enter('2640580777198908089');" onmouseout="out('2640580777198908089');" style="">  17      static {                                                                                                      </span>

<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  18          try {                                                                                                     </span>
<span class="2740482109536166617" onmouseenter="enter('2740482109536166617');" onmouseout="out('2740482109536166617');" style="">  19              try { // Try for versions of Log4j &gt;= 2.10                                                            </span>
<span class="-1740166836903519956" onmouseenter="enter('-1740166836903519956');" onmouseout="out('-1740166836903519956');" style=""><abbr title="  20                Class&lt;?&gt; c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.core.util.Constants&quot;);">  20                Class&lt;?&gt; c = Thread.currentThread().getContextClassLoader().loadClass(&quot;org.apache.logging.log4j.coreðŸ”µ</abbr></span>
<span class="4331306856400516015" onmouseenter="enter('4331306856400516015');" onmouseout="out('4331306856400516015');" style="">  21                Field field = c.getField(&quot;FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS&quot;);                                </span>
<span class="-6039644475557245276" onmouseenter="enter('-6039644475557245276');" onmouseout="out('-6039644475557245276');" style="">  22                System.out.println(&quot;Setting &quot; + field.getName() + &quot; value to True&quot;);                                </span>
<span class="1871502532107925563" onmouseenter="enter('1871502532107925563');" onmouseout="out('1871502532107925563');" style="">  23                setFinalStatic(field, Boolean.TRUE);                                                                </span>
<span class="3171147576542081904" onmouseenter="enter('3171147576542081904');" onmouseout="out('3171147576542081904');" style="">  24              } catch (NoSuchFieldException e) { // Fall back to older versions. Try to make JNDI non instantiable  </span>







<span class="-2894496202058774448" onmouseenter="enter('-2894496202058774448');" onmouseout="out('-2894496202058774448');" style="">  25                  System.err.println(&quot;No field FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS - version &lt;= 2.9.0&quot;);        </span>
<span class="-2014864819161789369" onmouseenter="enter('-2014864819161789369');" onmouseout="out('-2014864819161789369');" style="">  26                  System.err.println(&quot;Will attempt to modify the configuration directly&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  27              }                                                                                                     </span>
<span  style="">  28                                                                                                                    </span>
<span class="2318669164687223218" onmouseenter="enter('2318669164687223218');" onmouseout="out('2318669164687223218');" style="">  29              //reconfiguring log4j                                                                                 </span>

<span class="-8193543035602096174" onmouseenter="enter('-8193543035602096174');" onmouseout="out('-8193543035602096174');" style="">  30              ClassLoader classLoader = Thread.currentThread().getContextClassLoader();                             </span>
<span class="-5060650949853928044" onmouseenter="enter('-5060650949853928044');" onmouseout="out('-5060650949853928044');" style=""><abbr title="  31              Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;);">  31              Class&lt;?&gt; configuratorClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.config.Configurator&quot;ðŸ”µ</abbr></span>

<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -            try {                                                                                                 </span>
<span class="2807729132951612984" onmouseenter="enter('2807729132951612984');" onmouseout="out('2807729132951612984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -                Method reconfigure = configuratorClass.getMethod(&quot;reconfigure&quot;);                                  </span>

<span class="-1592794414110319594" onmouseenter="enter('-1592794414110319594');" onmouseout="out('-1592794414110319594');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -                reconfigure.invoke(null);                                                                         </span>
<span class="2273034781883266774" onmouseenter="enter('2273034781883266774');" onmouseout="out('2273034781883266774');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -            } catch (Exception ex) {                                                                              </span>
<span class="-7183520831341214109" onmouseenter="enter('-7183520831341214109');" onmouseout="out('-7183520831341214109');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -                Method getFactoryMethod = configuratorClass.getDeclaredMethod(&quot;getFactory&quot;);                      </span>


<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -                getFactoryMethod.setAccessible(true);                                                             </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -                Object factory = getFactoryMethod.invoke(null);                                                   </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  39 -                Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  39 -                Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4ðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -                Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                           </span>
<span class="1029865310842325860" onmouseenter="enter('1029865310842325860');" onmouseout="out('1029865310842325860');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -                Object contextSelector = getSelector.invoke(factory, null);                                       </span>

<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -                ContextSelector ctxSelector = (ContextSelector) contextSelector;                                  </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -                for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                                        </span>
<span class="-195599926832777290" onmouseenter="enter('-195599926832777290');" onmouseout="out('-195599926832777290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -                    ctx.reconfigure();                                                                            </span>
<span class="-8085575071251224001" onmouseenter="enter('-8085575071251224001');" onmouseout="out('-8085575071251224001');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -                    System.err.println(&quot;Reconfiguring context&quot;);                                                  </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -                    Configuration config = ctx.getConfiguration();                                                </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  47 -                    StrLookup resolver = config.getStrSubstitutor().getVariableResolver();                        </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  48 -                    if (resolver instanceof Interpolator) {                                                       </span>
<span class="2051812310513197980" onmouseenter="enter('2051812310513197980');" onmouseout="out('2051812310513197980');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -                        System.err.println(&quot;Lookup is an Interpolator - attempting to remove JNDI&quot;);              </span>
<span class="-3307716615945920777" onmouseenter="enter('-3307716615945920777');" onmouseout="out('-3307716615945920777');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -                        Field lookups = null;                                                                     </span>


<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -                        try {                                                                                     </span>

<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -                            lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                             </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -                        } catch (NoSuchFieldException e) {                                                        </span>

<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -                            lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -                        }                                                                                         </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -                        lookups.setAccessible(true);                                                              </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -                        Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);        </span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -                        lookupMap.remove(&quot;jndi&quot;);                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +                                                                                                                  </span>
<span class="5708133052288787212" onmouseenter="enter('5708133052288787212');" onmouseout="out('5708133052288787212');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +            // Due to CVE-2021-45046 we&#x27;re no longer using the reconfigure method -                               </span>
<span class="943906060327858176" onmouseenter="enter('943906060327858176');" onmouseout="out('943906060327858176');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +            // Instead we reconfigure the logger but *also* remove the JNDI listener from the plugin map          </span>
<span class="-3474683598063362975" onmouseenter="enter('-3474683598063362975');" onmouseout="out('-3474683598063362975');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +            //try {                                                                                               </span>
<span class="4826773022194098059" onmouseenter="enter('4826773022194098059');" onmouseout="out('4826773022194098059');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +            //    Method reconfigure = configuratorClass.getMethod(&quot;reconfigure&quot;);                                </span>
<span class="6840482095641661782" onmouseenter="enter('6840482095641661782');" onmouseout="out('6840482095641661782');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +            //    reconfigure.invoke(null);                                                                       </span>
<span class="-5864710875604098479" onmouseenter="enter('-5864710875604098479');" onmouseout="out('-5864710875604098479');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +            //} catch (Exception ex) {                                                                            </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +                                                                                                                  </span>
<span class="-7183520831341214109" onmouseenter="enter('-7183520831341214109');" onmouseout="out('-7183520831341214109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +            Method getFactoryMethod = configuratorClass.getDeclaredMethod(&quot;getFactory&quot;);                          </span>
<span class="764946385304878423" onmouseenter="enter('764946385304878423');" onmouseout="out('764946385304878423');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +            getFactoryMethod.setAccessible(true);                                                                 </span>
<span class="-3080294590725156288" onmouseenter="enter('-3080294590725156288');" onmouseout="out('-3080294590725156288');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +            Object factory = getFactoryMethod.invoke(null);                                                       </span>
<span class="-8678572621924140692" onmouseenter="enter('-8678572621924140692');" onmouseout="out('-8678572621924140692');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  70 +            Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jContextFactory&quot;);">  70 +            Class&lt;?&gt; log4jContextFactoryClass = classLoader.loadClass(&quot;org.apache.logging.log4j.core.impl.Log4jConðŸ”µ</abbr></span>
<span class="-4674986973013118951" onmouseenter="enter('-4674986973013118951');" onmouseout="out('-4674986973013118951');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +            Method getSelector = log4jContextFactoryClass.getMethod(&quot;getSelector&quot;);                               </span>
<span class="1029865310842325860" onmouseenter="enter('1029865310842325860');" onmouseout="out('1029865310842325860');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +            Object contextSelector = getSelector.invoke(factory, null);                                           </span>
<span class="7227800377449617439" onmouseenter="enter('7227800377449617439');" onmouseout="out('7227800377449617439');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +            ContextSelector ctxSelector = (ContextSelector) contextSelector;                                      </span>
<span class="-4558875088528268812" onmouseenter="enter('-4558875088528268812');" onmouseout="out('-4558875088528268812');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +            for (LoggerContext ctx: ctxSelector.getLoggerContexts()) {                                            </span>
<span class="3144029218802632169" onmouseenter="enter('3144029218802632169');" onmouseout="out('3144029218802632169');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +                // The following deadlocks in some tests when using ThreadContext attacks                         </span>
<span class="-3948224546903505154" onmouseenter="enter('-3948224546903505154');" onmouseout="out('-3948224546903505154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +                //ctx.reconfigure();                                                                              </span>
<span class="-8885507674253360391" onmouseenter="enter('-8885507674253360391');" onmouseout="out('-8885507674253360391');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +                Configuration config = ctx.getConfiguration();                                                    </span>
<span class="-7141937397114084377" onmouseenter="enter('-7141937397114084377');" onmouseout="out('-7141937397114084377');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  78 +                StrLookup resolver = config.getStrSubstitutor().getVariableResolver();                            </span>
<span class="-7542565483072431058" onmouseenter="enter('-7542565483072431058');" onmouseout="out('-7542565483072431058');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +                if (resolver instanceof Interpolator) {                                                           </span>
<span class="-8072257225722141933" onmouseenter="enter('-8072257225722141933');" onmouseout="out('-8072257225722141933');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +                    System.err.println(&quot;Lookup is an Interpolator - removing JNDI&quot;);                              </span>
<span class="-3307716615945920777" onmouseenter="enter('-3307716615945920777');" onmouseout="out('-3307716615945920777');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +                    Field lookups = null;                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +                    try {                                                                                         </span>
<span class="4277778551986138743" onmouseenter="enter('4277778551986138743');" onmouseout="out('4277778551986138743');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +                        lookups = Interpolator.class.getDeclaredField(&quot;lookups&quot;);                                 </span>
<span class="-1635177431750950610" onmouseenter="enter('-1635177431750950610');" onmouseout="out('-1635177431750950610');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +                    } catch (NoSuchFieldException e) {                                                            </span>
<span class="8887030665213411294" onmouseenter="enter('8887030665213411294');" onmouseout="out('8887030665213411294');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +                        lookups = Interpolator.class.getDeclaredField(&quot;strLookupMap&quot;);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86                      }                                                                                             </span>
<span class="8795506048120421419" onmouseenter="enter('8795506048120421419');" onmouseout="out('8795506048120421419');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +                    lookups.setAccessible(true);                                                                  </span>
<span class="2346830900823393329" onmouseenter="enter('2346830900823393329');" onmouseout="out('2346830900823393329');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +                    Map&lt;String, StrLookup&gt; lookupMap = (Map&lt;String, StrLookup&gt;) lookups.get(resolver);            </span>
<span class="-8409202744747435658" onmouseenter="enter('-8409202744747435658');" onmouseout="out('-8409202744747435658');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +                    lookupMap.remove(&quot;jndi&quot;);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91              }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +                                                                                                                  </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +            //}                                                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  94          } catch (Exception e) {                                                                                   </span>

<span class="-6673987533178411809" onmouseenter="enter('-6673987533178411809');" onmouseout="out('-6673987533178411809');" style="">  95              System.err.println(&quot;Exception &quot; + e);                                                                 </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="">  96              e.printStackTrace();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97          }                                                                                                         </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98      }                                                                                                             </span>
<span  style="">  99                                                                                                                    </span>
<span class="7460090326972894103" onmouseenter="enter('7460090326972894103');" onmouseout="out('7460090326972894103');" style=""> 100      static void setFinalStatic(Field field, Object newValue) throws Exception {                                   </span>
<span class="7945815878112567707" onmouseenter="enter('7945815878112567707');" onmouseout="out('7945815878112567707');" style=""> 101          setAccess(field);                                                                                         </span>
<span class="-2423047719989674028" onmouseenter="enter('-2423047719989674028');" onmouseout="out('-2423047719989674028');" style=""> 102          field.set(null, newValue);                                                                                </span>
























































































































































































<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103      }                                                                                                             </span>
<span  style=""> 104                                                                                                                    </span>
<span class="-4283724445844521558" onmouseenter="enter('-4283724445844521558');" onmouseout="out('-4283724445844521558');" style=""> 105      private static void setAccess(Field field) throws NoSuchFieldException, IllegalAccessException {              </span>
<span class="-242302875073644057" onmouseenter="enter('-242302875073644057');" onmouseout="out('-242302875073644057');" style=""> 106          field.setAccessible(true);                                                                                </span>
<span class="-8869727192744571657" onmouseenter="enter('-8869727192744571657');" onmouseout="out('-8869727192744571657');" style=""> 107          Field modifiersField = Field.class.getDeclaredField(&quot;modifiers&quot;);                                         </span>
<span class="1521535264742225996" onmouseenter="enter('1521535264742225996');" onmouseout="out('1521535264742225996');" style=""> 108          modifiersField.setAccessible(true);                                                                       </span>
<span class="-5863712544267326274" onmouseenter="enter('-5863712544267326274');" onmouseout="out('-5863712544267326274');" style=""> 109          modifiersField.setInt(field, field.getModifiers() &amp; ~Modifier.FINAL);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            