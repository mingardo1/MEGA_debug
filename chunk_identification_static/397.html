<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>397</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    397
                    <a href="396.html">prev</a>
                    <a href="398.html">next</a>
                    <a href="397_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_08eab84481ddc54518a8d0a2edc0fe5de5815a24_launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;08eab84481ddc54518a8d0a2edc0fe5de5815a24:launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;08eab84481ddc54518a8d0a2edc0fe5de5815a24^1:launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;08eab84481ddc54518a8d0a2edc0fe5de5815a24^2:launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;37844f41df13ae43fdf96bea35193ae6991feb67:launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 /*</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  53     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  53     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 			});</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  65         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  65         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  71         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  71         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  72         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  72         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  77         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);">  77         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         return applicationId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         List&lt;String&gt; paths = Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 		return paths;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 }</span>
  92 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93 /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 145     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {"> 145     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146         if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 147             String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());"> 147             String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString())ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148             List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149             paths.forEach(path -&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150                 jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154         String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 157         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);"> 157         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 163         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);"> 163         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 164         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true);"> 164         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 169         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);"> 169         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172         return applicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175     private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176         if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177             addjarPath = addjarPath.substring(1, addjarPath.length() - 1).replace(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179         return Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182 }</span>
 183 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 /*</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  53     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  53     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 			});</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  65         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  65         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  71         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  71         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  72         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  72         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  77         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);">  77         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         return applicationId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         List&lt;String&gt; paths = Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 		return paths;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 }</span>
  92 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93 /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 145     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {"> 145     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146         if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 147             String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());"> 147             String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString())ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148             List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149             paths.forEach(path -&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150                 jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154         String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 157         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);"> 157         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 163         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);"> 163         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 164         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true);"> 164         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 169         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);"> 169         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172         return applicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175     private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176         if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177             addjarPath = addjarPath.substring(1, addjarPath.length() - 1).replace(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179         return Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182 }</span>
 183 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  58     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  58     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59         if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  60             String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());">  60             String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString())ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61             List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62             paths.forEach(path -&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63                 jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67         String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  70         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  70         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  76         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  76         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  77         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true);">  77         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  82         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);">  82         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85         return applicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88     private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89         if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90             addjarPath = addjarPath.substring(1, addjarPath.length() - 1).replace(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92         return Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95 }</span>
  96 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -/*</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 - * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 - * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 - * distributed with this work for additional information</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 - * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 - * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 - * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 - * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 - *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 - * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 - *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 - * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 - * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 - * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 - * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 - * limitations under the License.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 - */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import org.slf4j.Logger;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -import org.slf4j.LoggerFactory;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -import java.net.URLDecoder;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -import java.util.Arrays;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -import java.util.List;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -import java.util.Properties;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 - * per job mode submitter</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 - * Date: 2018/11/17</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 - * Company: www.dtstack.com</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 - * @author xuchao</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 - */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -public class PerJobSubmitter {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -    private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  51 -    public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  51 -    public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws ExceðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -			});</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -		}</span>







<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -		String confProp = launcherOptions.getConfProp();</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -        confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -        Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  63 -        ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  63 -        ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confPropertðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -        PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -        perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -        String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  69 -        AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  69 -        AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  70 -        ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  70 -        ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, ðŸ”µ</abbr></span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -        String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -        String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -        String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -        LOG.info(tips);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -        return applicationId;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -        List&lt;String&gt; paths = Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -		return paths;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -	}</span>






<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -}</span></pre></td>
                            <td><pre>   1  /*
   2   * Licensed to the Apache Software Foundation (ASF) under one
   3   * or more contributor license agreements.  See the NOTICE file
   4   * distributed with this work for additional information
   5   * regarding copyright ownership.  The ASF licenses this file
   6   * to you under the Apache License, Version 2.0 (the
   7   * &quot;License&quot;); you may not use this file except in compliance
   8   * with the License.  You may obtain a copy of the License at
   9   *
  10   * http://www.apache.org/licenses/LICENSE-2.0
  11   *
  12   * Unless required by applicable law or agreed to in writing, software
  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15   * See the License for the specific language governing permissions and
  16   * limitations under the License.
  17   */
  18  
  19  package com.dtstack.flink.sql.launcher.perjob;
  20  
  21  import org.apache.flink.client.deployment.ClusterSpecification;
  22  import org.apache.flink.client.program.ClusterClient;
  23  import org.apache.flink.configuration.Configuration;
  24  import org.apache.flink.core.fs.Path;
  25  import org.apache.flink.runtime.jobgraph.JobGraph;
  26  import org.apache.flink.yarn.AbstractYarnClusterDescriptor;
  27  
  28  import com.dtstack.flink.sql.option.Options;
  29  import com.dtstack.flink.sql.util.PluginUtil;
  30  import org.apache.commons.io.Charsets;
  31  import org.apache.commons.lang3.StringUtils;
  32  import org.apache.hadoop.yarn.api.records.ApplicationId;
  33  import org.slf4j.Logger;
  34  import org.slf4j.LoggerFactory;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +</span>
  36  import java.net.URLDecoder;
  37  import java.util.Arrays;
  38  import java.util.List;
  39  import java.util.Properties;
  40  
  41  /**
  42   * per job mode submitter
  43   * Date: 2018/11/17
  44   * Company: www.dtstack.com
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 + *</span>
  46   * @author xuchao
  47   */
  48  
  49  public class PerJobSubmitter {
  50  
  51      private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);
  52  
<abbr title="  53      public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  53      public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws ExceðŸ”µ</abbr>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -			});</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -		}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +        if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +            String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +            List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +            paths.forEach(path -&gt; {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +                jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +            });</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +        }</span>
  68  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +        String confProp = launcherOptions.getConfProp();</span>
  71          confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());
  72          Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);
<abbr title="  73          ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  73          ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confPropertðŸ”µ</abbr>
  74  
  75          PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();
  76          perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);
  77  
  78          String flinkJarPath = launcherOptions.getFlinkJarPath();
<abbr title="  79          AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  79          AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriðŸ”µ</abbr>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  80 -        ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  80 -        ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  81 +        ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph, true);">  81 +        ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, ðŸ”µ</abbr></span>
  82  
  83          String applicationId = clusterClient.getClusterId().toString();
  84          String flinkJobId = jobGraph.getJobID().toString();
  85  
  86          String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);
  87          LOG.info(tips);
  88  
  89          return applicationId;
  90      }
  91  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -        List&lt;String&gt; paths = Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -		return paths;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -	}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +    private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +        if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +            addjarPath = addjarPath.substring(1, addjarPath.length() - 1).replace(&quot;\&quot;&quot;, &quot;&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +        return Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +    }</span>
 105  
 106  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            