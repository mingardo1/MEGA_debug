<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>556</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    556
                    <a href="555.html">prev</a>
                    <a href="557.html">next</a>
                    <a href="556_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_7302b163e73618ae14d90bd0ad9b64f1caf7c884_launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;7302b163e73618ae14d90bd0ad9b64f1caf7c884:launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;7302b163e73618ae14d90bd0ad9b64f1caf7c884^1:launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;7302b163e73618ae14d90bd0ad9b64f1caf7c884^2:launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;b259aa5e9ca64e4d07266783ec504a1f5fd6d5ec:launcher/src/main/java/com/dtstack/flink/sql/launcher/perjob/PerJobSubmitter.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 /*</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  52     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  52     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 			});</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  64         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  64         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  70         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  70         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  71         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  71         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  76         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);">  76         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77         System.out.println(tips);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         return applicationId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 		List&lt;String&gt; paths = Arrays.asList(addjarPath.split(&quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 		return paths;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 }</span>
  92 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93 /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 143     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {"> 143     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145 			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147 			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148 				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149 			});</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152 		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 155         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);"> 155         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 161         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);"> 161         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 162         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);"> 162         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 167         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);"> 167         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170         return applicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173 	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175 			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177         List&lt;String&gt; paths = Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178 		return paths;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181 }</span>
 182 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 /*</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13  *</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  52     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  52     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 			});</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  64         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  64         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  70         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  70         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  71         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  71         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  76         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);">  76         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77         System.out.println(tips);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         return applicationId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 		List&lt;String&gt; paths = Arrays.asList(addjarPath.split(&quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 		return paths;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 }</span>
  92 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93 /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 143     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {"> 143     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145 			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147 			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148 				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149 			});</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152 		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 155         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);"> 155         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 161         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);"> 161         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 162         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);"> 162         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 167         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);"> 167         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170         return applicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173 	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175 			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177         List&lt;String&gt; paths = Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178 		return paths;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181 }</span>
 182 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7  * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8  * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9  * distributed with this work for additional information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10  * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11  * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12  * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13  * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16  *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17  * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20  * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21  * limitations under the License.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35 import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import org.slf4j.Logger;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 import java.net.URLDecoder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43 import java.util.Properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46  * per job mode submitter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47  * Date: 2018/11/17</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48  * Company: www.dtstack.com</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49  * @author xuchao</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52 public class PerJobSubmitter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54     private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  56     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  56     public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) thðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57 		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58 			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59 			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60 			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61 				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62 			});</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65 		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66         confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67         Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  68         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  68         ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(coðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70         PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71         perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73         String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  74         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  74         AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  75         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  75         ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecifðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77         String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78         String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  80         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);">  80         String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobIdðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81         LOG.info(tips);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83         return applicationId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86 	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87 		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88 			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90         List&lt;String&gt; paths = Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91 		return paths;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94 }</span>
  95 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -/*</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 - * Licensed to the Apache Software Foundation (ASF) under one</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 - * or more contributor license agreements.  See the NOTICE file</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 - * distributed with this work for additional information</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 - * regarding copyright ownership.  The ASF licenses this file</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 - * to you under the Apache License, Version 2.0 (the</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 - * &quot;License&quot;); you may not use this file except in compliance</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 - * with the License.  You may obtain a copy of the License at</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 - *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 - * http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 - *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 - * Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 - * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 - * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 - * See the License for the specific language governing permissions and</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 - * limitations under the License.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 - */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -package com.dtstack.flink.sql.launcher.perjob;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import org.apache.commons.lang3.StringUtils;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import org.apache.flink.client.deployment.ClusterSpecification;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -import org.apache.flink.client.program.ClusterClient;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import org.apache.flink.configuration.Configuration;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -import org.apache.flink.core.fs.Path;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import org.apache.flink.runtime.jobgraph.JobGraph;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import org.apache.flink.yarn.AbstractYarnClusterDescriptor;</span>





<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -import org.apache.hadoop.yarn.api.records.ApplicationId;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -import org.slf4j.Logger;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import org.slf4j.LoggerFactory;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -import java.net.URLDecoder;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -import java.util.Arrays;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -import java.util.List;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -import java.util.Properties;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 - * per job mode submitter</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 - * Date: 2018/11/17</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 - * Company: www.dtstack.com</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 - * @author xuchao</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 - */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -public class PerJobSubmitter {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -    private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  50 -    public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  50 -    public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws ExceðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -			List&lt;String&gt; paths = getJarPaths(addjarPath);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -			paths.forEach( path -&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -				jobGraph.addJar(new Path(&quot;file://&quot; + path));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -			});</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -		String confProp = launcherOptions.getConfProp();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -        confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -        Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  62 -        ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  62 -        ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confPropertðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -        PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -        perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -        String flinkJarPath = launcherOptions.getFlinkJarPath();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  68 -        AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  68 -        AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  69 -        ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  69 -        ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, ðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -        String applicationId = clusterClient.getClusterId().toString();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -        String flinkJobId = jobGraph.getJobID().toString();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -        String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -        System.out.println(tips);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -        LOG.info(tips);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -        return applicationId;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -	private static List&lt;String&gt; getJarPaths(String addjarPath) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -		if (addjarPath.length() &gt; 2) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -		List&lt;String&gt; paths = Arrays.asList(addjarPath.split(&quot;,&quot;));</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -		return paths;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -}</span></pre></td>
                            <td><pre>   1  /*
   2   * Licensed to the Apache Software Foundation (ASF) under one
   3   * or more contributor license agreements.  See the NOTICE file
   4   * distributed with this work for additional information
   5   * regarding copyright ownership.  The ASF licenses this file
   6   * to you under the Apache License, Version 2.0 (the
   7   * &quot;License&quot;); you may not use this file except in compliance
   8   * with the License.  You may obtain a copy of the License at
   9   *
  10   * http://www.apache.org/licenses/LICENSE-2.0
  11   *
  12   * Unless required by applicable law or agreed to in writing, software
  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  15   * See the License for the specific language governing permissions and
  16   * limitations under the License.
  17   */
  18  
  19  package com.dtstack.flink.sql.launcher.perjob;
  20  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import org.apache.commons.lang3.StringUtils;</span>
  25  import org.apache.flink.client.deployment.ClusterSpecification;
  26  import org.apache.flink.client.program.ClusterClient;
  27  import org.apache.flink.configuration.Configuration;
  28  import org.apache.flink.core.fs.Path;
  29  import org.apache.flink.runtime.jobgraph.JobGraph;
  30  import org.apache.flink.yarn.AbstractYarnClusterDescriptor;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 +import com.dtstack.flink.sql.option.Options;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import com.dtstack.flink.sql.util.PluginUtil;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  34 +import org.apache.commons.io.Charsets;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +import org.apache.commons.lang3.StringUtils;</span>
  36  import org.apache.hadoop.yarn.api.records.ApplicationId;
  37  import org.slf4j.Logger;
  38  import org.slf4j.LoggerFactory;
  39  import java.net.URLDecoder;
  40  import java.util.Arrays;
  41  import java.util.List;
  42  import java.util.Properties;
  43  
  44  /**
  45   * per job mode submitter
  46   * Date: 2018/11/17
  47   * Company: www.dtstack.com
  48   * @author xuchao
  49   */
  50  
  51  public class PerJobSubmitter {
  52  
  53      private static final Logger LOG = LoggerFactory.getLogger(PerJobSubmitter.class);
  54  
<abbr title="  55      public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws Exception {">  55      public static String submit(Options launcherOptions, JobGraph jobGraph, Configuration flinkConfig) throws ExceðŸ”µ</abbr>
  56  		if (!StringUtils.isBlank(launcherOptions.getAddjar())) {
  57  			String addjarPath = URLDecoder.decode(launcherOptions.getAddjar(), Charsets.UTF_8.toString());
  58  			List&lt;String&gt; paths = getJarPaths(addjarPath);
  59  			paths.forEach( path -&gt; {
  60  				jobGraph.addJar(new Path(&quot;file://&quot; + path));
  61  			});
  62  		}
  63  
  64  		String confProp = launcherOptions.getConfProp();
  65          confProp = URLDecoder.decode(confProp, Charsets.UTF_8.toString());
  66          Properties confProperties = PluginUtil.jsonStrToObject(confProp, Properties.class);
<abbr title="  67          ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confProperties);">  67          ClusterSpecification clusterSpecification = FLinkPerJobResourceUtil.createClusterSpecification(confPropertðŸ”µ</abbr>
  68  
  69          PerJobClusterClientBuilder perJobClusterClientBuilder = new PerJobClusterClientBuilder();
  70          perJobClusterClientBuilder.init(launcherOptions.getYarnconf(), flinkConfig, confProperties);
  71  
  72          String flinkJarPath = launcherOptions.getFlinkJarPath();
<abbr title="  73          AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriptor(flinkJarPath, launcherOptions, jobGraph);">  73          AbstractYarnClusterDescriptor yarnClusterDescriptor = perJobClusterClientBuilder.createPerJobClusterDescriðŸ”µ</abbr>
<abbr title="  74          ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, jobGraph,true);">  74          ClusterClient&lt;ApplicationId&gt; clusterClient = yarnClusterDescriptor.deployJobCluster(clusterSpecification, ðŸ”µ</abbr>
  75  
  76          String applicationId = clusterClient.getClusterId().toString();
  77          String flinkJobId = jobGraph.getJobID().toString();
  78  
  79          String tips = String.format(&quot;deploy per_job with appId: %s, jobId: %s&quot;, applicationId, flinkJobId);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -        System.out.println(tips);</span>
  81          LOG.info(tips);
  82  
  83          return applicationId;
  84      }
  85  
  86  	private static List&lt;String&gt; getJarPaths(String addjarPath) {
  87  		if (addjarPath.length() &gt; 2) {
  88  			addjarPath = addjarPath.substring(1,addjarPath.length()-1).replace(&quot;\&quot;&quot;,&quot;&quot;);
  89  		}
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -		List&lt;String&gt; paths = Arrays.asList(addjarPath.split(&quot;,&quot;));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +        List&lt;String&gt; paths = Arrays.asList(StringUtils.split(addjarPath, &quot;,&quot;));</span>
  92  		return paths;
  93  	}
  94  
  95  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            