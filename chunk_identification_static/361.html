<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>361</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    361
                    <a href="360.html">prev</a>
                    <a href="362.html">next</a>
                    <a href="361_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_e408d12c730a7397701e361d52cac823c1694111_elasticsearch6/elasticsearch6-side/elasticsearch6-all-side/src/main/java/com/dtstack/flink/sql/side/elasticsearch6/Elasticsearch6AllReqRow.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e408d12c730a7397701e361d52cac823c1694111:elasticsearch6/elasticsearch6-side/elasticsearch6-all-side/src/main/java/com/dtstack/flink/sql/side/elasticsearch6/Elasticsearch6AllReqRow.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e408d12c730a7397701e361d52cac823c1694111^1:elasticsearch6/elasticsearch6-side/elasticsearch6-all-side/src/main/java/com/dtstack/flink/sql/side/elasticsearch6/Elasticsearch6AllReqRow.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e408d12c730a7397701e361d52cac823c1694111^2:elasticsearch6/elasticsearch6-side/elasticsearch6-all-side/src/main/java/com/dtstack/flink/sql/side/elasticsearch6/Elasticsearch6AllReqRow.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;09a8d23c2b8c9e6955f6f68bed4a2fe16cc7fbd3:elasticsearch6/elasticsearch6-side/elasticsearch6-all-side/src/main/java/com/dtstack/flink/sql/side/elasticsearch6/Elasticsearch6AllReqRow.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-6877897769465959367" onmouseenter="enter('-6877897769465959367');" onmouseout="out('-6877897769465959367');" style="">  19 package com.dtstack.flink.sql.side.elasticsearch6;                                                       </span>
<span  style="">  20                                                                                                          </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  21 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  22 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  23 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  24 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="388410541738591361" onmouseenter="enter('388410541738591361');" onmouseout="out('388410541738591361');" style="">  25 import com.dtstack.flink.sql.side.elasticsearch6.table.Elasticsearch6SideTableInfo;                      </span>
<span class="290690444034872857" onmouseenter="enter('290690444034872857');" onmouseout="out('290690444034872857');" style="">  26 import com.dtstack.flink.sql.side.elasticsearch6.util.Es6Util;                                           </span>
<span class="5967037440424460461" onmouseenter="enter('5967037440424460461');" onmouseout="out('5967037440424460461');" style="">  27 import com.dtstack.flink.sql.side.elasticsearch6.util.SwitchUtil;                                        </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  28 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  29 import com.google.common.collect.Maps;                                                                   </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  30 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  31 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  32 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  33 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  34 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  35 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  36 import org.apache.flink.util.Collector;                                                                  </span>
<span class="-5662954158270406888" onmouseenter="enter('-5662954158270406888');" onmouseout="out('-5662954158270406888');" style="">  37 import org.elasticsearch.action.search.SearchRequest;                                                    </span>
<span class="7546585836699577478" onmouseenter="enter('7546585836699577478');" onmouseout="out('7546585836699577478');" style="">  38 import org.elasticsearch.action.search.SearchResponse;                                                   </span>
<span class="-1439206680157962857" onmouseenter="enter('-1439206680157962857');" onmouseout="out('-1439206680157962857');" style="">  39 import org.elasticsearch.client.RequestOptions;                                                          </span>
<span class="-7957925609215861115" onmouseenter="enter('-7957925609215861115');" onmouseout="out('-7957925609215861115');" style="">  40 import org.elasticsearch.client.RestHighLevelClient;                                                     </span>
<span class="-3798447231110012333" onmouseenter="enter('-3798447231110012333');" onmouseout="out('-3798447231110012333');" style="">  41 import org.elasticsearch.index.query.BoolQueryBuilder;                                                   </span>
<span class="4378821268051739093" onmouseenter="enter('4378821268051739093');" onmouseout="out('4378821268051739093');" style="">  42 import org.elasticsearch.search.SearchHit;                                                               </span>
<span class="-2631063383852475600" onmouseenter="enter('-2631063383852475600');" onmouseout="out('-2631063383852475600');" style="">  43 import org.elasticsearch.search.builder.SearchSourceBuilder;                                             </span>
<span class="-9133781105073271748" onmouseenter="enter('-9133781105073271748');" onmouseout="out('-9133781105073271748');" style="">  44 import org.elasticsearch.search.sort.SortOrder;                                                          </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  45 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  46 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  47                                                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  48 import java.io.IOException;                                                                              </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  49 import java.io.Serializable;                                                                             </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  50 import java.sql.Timestamp;                                                                               </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  51 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  52 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  53 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  54 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span  style="">  55                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56 /**                                                                                                      </span>
<span class="5111762851773435404" onmouseenter="enter('5111762851773435404');" onmouseout="out('5111762851773435404');" style="">  57  * @author yinxi                                                                                         </span>
<span class="9159416879699011666" onmouseenter="enter('9159416879699011666');" onmouseout="out('9159416879699011666');" style="">  58  * @date 2020/1/13 - 1:00                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  59  */                                                                                                      </span>
<span class="5844733793981427955" onmouseenter="enter('5844733793981427955');" onmouseout="out('5844733793981427955');" style="">  60 public class Elasticsearch6AllReqRow extends BaseAllReqRow implements Serializable {                     </span>
<span  style="">  61                                                                                                          </span>
<span class="-7348129739479646471" onmouseenter="enter('-7348129739479646471');" onmouseout="out('-7348129739479646471');" style="">  62     private static final Logger LOG = LoggerFactory.getLogger(Elasticsearch6AllReqRow.class);            </span>
<span  style="">  63                                                                                                          </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  64     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  65     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span class="-7435725468078760432" onmouseenter="enter('-7435725468078760432');" onmouseout="out('-7435725468078760432');" style="">  66     private transient RestHighLevelClient rhlClient;                                                     </span>
<span class="941714068177323601" onmouseenter="enter('941714068177323601');" onmouseout="out('941714068177323601');" style="">  67     private SearchRequest searchRequest;                                                                 </span>
<span class="-3071210506994519965" onmouseenter="enter('-3071210506994519965');" onmouseout="out('-3071210506994519965');" style="">  68     private BoolQueryBuilder boolQueryBuilder;                                                           </span>
<span  style="">  69                                                                                                          </span>
<span class="1319002072473948640" onmouseenter="enter('1319002072473948640');" onmouseout="out('1319002072473948640');" style=""><abbr title="  70     public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  70     public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInüîµ</abbr></span>
<span class="3324474204197455744" onmouseenter="enter('3324474204197455744');" onmouseout="out('3324474204197455744');" style="">  71         super(new Elasticsearch6AllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74     @Override                                                                                            </span>
<span class="-8216611023082687855" onmouseenter="enter('-8216611023082687855');" onmouseout="out('-8216611023082687855');" style="">  75     public void flatMap(Row value, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style="">  76         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style="">  77         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="2521208657133541418" onmouseenter="enter('2521208657133541418');" onmouseout="out('2521208657133541418');" style="">  78             Object equalObj = value.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style="">  79             if (equalObj == null) {                                                                      </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  80                 sendOutputRow(value, null, out);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  81                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82             }                                                                                            </span>
<span  style="">  83                                                                                                          </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style="">  84             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85         }                                                                                                </span>
<span  style="">  86                                                                                                          </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style="">  87         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style="">  88         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style="">  89         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  90             sendOutputRow(value, null, out);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  91             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92         }                                                                                                </span>
<span  style="">  93                                                                                                          </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style="">  94         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="7685661371746735414" onmouseenter="enter('7685661371746735414');" onmouseout="out('7685661371746735414');" style="">  95             sendOutputRow(value, one, out);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97     }                                                                                                    </span>
<span  style="">  98                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  99 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105             Object obj = input.getField(entry.getValue());                                               </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 106             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 106             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRoüîµ</abbr></span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 108             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 108             //Type information for indicating event or processing time. However, it behaves like a regulaüîµ</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112                                                                                                          </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126                                                                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 127 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133             Object obj = input.getField(entry.getValue());                                               </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 134             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 134             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRoüîµ</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 136             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 136             //Type information for indicating event or processing time. However, it behaves like a regulaüîµ</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138                 //ÂéªÈô§‰∏ä‰∏ÄÂ±ÇOutputRowtimeProcessFunction Ë∞ÉÁî®Êó∂Âå∫ÂØºËá¥ÁöÑÂΩ±Âìç                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 139                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());"> 139                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())üîµ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142                                                                                                          </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         return row;                                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 155 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 156 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 157     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 158         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 159         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 160             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161         }                                                                                                </span>
<span  style=""> 162                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 163         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164     }                                                                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 166     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 167         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 168         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 169             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170         }                                                                                                </span>
<span  style=""> 171                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 172         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173     }                                                                                                    </span>
<span  style=""> 174                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 175     @Override                                                                                            </span>
<span class="-7394496570177698356" onmouseenter="enter('-7394496570177698356');" onmouseout="out('-7394496570177698356');" style=""> 176     protected void initCache() {                                                                         </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 177         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 178         cacheRef.set(newCache);                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 179         try {                                                                                            </span>
<span class="674709874682000492" onmouseenter="enter('674709874682000492');" onmouseout="out('674709874682000492');" style=""> 180             // create search request and build where cause                                               </span>
<span class="5314623451052488943" onmouseenter="enter('5314623451052488943');" onmouseout="out('5314623451052488943');" style=""> 181             searchRequest = Es6Util.setSearchRequest(sideInfo);                                          </span>
<span class="6145103519064773487" onmouseenter="enter('6145103519064773487');" onmouseout="out('6145103519064773487');" style=""> 182             boolQueryBuilder = Es6Util.setPredicateclause(sideInfo);                                     </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 183             loadData(newCache);                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 184         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 185             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 186             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188     }                                                                                                    </span>
<span  style=""> 189                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 190     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 191     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 192         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 193         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 194         try {                                                                                            </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 195             loadData(newCache);                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 196         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 197             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 198             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199         }                                                                                                </span>
<span  style=""> 200                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 201         cacheRef.set(newCache);                                                                          </span>
<span class="6843412230405095659" onmouseenter="enter('6843412230405095659');" onmouseout="out('6843412230405095659');" style=""> 202         LOG.info(&quot;----- elasticsearch6 all cacheRef reload end:{}&quot;, Calendar.getInstance());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203     }                                                                                                    </span>
<span  style=""> 204                                                                                                          </span>
<span class="6000828278631814031" onmouseenter="enter('6000828278631814031');" onmouseout="out('6000828278631814031');" style=""> 205     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws IOException {          </span>
<span class="-6049088456160341398" onmouseenter="enter('-6049088456160341398');" onmouseout="out('-6049088456160341398');" style=""><abbr title=" 206         Elasticsearch6SideTableInfo tableInfo = (Elasticsearch6SideTableInfo) sideInfo.getSideTableInfo();"> 206         Elasticsearch6SideTableInfo tableInfo = (Elasticsearch6SideTableInfo) sideInfo.getSideTableInfo()üîµ</abbr></span>
<span  style=""> 207                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 208         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 209             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 210                 try {                                                                                    </span>
<span class="-86728648582584645" onmouseenter="enter('-86728648582584645');" onmouseout="out('-86728648582584645');" style=""><abbr title=" 211                     rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInfo.getUserName(), tableInfo.getPassword());"> 211                     rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInüîµ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 212                     break;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 213                 } catch (Exception e) {                                                                  </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 214                     if (i == CONN_RETRY_NUM - 1) {                                                       </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 215                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216                     }                                                                                    </span>
<span  style=""> 217                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 218                     try {                                                                                </span>
<span class="-7848393314785821372" onmouseenter="enter('-7848393314785821372');" onmouseout="out('-7848393314785821372');" style=""><abbr title=" 219                         String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.getUserName() + &quot;, pwd:&quot; + tableInfo.getPassword();"> 219                         String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.güîµ</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 220                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 221                         Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                        </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 222                     } catch (InterruptedException e1) {                                                  </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 223                         LOG.error(&quot;&quot;, e1);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225                 }                                                                                        </span>
<span  style=""> 226                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227             }                                                                                            </span>
<span class="3043029469447425667" onmouseenter="enter('3043029469447425667');" onmouseout="out('3043029469447425667');" style=""> 228             SearchSourceBuilder searchSourceBuilder = initConfiguration(boolQueryBuilder);               </span>
<span class="-3435762614644628348" onmouseenter="enter('-3435762614644628348');" onmouseout="out('-3435762614644628348');" style=""> 229             searchData(searchSourceBuilder, tmpCache);                                                   </span>
<span  style=""> 230                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 231         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 232             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 233             throw new RuntimeException(e);                                                               </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 234         } finally {                                                                                      </span>
<span  style=""> 235                                                                                                          </span>
<span class="-7971333903947873763" onmouseenter="enter('-7971333903947873763');" onmouseout="out('-7971333903947873763');" style=""> 236             if (rhlClient != null) {                                                                     </span>
<span class="-1010227642904461194" onmouseenter="enter('-1010227642904461194');" onmouseout="out('-1010227642904461194');" style=""> 237                 rhlClient.close();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240     }                                                                                                    </span>
<span  style=""> 241                                                                                                          </span>
<span class="2269102045065714005" onmouseenter="enter('2269102045065714005');" onmouseout="out('2269102045065714005');" style=""> 242     // initialize searchSourceBuilder                                                                    </span>
<span class="-2224311872144648433" onmouseenter="enter('-2224311872144648433');" onmouseout="out('-2224311872144648433');" style=""> 243     private SearchSourceBuilder initConfiguration(BoolQueryBuilder boolQueryBuilder){                    </span>
<span class="-3057155605199132792" onmouseenter="enter('-3057155605199132792');" onmouseout="out('-3057155605199132792');" style=""> 244         SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();                             </span>
<span class="5888509824421807900" onmouseenter="enter('5888509824421807900');" onmouseout="out('5888509824421807900');" style=""> 245         if (boolQueryBuilder != null) {                                                                  </span>
<span class="2112246244941479873" onmouseenter="enter('2112246244941479873');" onmouseout="out('2112246244941479873');" style=""> 246             searchSourceBuilder.query(boolQueryBuilder);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247         }                                                                                                </span>
<span  style=""> 248                                                                                                          </span>
<span class="9166141955334164362" onmouseenter="enter('9166141955334164362');" onmouseout="out('9166141955334164362');" style=""> 249         searchSourceBuilder.size(getFetchSize());                                                        </span>
<span class="4871961152897776065" onmouseenter="enter('4871961152897776065');" onmouseout="out('4871961152897776065');" style=""> 250         searchSourceBuilder.sort(&quot;_id&quot;, SortOrder.DESC);                                                 </span>
<span  style=""> 251                                                                                                          </span>
<span class="8838423000996937411" onmouseenter="enter('8838423000996937411');" onmouseout="out('8838423000996937411');" style=""> 252         // fields included in the source data                                                            </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 253         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);         </span>
<span class="834931586921422776" onmouseenter="enter('834931586921422776');" onmouseout="out('834931586921422776');" style=""> 254         searchSourceBuilder.fetchSource(sideFieldNames, null);                                           </span>
<span class="6987226028729546159" onmouseenter="enter('6987226028729546159');" onmouseout="out('6987226028729546159');" style=""> 255         return searchSourceBuilder;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256     }                                                                                                    </span>
<span  style=""> 257                                                                                                          </span>
<span  style=""> 258                                                                                                          </span>
<span class="-5770816861072855867" onmouseenter="enter('-5770816861072855867');" onmouseout="out('-5770816861072855867');" style=""><abbr title=" 259     private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {"> 259     private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;üîµ</abbr></span>
<span  style=""> 260                                                                                                          </span>
<span class="-8453426813158434905" onmouseenter="enter('-8453426813158434905');" onmouseout="out('-8453426813158434905');" style=""> 261         Object[] searchAfterParameter = null;                                                            </span>
<span class="-1026355603335276750" onmouseenter="enter('-1026355603335276750');" onmouseout="out('-1026355603335276750');" style=""> 262         SearchResponse searchResponse = null;                                                            </span>
<span class="7944441773116551326" onmouseenter="enter('7944441773116551326');" onmouseout="out('7944441773116551326');" style=""> 263         SearchHit[] searchHits = null;                                                                   </span>
<span  style=""> 264                                                                                                          </span>
<span class="-3127950886903104513" onmouseenter="enter('-3127950886903104513');" onmouseout="out('-3127950886903104513');" style=""> 265         while (true) {                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 266             try {                                                                                        </span>
<span class="-8834251943337813063" onmouseenter="enter('-8834251943337813063');" onmouseout="out('-8834251943337813063');" style=""> 267                 if (searchAfterParameter != null) {                                                      </span>
<span class="-7450619709568283762" onmouseenter="enter('-7450619709568283762');" onmouseout="out('-7450619709568283762');" style=""> 268                     // set search mark                                                                   </span>
<span class="-1605613418950762671" onmouseenter="enter('-1605613418950762671');" onmouseout="out('-1605613418950762671');" style=""> 269                     searchSourceBuilder.searchAfter(searchAfterParameter);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270                 }                                                                                        </span>
<span  style=""> 271                                                                                                          </span>
<span class="-1428606878545121206" onmouseenter="enter('-1428606878545121206');" onmouseout="out('-1428606878545121206');" style=""> 272                 searchRequest.source(searchSourceBuilder);                                               </span>
<span class="7835248494248469019" onmouseenter="enter('7835248494248469019');" onmouseout="out('7835248494248469019');" style=""> 273                 searchResponse = rhlClient.search(searchRequest, RequestOptions.DEFAULT);                </span>
<span class="-5450331146729317410" onmouseenter="enter('-5450331146729317410');" onmouseout="out('-5450331146729317410');" style=""> 274                 searchHits = searchResponse.getHits().getHits();                                         </span>
<span class="4838685550122638048" onmouseenter="enter('4838685550122638048');" onmouseout="out('4838685550122638048');" style=""> 275                 loadToCache(searchHits, tmpCache);                                                       </span>
<span  style=""> 276                                                                                                          </span>
<span class="1973318889644552850" onmouseenter="enter('1973318889644552850');" onmouseout="out('1973318889644552850');" style=""> 277                 if (searchHits.length &lt; getFetchSize()) {                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 278                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279                 }                                                                                        </span>
<span  style=""> 280                                                                                                          </span>
<span class="7053413659196757604" onmouseenter="enter('7053413659196757604');" onmouseout="out('7053413659196757604');" style=""> 281                 searchAfterParameter = searchHits[searchHits.length - 1].getSortValues();                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 282             } catch (IOException e) {                                                                    </span>
<span class="-2611542528459573797" onmouseenter="enter('-2611542528459573797');" onmouseout="out('-2611542528459573797');" style=""> 283                 LOG.error(&quot;Query failed!&quot;, e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286     }                                                                                                    </span>
<span  style=""> 287                                                                                                          </span>
<span class="6185545389876623927" onmouseenter="enter('6185545389876623927');" onmouseout="out('6185545389876623927');" style=""> 288     // data load to cache                                                                                </span>
<span class="-1880698783322592076" onmouseenter="enter('-1880698783322592076');" onmouseout="out('-1880698783322592076');" style=""> 289     private void loadToCache(SearchHit[] searchHits, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {  </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 290         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);         </span>
<span class="-4984551143623777064" onmouseenter="enter('-4984551143623777064');" onmouseout="out('-4984551143623777064');" style=""> 291         String[] sideFieldTypes = sideInfo.getSideTableInfo().getFieldTypes();                           </span>
<span  style=""> 292                                                                                                          </span>
<span class="4685904830571915876" onmouseenter="enter('4685904830571915876');" onmouseout="out('4685904830571915876');" style=""> 293         for (SearchHit searchHit : searchHits) {                                                         </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 294             Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                              </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 295             for (String fieldName : sideFieldNames) {                                                    </span>
<span class="751016650926868726" onmouseenter="enter('751016650926868726');" onmouseout="out('751016650926868726');" style=""> 296                 Object object = searchHit.getSourceAsMap().get(fieldName.trim());                        </span>
<span class="-5554489446561494047" onmouseenter="enter('-5554489446561494047');" onmouseout="out('-5554489446561494047');" style=""> 297                 int fieldIndex = sideInfo.getSideTableInfo().getFieldList().indexOf(fieldName.trim());   </span>
<span class="-3781318186031183467" onmouseenter="enter('-3781318186031183467');" onmouseout="out('-3781318186031183467');" style=""> 298                 object = SwitchUtil.getTarget(object, sideFieldTypes[fieldIndex]);                       </span>
<span class="-1923378616241569286" onmouseenter="enter('-1923378616241569286');" onmouseout="out('-1923378616241569286');" style=""> 299                 oneRow.put(fieldName.trim(), object);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300             }                                                                                            </span>
<span  style=""> 301                                                                                                          </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 302             String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                            </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 303             List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 303             List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayListüîµ</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 304             list.add(oneRow);                                                                            </span>
<span  style=""> 305                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307     }                                                                                                    </span>
<span  style=""> 308                                                                                                          </span>
<span class="-7768596139566319511" onmouseenter="enter('-7768596139566319511');" onmouseout="out('-7768596139566319511');" style=""> 309     public int getFetchSize() {                                                                          </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style=""> 310         return 1000;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-6877897769465959367" onmouseenter="enter('-6877897769465959367');" onmouseout="out('-6877897769465959367');" style="">  19 package com.dtstack.flink.sql.side.elasticsearch6;                                                       </span>
<span  style="">  20                                                                                                          </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  21 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  22 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  23 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  24 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="388410541738591361" onmouseenter="enter('388410541738591361');" onmouseout="out('388410541738591361');" style="">  25 import com.dtstack.flink.sql.side.elasticsearch6.table.Elasticsearch6SideTableInfo;                      </span>
<span class="290690444034872857" onmouseenter="enter('290690444034872857');" onmouseout="out('290690444034872857');" style="">  26 import com.dtstack.flink.sql.side.elasticsearch6.util.Es6Util;                                           </span>
<span class="5967037440424460461" onmouseenter="enter('5967037440424460461');" onmouseout="out('5967037440424460461');" style="">  27 import com.dtstack.flink.sql.side.elasticsearch6.util.SwitchUtil;                                        </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  28 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  29 import com.google.common.collect.Maps;                                                                   </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  30 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  31 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  32 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  33 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  34 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  35 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  36 import org.apache.flink.util.Collector;                                                                  </span>
<span class="-5662954158270406888" onmouseenter="enter('-5662954158270406888');" onmouseout="out('-5662954158270406888');" style="">  37 import org.elasticsearch.action.search.SearchRequest;                                                    </span>
<span class="7546585836699577478" onmouseenter="enter('7546585836699577478');" onmouseout="out('7546585836699577478');" style="">  38 import org.elasticsearch.action.search.SearchResponse;                                                   </span>
<span class="-1439206680157962857" onmouseenter="enter('-1439206680157962857');" onmouseout="out('-1439206680157962857');" style="">  39 import org.elasticsearch.client.RequestOptions;                                                          </span>
<span class="-7957925609215861115" onmouseenter="enter('-7957925609215861115');" onmouseout="out('-7957925609215861115');" style="">  40 import org.elasticsearch.client.RestHighLevelClient;                                                     </span>
<span class="-3798447231110012333" onmouseenter="enter('-3798447231110012333');" onmouseout="out('-3798447231110012333');" style="">  41 import org.elasticsearch.index.query.BoolQueryBuilder;                                                   </span>
<span class="4378821268051739093" onmouseenter="enter('4378821268051739093');" onmouseout="out('4378821268051739093');" style="">  42 import org.elasticsearch.search.SearchHit;                                                               </span>
<span class="-2631063383852475600" onmouseenter="enter('-2631063383852475600');" onmouseout="out('-2631063383852475600');" style="">  43 import org.elasticsearch.search.builder.SearchSourceBuilder;                                             </span>
<span class="-9133781105073271748" onmouseenter="enter('-9133781105073271748');" onmouseout="out('-9133781105073271748');" style="">  44 import org.elasticsearch.search.sort.SortOrder;                                                          </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  45 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  46 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  47                                                                                                          </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  48 import java.io.IOException;                                                                              </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  49 import java.io.Serializable;                                                                             </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  50 import java.sql.Timestamp;                                                                               </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  51 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  52 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  53 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  54 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span  style="">  55                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56 /**                                                                                                      </span>
<span class="5111762851773435404" onmouseenter="enter('5111762851773435404');" onmouseout="out('5111762851773435404');" style="">  57  * @author yinxi                                                                                         </span>
<span class="9159416879699011666" onmouseenter="enter('9159416879699011666');" onmouseout="out('9159416879699011666');" style="">  58  * @date 2020/1/13 - 1:00                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  59  */                                                                                                      </span>
<span class="5844733793981427955" onmouseenter="enter('5844733793981427955');" onmouseout="out('5844733793981427955');" style="">  60 public class Elasticsearch6AllReqRow extends BaseAllReqRow implements Serializable {                     </span>
<span  style="">  61                                                                                                          </span>
<span class="-7348129739479646471" onmouseenter="enter('-7348129739479646471');" onmouseout="out('-7348129739479646471');" style="">  62     private static final Logger LOG = LoggerFactory.getLogger(Elasticsearch6AllReqRow.class);            </span>
<span  style="">  63                                                                                                          </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  64     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  65     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span class="-7435725468078760432" onmouseenter="enter('-7435725468078760432');" onmouseout="out('-7435725468078760432');" style="">  66     private transient RestHighLevelClient rhlClient;                                                     </span>
<span class="941714068177323601" onmouseenter="enter('941714068177323601');" onmouseout="out('941714068177323601');" style="">  67     private SearchRequest searchRequest;                                                                 </span>
<span class="-3071210506994519965" onmouseenter="enter('-3071210506994519965');" onmouseout="out('-3071210506994519965');" style="">  68     private BoolQueryBuilder boolQueryBuilder;                                                           </span>
<span  style="">  69                                                                                                          </span>
<span class="1319002072473948640" onmouseenter="enter('1319002072473948640');" onmouseout="out('1319002072473948640');" style=""><abbr title="  70     public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  70     public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInüîµ</abbr></span>
<span class="3324474204197455744" onmouseenter="enter('3324474204197455744');" onmouseout="out('3324474204197455744');" style="">  71         super(new Elasticsearch6AllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74     @Override                                                                                            </span>
<span class="-8216611023082687855" onmouseenter="enter('-8216611023082687855');" onmouseout="out('-8216611023082687855');" style="">  75     public void flatMap(Row value, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style="">  76         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style="">  77         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="2521208657133541418" onmouseenter="enter('2521208657133541418');" onmouseout="out('2521208657133541418');" style="">  78             Object equalObj = value.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style="">  79             if (equalObj == null) {                                                                      </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  80                 sendOutputRow(value, null, out);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  81                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82             }                                                                                            </span>
<span  style="">  83                                                                                                          </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style="">  84             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85         }                                                                                                </span>
<span  style="">  86                                                                                                          </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style="">  87         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style="">  88         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style="">  89         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  90             sendOutputRow(value, null, out);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  91             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92         }                                                                                                </span>
<span  style="">  93                                                                                                          </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style="">  94         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="7685661371746735414" onmouseenter="enter('7685661371746735414');" onmouseout="out('7685661371746735414');" style="">  95             sendOutputRow(value, one, out);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97     }                                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  98 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99 @Override                                                                                                </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104             Object obj = input.getField(entry.getValue());                                               </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 105             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 105             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRoüîµ</abbr></span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 107             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 107             //Type information for indicating event or processing time. However, it behaves like a regulaüîµ</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110             }                                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 111                                                                                                          </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 112             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 114                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 117                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 118             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 119                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 120             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 121         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 122                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 123         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 124     }                                                                                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 125 ||||||| BASE                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126 @Override                                                                                                </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131             Object obj = input.getField(entry.getValue());                                               </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 132             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 132             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRoüîµ</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 134             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 134             //Type information for indicating event or processing time. However, it behaves like a regulaüîµ</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136                 //ÂéªÈô§‰∏ä‰∏ÄÂ±ÇOutputRowtimeProcessFunction Ë∞ÉÁî®Êó∂Âå∫ÂØºËá¥ÁöÑÂΩ±Âìç                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 137                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());"> 137                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())üîµ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                                                                                                          </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 154 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 155 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 156                                                                                                          </span>
<span  style=""> 157                                                                                                          </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 158     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 159         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 160         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 161             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span  style=""> 163                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 164         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165     }                                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 167     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 168         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 169         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 170             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171         }                                                                                                </span>
<span  style=""> 172                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 173         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174     }                                                                                                    </span>
<span  style=""> 175                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 176     @Override                                                                                            </span>
<span class="-7394496570177698356" onmouseenter="enter('-7394496570177698356');" onmouseout="out('-7394496570177698356');" style=""> 177     protected void initCache() {                                                                         </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 178         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 179         cacheRef.set(newCache);                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 180         try {                                                                                            </span>
<span class="674709874682000492" onmouseenter="enter('674709874682000492');" onmouseout="out('674709874682000492');" style=""> 181             // create search request and build where cause                                               </span>
<span class="5314623451052488943" onmouseenter="enter('5314623451052488943');" onmouseout="out('5314623451052488943');" style=""> 182             searchRequest = Es6Util.setSearchRequest(sideInfo);                                          </span>
<span class="6145103519064773487" onmouseenter="enter('6145103519064773487');" onmouseout="out('6145103519064773487');" style=""> 183             boolQueryBuilder = Es6Util.setPredicateclause(sideInfo);                                     </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 184             loadData(newCache);                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 185         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 186             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 187             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189     }                                                                                                    </span>
<span  style=""> 190                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 191     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 192     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 193         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 194         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 195         try {                                                                                            </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 196             loadData(newCache);                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 197         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 198             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 199             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200         }                                                                                                </span>
<span  style=""> 201                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 202         cacheRef.set(newCache);                                                                          </span>
<span class="6843412230405095659" onmouseenter="enter('6843412230405095659');" onmouseout="out('6843412230405095659');" style=""> 203         LOG.info(&quot;----- elasticsearch6 all cacheRef reload end:{}&quot;, Calendar.getInstance());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204     }                                                                                                    </span>
<span  style=""> 205                                                                                                          </span>
<span class="6000828278631814031" onmouseenter="enter('6000828278631814031');" onmouseout="out('6000828278631814031');" style=""> 206     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws IOException {          </span>
<span class="-6049088456160341398" onmouseenter="enter('-6049088456160341398');" onmouseout="out('-6049088456160341398');" style=""><abbr title=" 207         Elasticsearch6SideTableInfo tableInfo = (Elasticsearch6SideTableInfo) sideInfo.getSideTableInfo();"> 207         Elasticsearch6SideTableInfo tableInfo = (Elasticsearch6SideTableInfo) sideInfo.getSideTableInfo()üîµ</abbr></span>
<span  style=""> 208                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 209         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 210             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 211                 try {                                                                                    </span>
<span class="-86728648582584645" onmouseenter="enter('-86728648582584645');" onmouseout="out('-86728648582584645');" style=""><abbr title=" 212                     rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInfo.getUserName(), tableInfo.getPassword());"> 212                     rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInüîµ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 213                     break;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 214                 } catch (Exception e) {                                                                  </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 215                     if (i == CONN_RETRY_NUM - 1) {                                                       </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 216                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217                     }                                                                                    </span>
<span  style=""> 218                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 219                     try {                                                                                </span>
<span class="-7848393314785821372" onmouseenter="enter('-7848393314785821372');" onmouseout="out('-7848393314785821372');" style=""><abbr title=" 220                         String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.getUserName() + &quot;, pwd:&quot; + tableInfo.getPassword();"> 220                         String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.güîµ</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 221                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 222                         Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                        </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 223                     } catch (InterruptedException e1) {                                                  </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 224                         LOG.error(&quot;&quot;, e1);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226                 }                                                                                        </span>
<span  style=""> 227                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228             }                                                                                            </span>
<span class="3043029469447425667" onmouseenter="enter('3043029469447425667');" onmouseout="out('3043029469447425667');" style=""> 229             SearchSourceBuilder searchSourceBuilder = initConfiguration(boolQueryBuilder);               </span>
<span class="-3435762614644628348" onmouseenter="enter('-3435762614644628348');" onmouseout="out('-3435762614644628348');" style=""> 230             searchData(searchSourceBuilder, tmpCache);                                                   </span>
<span  style=""> 231                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 232         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 233             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 234             throw new RuntimeException(e);                                                               </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 235         } finally {                                                                                      </span>
<span  style=""> 236                                                                                                          </span>
<span class="-7971333903947873763" onmouseenter="enter('-7971333903947873763');" onmouseout="out('-7971333903947873763');" style=""> 237             if (rhlClient != null) {                                                                     </span>
<span class="-1010227642904461194" onmouseenter="enter('-1010227642904461194');" onmouseout="out('-1010227642904461194');" style=""> 238                 rhlClient.close();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241     }                                                                                                    </span>
<span  style=""> 242                                                                                                          </span>
<span class="2269102045065714005" onmouseenter="enter('2269102045065714005');" onmouseout="out('2269102045065714005');" style=""> 243     // initialize searchSourceBuilder                                                                    </span>
<span class="-2224311872144648433" onmouseenter="enter('-2224311872144648433');" onmouseout="out('-2224311872144648433');" style=""> 244     private SearchSourceBuilder initConfiguration(BoolQueryBuilder boolQueryBuilder){                    </span>
<span class="-3057155605199132792" onmouseenter="enter('-3057155605199132792');" onmouseout="out('-3057155605199132792');" style=""> 245         SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();                             </span>
<span class="5888509824421807900" onmouseenter="enter('5888509824421807900');" onmouseout="out('5888509824421807900');" style=""> 246         if (boolQueryBuilder != null) {                                                                  </span>
<span class="2112246244941479873" onmouseenter="enter('2112246244941479873');" onmouseout="out('2112246244941479873');" style=""> 247             searchSourceBuilder.query(boolQueryBuilder);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248         }                                                                                                </span>
<span  style=""> 249                                                                                                          </span>
<span class="9166141955334164362" onmouseenter="enter('9166141955334164362');" onmouseout="out('9166141955334164362');" style=""> 250         searchSourceBuilder.size(getFetchSize());                                                        </span>
<span class="4871961152897776065" onmouseenter="enter('4871961152897776065');" onmouseout="out('4871961152897776065');" style=""> 251         searchSourceBuilder.sort(&quot;_id&quot;, SortOrder.DESC);                                                 </span>
<span  style=""> 252                                                                                                          </span>
<span class="8838423000996937411" onmouseenter="enter('8838423000996937411');" onmouseout="out('8838423000996937411');" style=""> 253         // fields included in the source data                                                            </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 254         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);         </span>
<span class="834931586921422776" onmouseenter="enter('834931586921422776');" onmouseout="out('834931586921422776');" style=""> 255         searchSourceBuilder.fetchSource(sideFieldNames, null);                                           </span>
<span class="6987226028729546159" onmouseenter="enter('6987226028729546159');" onmouseout="out('6987226028729546159');" style=""> 256         return searchSourceBuilder;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257     }                                                                                                    </span>
<span  style=""> 258                                                                                                          </span>
<span  style=""> 259                                                                                                          </span>
<span class="-5770816861072855867" onmouseenter="enter('-5770816861072855867');" onmouseout="out('-5770816861072855867');" style=""><abbr title=" 260     private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {"> 260     private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;üîµ</abbr></span>
<span  style=""> 261                                                                                                          </span>
<span class="-8453426813158434905" onmouseenter="enter('-8453426813158434905');" onmouseout="out('-8453426813158434905');" style=""> 262         Object[] searchAfterParameter = null;                                                            </span>
<span class="-1026355603335276750" onmouseenter="enter('-1026355603335276750');" onmouseout="out('-1026355603335276750');" style=""> 263         SearchResponse searchResponse = null;                                                            </span>
<span class="7944441773116551326" onmouseenter="enter('7944441773116551326');" onmouseout="out('7944441773116551326');" style=""> 264         SearchHit[] searchHits = null;                                                                   </span>
<span  style=""> 265                                                                                                          </span>
<span class="-3127950886903104513" onmouseenter="enter('-3127950886903104513');" onmouseout="out('-3127950886903104513');" style=""> 266         while (true) {                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 267             try {                                                                                        </span>
<span class="-8834251943337813063" onmouseenter="enter('-8834251943337813063');" onmouseout="out('-8834251943337813063');" style=""> 268                 if (searchAfterParameter != null) {                                                      </span>
<span class="-7450619709568283762" onmouseenter="enter('-7450619709568283762');" onmouseout="out('-7450619709568283762');" style=""> 269                     // set search mark                                                                   </span>
<span class="-1605613418950762671" onmouseenter="enter('-1605613418950762671');" onmouseout="out('-1605613418950762671');" style=""> 270                     searchSourceBuilder.searchAfter(searchAfterParameter);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271                 }                                                                                        </span>
<span  style=""> 272                                                                                                          </span>
<span class="-1428606878545121206" onmouseenter="enter('-1428606878545121206');" onmouseout="out('-1428606878545121206');" style=""> 273                 searchRequest.source(searchSourceBuilder);                                               </span>
<span class="7835248494248469019" onmouseenter="enter('7835248494248469019');" onmouseout="out('7835248494248469019');" style=""> 274                 searchResponse = rhlClient.search(searchRequest, RequestOptions.DEFAULT);                </span>
<span class="-5450331146729317410" onmouseenter="enter('-5450331146729317410');" onmouseout="out('-5450331146729317410');" style=""> 275                 searchHits = searchResponse.getHits().getHits();                                         </span>
<span class="4838685550122638048" onmouseenter="enter('4838685550122638048');" onmouseout="out('4838685550122638048');" style=""> 276                 loadToCache(searchHits, tmpCache);                                                       </span>
<span  style=""> 277                                                                                                          </span>
<span class="1973318889644552850" onmouseenter="enter('1973318889644552850');" onmouseout="out('1973318889644552850');" style=""> 278                 if (searchHits.length &lt; getFetchSize()) {                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 279                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280                 }                                                                                        </span>
<span  style=""> 281                                                                                                          </span>
<span class="7053413659196757604" onmouseenter="enter('7053413659196757604');" onmouseout="out('7053413659196757604');" style=""> 282                 searchAfterParameter = searchHits[searchHits.length - 1].getSortValues();                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 283             } catch (IOException e) {                                                                    </span>
<span class="-2611542528459573797" onmouseenter="enter('-2611542528459573797');" onmouseout="out('-2611542528459573797');" style=""> 284                 LOG.error(&quot;Query failed!&quot;, e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287     }                                                                                                    </span>
<span  style=""> 288                                                                                                          </span>
<span class="6185545389876623927" onmouseenter="enter('6185545389876623927');" onmouseout="out('6185545389876623927');" style=""> 289     // data load to cache                                                                                </span>
<span class="-1880698783322592076" onmouseenter="enter('-1880698783322592076');" onmouseout="out('-1880698783322592076');" style=""> 290     private void loadToCache(SearchHit[] searchHits, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {  </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 291         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);         </span>
<span class="-4984551143623777064" onmouseenter="enter('-4984551143623777064');" onmouseout="out('-4984551143623777064');" style=""> 292         String[] sideFieldTypes = sideInfo.getSideTableInfo().getFieldTypes();                           </span>
<span  style=""> 293                                                                                                          </span>
<span class="4685904830571915876" onmouseenter="enter('4685904830571915876');" onmouseout="out('4685904830571915876');" style=""> 294         for (SearchHit searchHit : searchHits) {                                                         </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 295             Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                              </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 296             for (String fieldName : sideFieldNames) {                                                    </span>
<span class="751016650926868726" onmouseenter="enter('751016650926868726');" onmouseout="out('751016650926868726');" style=""> 297                 Object object = searchHit.getSourceAsMap().get(fieldName.trim());                        </span>
<span class="-5554489446561494047" onmouseenter="enter('-5554489446561494047');" onmouseout="out('-5554489446561494047');" style=""> 298                 int fieldIndex = sideInfo.getSideTableInfo().getFieldList().indexOf(fieldName.trim());   </span>
<span class="-3781318186031183467" onmouseenter="enter('-3781318186031183467');" onmouseout="out('-3781318186031183467');" style=""> 299                 object = SwitchUtil.getTarget(object, sideFieldTypes[fieldIndex]);                       </span>
<span class="-1923378616241569286" onmouseenter="enter('-1923378616241569286');" onmouseout="out('-1923378616241569286');" style=""> 300                 oneRow.put(fieldName.trim(), object);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301             }                                                                                            </span>
<span  style=""> 302                                                                                                          </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 303             String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                            </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 304             List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 304             List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayListüîµ</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 305             list.add(oneRow);                                                                            </span>
<span  style=""> 306                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308     }                                                                                                    </span>
<span  style=""> 309                                                                                                          </span>
<span class="-7768596139566319511" onmouseenter="enter('-7768596139566319511');" onmouseout="out('-7768596139566319511');" style=""> 310     public int getFetchSize() {                                                                          </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style=""> 311         return 1000;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-6877897769465959367" onmouseenter="enter('-6877897769465959367');" onmouseout="out('-6877897769465959367');" style="">  18 package com.dtstack.flink.sql.side.elasticsearch6;                                                       </span>
<span  style="">  19                                                                                                          </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  20 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  21 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  22 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  23 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="388410541738591361" onmouseenter="enter('388410541738591361');" onmouseout="out('388410541738591361');" style="">  24 import com.dtstack.flink.sql.side.elasticsearch6.table.Elasticsearch6SideTableInfo;                      </span>
<span class="290690444034872857" onmouseenter="enter('290690444034872857');" onmouseout="out('290690444034872857');" style="">  25 import com.dtstack.flink.sql.side.elasticsearch6.util.Es6Util;                                           </span>
<span class="5967037440424460461" onmouseenter="enter('5967037440424460461');" onmouseout="out('5967037440424460461');" style="">  26 import com.dtstack.flink.sql.side.elasticsearch6.util.SwitchUtil;                                        </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  27 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  28 import com.google.common.collect.Maps;                                                                   </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  29 import java.io.IOException;                                                                              </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  30 import java.io.Serializable;                                                                             </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  31 import java.sql.Timestamp;                                                                               </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  32 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  33 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  34 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  35 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  36 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  37 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  38 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  39 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  40 import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                           </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  41 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  42 import org.apache.flink.util.Collector;                                                                  </span>
<span class="-5662954158270406888" onmouseenter="enter('-5662954158270406888');" onmouseout="out('-5662954158270406888');" style="">  43 import org.elasticsearch.action.search.SearchRequest;                                                    </span>
<span class="7546585836699577478" onmouseenter="enter('7546585836699577478');" onmouseout="out('7546585836699577478');" style="">  44 import org.elasticsearch.action.search.SearchResponse;                                                   </span>
<span class="-1439206680157962857" onmouseenter="enter('-1439206680157962857');" onmouseout="out('-1439206680157962857');" style="">  45 import org.elasticsearch.client.RequestOptions;                                                          </span>
<span class="-7957925609215861115" onmouseenter="enter('-7957925609215861115');" onmouseout="out('-7957925609215861115');" style="">  46 import org.elasticsearch.client.RestHighLevelClient;                                                     </span>
<span class="-3798447231110012333" onmouseenter="enter('-3798447231110012333');" onmouseout="out('-3798447231110012333');" style="">  47 import org.elasticsearch.index.query.BoolQueryBuilder;                                                   </span>
<span class="4378821268051739093" onmouseenter="enter('4378821268051739093');" onmouseout="out('4378821268051739093');" style="">  48 import org.elasticsearch.search.SearchHit;                                                               </span>
<span class="-2631063383852475600" onmouseenter="enter('-2631063383852475600');" onmouseout="out('-2631063383852475600');" style="">  49 import org.elasticsearch.search.builder.SearchSourceBuilder;                                             </span>
<span class="-9133781105073271748" onmouseenter="enter('-9133781105073271748');" onmouseout="out('-9133781105073271748');" style="">  50 import org.elasticsearch.search.sort.SortOrder;                                                          </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  51 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  52 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  53                                                                                                          </span>
<span  style="">  54                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55 /**                                                                                                      </span>
<span class="5111762851773435404" onmouseenter="enter('5111762851773435404');" onmouseout="out('5111762851773435404');" style="">  56  * @author yinxi                                                                                         </span>
<span class="9159416879699011666" onmouseenter="enter('9159416879699011666');" onmouseout="out('9159416879699011666');" style="">  57  * @date 2020/1/13 - 1:00                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  58  */                                                                                                      </span>
<span class="5844733793981427955" onmouseenter="enter('5844733793981427955');" onmouseout="out('5844733793981427955');" style="">  59 public class Elasticsearch6AllReqRow extends BaseAllReqRow implements Serializable {                     </span>
<span class="-7348129739479646471" onmouseenter="enter('-7348129739479646471');" onmouseout="out('-7348129739479646471');" style="">  60     private static final Logger LOG = LoggerFactory.getLogger(Elasticsearch6AllReqRow.class);            </span>
<span  style="">  61                                                                                                          </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  62     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span  style="">  63                                                                                                          </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  64     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span  style="">  65                                                                                                          </span>
<span class="-7435725468078760432" onmouseenter="enter('-7435725468078760432');" onmouseout="out('-7435725468078760432');" style="">  66     private transient RestHighLevelClient rhlClient;                                                     </span>
<span  style="">  67                                                                                                          </span>
<span class="941714068177323601" onmouseenter="enter('941714068177323601');" onmouseout="out('941714068177323601');" style="">  68     private SearchRequest searchRequest;                                                                 </span>
<span  style="">  69                                                                                                          </span>
<span class="-3071210506994519965" onmouseenter="enter('-3071210506994519965');" onmouseout="out('-3071210506994519965');" style="">  70     private BoolQueryBuilder boolQueryBuilder;                                                           </span>
<span  style="">  71                                                                                                          </span>
<span class="1319002072473948640" onmouseenter="enter('1319002072473948640');" onmouseout="out('1319002072473948640');" style=""><abbr title="  72     public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  72     public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInüîµ</abbr></span>
<span class="3324474204197455744" onmouseenter="enter('3324474204197455744');" onmouseout="out('3324474204197455744');" style="">  73         super(new Elasticsearch6AllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74     }                                                                                                    </span>
<span  style="">  75                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  76     @Override                                                                                            </span>
<span class="-8216611023082687855" onmouseenter="enter('-8216611023082687855');" onmouseout="out('-8216611023082687855');" style="">  77     public void flatMap(Row value, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style="">  78         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style="">  79         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="2521208657133541418" onmouseenter="enter('2521208657133541418');" onmouseout="out('2521208657133541418');" style="">  80             Object equalObj = value.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style="">  81             if (equalObj == null) {                                                                      </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  82                 sendOutputRow(value, null, out);                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  83                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84             }                                                                                            </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style="">  85             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86         }                                                                                                </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style="">  87         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style="">  88         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style="">  89         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  90             sendOutputRow(value, null, out);                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  91             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92         }                                                                                                </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style="">  93         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="7685661371746735414" onmouseenter="enter('7685661371746735414');" onmouseout="out('7685661371746735414');" style="">  94             sendOutputRow(value, one, out);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span  style="">  97                                                                                                          </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style="">  98     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style="">  99         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 100         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 101             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102         }                                                                                                </span>
<span  style=""> 103                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 104         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 107     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 108         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 109         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 110             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111         }                                                                                                </span>
<span  style=""> 112                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 113         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114     }                                                                                                    </span>
<span  style=""> 115                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 116     @Override                                                                                            </span>
<span class="-7394496570177698356" onmouseenter="enter('-7394496570177698356');" onmouseout="out('-7394496570177698356');" style=""> 117     protected void initCache() {                                                                         </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 118         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 119         cacheRef.set(newCache);                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 120         try {                                                                                            </span>
<span class="674709874682000492" onmouseenter="enter('674709874682000492');" onmouseout="out('674709874682000492');" style=""> 121             // create search request and build where cause                                               </span>
<span class="5314623451052488943" onmouseenter="enter('5314623451052488943');" onmouseout="out('5314623451052488943');" style=""> 122             searchRequest = Es6Util.setSearchRequest(sideInfo);                                          </span>
<span class="6145103519064773487" onmouseenter="enter('6145103519064773487');" onmouseout="out('6145103519064773487');" style=""> 123             boolQueryBuilder = Es6Util.setPredicateclause(sideInfo);                                     </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 124             loadData(newCache);                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 125         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 126             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 127             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129     }                                                                                                    </span>
<span  style=""> 130                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 131     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 132     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 133         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 134         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 135         try {                                                                                            </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 136             loadData(newCache);                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 137         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 138             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 139             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140         }                                                                                                </span>
<span  style=""> 141                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 142         cacheRef.set(newCache);                                                                          </span>
<span class="6843412230405095659" onmouseenter="enter('6843412230405095659');" onmouseout="out('6843412230405095659');" style=""> 143         LOG.info(&quot;----- elasticsearch6 all cacheRef reload end:{}&quot;, Calendar.getInstance());             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144     }                                                                                                    </span>
<span  style=""> 145                                                                                                          </span>
<span class="6000828278631814031" onmouseenter="enter('6000828278631814031');" onmouseout="out('6000828278631814031');" style=""> 146     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws IOException {          </span>
<span class="-6049088456160341398" onmouseenter="enter('-6049088456160341398');" onmouseout="out('-6049088456160341398');" style=""><abbr title=" 147         Elasticsearch6SideTableInfo tableInfo = (Elasticsearch6SideTableInfo) sideInfo.getSideTableInfo();"> 147         Elasticsearch6SideTableInfo tableInfo = (Elasticsearch6SideTableInfo) sideInfo.getSideTableInfo()üîµ</abbr></span>
<span  style=""> 148                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 149         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 150             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 151                 try {                                                                                    </span>
<span class="-86728648582584645" onmouseenter="enter('-86728648582584645');" onmouseout="out('-86728648582584645');" style=""><abbr title=" 152                     rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInfo.getUserName(), tableInfo.getPassword());"> 152                     rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInüîµ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 153                     break;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 154                 } catch (Exception e) {                                                                  </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 155                     if (i == CONN_RETRY_NUM - 1) {                                                       </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 156                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                     }                                                                                    </span>
<span  style=""> 158                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 159                     try {                                                                                </span>
<span class="-7848393314785821372" onmouseenter="enter('-7848393314785821372');" onmouseout="out('-7848393314785821372');" style=""><abbr title=" 160                         String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.getUserName() + &quot;, pwd:&quot; + tableInfo.getPassword();"> 160                         String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.güîµ</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 161                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 162                         Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                        </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 163                     } catch (InterruptedException e1) {                                                  </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 164                         LOG.error(&quot;&quot;, e1);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166                 }                                                                                        </span>
<span  style=""> 167                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168             }                                                                                            </span>
<span class="3043029469447425667" onmouseenter="enter('3043029469447425667');" onmouseout="out('3043029469447425667');" style=""> 169             SearchSourceBuilder searchSourceBuilder = initConfiguration(boolQueryBuilder);               </span>
<span class="-3435762614644628348" onmouseenter="enter('-3435762614644628348');" onmouseout="out('-3435762614644628348');" style=""> 170             searchData(searchSourceBuilder, tmpCache);                                                   </span>
<span  style=""> 171                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 172         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 173             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 174             throw new RuntimeException(e);                                                               </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 175         } finally {                                                                                      </span>
<span  style=""> 176                                                                                                          </span>
<span class="-7971333903947873763" onmouseenter="enter('-7971333903947873763');" onmouseout="out('-7971333903947873763');" style=""> 177             if (rhlClient != null) {                                                                     </span>
<span class="-1010227642904461194" onmouseenter="enter('-1010227642904461194');" onmouseout="out('-1010227642904461194');" style=""> 178                 rhlClient.close();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181     }                                                                                                    </span>
<span  style=""> 182                                                                                                          </span>
<span class="2269102045065714005" onmouseenter="enter('2269102045065714005');" onmouseout="out('2269102045065714005');" style=""> 183     // initialize searchSourceBuilder                                                                    </span>
<span class="-2224311872144648433" onmouseenter="enter('-2224311872144648433');" onmouseout="out('-2224311872144648433');" style=""> 184     private SearchSourceBuilder initConfiguration(BoolQueryBuilder boolQueryBuilder){                    </span>
<span class="-3057155605199132792" onmouseenter="enter('-3057155605199132792');" onmouseout="out('-3057155605199132792');" style=""> 185         SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();                             </span>
<span class="5888509824421807900" onmouseenter="enter('5888509824421807900');" onmouseout="out('5888509824421807900');" style=""> 186         if (boolQueryBuilder != null) {                                                                  </span>
<span class="2112246244941479873" onmouseenter="enter('2112246244941479873');" onmouseout="out('2112246244941479873');" style=""> 187             searchSourceBuilder.query(boolQueryBuilder);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188         }                                                                                                </span>
<span  style=""> 189                                                                                                          </span>
<span class="9166141955334164362" onmouseenter="enter('9166141955334164362');" onmouseout="out('9166141955334164362');" style=""> 190         searchSourceBuilder.size(getFetchSize());                                                        </span>
<span class="4871961152897776065" onmouseenter="enter('4871961152897776065');" onmouseout="out('4871961152897776065');" style=""> 191         searchSourceBuilder.sort(&quot;_id&quot;, SortOrder.DESC);                                                 </span>
<span  style=""> 192                                                                                                          </span>
<span class="8838423000996937411" onmouseenter="enter('8838423000996937411');" onmouseout="out('8838423000996937411');" style=""> 193         // fields included in the source data                                                            </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 194         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);         </span>
<span class="834931586921422776" onmouseenter="enter('834931586921422776');" onmouseout="out('834931586921422776');" style=""> 195         searchSourceBuilder.fetchSource(sideFieldNames, null);                                           </span>
<span class="6987226028729546159" onmouseenter="enter('6987226028729546159');" onmouseout="out('6987226028729546159');" style=""> 196         return searchSourceBuilder;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197     }                                                                                                    </span>
<span  style=""> 198                                                                                                          </span>
<span class="-5770816861072855867" onmouseenter="enter('-5770816861072855867');" onmouseout="out('-5770816861072855867');" style=""><abbr title=" 199     private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {"> 199     private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;üîµ</abbr></span>
<span  style=""> 200                                                                                                          </span>
<span class="-8453426813158434905" onmouseenter="enter('-8453426813158434905');" onmouseout="out('-8453426813158434905');" style=""> 201         Object[] searchAfterParameter = null;                                                            </span>
<span class="-1026355603335276750" onmouseenter="enter('-1026355603335276750');" onmouseout="out('-1026355603335276750');" style=""> 202         SearchResponse searchResponse = null;                                                            </span>
<span class="7944441773116551326" onmouseenter="enter('7944441773116551326');" onmouseout="out('7944441773116551326');" style=""> 203         SearchHit[] searchHits = null;                                                                   </span>
<span  style=""> 204                                                                                                          </span>
<span class="-3127950886903104513" onmouseenter="enter('-3127950886903104513');" onmouseout="out('-3127950886903104513');" style=""> 205         while (true) {                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 206             try {                                                                                        </span>
<span class="-8834251943337813063" onmouseenter="enter('-8834251943337813063');" onmouseout="out('-8834251943337813063');" style=""> 207                 if (searchAfterParameter != null) {                                                      </span>
<span class="-7450619709568283762" onmouseenter="enter('-7450619709568283762');" onmouseout="out('-7450619709568283762');" style=""> 208                     // set search mark                                                                   </span>
<span class="-1605613418950762671" onmouseenter="enter('-1605613418950762671');" onmouseout="out('-1605613418950762671');" style=""> 209                     searchSourceBuilder.searchAfter(searchAfterParameter);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210                 }                                                                                        </span>
<span  style=""> 211                                                                                                          </span>
<span class="-1428606878545121206" onmouseenter="enter('-1428606878545121206');" onmouseout="out('-1428606878545121206');" style=""> 212                 searchRequest.source(searchSourceBuilder);                                               </span>
<span class="7835248494248469019" onmouseenter="enter('7835248494248469019');" onmouseout="out('7835248494248469019');" style=""> 213                 searchResponse = rhlClient.search(searchRequest, RequestOptions.DEFAULT);                </span>
<span class="-5450331146729317410" onmouseenter="enter('-5450331146729317410');" onmouseout="out('-5450331146729317410');" style=""> 214                 searchHits = searchResponse.getHits().getHits();                                         </span>
<span class="4838685550122638048" onmouseenter="enter('4838685550122638048');" onmouseout="out('4838685550122638048');" style=""> 215                 loadToCache(searchHits, tmpCache);                                                       </span>
<span  style=""> 216                                                                                                          </span>
<span class="1973318889644552850" onmouseenter="enter('1973318889644552850');" onmouseout="out('1973318889644552850');" style=""> 217                 if (searchHits.length &lt; getFetchSize()) {                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 218                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219                 }                                                                                        </span>
<span  style=""> 220                                                                                                          </span>
<span class="7053413659196757604" onmouseenter="enter('7053413659196757604');" onmouseout="out('7053413659196757604');" style=""> 221                 searchAfterParameter = searchHits[searchHits.length - 1].getSortValues();                </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 222             } catch (IOException e) {                                                                    </span>
<span class="-2611542528459573797" onmouseenter="enter('-2611542528459573797');" onmouseout="out('-2611542528459573797');" style=""> 223                 LOG.error(&quot;Query failed!&quot;, e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226     }                                                                                                    </span>
<span  style=""> 227                                                                                                          </span>
<span class="6185545389876623927" onmouseenter="enter('6185545389876623927');" onmouseout="out('6185545389876623927');" style=""> 228     // data load to cache                                                                                </span>
<span class="-1880698783322592076" onmouseenter="enter('-1880698783322592076');" onmouseout="out('-1880698783322592076');" style=""> 229     private void loadToCache(SearchHit[] searchHits, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {  </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 230         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);         </span>
<span class="-4984551143623777064" onmouseenter="enter('-4984551143623777064');" onmouseout="out('-4984551143623777064');" style=""> 231         String[] sideFieldTypes = sideInfo.getSideTableInfo().getFieldTypes();                           </span>
<span  style=""> 232                                                                                                          </span>
<span class="4685904830571915876" onmouseenter="enter('4685904830571915876');" onmouseout="out('4685904830571915876');" style=""> 233         for (SearchHit searchHit : searchHits) {                                                         </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 234             Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                              </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 235             for (String fieldName : sideFieldNames) {                                                    </span>
<span class="751016650926868726" onmouseenter="enter('751016650926868726');" onmouseout="out('751016650926868726');" style=""> 236                 Object object = searchHit.getSourceAsMap().get(fieldName.trim());                        </span>
<span class="-5554489446561494047" onmouseenter="enter('-5554489446561494047');" onmouseout="out('-5554489446561494047');" style=""> 237                 int fieldIndex = sideInfo.getSideTableInfo().getFieldList().indexOf(fieldName.trim());   </span>
<span class="-3781318186031183467" onmouseenter="enter('-3781318186031183467');" onmouseout="out('-3781318186031183467');" style=""> 238                 object = SwitchUtil.getTarget(object, sideFieldTypes[fieldIndex]);                       </span>
<span class="-1923378616241569286" onmouseenter="enter('-1923378616241569286');" onmouseout="out('-1923378616241569286');" style=""> 239                 oneRow.put(fieldName.trim(), object);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240             }                                                                                            </span>
<span  style=""> 241                                                                                                          </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 242             String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                            </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 243             List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 243             List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayListüîµ</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 244             list.add(oneRow);                                                                            </span>
<span  style=""> 245                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247     }                                                                                                    </span>
<span  style=""> 248                                                                                                          </span>
<span class="-7768596139566319511" onmouseenter="enter('-7768596139566319511');" onmouseout="out('-7768596139566319511');" style=""> 249     public int getFetchSize() {                                                                          </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style=""> 250         return 1000;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252 }                                                                                                        </span>



























































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="-6877897769465959367" onmouseenter="enter('-6877897769465959367');" onmouseout="out('-6877897769465959367');" style="">  19  package com.dtstack.flink.sql.side.elasticsearch6;                                                                </span>
<span  style="">  20                                                                                                                    </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  21  import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  22  import com.dtstack.flink.sql.side.BaseAllReqRow;                                                                  </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  23  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  24  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="388410541738591361" onmouseenter="enter('388410541738591361');" onmouseout="out('388410541738591361');" style="">  25  import com.dtstack.flink.sql.side.elasticsearch6.table.Elasticsearch6SideTableInfo;                               </span>
<span class="290690444034872857" onmouseenter="enter('290690444034872857');" onmouseout="out('290690444034872857');" style="">  26  import com.dtstack.flink.sql.side.elasticsearch6.util.Es6Util;                                                    </span>
<span class="5967037440424460461" onmouseenter="enter('5967037440424460461');" onmouseout="out('5967037440424460461');" style="">  27  import com.dtstack.flink.sql.side.elasticsearch6.util.SwitchUtil;                                                 </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  28  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  29  import com.google.common.collect.Maps;                                                                            </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  30  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  31  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  32  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  34 +import org.apache.flink.table.dataformat.BaseRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  35  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  36  import org.apache.flink.types.Row;                                                                                </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  37  import org.apache.flink.util.Collector;                                                                           </span>
<span class="-5662954158270406888" onmouseenter="enter('-5662954158270406888');" onmouseout="out('-5662954158270406888');" style="">  38  import org.elasticsearch.action.search.SearchRequest;                                                             </span>
<span class="7546585836699577478" onmouseenter="enter('7546585836699577478');" onmouseout="out('7546585836699577478');" style="">  39  import org.elasticsearch.action.search.SearchResponse;                                                            </span>
<span class="-1439206680157962857" onmouseenter="enter('-1439206680157962857');" onmouseout="out('-1439206680157962857');" style="">  40  import org.elasticsearch.client.RequestOptions;                                                                   </span>
<span class="-7957925609215861115" onmouseenter="enter('-7957925609215861115');" onmouseout="out('-7957925609215861115');" style="">  41  import org.elasticsearch.client.RestHighLevelClient;                                                              </span>
<span class="-3798447231110012333" onmouseenter="enter('-3798447231110012333');" onmouseout="out('-3798447231110012333');" style="">  42  import org.elasticsearch.index.query.BoolQueryBuilder;                                                            </span>
<span class="4378821268051739093" onmouseenter="enter('4378821268051739093');" onmouseout="out('4378821268051739093');" style="">  43  import org.elasticsearch.search.SearchHit;                                                                        </span>
<span class="-2631063383852475600" onmouseenter="enter('-2631063383852475600');" onmouseout="out('-2631063383852475600');" style="">  44  import org.elasticsearch.search.builder.SearchSourceBuilder;                                                      </span>
<span class="-9133781105073271748" onmouseenter="enter('-9133781105073271748');" onmouseout="out('-9133781105073271748');" style="">  45  import org.elasticsearch.search.sort.SortOrder;                                                                   </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  46  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  47  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  48                                                                                                                    </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  49  import java.io.IOException;                                                                                       </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  50  import java.io.Serializable;                                                                                      </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  51  import java.sql.Timestamp;                                                                                        </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  52  import java.util.Calendar;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  53  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  54  import java.util.Map;                                                                                             </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  55  import java.util.concurrent.atomic.AtomicReference;                                                               </span>
<span  style="">  56                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  57  /**                                                                                                               </span>
<span class="5111762851773435404" onmouseenter="enter('5111762851773435404');" onmouseout="out('5111762851773435404');" style="">  58   * @author yinxi                                                                                                  </span>
<span class="9159416879699011666" onmouseenter="enter('9159416879699011666');" onmouseout="out('9159416879699011666');" style="">  59   * @date 2020/1/13 - 1:00                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  60   */                                                                                                               </span>
<span class="5844733793981427955" onmouseenter="enter('5844733793981427955');" onmouseout="out('5844733793981427955');" style="">  61  public class Elasticsearch6AllReqRow extends BaseAllReqRow implements Serializable {                              </span>
<span  style="">  62                                                                                                                    </span>
<span class="-7348129739479646471" onmouseenter="enter('-7348129739479646471');" onmouseout="out('-7348129739479646471');" style="">  63      private static final Logger LOG = LoggerFactory.getLogger(Elasticsearch6AllReqRow.class);                     </span>
<span  style="">  64                                                                                                                    </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  65      private static final int CONN_RETRY_NUM = 3;                                                                  </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  66      private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();           </span>
<span class="-7435725468078760432" onmouseenter="enter('-7435725468078760432');" onmouseout="out('-7435725468078760432');" style="">  67      private transient RestHighLevelClient rhlClient;                                                              </span>
<span class="941714068177323601" onmouseenter="enter('941714068177323601');" onmouseout="out('941714068177323601');" style="">  68      private SearchRequest searchRequest;                                                                          </span>
<span class="-3071210506994519965" onmouseenter="enter('-3071210506994519965');" onmouseout="out('-3071210506994519965');" style="">  69      private BoolQueryBuilder boolQueryBuilder;                                                                    </span>
<span  style="">  70                                                                                                                    </span>
<span class="1319002072473948640" onmouseenter="enter('1319002072473948640');" onmouseout="out('1319002072473948640');" style=""><abbr title="  71      public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  71      public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Aüîµ</abbr></span>
<span class="3324474204197455744" onmouseenter="enter('3324474204197455744');" onmouseout="out('3324474204197455744');" style="">  72          super(new Elasticsearch6AllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73      }                                                                                                             </span>
<span  style="">  74                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  75      @Override                                                                                                     </span>
<span class="-8452891775464581011" onmouseenter="enter('-8452891775464581011');" onmouseout="out('-8452891775464581011');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  76 -    public void flatMap(CRow value, Collector&lt;CRow&gt; out) throws Exception {                                       </span>
<span class="-8216611023082687855" onmouseenter="enter('-8216611023082687855');" onmouseout="out('-8216611023082687855');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +    public void flatMap(Row value, Collector&lt;BaseRow&gt; out) throws Exception {                                     </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style="">  78          List&lt;Object&gt; inputParams = Lists.newArrayList();                                                          </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style="">  79          for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                                 </span>
<span class="2735827600528721418" onmouseenter="enter('2735827600528721418');" onmouseout="out('2735827600528721418');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -            Object equalObj = value.row().getField(conValIndex);                                                  </span>
<span class="2521208657133541418" onmouseenter="enter('2521208657133541418');" onmouseout="out('2521208657133541418');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +            Object equalObj = value.getField(conValIndex);                                                        </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style="">  82              if (equalObj == null) {                                                                               </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  83                  sendOutputRow(value, null, out);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  84                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85              }                                                                                                     </span>
<span  style="">  86                                                                                                                    </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style="">  87              inputParams.add(equalObj);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  88          }                                                                                                         </span>
<span  style="">  89                                                                                                                    </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style="">  90          String key = buildKey(inputParams);                                                                       </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style="">  91          List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                            </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style="">  92          if (CollectionUtils.isEmpty(cacheList)) {                                                                 </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  93              sendOutputRow(value, null, out);                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  94              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95          }                                                                                                         </span>
<span  style="">  96                                                                                                                    </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style="">  97          for (Map&lt;String, Object&gt; one : cacheList) {                                                               </span>
<span class="7685661371746735414" onmouseenter="enter('7685661371746735414');" onmouseout="out('7685661371746735414');" style="">  98              sendOutputRow(value, one, out);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100      }                                                                                                             </span>
<span  style=""> 101                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 102      @Override                                                                                                     </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style=""> 103      public Row fillData(Row input, Object sideInput) {                                                            </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style=""> 104          Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                          </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 105          Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 106          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 107              Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style=""><abbr title=" 108              boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 108              boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfoüîµ</abbr></span>
<span  style=""> 109                                                                                                                    </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style=""><abbr title=" 110              //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 110              //Type information for indicating event or processing time. However, it behaves like a regular SQL timüîµ</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style=""> 111              if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -                //ÂéªÈô§‰∏ä‰∏ÄÂ±ÇOutputRowtimeProcessFunction Ë∞ÉÁî®Êó∂Âå∫ÂØºËá¥ÁöÑÂΩ±Âìç                                                     </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -                obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -                                                                                                                  </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +                obj = ((Timestamp) obj).getTime();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +            }                                                                                                     </span>
<span  style=""> 118                                                                                                                    </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 119              row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120          }                                                                                                         </span>
<span  style=""> 121                                                                                                                    </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style=""> 122          for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {                    </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 123              if (cacheInfo == null) {                                                                              </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 124                  row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 125              } else {                                                                                              </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 126                  row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128          }                                                                                                         </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 130          return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131      }                                                                                                             </span>
<span  style=""> 132                                                                                                                    </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 133      private String buildKey(List&lt;Object&gt; equalValList) {                                                          </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 134          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 135          for (Object equalVal : equalValList) {                                                                    </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 136              sb.append(equalVal).append(&quot;_&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137          }                                                                                                         </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 139          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140      }                                                                                                             </span>
<span  style=""> 141                                                                                                                    </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 142      private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                               </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 143          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 144          for (String equalField : equalFieldList) {                                                                </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 145              sb.append(val.get(equalField)).append(&quot;_&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146          }                                                                                                         </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 148          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149      }                                                                                                             </span>
<span  style=""> 150                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 151      @Override                                                                                                     </span>
<span class="-7394496570177698356" onmouseenter="enter('-7394496570177698356');" onmouseout="out('-7394496570177698356');" style=""> 152      protected void initCache() {                                                                                  </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 153          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 154          cacheRef.set(newCache);                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 155          try {                                                                                                     </span>
<span class="674709874682000492" onmouseenter="enter('674709874682000492');" onmouseout="out('674709874682000492');" style=""> 156              // create search request and build where cause                                                        </span>
<span class="5314623451052488943" onmouseenter="enter('5314623451052488943');" onmouseout="out('5314623451052488943');" style=""> 157              searchRequest = Es6Util.setSearchRequest(sideInfo);                                                   </span>
<span class="6145103519064773487" onmouseenter="enter('6145103519064773487');" onmouseout="out('6145103519064773487');" style=""> 158              boolQueryBuilder = Es6Util.setPredicateclause(sideInfo);                                              </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 159              loadData(newCache);                                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 160          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 161              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 162              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164      }                                                                                                             </span>
<span  style=""> 165                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 166      @Override                                                                                                     </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 167      protected void reloadCache() {                                                                                </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 168          //reload cacheRef and replace to old cacheRef                                                             </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 169          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 170          try {                                                                                                     </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 171              loadData(newCache);                                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 172          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 173              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 174              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175          }                                                                                                         </span>
<span  style=""> 176                                                                                                                    </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 177          cacheRef.set(newCache);                                                                                   </span>
<span class="6843412230405095659" onmouseenter="enter('6843412230405095659');" onmouseout="out('6843412230405095659');" style=""> 178          LOG.info(&quot;----- elasticsearch6 all cacheRef reload end:{}&quot;, Calendar.getInstance());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179      }                                                                                                             </span>
<span  style=""> 180                                                                                                                    </span>
<span class="6000828278631814031" onmouseenter="enter('6000828278631814031');" onmouseout="out('6000828278631814031');" style=""> 181      private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws IOException {                   </span>
<span class="-6049088456160341398" onmouseenter="enter('-6049088456160341398');" onmouseout="out('-6049088456160341398');" style=""> 182          Elasticsearch6SideTableInfo tableInfo = (Elasticsearch6SideTableInfo) sideInfo.getSideTableInfo();        </span>
<span  style=""> 183                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 184          try {                                                                                                     </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 185              for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 186                  try {                                                                                             </span>
<span class="-86728648582584645" onmouseenter="enter('-86728648582584645');" onmouseout="out('-86728648582584645');" style=""><abbr title=" 187                      rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInfo.getUserName(), tableInfo.getPassword());"> 187                      rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInfo.getUseüîµ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 188                      break;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 189                  } catch (Exception e) {                                                                           </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 190                      if (i == CONN_RETRY_NUM - 1) {                                                                </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 191                          throw new RuntimeException(&quot;&quot;, e);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192                      }                                                                                             </span>
<span  style=""> 193                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 194                      try {                                                                                         </span>
<span class="-7848393314785821372" onmouseenter="enter('-7848393314785821372');" onmouseout="out('-7848393314785821372');" style=""><abbr title=" 195                          String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.getUserName() + &quot;, pwd:&quot; + tableInfo.getPassword();"> 195                          String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.getUserNamüîµ</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 196                          LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);            </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 197                          Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                                 </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 198                      } catch (InterruptedException e1) {                                                           </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 199                          LOG.error(&quot;&quot;, e1);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201                  }                                                                                                 </span>
<span  style=""> 202                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203              }                                                                                                     </span>
<span class="3043029469447425667" onmouseenter="enter('3043029469447425667');" onmouseout="out('3043029469447425667');" style=""> 204              SearchSourceBuilder searchSourceBuilder = initConfiguration(boolQueryBuilder);                        </span>
<span class="-3435762614644628348" onmouseenter="enter('-3435762614644628348');" onmouseout="out('-3435762614644628348');" style=""> 205              searchData(searchSourceBuilder, tmpCache);                                                            </span>
<span  style=""> 206                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 207          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 208              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 209              throw new RuntimeException(e);                                                                        </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 210          } finally {                                                                                               </span>
<span  style=""> 211                                                                                                                    </span>
<span class="-7971333903947873763" onmouseenter="enter('-7971333903947873763');" onmouseout="out('-7971333903947873763');" style=""> 212              if (rhlClient != null) {                                                                              </span>
<span class="-1010227642904461194" onmouseenter="enter('-1010227642904461194');" onmouseout="out('-1010227642904461194');" style=""> 213                  rhlClient.close();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span  style=""> 217                                                                                                                    </span>
<span class="2269102045065714005" onmouseenter="enter('2269102045065714005');" onmouseout="out('2269102045065714005');" style=""> 218      // initialize searchSourceBuilder                                                                             </span>
<span class="-2224311872144648433" onmouseenter="enter('-2224311872144648433');" onmouseout="out('-2224311872144648433');" style=""> 219      private SearchSourceBuilder initConfiguration(BoolQueryBuilder boolQueryBuilder){                             </span>
<span class="-3057155605199132792" onmouseenter="enter('-3057155605199132792');" onmouseout="out('-3057155605199132792');" style=""> 220          SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();                                      </span>
<span class="5888509824421807900" onmouseenter="enter('5888509824421807900');" onmouseout="out('5888509824421807900');" style=""> 221          if (boolQueryBuilder != null) {                                                                           </span>
<span class="2112246244941479873" onmouseenter="enter('2112246244941479873');" onmouseout="out('2112246244941479873');" style=""> 222              searchSourceBuilder.query(boolQueryBuilder);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223          }                                                                                                         </span>
<span  style=""> 224                                                                                                                    </span>
<span class="9166141955334164362" onmouseenter="enter('9166141955334164362');" onmouseout="out('9166141955334164362');" style=""> 225          searchSourceBuilder.size(getFetchSize());                                                                 </span>
<span class="4871961152897776065" onmouseenter="enter('4871961152897776065');" onmouseout="out('4871961152897776065');" style=""> 226          searchSourceBuilder.sort(&quot;_id&quot;, SortOrder.DESC);                                                          </span>
<span  style=""> 227                                                                                                                    </span>
<span class="8838423000996937411" onmouseenter="enter('8838423000996937411');" onmouseout="out('8838423000996937411');" style=""> 228          // fields included in the source data                                                                     </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 229          String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);                  </span>
<span class="834931586921422776" onmouseenter="enter('834931586921422776');" onmouseout="out('834931586921422776');" style=""> 230          searchSourceBuilder.fetchSource(sideFieldNames, null);                                                    </span>
<span class="6987226028729546159" onmouseenter="enter('6987226028729546159');" onmouseout="out('6987226028729546159');" style=""> 231          return searchSourceBuilder;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232      }                                                                                                             </span>
<span  style=""> 233                                                                                                                    </span>
<span  style=""> 234                                                                                                                    </span>
<span class="-5770816861072855867" onmouseenter="enter('-5770816861072855867');" onmouseout="out('-5770816861072855867');" style=""><abbr title=" 235      private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {"> 235      private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCacüîµ</abbr></span>
<span  style=""> 236                                                                                                                    </span>
<span class="-8453426813158434905" onmouseenter="enter('-8453426813158434905');" onmouseout="out('-8453426813158434905');" style=""> 237          Object[] searchAfterParameter = null;                                                                     </span>
<span class="-1026355603335276750" onmouseenter="enter('-1026355603335276750');" onmouseout="out('-1026355603335276750');" style=""> 238          SearchResponse searchResponse = null;                                                                     </span>
<span class="7944441773116551326" onmouseenter="enter('7944441773116551326');" onmouseout="out('7944441773116551326');" style=""> 239          SearchHit[] searchHits = null;                                                                            </span>
<span  style=""> 240                                                                                                                    </span>
<span class="-3127950886903104513" onmouseenter="enter('-3127950886903104513');" onmouseout="out('-3127950886903104513');" style=""> 241          while (true) {                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 242              try {                                                                                                 </span>
<span class="-8834251943337813063" onmouseenter="enter('-8834251943337813063');" onmouseout="out('-8834251943337813063');" style=""> 243                  if (searchAfterParameter != null) {                                                               </span>
<span class="-7450619709568283762" onmouseenter="enter('-7450619709568283762');" onmouseout="out('-7450619709568283762');" style=""> 244                      // set search mark                                                                            </span>
<span class="-1605613418950762671" onmouseenter="enter('-1605613418950762671');" onmouseout="out('-1605613418950762671');" style=""> 245                      searchSourceBuilder.searchAfter(searchAfterParameter);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246                  }                                                                                                 </span>
<span  style=""> 247                                                                                                                    </span>
<span class="-1428606878545121206" onmouseenter="enter('-1428606878545121206');" onmouseout="out('-1428606878545121206');" style=""> 248                  searchRequest.source(searchSourceBuilder);                                                        </span>
<span class="7835248494248469019" onmouseenter="enter('7835248494248469019');" onmouseout="out('7835248494248469019');" style=""> 249                  searchResponse = rhlClient.search(searchRequest, RequestOptions.DEFAULT);                         </span>
<span class="-5450331146729317410" onmouseenter="enter('-5450331146729317410');" onmouseout="out('-5450331146729317410');" style=""> 250                  searchHits = searchResponse.getHits().getHits();                                                  </span>
<span class="4838685550122638048" onmouseenter="enter('4838685550122638048');" onmouseout="out('4838685550122638048');" style=""> 251                  loadToCache(searchHits, tmpCache);                                                                </span>
<span  style=""> 252                                                                                                                    </span>
<span class="1973318889644552850" onmouseenter="enter('1973318889644552850');" onmouseout="out('1973318889644552850');" style=""> 253                  if (searchHits.length &lt; getFetchSize()) {                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 254                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255                  }                                                                                                 </span>
<span  style=""> 256                                                                                                                    </span>
<span class="7053413659196757604" onmouseenter="enter('7053413659196757604');" onmouseout="out('7053413659196757604');" style=""> 257                  searchAfterParameter = searchHits[searchHits.length - 1].getSortValues();                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 258              } catch (IOException e) {                                                                             </span>
<span class="-2611542528459573797" onmouseenter="enter('-2611542528459573797');" onmouseout="out('-2611542528459573797');" style=""> 259                  LOG.error(&quot;Query failed!&quot;, e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262      }                                                                                                             </span>
<span  style=""> 263                                                                                                                    </span>
<span class="6185545389876623927" onmouseenter="enter('6185545389876623927');" onmouseout="out('6185545389876623927');" style=""> 264      // data load to cache                                                                                         </span>
<span class="-1880698783322592076" onmouseenter="enter('-1880698783322592076');" onmouseout="out('-1880698783322592076');" style=""> 265      private void loadToCache(SearchHit[] searchHits, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {           </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 266          String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);                  </span>
<span class="-4984551143623777064" onmouseenter="enter('-4984551143623777064');" onmouseout="out('-4984551143623777064');" style=""> 267          String[] sideFieldTypes = sideInfo.getSideTableInfo().getFieldTypes();                                    </span>
<span  style=""> 268                                                                                                                    </span>
<span class="4685904830571915876" onmouseenter="enter('4685904830571915876');" onmouseout="out('4685904830571915876');" style=""> 269          for (SearchHit searchHit : searchHits) {                                                                  </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 270              Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                                       </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 271              for (String fieldName : sideFieldNames) {                                                             </span>
<span class="751016650926868726" onmouseenter="enter('751016650926868726');" onmouseout="out('751016650926868726');" style=""> 272                  Object object = searchHit.getSourceAsMap().get(fieldName.trim());                                 </span>
<span class="-5554489446561494047" onmouseenter="enter('-5554489446561494047');" onmouseout="out('-5554489446561494047');" style=""> 273                  int fieldIndex = sideInfo.getSideTableInfo().getFieldList().indexOf(fieldName.trim());            </span>
<span class="-3781318186031183467" onmouseenter="enter('-3781318186031183467');" onmouseout="out('-3781318186031183467');" style=""> 274                  object = SwitchUtil.getTarget(object, sideFieldTypes[fieldIndex]);                                </span>
<span class="-1923378616241569286" onmouseenter="enter('-1923378616241569286');" onmouseout="out('-1923378616241569286');" style=""> 275                  oneRow.put(fieldName.trim(), object);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276              }                                                                                                     </span>
<span  style=""> 277                                                                                                                    </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 278              String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                                     </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""> 279              List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());     </span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 280              list.add(oneRow);                                                                                     </span>
<span  style=""> 281                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283      }                                                                                                             </span>
<span  style=""> 284                                                                                                                    </span>
<span class="-7768596139566319511" onmouseenter="enter('-7768596139566319511');" onmouseout="out('-7768596139566319511');" style=""> 285      public int getFetchSize() {                                                                                   </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style=""> 286          return 1000;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="-6877897769465959367" onmouseenter="enter('-6877897769465959367');" onmouseout="out('-6877897769465959367');" style="">  19  package com.dtstack.flink.sql.side.elasticsearch6;                                                                </span>
<span  style="">  20                                                                                                                    </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  21  import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  22  import com.dtstack.flink.sql.side.BaseAllReqRow;                                                                  </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  23  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  24  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="388410541738591361" onmouseenter="enter('388410541738591361');" onmouseout="out('388410541738591361');" style="">  25  import com.dtstack.flink.sql.side.elasticsearch6.table.Elasticsearch6SideTableInfo;                               </span>
<span class="290690444034872857" onmouseenter="enter('290690444034872857');" onmouseout="out('290690444034872857');" style="">  26  import com.dtstack.flink.sql.side.elasticsearch6.util.Es6Util;                                                    </span>
<span class="5967037440424460461" onmouseenter="enter('5967037440424460461');" onmouseout="out('5967037440424460461');" style="">  27  import com.dtstack.flink.sql.side.elasticsearch6.util.SwitchUtil;                                                 </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  28  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  29  import com.google.common.collect.Maps;                                                                            </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  30  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  31  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  32  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="">  33  import org.apache.flink.table.runtime.types.CRow;                                                                 </span>

<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  34  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  35  import org.apache.flink.types.Row;                                                                                </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  36  import org.apache.flink.util.Collector;                                                                           </span>
<span class="-5662954158270406888" onmouseenter="enter('-5662954158270406888');" onmouseout="out('-5662954158270406888');" style="">  37  import org.elasticsearch.action.search.SearchRequest;                                                             </span>
<span class="7546585836699577478" onmouseenter="enter('7546585836699577478');" onmouseout="out('7546585836699577478');" style="">  38  import org.elasticsearch.action.search.SearchResponse;                                                            </span>
<span class="-1439206680157962857" onmouseenter="enter('-1439206680157962857');" onmouseout="out('-1439206680157962857');" style="">  39  import org.elasticsearch.client.RequestOptions;                                                                   </span>
<span class="-7957925609215861115" onmouseenter="enter('-7957925609215861115');" onmouseout="out('-7957925609215861115');" style="">  40  import org.elasticsearch.client.RestHighLevelClient;                                                              </span>
<span class="-3798447231110012333" onmouseenter="enter('-3798447231110012333');" onmouseout="out('-3798447231110012333');" style="">  41  import org.elasticsearch.index.query.BoolQueryBuilder;                                                            </span>
<span class="4378821268051739093" onmouseenter="enter('4378821268051739093');" onmouseout="out('4378821268051739093');" style="">  42  import org.elasticsearch.search.SearchHit;                                                                        </span>
<span class="-2631063383852475600" onmouseenter="enter('-2631063383852475600');" onmouseout="out('-2631063383852475600');" style="">  43  import org.elasticsearch.search.builder.SearchSourceBuilder;                                                      </span>
<span class="-9133781105073271748" onmouseenter="enter('-9133781105073271748');" onmouseout="out('-9133781105073271748');" style="">  44  import org.elasticsearch.search.sort.SortOrder;                                                                   </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  45  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  46  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  47                                                                                                                    </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  48  import java.io.IOException;                                                                                       </span>
<span class="5998602906817463685" onmouseenter="enter('5998602906817463685');" onmouseout="out('5998602906817463685');" style="">  49  import java.io.Serializable;                                                                                      </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  50  import java.sql.Timestamp;                                                                                        </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  51  import java.util.Calendar;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  52  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  53  import java.util.Map;                                                                                             </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  54  import java.util.concurrent.atomic.AtomicReference;                                                               </span>
<span  style="">  55                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56  /**                                                                                                               </span>
<span class="5111762851773435404" onmouseenter="enter('5111762851773435404');" onmouseout="out('5111762851773435404');" style="">  57   * @author yinxi                                                                                                  </span>
<span class="9159416879699011666" onmouseenter="enter('9159416879699011666');" onmouseout="out('9159416879699011666');" style="">  58   * @date 2020/1/13 - 1:00                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  59   */                                                                                                               </span>
<span class="5844733793981427955" onmouseenter="enter('5844733793981427955');" onmouseout="out('5844733793981427955');" style="">  60  public class Elasticsearch6AllReqRow extends BaseAllReqRow implements Serializable {                              </span>
<span  style="">  61                                                                                                                    </span>
<span class="-7348129739479646471" onmouseenter="enter('-7348129739479646471');" onmouseout="out('-7348129739479646471');" style="">  62      private static final Logger LOG = LoggerFactory.getLogger(Elasticsearch6AllReqRow.class);                     </span>
<span  style="">  63                                                                                                                    </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  64      private static final int CONN_RETRY_NUM = 3;                                                                  </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  65      private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();           </span>
<span class="-7435725468078760432" onmouseenter="enter('-7435725468078760432');" onmouseout="out('-7435725468078760432');" style="">  66      private transient RestHighLevelClient rhlClient;                                                              </span>
<span class="941714068177323601" onmouseenter="enter('941714068177323601');" onmouseout="out('941714068177323601');" style="">  67      private SearchRequest searchRequest;                                                                          </span>
<span class="-3071210506994519965" onmouseenter="enter('-3071210506994519965');" onmouseout="out('-3071210506994519965');" style="">  68      private BoolQueryBuilder boolQueryBuilder;                                                                    </span>
<span  style="">  69                                                                                                                    </span>
<span class="1319002072473948640" onmouseenter="enter('1319002072473948640');" onmouseout="out('1319002072473948640');" style=""><abbr title="  70      public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  70      public Elasticsearch6AllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Aüîµ</abbr></span>
<span class="3324474204197455744" onmouseenter="enter('3324474204197455744');" onmouseout="out('3324474204197455744');" style="">  71          super(new Elasticsearch6AllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72      }                                                                                                             </span>
<span  style="">  73                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74      @Override                                                                                                     </span>
<span class="-8452891775464581011" onmouseenter="enter('-8452891775464581011');" onmouseout="out('-8452891775464581011');" style="">  75      public void flatMap(CRow value, Collector&lt;CRow&gt; out) throws Exception {                                       </span>

<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style="">  76          List&lt;Object&gt; inputParams = Lists.newArrayList();                                                          </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style="">  77          for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                                 </span>
<span class="2735827600528721418" onmouseenter="enter('2735827600528721418');" onmouseout="out('2735827600528721418');" style="">  78              Object equalObj = value.row().getField(conValIndex);                                                  </span>

<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style="">  79              if (equalObj == null) {                                                                               </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  80                  sendOutputRow(value, null, out);                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  81                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82              }                                                                                                     </span>
<span  style="">  83                                                                                                                    </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style="">  84              inputParams.add(equalObj);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85          }                                                                                                         </span>
<span  style="">  86                                                                                                                    </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style="">  87          String key = buildKey(inputParams);                                                                       </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style="">  88          List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                            </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style="">  89          if (CollectionUtils.isEmpty(cacheList)) {                                                                 </span>
<span class="-3887405038719950777" onmouseenter="enter('-3887405038719950777');" onmouseout="out('-3887405038719950777');" style="">  90              sendOutputRow(value, null, out);                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="">  91              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92          }                                                                                                         </span>
<span  style="">  93                                                                                                                    </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style="">  94          for (Map&lt;String, Object&gt; one : cacheList) {                                                               </span>
<span class="7685661371746735414" onmouseenter="enter('7685661371746735414');" onmouseout="out('7685661371746735414');" style="">  95              sendOutputRow(value, one, out);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97      }                                                                                                             </span>
<span  style="">  98                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -    @Override                                                                                                     </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -    public Row fillData(Row input, Object sideInput) {                                                            </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -        Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                          </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -        Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -        for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -            Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 105 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 105 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfoüîµ</abbr></span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -                                                                                                                  </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 107 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 107 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL timüîµ</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -            if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -                //ÂéªÈô§‰∏ä‰∏ÄÂ±ÇOutputRowtimeProcessFunction Ë∞ÉÁî®Êó∂Âå∫ÂØºËá¥ÁöÑÂΩ±Âìç                                                     </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -                obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -                                                                                                                  </span>


<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -                                                                                                                  </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -            row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -                                                                                                                  </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -        for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {                    </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -            if (cacheInfo == null) {                                                                              </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -                row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -            } else {                                                                                              </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -                row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 122 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -                                                                                                                  </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -        return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -                                                                                                                  </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 128      private String buildKey(List&lt;Object&gt; equalValList) {                                                          </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 129          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 130          for (Object equalVal : equalValList) {                                                                    </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 131              sb.append(equalVal).append(&quot;_&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132          }                                                                                                         </span>
<span  style=""> 133                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 134          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135      }                                                                                                             </span>
<span  style=""> 136                                                                                                                    </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 137      private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                               </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 138          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 139          for (String equalField : equalFieldList) {                                                                </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 140              sb.append(val.get(equalField)).append(&quot;_&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141          }                                                                                                         </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 143          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144      }                                                                                                             </span>
<span  style=""> 145                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 146      @Override                                                                                                     </span>
<span class="-7394496570177698356" onmouseenter="enter('-7394496570177698356');" onmouseout="out('-7394496570177698356');" style=""> 147      protected void initCache() {                                                                                  </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 148          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 149          cacheRef.set(newCache);                                                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 150          try {                                                                                                     </span>
<span class="674709874682000492" onmouseenter="enter('674709874682000492');" onmouseout="out('674709874682000492');" style=""> 151              // create search request and build where cause                                                        </span>
<span class="5314623451052488943" onmouseenter="enter('5314623451052488943');" onmouseout="out('5314623451052488943');" style=""> 152              searchRequest = Es6Util.setSearchRequest(sideInfo);                                                   </span>
<span class="6145103519064773487" onmouseenter="enter('6145103519064773487');" onmouseout="out('6145103519064773487');" style=""> 153              boolQueryBuilder = Es6Util.setPredicateclause(sideInfo);                                              </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 154              loadData(newCache);                                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 155          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 156              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 157              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159      }                                                                                                             </span>
<span  style=""> 160                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 161      @Override                                                                                                     </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 162      protected void reloadCache() {                                                                                </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 163          //reload cacheRef and replace to old cacheRef                                                             </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 164          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 165          try {                                                                                                     </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 166              loadData(newCache);                                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 167          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 168              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 169              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170          }                                                                                                         </span>
<span  style=""> 171                                                                                                                    </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 172          cacheRef.set(newCache);                                                                                   </span>
<span class="6843412230405095659" onmouseenter="enter('6843412230405095659');" onmouseout="out('6843412230405095659');" style=""> 173          LOG.info(&quot;----- elasticsearch6 all cacheRef reload end:{}&quot;, Calendar.getInstance());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174      }                                                                                                             </span>
<span  style=""> 175                                                                                                                    </span>
<span class="6000828278631814031" onmouseenter="enter('6000828278631814031');" onmouseout="out('6000828278631814031');" style=""> 176      private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws IOException {                   </span>
<span class="-6049088456160341398" onmouseenter="enter('-6049088456160341398');" onmouseout="out('-6049088456160341398');" style=""> 177          Elasticsearch6SideTableInfo tableInfo = (Elasticsearch6SideTableInfo) sideInfo.getSideTableInfo();        </span>
<span  style=""> 178                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 179          try {                                                                                                     </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 180              for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 181                  try {                                                                                             </span>
<span class="-86728648582584645" onmouseenter="enter('-86728648582584645');" onmouseout="out('-86728648582584645');" style=""><abbr title=" 182                      rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInfo.getUserName(), tableInfo.getPassword());"> 182                      rhlClient = Es6Util.getClient(tableInfo.getAddress(), tableInfo.isAuthMesh(), tableInfo.getUseüîµ</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 183                      break;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 184                  } catch (Exception e) {                                                                           </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 185                      if (i == CONN_RETRY_NUM - 1) {                                                                </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 186                          throw new RuntimeException(&quot;&quot;, e);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187                      }                                                                                             </span>
<span  style=""> 188                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 189                      try {                                                                                         </span>
<span class="-7848393314785821372" onmouseenter="enter('-7848393314785821372');" onmouseout="out('-7848393314785821372');" style=""><abbr title=" 190                          String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.getUserName() + &quot;, pwd:&quot; + tableInfo.getPassword();"> 190                          String connInfo = &quot;url: &quot; + tableInfo.getAddress() + &quot;; userName: &quot; + tableInfo.getUserNamüîµ</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 191                          LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);            </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 192                          Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                                 </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 193                      } catch (InterruptedException e1) {                                                           </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 194                          LOG.error(&quot;&quot;, e1);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                  }                                                                                                 </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198              }                                                                                                     </span>
<span class="3043029469447425667" onmouseenter="enter('3043029469447425667');" onmouseout="out('3043029469447425667');" style=""> 199              SearchSourceBuilder searchSourceBuilder = initConfiguration(boolQueryBuilder);                        </span>
<span class="-3435762614644628348" onmouseenter="enter('-3435762614644628348');" onmouseout="out('-3435762614644628348');" style=""> 200              searchData(searchSourceBuilder, tmpCache);                                                            </span>
<span  style=""> 201                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 202          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 203              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 204              throw new RuntimeException(e);                                                                        </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 205          } finally {                                                                                               </span>
<span  style=""> 206                                                                                                                    </span>
<span class="-7971333903947873763" onmouseenter="enter('-7971333903947873763');" onmouseout="out('-7971333903947873763');" style=""> 207              if (rhlClient != null) {                                                                              </span>
<span class="-1010227642904461194" onmouseenter="enter('-1010227642904461194');" onmouseout="out('-1010227642904461194');" style=""> 208                  rhlClient.close();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211      }                                                                                                             </span>
<span  style=""> 212                                                                                                                    </span>
<span class="2269102045065714005" onmouseenter="enter('2269102045065714005');" onmouseout="out('2269102045065714005');" style=""> 213      // initialize searchSourceBuilder                                                                             </span>
<span class="-2224311872144648433" onmouseenter="enter('-2224311872144648433');" onmouseout="out('-2224311872144648433');" style=""> 214      private SearchSourceBuilder initConfiguration(BoolQueryBuilder boolQueryBuilder){                             </span>
<span class="-3057155605199132792" onmouseenter="enter('-3057155605199132792');" onmouseout="out('-3057155605199132792');" style=""> 215          SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();                                      </span>
<span class="5888509824421807900" onmouseenter="enter('5888509824421807900');" onmouseout="out('5888509824421807900');" style=""> 216          if (boolQueryBuilder != null) {                                                                           </span>
<span class="2112246244941479873" onmouseenter="enter('2112246244941479873');" onmouseout="out('2112246244941479873');" style=""> 217              searchSourceBuilder.query(boolQueryBuilder);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218          }                                                                                                         </span>
<span  style=""> 219                                                                                                                    </span>
<span class="9166141955334164362" onmouseenter="enter('9166141955334164362');" onmouseout="out('9166141955334164362');" style=""> 220          searchSourceBuilder.size(getFetchSize());                                                                 </span>
<span class="4871961152897776065" onmouseenter="enter('4871961152897776065');" onmouseout="out('4871961152897776065');" style=""> 221          searchSourceBuilder.sort(&quot;_id&quot;, SortOrder.DESC);                                                          </span>
<span  style=""> 222                                                                                                                    </span>
<span class="8838423000996937411" onmouseenter="enter('8838423000996937411');" onmouseout="out('8838423000996937411');" style=""> 223          // fields included in the source data                                                                     </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 224          String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);                  </span>
<span class="834931586921422776" onmouseenter="enter('834931586921422776');" onmouseout="out('834931586921422776');" style=""> 225          searchSourceBuilder.fetchSource(sideFieldNames, null);                                                    </span>
<span class="6987226028729546159" onmouseenter="enter('6987226028729546159');" onmouseout="out('6987226028729546159');" style=""> 226          return searchSourceBuilder;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227      }                                                                                                             </span>
<span  style=""> 228                                                                                                                    </span>
<span  style=""> 229                                                                                                                    </span>
<span class="-5770816861072855867" onmouseenter="enter('-5770816861072855867');" onmouseout="out('-5770816861072855867');" style=""><abbr title=" 230      private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {"> 230      private void searchData(SearchSourceBuilder searchSourceBuilder, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCacüîµ</abbr></span>
<span  style=""> 231                                                                                                                    </span>
<span class="-8453426813158434905" onmouseenter="enter('-8453426813158434905');" onmouseout="out('-8453426813158434905');" style=""> 232          Object[] searchAfterParameter = null;                                                                     </span>
<span class="-1026355603335276750" onmouseenter="enter('-1026355603335276750');" onmouseout="out('-1026355603335276750');" style=""> 233          SearchResponse searchResponse = null;                                                                     </span>
<span class="7944441773116551326" onmouseenter="enter('7944441773116551326');" onmouseout="out('7944441773116551326');" style=""> 234          SearchHit[] searchHits = null;                                                                            </span>
<span  style=""> 235                                                                                                                    </span>
<span class="-3127950886903104513" onmouseenter="enter('-3127950886903104513');" onmouseout="out('-3127950886903104513');" style=""> 236          while (true) {                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 237              try {                                                                                                 </span>
<span class="-8834251943337813063" onmouseenter="enter('-8834251943337813063');" onmouseout="out('-8834251943337813063');" style=""> 238                  if (searchAfterParameter != null) {                                                               </span>
<span class="-7450619709568283762" onmouseenter="enter('-7450619709568283762');" onmouseout="out('-7450619709568283762');" style=""> 239                      // set search mark                                                                            </span>
<span class="-1605613418950762671" onmouseenter="enter('-1605613418950762671');" onmouseout="out('-1605613418950762671');" style=""> 240                      searchSourceBuilder.searchAfter(searchAfterParameter);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241                  }                                                                                                 </span>
<span  style=""> 242                                                                                                                    </span>
<span class="-1428606878545121206" onmouseenter="enter('-1428606878545121206');" onmouseout="out('-1428606878545121206');" style=""> 243                  searchRequest.source(searchSourceBuilder);                                                        </span>
<span class="7835248494248469019" onmouseenter="enter('7835248494248469019');" onmouseout="out('7835248494248469019');" style=""> 244                  searchResponse = rhlClient.search(searchRequest, RequestOptions.DEFAULT);                         </span>
<span class="-5450331146729317410" onmouseenter="enter('-5450331146729317410');" onmouseout="out('-5450331146729317410');" style=""> 245                  searchHits = searchResponse.getHits().getHits();                                                  </span>
<span class="4838685550122638048" onmouseenter="enter('4838685550122638048');" onmouseout="out('4838685550122638048');" style=""> 246                  loadToCache(searchHits, tmpCache);                                                                </span>
<span  style=""> 247                                                                                                                    </span>
<span class="1973318889644552850" onmouseenter="enter('1973318889644552850');" onmouseout="out('1973318889644552850');" style=""> 248                  if (searchHits.length &lt; getFetchSize()) {                                                         </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 249                      break;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250                  }                                                                                                 </span>
<span  style=""> 251                                                                                                                    </span>
<span class="7053413659196757604" onmouseenter="enter('7053413659196757604');" onmouseout="out('7053413659196757604');" style=""> 252                  searchAfterParameter = searchHits[searchHits.length - 1].getSortValues();                         </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style=""> 253              } catch (IOException e) {                                                                             </span>
<span class="-2611542528459573797" onmouseenter="enter('-2611542528459573797');" onmouseout="out('-2611542528459573797');" style=""> 254                  LOG.error(&quot;Query failed!&quot;, e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257      }                                                                                                             </span>
<span  style=""> 258                                                                                                                    </span>
<span class="6185545389876623927" onmouseenter="enter('6185545389876623927');" onmouseout="out('6185545389876623927');" style=""> 259      // data load to cache                                                                                         </span>
<span class="-1880698783322592076" onmouseenter="enter('-1880698783322592076');" onmouseout="out('-1880698783322592076');" style=""> 260      private void loadToCache(SearchHit[] searchHits, Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {           </span>
<span class="8809866232242294416" onmouseenter="enter('8809866232242294416');" onmouseout="out('8809866232242294416');" style=""> 261          String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields().trim(), &quot;,&quot;);                  </span>
<span class="-4984551143623777064" onmouseenter="enter('-4984551143623777064');" onmouseout="out('-4984551143623777064');" style=""> 262          String[] sideFieldTypes = sideInfo.getSideTableInfo().getFieldTypes();                                    </span>
<span  style=""> 263                                                                                                                    </span>
<span class="4685904830571915876" onmouseenter="enter('4685904830571915876');" onmouseout="out('4685904830571915876');" style=""> 264          for (SearchHit searchHit : searchHits) {                                                                  </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 265              Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                                       </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 266              for (String fieldName : sideFieldNames) {                                                             </span>
<span class="751016650926868726" onmouseenter="enter('751016650926868726');" onmouseout="out('751016650926868726');" style=""> 267                  Object object = searchHit.getSourceAsMap().get(fieldName.trim());                                 </span>
<span class="-5554489446561494047" onmouseenter="enter('-5554489446561494047');" onmouseout="out('-5554489446561494047');" style=""> 268                  int fieldIndex = sideInfo.getSideTableInfo().getFieldList().indexOf(fieldName.trim());            </span>
<span class="-3781318186031183467" onmouseenter="enter('-3781318186031183467');" onmouseout="out('-3781318186031183467');" style=""> 269                  object = SwitchUtil.getTarget(object, sideFieldTypes[fieldIndex]);                                </span>
<span class="-1923378616241569286" onmouseenter="enter('-1923378616241569286');" onmouseout="out('-1923378616241569286');" style=""> 270                  oneRow.put(fieldName.trim(), object);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271              }                                                                                                     </span>
<span  style=""> 272                                                                                                                    </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 273              String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                                     </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""> 274              List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());     </span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 275              list.add(oneRow);                                                                                     </span>
<span  style=""> 276                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278      }                                                                                                             </span>
<span  style=""> 279                                                                                                                    </span>
<span class="-7768596139566319511" onmouseenter="enter('-7768596139566319511');" onmouseout="out('-7768596139566319511');" style=""> 280      public int getFetchSize() {                                                                                   </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style=""> 281          return 1000;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            